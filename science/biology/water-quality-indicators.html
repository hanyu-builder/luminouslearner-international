<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Quality Indicators Simulator | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Noto Sans', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Noto Sans', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        
        /* Custom range slider styling for dark mode */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #10b981; /* Emerald 500 */
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #334155; /* Slate 700 */
            border-radius: 2px;
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        .water-surface {
            background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion;

        // --- Icons ---
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- Data & Logic ---

        const SPECIES_DATA = [
            {
                id: 'stonefly',
                name: 'Stonefly Nymph',
                description: 'Highly sensitive. Found only in very clean, high oxygen water.',
                pollutionTolerance: 'Very Low',
                minDO: 8,
                maxNitrate: 5,
                phRange: [6.5, 7.5],
                image: (color) => (
                    <svg viewBox="0 0 24 24" width="32" height="32" stroke={color} fill="none" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M12 2L12 22" />
                        <path d="M12 6L8 4" />
                        <path d="M12 6L16 4" />
                        <path d="M12 10L6 8" />
                        <path d="M12 10L18 8" />
                        <path d="M12 16L9 20" />
                        <path d="M12 16L15 20" />
                    </svg>
                )
            },
            {
                id: 'mayfly',
                name: 'Mayfly Nymph',
                description: 'Sensitive. Requires clean water with low pollution.',
                pollutionTolerance: 'Low',
                minDO: 6,
                maxNitrate: 15,
                phRange: [6.0, 8.0],
                image: (color) => (
                    <svg viewBox="0 0 24 24" width="32" height="32" stroke={color} fill="none" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <path d="M12 4l-4 6 4 2 4-2-4-6z"></path>
                        <path d="M12 14l-3 4"></path>
                        <path d="M12 14l3 4"></path>
                        <line x1="12" y1="20" x2="9" y2="22"></line>
                        <line x1="12" y1="20" x2="15" y2="22"></line>
                    </svg>
                )
            },
            {
                id: 'shrimp',
                name: 'Freshwater Shrimp',
                description: 'Moderate tolerance. Can survive in slightly polluted water.',
                pollutionTolerance: 'Moderate',
                minDO: 4,
                maxNitrate: 30,
                phRange: [5.5, 8.5],
                image: (color) => (
                    <svg viewBox="0 0 24 24" width="32" height="32" stroke={color} fill="none" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M16 10a4 4 0 0 1-8 0c0-1.5 1-2.5 2-3s2 1.5 2 3"></path>
                        <path d="M8 10c0 2 1.5 3 4 3s4-1 4-3"></path>
                        <path d="M12 13v4"></path>
                        <path d="M10 21l2-4 2 4"></path>
                    </svg>
                )
            },
            {
                id: 'bloodworm',
                name: 'Bloodworm',
                description: 'High tolerance. Thrives in low oxygen and polluted water.',
                pollutionTolerance: 'High',
                minDO: 1,
                maxNitrate: 80,
                phRange: [4.0, 10.0],
                image: (color) => (
                    <svg viewBox="0 0 24 24" width="32" height="32" stroke={color} fill="none" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M19 5c-1.5 0-2.8.6-3.5 1.5A3.5 3.5 0 0 0 12 5a3.5 3.5 0 0 0-3.5 1.5A3.5 3.5 0 0 0 5 5"></path>
                        <path d="M12 19c2 0 3-1 3-3s-1-3-3-3-3 1-3 3 1 3 3 3z"></path>
                        <path d="M5 5c0 8 5 9 7 9s7-1 7-9"></path>
                    </svg>
                )
            },
            {
                id: 'rat_tailed_maggot',
                name: 'Rat-tailed Maggot',
                description: 'Very high tolerance. Survives in sewage and anaerobic conditions.',
                pollutionTolerance: 'Very High',
                minDO: 0,
                maxNitrate: 100,
                phRange: [3.0, 11.0],
                image: (color) => (
                    <svg viewBox="0 0 24 24" width="32" height="32" stroke={color} fill="none" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <ellipse cx="12" cy="10" rx="5" ry="7"></ellipse>
                        <path d="M12 17s2 5 8 5"></path>
                        <line x1="12" y1="3" x2="12" y2="3.01"></line>
                    </svg>
                )
            }
        ];

        // --- Components ---

        const Header = () => (
            <header className="bg-slate-900 border-b border-slate-800 text-white shadow-lg">
                <div className="container mx-auto px-4 py-4 flex justify-between items-center">
                    <div className="flex items-center space-x-3">
                        <div className="bg-slate-800 p-2 rounded-full text-emerald-400 border border-slate-700">
                            <Icon name="droplets" size={24} />
                        </div>
                        <div>
                            <h1 className="text-xl font-bold tracking-tight">Water Quality Simulator</h1>
                        </div>
                    </div>
                </div>
            </header>
        );

        const ControlPanel = ({ params, setParams, resetParams }) => {
            const handleChange = (key, value) => {
                setParams(prev => ({ ...prev, [key]: parseFloat(value) }));
            };

            return (
                <div className="bg-slate-900 p-6 rounded-xl shadow-lg border border-slate-800 h-full">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-lg font-semibold text-slate-100 flex items-center">
                            <Icon name="flask-conical" className="mr-2 text-emerald-500" size={20} />
                            Parameters
                        </h2>
                        <button 
                            onClick={resetParams}
                            className="text-xs flex items-center text-slate-400 hover:text-emerald-400 transition-colors"
                        >
                            <Icon name="rotate-ccw" size={14} className="mr-1" /> Reset
                        </button>
                    </div>

                    <div className="space-y-6">
                        {/* Dissolved Oxygen */}
                        <div>
                            <div className="flex justify-between mb-2">
                                <label className="text-sm font-medium text-slate-300">Dissolved Oxygen</label>
                                <span className={`text-sm font-bold ${params.dissolvedOxygen > 6 ? 'text-emerald-400' : 'text-red-400'}`}>
                                    {params.dissolvedOxygen.toFixed(1)} mg/L
                                </span>
                            </div>
                            <input 
                                type="range" min="0" max="12" step="0.1"
                                value={params.dissolvedOxygen}
                                onChange={(e) => handleChange('dissolvedOxygen', e.target.value)}
                            />
                            <div className="flex justify-between text-xs text-slate-500 mt-1">
                                <span>Anoxic (0)</span>
                                <span>Saturated (12)</span>
                            </div>
                        </div>

                        {/* Nitrate */}
                        <div>
                            <div className="flex justify-between mb-2">
                                <label className="text-sm font-medium text-slate-300">Nitrate Level</label>
                                <span className={`text-sm font-bold ${params.nitrate < 10 ? 'text-emerald-400' : 'text-red-400'}`}>
                                    {params.nitrate} ppm
                                </span>
                            </div>
                            <input 
                                type="range" min="0" max="100" step="1"
                                value={params.nitrate}
                                onChange={(e) => handleChange('nitrate', e.target.value)}
                            />
                             <div className="flex justify-between text-xs text-slate-500 mt-1">
                                <span>Clean (0)</span>
                                <span>Eutrophic (100)</span>
                            </div>
                        </div>

                        {/* pH Level */}
                        <div>
                            <div className="flex justify-between mb-2">
                                <label className="text-sm font-medium text-slate-300">pH Level</label>
                                <span className={`text-sm font-bold ${Math.abs(params.ph - 7) < 1 ? 'text-emerald-400' : 'text-red-400'}`}>
                                    {params.ph.toFixed(1)}
                                </span>
                            </div>
                            <input 
                                type="range" min="0" max="14" step="0.1"
                                value={params.ph}
                                onChange={(e) => handleChange('ph', e.target.value)}
                            />
                            <div className="bg-gradient-to-r from-red-500 via-green-500 to-blue-500 h-1 rounded-full mt-2 opacity-50"></div>
                             <div className="flex justify-between text-xs text-slate-500 mt-1">
                                <span>Acidic (0)</span>
                                <span>Alkaline (14)</span>
                            </div>
                        </div>

                        {/* Turbidity */}
                        <div>
                            <div className="flex justify-between mb-2">
                                <label className="text-sm font-medium text-slate-300">Turbidity</label>
                                <span className="text-sm font-bold text-slate-400">
                                    {params.turbidity}%
                                </span>
                            </div>
                            <input 
                                type="range" min="0" max="100" step="1"
                                value={params.turbidity}
                                onChange={(e) => handleChange('turbidity', e.target.value)}
                            />
                            <div className="flex justify-between text-xs text-slate-500 mt-1">
                                <span>Clear (0)</span>
                                <span>Cloudy (100)</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const RiverSimulation = ({ params, activeSpecies }) => {
            // Calculate visual parameters based on state
            const waterColor = useMemo(() => {
                // Base blue - slightly darker/richer for dark mode integration
                let r = 20, g = 100, b = 200;
                
                // Nitrate adds green (Algae bloom)
                if (params.nitrate > 20) {
                    r += (params.nitrate * 0.5);
                    g += (params.nitrate * 1.5);
                    b -= (params.nitrate * 1.5);
                }

                // Turbidity adds brown/grey
                const mudFactor = params.turbidity / 100;
                r = r * (1 - mudFactor) + 100 * mudFactor;
                g = g * (1 - mudFactor) + 80 * mudFactor;
                b = b * (1 - mudFactor) + 50 * mudFactor;

                // pH extreme shifts (Acid red, Base blue/purple) - subtle tint
                if (params.ph < 5) r += (5 - params.ph) * 30;
                if (params.ph > 9) b += (params.ph - 9) * 20;

                return `rgb(${Math.min(255, Math.max(0, r))}, ${Math.min(255, Math.max(0, g))}, ${Math.min(255, Math.max(0, b))})`;
            }, [params]);

            return (
                <div className="bg-slate-900 p-4 rounded-xl shadow-lg border border-slate-800 relative overflow-hidden h-96 md:h-auto min-h-[400px]">
                    <h2 className="absolute top-4 left-4 z-20 bg-slate-900/80 backdrop-blur px-3 py-1 rounded-full text-sm font-bold text-slate-200 border border-slate-700 flex items-center">
                        <Icon name="fish" className="mr-2 text-sky-400" size={16} />
                        River Ecosystem View
                    </h2>

                    {/* Sky/Background - Dark mode sky */}
                    <div className="absolute inset-0 bg-slate-800 z-0 bg-gradient-to-b from-slate-900 to-slate-800"></div>
                    
                    {/* River Bed - Darker stones */}
                    <div className="absolute bottom-0 w-full h-1/4 bg-stone-800 z-0 flex items-end justify-center opacity-80" 
                         style={{ backgroundImage: 'radial-gradient(circle, #44403c 10%, transparent 10%)', backgroundSize: '20px 20px' }}>
                    </div>

                    {/* Water Body */}
                    <div 
                        className="absolute inset-x-0 bottom-0 h-3/4 transition-colors duration-1000 z-10 water-surface"
                        style={{ backgroundColor: waterColor, opacity: 0.85 }}
                    >
                         {/* Bubble Animation for DO */}
                         {Array.from({ length: Math.floor(params.dissolvedOxygen * 2) }).map((_, i) => (
                            <div key={`bubble-${i}`} 
                                 className="absolute bg-white/20 rounded-full animate-float"
                                 style={{
                                     width: Math.random() * 8 + 2 + 'px',
                                     height: Math.random() * 8 + 2 + 'px',
                                     left: Math.random() * 100 + '%',
                                     bottom: Math.random() * 100 + '%',
                                     animationDuration: Math.random() * 2 + 2 + 's',
                                     animationDelay: Math.random() * 2 + 's'
                                 }}
                            />
                        ))}

                        {/* Algae overlay for Nitrate */}
                        {params.nitrate > 40 && (
                            <div className="absolute inset-0 bg-green-900/60 mix-blend-overlay transition-opacity duration-1000 pointer-events-none"
                                 style={{ opacity: (params.nitrate - 40) / 100 }}>
                            </div>
                        )}
                    </div>

                    {/* Species Rendering */}
                    <div className="absolute inset-0 z-20 pointer-events-none">
                        <AnimatePresence>
                            {activeSpecies.map((species) => (
                                 Array.from({ length: 3 }).map((_, i) => ( // Render 3 of each active species
                                    <motion.div key={`${species.id}-${i}`} 
                                         className="absolute transition-all duration-700 ease-in-out"
                                         initial={{ opacity: 0, scale: 0 }}
                                         animate={{ opacity: 1, scale: 0.8 }}
                                         exit={{ opacity: 0, scale: 0 }}
                                         style={{
                                             left: `${10 + (i * 30) + (Math.random() * 10)}%`,
                                             top: `${40 + (i * 15) + (Math.random() * 20)}%`
                                         }}>
                                        <div className="animate-float" style={{ animationDelay: `${i * 0.5}s` }}>
                                            {species.image(params.nitrate > 50 ? '#1e293b' : '#cffafe')}
                                            <div className="text-[10px] bg-slate-900/70 text-slate-200 px-1 rounded text-center mt-1 font-bold whitespace-nowrap shadow-sm backdrop-blur-sm border border-slate-700/50">
                                                {species.name.split(' ')[0]}
                                            </div>
                                        </div>
                                    </motion.div>
                                ))
                            ))}
                        </AnimatePresence>
                        
                        {activeSpecies.length === 0 && (
                            <div className="absolute inset-0 flex items-center justify-center">
                                <div className="bg-red-900/80 p-6 rounded-xl text-center backdrop-blur-sm border border-red-700/50 shadow-2xl">
                                    <Icon name="alert-triangle" className="mx-auto text-red-400 mb-2" size={32} />
                                    <p className="text-red-100 font-bold text-lg">No Survival</p>
                                    <p className="text-red-300 text-sm">Water conditions are lethal.</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const SpeciesInfo = ({ speciesList, currentParams }) => {
            return (
                <div className="bg-slate-900 p-6 rounded-xl shadow-lg border border-slate-800 mt-6">
                    <h2 className="text-lg font-semibold text-slate-100 mb-4 flex items-center">
                        <Icon name="bug" className="mr-2 text-emerald-500" size={20} />
                        Indicator Species Guide
                    </h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                        {SPECIES_DATA.map((species) => {
                            const isAlive = speciesList.some(s => s.id === species.id);
                            return (
                                <div key={species.id} className={`p-4 rounded-lg border transition-all duration-300 ${isAlive ? 'bg-emerald-950/30 border-emerald-800 shadow-emerald-900/20 shadow-lg' : 'bg-slate-800/50 border-slate-800 opacity-50 grayscale'}`}>
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="p-2 bg-slate-800 rounded-full border border-slate-700">
                                            {species.image(isAlive ? '#34d399' : '#94a3b8')}
                                        </div>
                                        {isAlive && <span className="px-2 py-0.5 bg-emerald-900/60 text-emerald-400 text-[10px] rounded-full font-bold border border-emerald-800/50">Active</span>}
                                    </div>
                                    <h3 className="font-bold text-sm mb-1 text-slate-200">{species.name}</h3>
                                    <p className="text-xs text-slate-400 mb-3 leading-relaxed min-h-[40px]">{species.description}</p>
                                    <div className="space-y-1.5 pt-2 border-t border-slate-700/50">
                                        <div className="flex justify-between text-[10px] text-slate-500">
                                            <span>Tolerance:</span>
                                            <span className="font-medium text-slate-300">{species.pollutionTolerance}</span>
                                        </div>
                                        <div className="flex justify-between text-[10px] text-slate-500">
                                            <span>Min DO:</span>
                                            <span className={`font-medium ${currentParams.dissolvedOxygen < species.minDO ? 'text-red-400' : 'text-emerald-400'}`}>{species.minDO} mg/L</span>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [params, setParams] = useState({
                dissolvedOxygen: 9.0, // mg/L
                nitrate: 5,           // ppm
                ph: 7.2,
                turbidity: 5          // percentage
            });

            // Logic to determine which species can survive
            const activeSpecies = useMemo(() => {
                return SPECIES_DATA.filter(species => {
                    const doOk = params.dissolvedOxygen >= species.minDO;
                    const nitrateOk = params.nitrate <= species.maxNitrate;
                    const phOk = params.ph >= species.phRange[0] && params.ph <= species.phRange[1];
                    // High turbidity hurts sensitive species (simple rule)
                    const turbidityOk = species.pollutionTolerance === 'Very Low' || species.pollutionTolerance === 'Low' 
                                        ? params.turbidity < 40 
                                        : true;

                    return doOk && nitrateOk && phOk && turbidityOk;
                });
            }, [params]);

            // Determine overall water quality status
            const qualityStatus = useMemo(() => {
                const score = activeSpecies.length;
                if (score >= 4) return { text: "Excellent", color: "text-emerald-400", bg: "bg-emerald-950/50", border: "border-emerald-900" };
                if (score >= 2) return { text: "Fair", color: "text-yellow-400", bg: "bg-yellow-950/50", border: "border-yellow-900" };
                return { text: "Poor", color: "text-red-400", bg: "bg-red-950/50", border: "border-red-900" };
            }, [activeSpecies]);

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    <Header />
                    
                    <main className="flex-grow container mx-auto p-4 md:p-6 max-w-7xl">
                        {/* Status Bar */}
                        <div className="mb-6 bg-slate-900 p-4 rounded-xl shadow-lg border border-slate-800 flex flex-col sm:flex-row items-center justify-between gap-4">
                            <div className="flex items-center space-x-4 w-full sm:w-auto">
                                <div className={`p-3 rounded-lg ${qualityStatus.bg} ${qualityStatus.color} border ${qualityStatus.border}`}>
                                    <Icon name="alert-triangle" size={24} />
                                </div>
                                <div>
                                    <p className="text-xs text-slate-500 font-bold uppercase tracking-wider">Overall Quality</p>
                                    <p className={`text-2xl font-bold ${qualityStatus.color}`}>{qualityStatus.text}</p>
                                </div>
                            </div>
                            <div className="w-full sm:w-auto bg-slate-800 px-5 py-3 rounded-lg border border-slate-700 flex items-center justify-between sm:justify-center space-x-3">
                                <span className="text-sm text-slate-400 font-medium">Biodiversity Index</span>
                                <span className="text-xl font-bold text-white bg-slate-700 px-3 py-1 rounded">
                                    {activeSpecies.length} <span className="text-slate-500 text-sm font-normal">/ {SPECIES_DATA.length}</span>
                                </span>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Left: Simulation View */}
                            <div className="lg:col-span-2">
                                <RiverSimulation params={params} activeSpecies={activeSpecies} />
                            </div>

                            {/* Right: Controls */}
                            <div className="lg:col-span-1">
                                <ControlPanel 
                                    params={params} 
                                    setParams={setParams} 
                                    resetParams={() => setParams({ dissolvedOxygen: 9.0, nitrate: 5, ph: 7.2, turbidity: 5 })}
                                />
                            </div>
                        </div>

                        {/* Bottom: Info Cards */}
                        <SpeciesInfo speciesList={activeSpecies} currentParams={params} />
                        
                        <div className="mt-8 text-center text-slate-500 text-xs">
                            <p>This simulation simplifies ecosystem complexity to demonstrate the impact of water parameters on indicator species.</p>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
