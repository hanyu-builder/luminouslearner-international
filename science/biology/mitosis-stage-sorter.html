<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitosis Stage Sorter | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow-y: auto; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Card Styling */
        .stage-card { 
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s; 
            cursor: grab; 
        }
        .stage-card:active { cursor: grabbing; }
        .stage-card.dragging { opacity: 0.5; border: 2px dashed #94a3b8; }
        
        /* Success Animation */
        .success-ring { animation: ring 0.5s ease-out; }
        @keyframes ring { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 100% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- CELL SVGs ---
        const InterphaseSVG = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                <circle cx="50" cy="50" r="45" fill="#fef2f2" stroke="#ef4444" strokeWidth="2"/>
                <circle cx="50" cy="50" r="20" fill="#fee2e2" stroke="#991b1b" strokeWidth="1" strokeDasharray="2,2"/>
                {/* Chromatin (messy lines) */}
                <path d="M40 40 Q 50 30 60 40 T 50 60" fill="none" stroke="#b91c1c" strokeWidth="1"/>
                <path d="M35 50 Q 45 60 55 50" fill="none" stroke="#b91c1c" strokeWidth="1"/>
            </svg>
        );
        const ProphaseSVG = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                <circle cx="50" cy="50" r="45" fill="#fef2f2" stroke="#ef4444" strokeWidth="2"/>
                <circle cx="50" cy="50" r="25" fill="none" stroke="#991b1b" strokeWidth="1" strokeDasharray="4,4" opacity="0.5"/>
                {/* Condensed Chromosomes (X shapes) */}
                <path d="M40 40 L 60 60 M 60 40 L 40 60" stroke="#b91c1c" strokeWidth="3" strokeLinecap="round"/>
                <path d="M30 50 L 50 70 M 50 50 L 30 70" stroke="#b91c1c" strokeWidth="3" strokeLinecap="round"/>
            </svg>
        );
        const MetaphaseSVG = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                <circle cx="50" cy="50" r="45" fill="#fef2f2" stroke="#ef4444" strokeWidth="2"/>
                {/* Spindle Fibers */}
                <line x1="50" y1="5" x2="50" y2="95" stroke="#cbd5e1" strokeWidth="1"/>
                <line x1="30" y1="10" x2="30" y2="90" stroke="#cbd5e1" strokeWidth="1"/>
                <line x1="70" y1="10" x2="70" y2="90" stroke="#cbd5e1" strokeWidth="1"/>
                {/* Chromosomes Aligned */}
                <path d="M25 50 L 45 50 M 35 40 L 35 60" stroke="#b91c1c" strokeWidth="3" strokeLinecap="round" transform="rotate(90 35 50)"/>
                <path d="M40 50 L 60 50 M 50 40 L 50 60" stroke="#b91c1c" strokeWidth="3" strokeLinecap="round" transform="rotate(90 50 50)"/>
                <path d="M55 50 L 75 50 M 65 40 L 65 60" stroke="#b91c1c" strokeWidth="3" strokeLinecap="round" transform="rotate(90 65 50)"/>
            </svg>
        );
        const AnaphaseSVG = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                <ellipse cx="50" cy="50" rx="35" ry="48" fill="#fef2f2" stroke="#ef4444" strokeWidth="2"/>
                {/* Chromatids Pulled Apart (< > shapes) */}
                <path d="M30 20 Q 35 25 30 30" stroke="#b91c1c" strokeWidth="3" fill="none"/>
                <path d="M50 20 Q 55 25 50 30" stroke="#b91c1c" strokeWidth="3" fill="none"/>
                <path d="M70 20 Q 75 25 70 30" stroke="#b91c1c" strokeWidth="3" fill="none"/>

                <path d="M30 80 Q 35 75 30 70" stroke="#b91c1c" strokeWidth="3" fill="none"/>
                <path d="M50 80 Q 55 75 50 70" stroke="#b91c1c" strokeWidth="3" fill="none"/>
                <path d="M70 80 Q 75 75 70 70" stroke="#b91c1c" strokeWidth="3" fill="none"/>
            </svg>
        );
        const TelophaseSVG = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                {/* Two Cells Forming */}
                <path d="M50 5 C 20 5 5 20 5 50 C 5 80 20 95 50 95 C 80 95 95 80 95 50 C 95 20 80 5 50 5 M 50 5 L 50 30 M 50 70 L 50 95" fill="#fef2f2" stroke="#ef4444" strokeWidth="2"/>
                {/* Nuclear Envelopes Reforming */}
                <circle cx="50" cy="25" r="15" fill="none" stroke="#991b1b" strokeDasharray="2,2"/>
                <circle cx="50" cy="75" r="15" fill="none" stroke="#991b1b" strokeDasharray="2,2"/>
                {/* Chromatin */}
                <path d="M45 25 Q 50 20 55 25" fill="none" stroke="#b91c1c" strokeWidth="1"/>
                <path d="M45 75 Q 50 80 55 75" fill="none" stroke="#b91c1c" strokeWidth="1"/>
            </svg>
        );

        // --- DATA ---
        const STAGES_DATA = [
            { id: '1', name: 'Interphase', desc: 'DNA replicates. Cell prepares for division.', Component: InterphaseSVG },
            { id: '2', name: 'Prophase', desc: 'Chromosomes condense. Nuclear membrane breaks down.', Component: ProphaseSVG },
            { id: '3', name: 'Metaphase', desc: 'Chromosomes align at the equator (middle).', Component: MetaphaseSVG },
            { id: '4', name: 'Anaphase', desc: 'Sister chromatids separate and move to opposite poles.', Component: AnaphaseSVG },
            { id: '5', name: 'Telophase', desc: 'Nuclear membranes reform. Cytokinesis begins.', Component: TelophaseSVG }
        ];

        // --- DRAGGABLE ITEM ---
        const DraggableItem = ({ data, index, dragging, onDragStart, onDragEnter, onDragEnd, showAnswer }) => {
            const { Component } = data;
            
            return (
                <div 
                    draggable
                    onDragStart={() => onDragStart(index)}
                    onDragEnter={() => onDragEnter(index)}
                    onDragEnd={onDragEnd}
                    onDragOver={(e) => e.preventDefault()} // Necessary to allow dropping
                    className={`stage-card bg-slate-800 border border-slate-700 rounded-xl p-4 flex flex-col items-center gap-3 select-none w-32 md:w-40 shrink-0 relative group
                        ${dragging ? 'dragging' : ''}
                    `}
                >
                    <div className="w-24 h-24 md:w-32 md:h-32 bg-white rounded-full overflow-hidden shadow-inner border-4 border-slate-200 pointer-events-none">
                        <Component />
                    </div>
                    
                    {/* Hidden Name (Reveal on Check) */}
                    <div className="text-center min-h-[3rem] flex items-center justify-center pointer-events-none">
                         {showAnswer ? (
                             <div className="animate-in fade-in zoom-in">
                                 <div className="text-xs font-bold text-white">{data.name}</div>
                             </div>
                         ) : (
                             <div className="w-8 h-1 bg-slate-700 rounded"></div>
                         )}
                    </div>
                    
                    <div className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity text-slate-500">
                         <Icon name="grip-vertical" size={16} />
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [items, setItems] = useState([]);
            const [isCorrect, setIsCorrect] = useState(false);
            const [checked, setChecked] = useState(false);
            const [feedback, setFeedback] = useState("");
            const dragItem = useRef(null);
            const dragOverItem = useRef(null);

            useEffect(() => {
                shuffle();
            }, []);

            const shuffle = () => {
                const shuffled = [...STAGES_DATA].sort(() => Math.random() - 0.5);
                setItems(shuffled);
                setChecked(false);
                setIsCorrect(false);
                setFeedback("");
            };

            // Native Drag and Drop Handlers
            const handleDragStart = (index) => {
                dragItem.current = index;
            };

            const handleDragEnter = (index) => {
                dragOverItem.current = index;
                
                // Reorder immediately for visual feedback
                const _items = [...items];
                const draggedItemContent = _items[dragItem.current];
                _items.splice(dragItem.current, 1);
                _items.splice(dragOverItem.current, 0, draggedItemContent);
                
                dragItem.current = index; // Update drag index to new position
                setItems(_items);
            };

            const handleDragEnd = () => {
                dragItem.current = null;
                dragOverItem.current = null;
            };

            const checkOrder = () => {
                const currentOrder = items.map(i => i.id).join(',');
                const correctOrder = "1,2,3,4,5";
                setChecked(true);
                
                if (currentOrder === correctOrder) {
                    setIsCorrect(true);
                    setFeedback("Perfect! You've mastered the cell cycle sequence.");
                } else {
                    setIsCorrect(false);
                    setFeedback("Not quite right. Remember: Interphase -> Pro -> Met -> Ana -> Telo.");
                }
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col items-center p-4 md:p-8">
                    
                    {/* Header */}
                    <div className="text-center mb-8 space-y-2">
                        <div className="inline-flex items-center justify-center p-3 bg-rose-600 rounded-xl shadow-lg shadow-rose-900/20 mb-2">
                            <Icon name="split" className="text-white" size={28} />
                        </div>
                        <h1 className="text-3xl md:text-4xl font-black text-white">Mitosis Sorter</h1>
                        <p className="text-slate-400 text-sm md:text-base">Drag and drop the stages into the correct chronological order.</p>
                    </div>

                    {/* Game Area */}
                    <div className="w-full max-w-5xl overflow-x-auto pb-4">
                        <div className="flex justify-center gap-4 min-w-max px-4">
                            {items.map((item, index) => (
                                <DraggableItem 
                                    key={item.id} // Stable key
                                    index={index}
                                    data={item} 
                                    showAnswer={checked}
                                    onDragStart={handleDragStart}
                                    onDragEnter={handleDragEnter}
                                    onDragEnd={handleDragEnd}
                                    dragging={false} // Visual state can be enhanced if needed
                                />
                            ))}
                        </div>
                    </div>

                    {/* Timeline Labels */}
                    <div className="w-full max-w-4xl flex justify-between text-[10px] font-bold text-slate-500 uppercase tracking-widest px-8 mt-2 mb-8">
                        <span>Start</span>
                        <span>&rarr; Time &rarr;</span>
                        <span>End</span>
                    </div>

                    {/* Controls & Feedback */}
                    <div className="flex flex-col items-center gap-6 w-full max-w-md">
                        
                        {!checked ? (
                            <button 
                                onClick={checkOrder}
                                className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-2xl shadow-xl shadow-blue-900/20 transition-all active:scale-95 flex items-center justify-center gap-2"
                            >
                                <Icon name="check-circle" /> Check Order
                            </button>
                        ) : (
                            <div className={`w-full p-6 rounded-2xl border text-center animate-in zoom-in ${isCorrect ? 'bg-emerald-900/30 border-emerald-500/50 success-ring' : 'bg-red-900/30 border-red-500/50'}`}>
                                <div className={`text-xl font-bold mb-2 ${isCorrect ? 'text-emerald-400' : 'text-red-400'}`}>
                                    {isCorrect ? 'Correct!' : 'Try Again'}
                                </div>
                                <p className="text-sm text-slate-300 mb-6">{feedback}</p>
                                <button 
                                    onClick={shuffle}
                                    className="px-6 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg font-bold text-white transition-colors flex items-center justify-center gap-2 mx-auto"
                                >
                                    <Icon name="rotate-ccw" size={16}/> Restart
                                </button>
                            </div>
                        )}

                    </div>

                    {/* Info Panel (Visible after check) */}
                    {checked && (
                        <div className="mt-12 grid grid-cols-1 md:grid-cols-5 gap-4 w-full max-w-5xl animate-in slide-in-from-bottom-8">
                            {STAGES_DATA.map((stage, i) => (
                                <div key={i} className="bg-slate-800/50 border border-slate-700 p-4 rounded-xl text-center">
                                    <div className="text-xs font-bold text-blue-400 mb-1">{i+1}. {stage.name.split(' ')[0]}</div>
                                    <p className="text-[10px] text-slate-400 leading-snug">{stage.desc}</p>
                                </div>
                            ))}
                        </div>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
