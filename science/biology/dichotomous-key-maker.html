<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dichotomous Key Maker | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Connector Lines for Tree View */
        .connector {
            position: absolute;
            background-color: #475569;
            z-index: 0;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    // Helper to convert kebab-case to PascalCase
                    const toPascalCase = (str) => str.replace(/(^\w|-\w)/g, (g) => g.replace(/-/, "").toUpperCase());
                    const pascalName = toPascalCase(name);
                    const iconData = window.lucide.icons[pascalName];
                    
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={`inline-block ${className}`} style={{width:size, height:size}}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- EXPANDED DATA ---
        const ORGANISMS = [
            // Vertebrates
            { id: 'cat', name: 'Cat', icon: 'cat', class: 'Mammal', traits: ['vertebrate', 'hair', 'milk'] },
            { id: 'bird', name: 'Sparrow', icon: 'bird', class: 'Bird', traits: ['vertebrate', 'feathers', 'wings'] },
            { id: 'turtle', name: 'Turtle', icon: 'shield', class: 'Reptile', traits: ['vertebrate', 'dry scales', 'shell'] }, 
            { id: 'frog', name: 'Frog', icon: 'flower', class: 'Amphibian', traits: ['vertebrate', 'moist skin', 'no scales'] }, 
            { id: 'fish', name: 'Goldfish', icon: 'fish', class: 'Fish', traits: ['vertebrate', 'wet scales', 'gills'] },
            
            // Invertebrates
            { id: 'butterfly', name: 'Butterfly', icon: 'wind', class: 'Insect', traits: ['invertebrate', 'wings', '6-legs'] }, 
            { id: 'spider', name: 'Spider', icon: 'bug', class: 'Arachnid', traits: ['invertebrate', '8-legs'] },
            { id: 'bee', name: 'Bee', icon: 'bug-off', class: 'Insect', traits: ['invertebrate', 'wings', '6-legs'] },
            { id: 'worm', name: 'Earthworm', icon: 'tornado', class: 'Annelid', traits: ['invertebrate', 'no-legs', 'segmented'] },
            { id: 'snail', name: 'Snail', icon: 'circle-dot', class: 'Mollusc', traits: ['invertebrate', 'shell', 'soft body'] }
        ];

        // Updated Initial Tree Structure
        const INITIAL_TREE = {
            id: 'root',
            question: 'Does it have a backbone (Vertebrate)?',
            yes: { 
                id: 'vert_node', 
                question: 'Does it have hair or fur?', 
                yes: 'cat', 
                no: {
                    id: 'non_mammal',
                    question: 'Does it have feathers?',
                    yes: 'bird',
                    no: {
                        id: 'scales_node',
                        question: 'Does it have dry scaly skin?',
                        yes: 'turtle',
                        no: {
                            id: 'water_node',
                            question: 'Does it live in water with gills?',
                            yes: 'fish',
                            no: 'frog'
                        }
                    }
                }
            },
            no: { 
                id: 'invert_node', 
                question: 'Does it have jointed legs?', 
                yes: { 
                    id: 'arthropod_node', 
                    question: 'Does it have 6 legs (Insect)?', 
                    yes: {
                        id: 'insect_node',
                        question: 'Does it have large colorful wings?',
                        yes: 'butterfly',
                        no: 'bee'
                    }, 
                    no: 'spider' 
                },
                no: {
                    id: 'worm_node',
                    question: 'Does it have a shell?',
                    yes: 'snail',
                    no: 'worm'
                }
            }
        };

        // --- COMPONENTS ---

        const OrganismCard = ({ id, isTarget = false }) => {
            const org = ORGANISMS.find(o => o.id === id);
            if (!org) return null;

            let displayIcon = org.icon;
            // Map generic icons if specific ones fail or for stylistic choice
            if (id === 'frog') displayIcon = 'meh'; 
            if (id === 'turtle') displayIcon = 'shield'; 
            if (id === 'snail') displayIcon = 'disc';
            if (id === 'butterfly') displayIcon = 'feather';

            return (
                <div className={`flex flex-col items-center gap-3 p-4 bg-slate-800 rounded-2xl border transition-all w-40 shadow-xl animate-in zoom-in
                    ${isTarget ? 'border-emerald-500 bg-emerald-900/20' : 'border-slate-700'}
                `}>
                    <div className={`w-16 h-16 rounded-full flex items-center justify-center text-white shadow-lg
                        ${isTarget ? 'bg-emerald-600' : 'bg-slate-700'}
                    `}>
                        <Icon name={displayIcon} size={32} />
                    </div>
                    <div className="text-center">
                        <span className="block text-sm font-bold text-white mb-1">{org.name}</span>
                        <span className="block text-[10px] font-mono text-emerald-400 bg-emerald-900/30 px-2 py-0.5 rounded-full border border-emerald-500/30">
                            {org.class}
                        </span>
                    </div>
                </div>
            );
        };

        // Interactive Step-by-Step Node
        const InteractiveNode = ({ node, onReset }) => {
            // If it's a leaf string, we found the organism
            if (typeof node === 'string') {
                return (
                    <div className="flex flex-col items-center justify-center h-full gap-6">
                        <div className="text-xl font-bold text-emerald-400 animate-bounce">Identification Complete!</div>
                        <OrganismCard id={node} isTarget={true} />
                        <button 
                            onClick={onReset}
                            className="mt-4 px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl text-white font-bold flex items-center gap-2 transition-all"
                        >
                            <Icon name="rotate-ccw" size={18}/> Start Over
                        </button>
                    </div>
                );
            }

            // Otherwise, it's a question node
            // We manage internal state to show only current question
            const [choice, setChoice] = useState(null); // 'yes' or 'no'

            if (choice === 'yes') {
                return <InteractiveNode node={node.yes} onReset={onReset} />;
            }
            if (choice === 'no') {
                return <InteractiveNode node={node.no} onReset={onReset} />;
            }

            return (
                <div className="flex flex-col items-center justify-center h-full max-w-2xl mx-auto animate-in fade-in slide-in-from-bottom-4">
                    <div className="w-full bg-slate-900 border border-blue-500/30 p-8 rounded-3xl shadow-2xl text-center">
                        <div className="text-xs font-bold text-blue-400 uppercase mb-4 tracking-widest">Diagnostic Question</div>
                        <h2 className="text-2xl md:text-3xl font-bold text-white mb-10 leading-tight">
                            {node.question}
                        </h2>
                        
                        <div className="grid grid-cols-2 gap-6">
                            <button 
                                onClick={() => setChoice('yes')}
                                className="py-6 rounded-2xl bg-emerald-600 hover:bg-emerald-500 text-white font-bold text-xl shadow-lg hover:scale-105 transition-all flex flex-col items-center gap-2 group"
                            >
                                <Icon name="check-circle" size={32} className="group-hover:animate-pulse"/>
                                YES
                            </button>
                            <button 
                                onClick={() => setChoice('no')}
                                className="py-6 rounded-2xl bg-red-600 hover:bg-red-500 text-white font-bold text-xl shadow-lg hover:scale-105 transition-all flex flex-col items-center gap-2 group"
                            >
                                <Icon name="x-circle" size={32} className="group-hover:animate-pulse"/>
                                NO
                            </button>
                        </div>
                    </div>
                    
                    <button 
                        onClick={onReset}
                        className="mt-12 text-slate-500 hover:text-slate-300 text-sm flex items-center gap-2"
                    >
                        <Icon name="rotate-ccw" size={14}/> Restart Key
                    </button>
                </div>
            );
        };

        // Original Tree Node (For Tree View Mode)
        const TreeNode = ({ node, depth = 0, path = [] }) => {
            if (typeof node === 'string') {
                const org = ORGANISMS.find(o => o.id === node);
                let displayIcon = org ? org.icon : 'help-circle';
                if (node === 'frog') displayIcon = 'meh'; 
                if (node === 'turtle') displayIcon = 'shield'; 
                if (node === 'snail') displayIcon = 'disc';
                if (node === 'butterfly') displayIcon = 'feather';

                return (
                    <div className="flex flex-col items-center mt-4 p-2 bg-slate-800 rounded-lg border border-slate-700 w-28">
                        <div className="w-8 h-8 rounded-full bg-emerald-900 text-emerald-400 flex items-center justify-center mb-1">
                            <Icon name={displayIcon} size={16} />
                        </div>
                        <span className="text-[10px] font-bold text-white">{org ? org.name : node}</span>
                        <span className="text-[8px] text-slate-400">{org ? org.class : ''}</span>
                    </div>
                );
            }

            return (
                <div className="flex flex-col items-center relative">
                    <div className="bg-slate-900 border border-slate-700 px-3 py-2 rounded text-[10px] font-bold mb-6 shadow whitespace-nowrap z-10">
                        {node.question}
                        <div className="absolute top-full left-1/2 w-px h-3 bg-slate-600 -translate-x-1/2"></div>
                        <div className="absolute top-[calc(100%+12px)] left-0 right-0 h-px bg-slate-600"></div>
                        <div className="absolute top-[calc(100%+12px)] left-0 w-px h-3 bg-slate-600"></div>
                        <div className="absolute top-[calc(100%+12px)] right-0 w-px h-3 bg-slate-600"></div>
                    </div>

                    <div className="flex gap-6 items-start">
                        <div className="flex flex-col items-center">
                            <div className="text-[8px] text-emerald-400 font-bold mb-1 bg-slate-900 px-1 rounded">YES</div>
                            <TreeNode node={node.yes} depth={depth + 1} />
                        </div>
                        <div className="flex flex-col items-center">
                            <div className="text-[8px] text-red-400 font-bold mb-1 bg-slate-900 px-1 rounded">NO</div>
                            <TreeNode node={node.no} depth={depth + 1} />
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [mode, setMode] = useState('interactive'); // interactive, tree, list
            // Force reset interactive component
            const [resetKey, setResetKey] = useState(0); 

            const handleReset = () => {
                setResetKey(k => k + 1);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="git-fork" className="text-blue-400" /> Key Maker
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Biological Classification</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Mode Select */}
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest">View Mode</label>
                                <div className="grid grid-cols-1 gap-2">
                                    <button 
                                        onClick={() => setMode('interactive')}
                                        className={`flex items-center gap-3 px-4 py-3 rounded-xl border transition-all text-sm font-bold
                                            ${mode === 'interactive' ? 'bg-blue-600 border-blue-500 text-white shadow-lg' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700'}
                                        `}
                                    >
                                        <Icon name="play-circle" size={18}/> Interactive (Step-by-Step)
                                    </button>
                                    <button 
                                        onClick={() => setMode('tree')}
                                        className={`flex items-center gap-3 px-4 py-3 rounded-xl border transition-all text-sm font-bold
                                            ${mode === 'tree' ? 'bg-emerald-600 border-emerald-500 text-white shadow-lg' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700'}
                                        `}
                                    >
                                        <Icon name="network" size={18}/> Tree Diagram (Full Map)
                                    </button>
                                    <button 
                                        onClick={() => setMode('list')}
                                        className={`flex items-center gap-3 px-4 py-3 rounded-xl border transition-all text-sm font-bold
                                            ${mode === 'list' ? 'bg-purple-600 border-purple-500 text-white shadow-lg' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700'}
                                        `}
                                    >
                                        <Icon name="list" size={18}/> Database List
                                    </button>
                                </div>
                            </div>
                            
                            {/* Info */}
                            <div className="bg-blue-900/20 p-4 rounded-xl border border-blue-500/30">
                                <div className="flex items-center gap-2 mb-2 text-blue-400 font-bold text-xs uppercase">
                                    <Icon name="info" size={14} /> Concept
                                </div>
                                <p className="text-xs text-slate-300 leading-relaxed">
                                    Start with "Interactive" mode to simulate how a biologist identifies an unknown organism in the field. Use "Tree Diagram" to see the whole classification logic.
                                </p>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col overflow-hidden">
                        
                        <div className="flex-1 overflow-auto p-8 relative">
                            
                            {mode === 'interactive' && (
                                <InteractiveNode key={resetKey} node={INITIAL_TREE} onReset={handleReset} />
                            )}

                            {mode === 'tree' && (
                                <div className="min-w-max flex justify-center pt-8 pb-20">
                                    <TreeNode node={INITIAL_TREE} />
                                </div>
                            )}

                            {mode === 'list' && (
                                <div className="w-full max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 animate-in fade-in">
                                    {ORGANISMS.map(org => {
                                        let displayIcon = org.icon;
                                        if (org.id === 'frog') displayIcon = 'meh'; 
                                        if (org.id === 'turtle') displayIcon = 'shield'; 
                                        if (org.id === 'snail') displayIcon = 'disc';
                                        if (org.id === 'butterfly') displayIcon = 'feather';

                                        return (
                                            <div key={org.id} className="flex items-center gap-4 p-4 bg-slate-800 rounded-xl border border-slate-700 hover:border-slate-500 transition-colors">
                                                <div className="p-3 bg-slate-700 rounded-full text-white shrink-0">
                                                    <Icon name={displayIcon} size={24}/>
                                                </div>
                                                <div className="min-w-0">
                                                    <div className="font-bold text-white truncate">{org.name}</div>
                                                    <div className="text-xs text-emerald-400 font-mono mb-1">{org.class}</div>
                                                    <div className="flex flex-wrap gap-1">
                                                        {org.traits.map(t => (
                                                            <span key={t} className="text-[9px] px-1.5 py-0.5 bg-slate-900 rounded text-slate-400 border border-slate-700">{t}</span>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
