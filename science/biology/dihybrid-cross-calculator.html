<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dihybrid Cross Calculator | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Grid Animation */
        .grid-cell { transition: all 0.2s ease; }
        .grid-cell:hover { transform: scale(1.02); z-index: 10; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border-color: #38bdf8; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { PieChart, Pie, Cell, Tooltip, Legend, ResponsiveContainer } = window.Recharts;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- GENETICS LOGIC ---
        const TRAIT_1 = {
            name: 'Seed Color',
            dom: { char: 'Y', label: 'Yellow', color: '#facc15' },
            rec: { char: 'y', label: 'Green', color: '#4ade80' }
        };
        const TRAIT_2 = {
            name: 'Seed Shape',
            dom: { char: 'R', label: 'Round', icon: 'circle' },
            rec: { char: 'r', label: 'Wrinkled', icon: 'hexagon' } // Using hexagon to represent wrinkled
        };

        // Possible alleles for a trait: Homo Dom (YY), Hetero (Yy), Homo Rec (yy)
        const OPTIONS_1 = [
            { geno: 'YY', label: 'YY (Homo Dom)' },
            { geno: 'Yy', label: 'Yy (Hetero)' },
            { geno: 'yy', label: 'yy (Homo Rec)' }
        ];
        const OPTIONS_2 = [
            { geno: 'RR', label: 'RR (Homo Dom)' },
            { geno: 'Rr', label: 'Rr (Hetero)' },
            { geno: 'rr', label: 'rr (Homo Rec)' }
        ];

        const App = () => {
            // Parent Genotypes
            const [p1t1, setP1t1] = useState('Yy'); // Parent 1 Trait 1
            const [p1t2, setP1t2] = useState('Rr'); // Parent 1 Trait 2
            const [p2t1, setP2t1] = useState('Yy'); // Parent 2 Trait 1
            const [p2t2, setP2t2] = useState('Rr'); // Parent 2 Trait 2

            // Helper: Get Gametes from Genotype (e.g. YyRr -> YR, Yr, yR, yr)
            // FOIL method: First, Outer, Inner, Last
            const getGametes = (t1, t2) => {
                return [
                    t1[0] + t2[0],
                    t1[0] + t2[1],
                    t1[1] + t2[0],
                    t1[1] + t2[1]
                ];
            };

            const p1Gametes = useMemo(() => getGametes(p1t1, p1t2), [p1t1, p1t2]);
            const p2Gametes = useMemo(() => getGametes(p2t1, p2t2), [p2t1, p2t2]);

            // Generate Offspring Grid (4x4)
            const grid = useMemo(() => {
                const g = [];
                for (let r = 0; r < 4; r++) {
                    for (let c = 0; c < 4; c++) {
                        // Combine gametes: p1[r] + p2[c]
                        // e.g. YR + yr -> YyRr
                        // Sort: Ys together, Rs together. Capital first.
                        const g1 = p1Gametes[r];
                        const g2 = p2Gametes[c];
                        
                        // Sort Trait 1 (Y/y)
                        let t1 = g1[0] + g2[0];
                        if (t1 === 'yY') t1 = 'Yy'; // Capital first
                        
                        // Sort Trait 2 (R/r)
                        let t2 = g1[1] + g2[1];
                        if (t2 === 'rR') t2 = 'Rr';
                        
                        g.push({
                            geno: t1 + t2,
                            p1Gamete: g1,
                            p2Gamete: g2,
                            // Determine Phenotype
                            isYellow: t1.includes('Y'),
                            isRound: t2.includes('R')
                        });
                    }
                }
                return g;
            }, [p1Gametes, p2Gametes]);

            // Statistics
            const stats = useMemo(() => {
                const counts = {
                    'Yellow Round': 0,
                    'Yellow Wrinkled': 0,
                    'Green Round': 0,
                    'Green Wrinkled': 0
                };
                
                grid.forEach(cell => {
                    let key = '';
                    key += cell.isYellow ? 'Yellow' : 'Green';
                    key += ' ';
                    key += cell.isRound ? 'Round' : 'Wrinkled';
                    counts[key]++;
                });

                const data = Object.entries(counts)
                    .filter(([_, val]) => val > 0)
                    .map(([name, value]) => ({
                        name, 
                        value,
                        // Determine color based on name
                        color: name.includes('Yellow') 
                            ? (name.includes('Round') ? '#eab308' : '#ca8a04') // Yellow
                            : (name.includes('Round') ? '#4ade80' : '#16a34a') // Green
                    }));
                return data;
            }, [grid]);

            // Helper to render seed visual
            const SeedVisual = ({ isYellow, isRound, size = "w-8 h-8" }) => {
                const colorClass = isYellow ? 'bg-yellow-400' : 'bg-green-400';
                const shapeClass = isRound ? 'rounded-full' : 'rounded-md skew-x-6 rotate-12 scale-90'; // Imperfect shape for wrinkled
                const borderClass = isYellow ? 'border-yellow-600' : 'border-green-600';
                
                return (
                    <div className={`${size} ${colorClass} ${shapeClass} border-2 ${borderClass} shadow-sm transition-all flex items-center justify-center`}>
                        {/* Texture for wrinkled */}
                        {!isRound && <div className="w-full h-full opacity-20 bg-[radial-gradient(circle,_transparent_20%,_#000_20%)] bg-[length:4px_4px]"></div>}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-96 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="grid-2x2" className="text-yellow-400" /> Dihybrid Calc
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Two-Trait Cross (9:3:3:1)</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Parent 1 Config */}
                            <div className="space-y-3">
                                <label className="text-xs font-bold text-blue-400 uppercase tracking-widest px-1 flex items-center gap-2">
                                    <Icon name="user" size={14}/> Parent 1 (Father)
                                </label>
                                <div className="grid grid-cols-2 gap-2">
                                    <div>
                                        <div className="text-[10px] text-slate-500 mb-1">Seed Color</div>
                                        <select 
                                            value={p1t1} 
                                            onChange={(e) => setP1t1(e.target.value)}
                                            className="w-full bg-slate-800 text-white p-2 rounded-lg border border-slate-600 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                        >
                                            {OPTIONS_1.map(o => <option key={o.geno} value={o.geno}>{o.label}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <div className="text-[10px] text-slate-500 mb-1">Seed Shape</div>
                                        <select 
                                            value={p1t2} 
                                            onChange={(e) => setP1t2(e.target.value)}
                                            className="w-full bg-slate-800 text-white p-2 rounded-lg border border-slate-600 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                        >
                                            {OPTIONS_2.map(o => <option key={o.geno} value={o.geno}>{o.label}</option>)}
                                        </select>
                                    </div>
                                </div>
                                <div className="text-center text-xl font-mono font-bold bg-slate-800/50 py-2 rounded border border-slate-700">
                                    {p1t1}{p1t2}
                                </div>
                            </div>

                            {/* Parent 2 Config */}
                            <div className="space-y-3">
                                <label className="text-xs font-bold text-pink-400 uppercase tracking-widest px-1 flex items-center gap-2">
                                    <Icon name="user" size={14}/> Parent 2 (Mother)
                                </label>
                                <div className="grid grid-cols-2 gap-2">
                                    <div>
                                        <div className="text-[10px] text-slate-500 mb-1">Seed Color</div>
                                        <select 
                                            value={p2t1} 
                                            onChange={(e) => setP2t1(e.target.value)}
                                            className="w-full bg-slate-800 text-white p-2 rounded-lg border border-slate-600 text-sm focus:ring-2 focus:ring-pink-500 outline-none"
                                        >
                                            {OPTIONS_1.map(o => <option key={o.geno} value={o.geno}>{o.label}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <div className="text-[10px] text-slate-500 mb-1">Seed Shape</div>
                                        <select 
                                            value={p2t2} 
                                            onChange={(e) => setP2t2(e.target.value)}
                                            className="w-full bg-slate-800 text-white p-2 rounded-lg border border-slate-600 text-sm focus:ring-2 focus:ring-pink-500 outline-none"
                                        >
                                            {OPTIONS_2.map(o => <option key={o.geno} value={o.geno}>{o.label}</option>)}
                                        </select>
                                    </div>
                                </div>
                                <div className="text-center text-xl font-mono font-bold bg-slate-800/50 py-2 rounded border border-slate-700">
                                    {p2t1}{p2t2}
                                </div>
                            </div>

                            {/* Key */}
                            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700 text-xs text-slate-300 space-y-2">
                                <div className="font-bold text-slate-400 uppercase mb-1">Gene Key</div>
                                <div className="flex justify-between">
                                    <span className="font-bold text-yellow-400">Y: Yellow (Dom)</span>
                                    <span className="text-slate-500">y: Green (Rec)</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="font-bold text-slate-200">R: Round (Dom)</span>
                                    <span className="text-slate-500">r: Wrinkled (Rec)</span>
                                </div>
                            </div>
                            
                            <div className="bg-emerald-900/20 p-4 rounded-xl border border-emerald-500/30 text-xs text-slate-300">
                                <div className="flex items-center gap-2 mb-2 text-emerald-400 font-bold uppercase">
                                    <Icon name="info" size={14} /> Tip
                                </div>
                                <p className="leading-relaxed">
                                    Try crossing two heterozygotes (YyRr x YyRr) to see the classic <strong>9:3:3:1</strong> phenotypic ratio!
                                </p>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-8 overflow-y-auto custom-scrollbar">
                        
                        <div className="flex flex-col items-center w-full max-w-5xl mx-auto gap-12">
                            
                            {/* Punnett Square Visual */}
                            <div className="w-full flex flex-col items-center">
                                <h2 className="text-xl font-bold text-white mb-6 flex items-center gap-2 justify-center">
                                    <Icon name="grid-3x3" /> 16-Grid Punnett Square
                                </h2>
                                
                                <div className="flex flex-col items-center">
                                    
                                    {/* Top Labels (Parent 2 Gametes) */}
                                    <div className="flex mb-2 ml-16 w-full max-w-lg justify-between px-2">
                                        {p2Gametes.map((g, i) => (
                                            <div key={i} className="w-1/4 text-center font-bold text-pink-400 font-mono bg-slate-900/50 rounded py-1 mx-1 border border-pink-500/30">{g}</div>
                                        ))}
                                    </div>

                                    <div className="flex w-full max-w-lg">
                                        {/* Side Labels (Parent 1 Gametes) */}
                                        <div className="flex flex-col justify-between mr-2 w-14 py-2">
                                            {p1Gametes.map((g, i) => (
                                                <div key={i} className="h-1/4 flex items-center justify-center font-bold text-blue-400 font-mono bg-slate-900/50 rounded my-1 border border-blue-500/30">{g}</div>
                                            ))}
                                        </div>

                                        {/* The Grid */}
                                        <div className="grid grid-cols-4 gap-2 bg-slate-800 p-2 rounded-xl border border-slate-700 flex-1 aspect-square shadow-2xl">
                                            {grid.map((cell, i) => (
                                                <div key={i} className="bg-slate-900 rounded-lg flex flex-col items-center justify-center border border-slate-700 shadow-inner grid-cell relative overflow-hidden group">
                                                    <div className="z-10 flex flex-col items-center">
                                                        <SeedVisual isYellow={cell.isYellow} isRound={cell.isRound} />
                                                        <span className="text-xs font-mono font-bold text-white mt-2">{cell.geno}</span>
                                                    </div>
                                                    {/* Hover Info */}
                                                    <div className="absolute inset-0 bg-black/80 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-[10px] text-center px-1 font-bold">
                                                        {cell.isYellow ? 'Yellow' : 'Green'}<br/>
                                                        {cell.isRound ? 'Round' : 'Wrinkled'}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Statistics Panel */}
                            <div className="w-full bg-slate-900 rounded-2xl border border-slate-800 p-6 shadow-xl">
                                <div className="flex flex-col md:flex-row gap-8">
                                    
                                    {/* Chart */}
                                    <div className="w-full md:w-1/2 h-56 relative">
                                        <div className="absolute top-0 left-0 text-xs font-bold text-slate-500 uppercase flex items-center gap-2">
                                            <Icon name="pie-chart" size={14}/> Phenotype Ratio
                                        </div>
                                        <ResponsiveContainer width="100%" height="100%">
                                            <PieChart>
                                                <Pie
                                                    data={stats}
                                                    cx="50%"
                                                    cy="55%"
                                                    innerRadius={40}
                                                    outerRadius={70}
                                                    paddingAngle={5}
                                                    dataKey="value"
                                                    stroke="none"
                                                >
                                                    {stats.map((entry, index) => (
                                                        <Cell key={`cell-${index}`} fill={entry.color} />
                                                    ))}
                                                </Pie>
                                                <Tooltip 
                                                    contentStyle={{ backgroundColor: '#1e293b', borderColor: '#475569', fontSize: '12px', borderRadius: '8px' }}
                                                    itemStyle={{ color: '#fff' }}
                                                />
                                            </PieChart>
                                        </ResponsiveContainer>
                                    </div>

                                    {/* Legend / List */}
                                    <div className="w-full md:w-1/2 flex flex-col justify-center gap-3">
                                        {stats.map((s, i) => (
                                            <div key={i} className="flex items-center justify-between p-2 rounded bg-slate-800/50 border border-slate-700/50">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-3 h-3 rounded-full" style={{ backgroundColor: s.color }}></div>
                                                    <span className="text-sm text-slate-300 font-medium">{s.name}</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <div className="text-xs text-slate-500">{((s.value/16)*100).toFixed(1)}%</div>
                                                    <span className="font-mono font-bold text-white bg-slate-700 px-2 py-0.5 rounded min-w-[2rem] text-center">{s.value}</span>
                                                </div>
                                            </div>
                                        ))}
                                        <div className="mt-2 pt-2 border-t border-slate-700 text-right text-xs text-slate-500">
                                            Total Offspring: 16
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
