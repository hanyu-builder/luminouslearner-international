<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phagocytosis Animator - LuminousLearner International</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Background Grid */
        .grid-bg {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* Enzyme Activity */
        .digest-fizz { animation: fizz 0.2s linear infinite; }
        @keyframes fizz {
            0% { transform: translate(0,0); }
            25% { transform: translate(2px,2px); }
            50% { transform: translate(-2px, -2px); }
            75% { transform: translate(2px, -2px); }
            100% { transform: translate(0,0); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- STAGES DATA ---
        const STAGES = [
            { 
                id: 'start', 
                title: '1. Detection', 
                desc: 'Pathogens (bacteria) enter the body. The Phagocyte detects chemical signals released by the pathogen.' 
            },
            { 
                id: 'chemotaxis', 
                title: '2. Chemotaxis', 
                desc: 'The Phagocyte moves towards the pathogen, attracted by chemicals (chemotaxis).' 
            },
            { 
                id: 'ingestion', 
                title: '3. Ingestion', 
                desc: 'The Phagocyte extends its cell membrane (pseudopodia) to surround and engulf the pathogen.' 
            },
            { 
                id: 'phagosome', 
                title: '4. Phagosome Formation', 
                desc: 'The pathogen is enclosed in a vesicle called a Phagosome inside the cytoplasm.' 
            },
            { 
                id: 'fusion', 
                title: '5. Fusion', 
                desc: 'Lysosomes containing digestive enzymes fuse with the Phagosome, forming a Phagolysosome.' 
            },
            { 
                id: 'digestion', 
                title: '6. Digestion', 
                desc: 'Digestive enzymes break down the pathogen into harmless particles.' 
            },
            { 
                id: 'exocytosis', 
                title: '7. Exocytosis', 
                desc: 'Indigestible waste materials are expelled from the cell.' 
            }
        ];

        // --- VISUAL COMPONENT ---
        const PhagocyteScene = ({ stageIdx }) => {
            const stage = STAGES[stageIdx].id;

            // Coordinates
            const centerX = 300;
            const centerY = 300;
            
            // Pathogen Position Logic
            const getPathogenPos = () => {
                switch(stage) {
                    case 'start': return { x: 300, y: 50, scale: 1, opacity: 1 };
                    case 'chemotaxis': return { x: 300, y: 150, scale: 1, opacity: 1 }; // Closer
                    case 'ingestion': return { x: 300, y: 220, scale: 1, opacity: 1 }; // Being hugged
                    case 'phagosome': return { x: 300, y: 280, scale: 1, opacity: 1 }; // Inside
                    case 'fusion': return { x: 300, y: 280, scale: 1, opacity: 1 }; // Inside
                    case 'digestion': return { x: 300, y: 280, scale: 0.5, opacity: 0.5 }; // Breaking down
                    case 'exocytosis': return { x: 450, y: 100, scale: 0.2, opacity: 0 }; // Expelled
                    default: return { x: 300, y: 50 };
                }
            };
            const pathPos = getPathogenPos();

            // Phagocyte Shape Logic (Path morphing)
            const getPhagocytePath = () => {
                // Base circle-ish blob
                if (stage === 'ingestion') {
                    // Cup shape (pseudopodia extending up)
                    return "M 200 250 C 150 350, 150 450, 300 480 C 450 450, 450 350, 400 250 C 400 150, 350 150, 350 200 C 350 220, 250 220, 250 200 C 250 150, 200 150, 200 250 Z";
                }
                // Resting or Enclosing
                return "M 200 250 C 150 350, 150 450, 300 480 C 450 450, 450 350, 400 250 C 400 150, 350 150, 350 200 C 350 220, 250 220, 250 200 C 250 150, 200 150, 200 250 Z";
            };

            // Lysosome Position
            const getLysoPos = (index) => {
                // Start positions
                const bases = [{x:220, y:350}, {x:380, y:350}, {x:300, y:400}];
                const base = bases[index];
                
                if (stage === 'fusion' || stage === 'digestion') {
                    // Move to center (Phagosome)
                    return { x: 300 + (index-1)*15, y: 280 + (index===2?15:0) };
                }
                return base;
            };

            return (
                <svg viewBox="0 0 600 500" className="w-full h-full drop-shadow-2xl">
                    
                    {/* Background Particles (Chemical Signals) */}
                    {stage === 'chemotaxis' && (
                        <g>
                            {[...Array(10)].map((_, i) => (
                                <motion.circle 
                                    key={i}
                                    r="2" fill="#fbbf24"
                                    initial={{ x: 300, y: 150, opacity: 1 }}
                                    animate={{ x: 300 + (Math.random()-0.5)*200, y: 300 + (Math.random()-0.5)*200, opacity: 0 }}
                                    transition={{ duration: 1.5, repeat: Infinity, delay: i*0.1 }}
                                />
                            ))}
                        </g>
                    )}

                    {/* --- Phagocyte --- */}
                    <motion.path 
                        d={getPhagocytePath()}
                        fill="#e0e7ff" stroke="#6366f1" strokeWidth="4"
                        animate={{ d: getPhagocytePath() }}
                        transition={{ duration: 1 }}
                    />
                    
                    {/* Nucleus */}
                    <motion.path 
                        d="M 250 380 Q 300 350 350 380 Q 350 430 300 440 Q 250 430 250 380"
                        fill="#818cf8" opacity="0.6"
                    />

                    {/* Lysosomes (Enzyme bags) */}
                    {[0, 1, 2].map(i => (
                        <motion.g 
                            key={`lyso-${i}`}
                            animate={getLysoPos(i)}
                            transition={{ duration: 1 }}
                        >
                            <circle r="8" fill="#ef4444" stroke="#b91c1c" strokeWidth="1" />
                            {/* Enzymes inside */}
                            <circle r="2" fill="white" opacity="0.5"/>
                        </motion.g>
                    ))}

                    {/* --- Phagosome (Vesicle) --- */}
                    {(stage === 'phagosome' || stage === 'fusion' || stage === 'digestion' || stage === 'exocytosis') && (
                        <motion.circle 
                            cx={pathPos.x} cy={pathPos.y} r="35" 
                            fill="none" stroke="#6366f1" strokeWidth="2" 
                            initial={{ scale: 0 }}
                            animate={{ 
                                scale: stage === 'exocytosis' ? 0 : 1,
                                x: stage === 'exocytosis' ? 400 : 300,
                                y: stage === 'exocytosis' ? 150 : 280,
                                opacity: stage === 'exocytosis' ? 0 : 1
                            }}
                            transition={{ duration: 1 }}
                        />
                    )}

                    {/* --- Pathogen (Bacteria) --- */}
                    <motion.g
                        animate={pathPos}
                        transition={{ duration: 1 }}
                    >
                        {stage === 'digestion' ? (
                            // Broken pieces
                            <g className="digest-fizz">
                                <circle cx="-5" cy="-5" r="3" fill="#22c55e" />
                                <circle cx="5" cy="5" r="3" fill="#22c55e" />
                                <circle cx="5" cy="-5" r="3" fill="#22c55e" />
                                <rect x="-8" y="2" width="6" height="4" fill="#22c55e" />
                            </g>
                        ) : stage === 'exocytosis' ? (
                             // Waste
                             <g>
                                <circle cx="0" cy="0" r="2" fill="#94a3b8" />
                                <circle cx="5" cy="5" r="2" fill="#94a3b8" />
                             </g>
                        ) : (
                            // Intact Bacteria
                            <g>
                                <rect x="-15" y="-8" width="30" height="16" rx="8" fill="#22c55e" stroke="#14532d" strokeWidth="2" />
                                {/* Flagella */}
                                <path d="M 15 0 Q 25 5 30 0" stroke="#22c55e" strokeWidth="2" fill="none" />
                                {/* Face */}
                                <circle cx="-5" cy="-2" r="1" fill="black"/>
                                <circle cx="5" cy="-2" r="1" fill="black"/>
                                <path d="M -5 3 Q 0 0 5 3" stroke="black" strokeWidth="1" fill="none"/>
                            </g>
                        )}
                    </motion.g>

                </svg>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [stageIdx, setStageIdx] = useState(0);
            const currentStage = STAGES[stageIdx];

            const nextStage = () => {
                setStageIdx(prev => (prev + 1) % STAGES.length);
            };

            const prevStage = () => {
                setStageIdx(prev => (prev - 1 + STAGES.length) % STAGES.length);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="shield-check" className="text-emerald-400" /> Phagocytosis
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Immune Defense Simulator</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Steps Indicator */}
                            <div className="flex justify-between items-center px-2">
                                <span className="text-xs font-bold text-slate-500 uppercase">Progress</span>
                                <span className="text-xs font-mono text-emerald-400">{stageIdx + 1} / {STAGES.length}</span>
                            </div>
                            <div className="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
                                <div 
                                    className="h-full bg-emerald-500 transition-all duration-500" 
                                    style={{ width: `${((stageIdx + 1) / STAGES.length) * 100}%` }}
                                ></div>
                            </div>

                            {/* Stage Info */}
                            <AnimatePresence mode='wait'>
                                <motion.div 
                                    key={currentStage.id}
                                    initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }}
                                    className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-lg"
                                >
                                    <h2 className="text-lg font-bold text-white mb-3">{currentStage.title}</h2>
                                    <p className="text-sm text-slate-300 leading-relaxed">
                                        {currentStage.desc}
                                    </p>
                                </motion.div>
                            </AnimatePresence>

                            {/* Controls */}
                            <div className="flex gap-3 pt-4 border-t border-slate-800">
                                <button 
                                    onClick={prevStage}
                                    className="p-3 bg-slate-800 hover:bg-slate-700 rounded-xl text-slate-300 border border-slate-600 transition-all"
                                >
                                    <Icon name="chevron-left" size={20}/>
                                </button>
                                <button 
                                    onClick={nextStage}
                                    className="flex-1 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95"
                                >
                                    {stageIdx === STAGES.length - 1 ? 'Restart' : 'Next Step'} <Icon name={stageIdx === STAGES.length - 1 ? "rotate-ccw" : "arrow-right"} size={18}/>
                                </button>
                            </div>

                            {/* Legend */}
                            <div className="bg-slate-800/50 p-3 rounded-xl border border-slate-700 text-xs text-slate-400 space-y-2">
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded bg-[#e0e7ff] border border-[#6366f1]"></div> Phagocyte (WBC)
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded bg-[#22c55e]"></div> Pathogen (Bacteria)
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded-full bg-[#ef4444]"></div> Lysosome (Enzymes)
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-6 overflow-hidden">
                        
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center p-8">
                            
                            <div className="w-full h-full max-w-lg relative">
                                <PhagocyteScene stageIdx={stageIdx} />
                                
                                {/* Context Label */}
                                <div className="absolute top-4 right-4 bg-black/60 backdrop-blur px-3 py-1.5 rounded-lg text-xs text-slate-300 border border-white/10">
                                    Non-specific Defense
                                </div>
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
