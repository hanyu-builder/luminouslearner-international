<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATP Cycle Animator - LuminousLearner International</title>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Glow Animation */
        .energy-burst {
            animation: burst 0.8s ease-out forwards;
        }
        @keyframes burst {
            0% { transform: scale(0.5); opacity: 1; box-shadow: 0 0 20px 10px #facc15; }
            100% { transform: scale(2.0); opacity: 0; box-shadow: 0 0 0 0 transparent; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        
        .safe-area-bottom { padding-bottom: max(2rem, env(safe-area-inset-bottom)); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;
        const { PieChart, Pie, Cell, ResponsiveContainer } = window.Recharts;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- COMPONENTS ---

        // ATP/ADP Molecule
        const Molecule = ({ state, x, y }) => {
            // state: 'ATP' or 'ADP'
            
            const phosphateColor = "#facc15"; // Yellow
            const riboseColor = "#60a5fa"; // Blue
            const adenosineColor = "#a78bfa"; // Purple

            return (
                <g transform={`translate(${x}, ${y})`}>
                    {/* Adenosine Base */}
                    <path d="M0 0 L15 -10 L30 0 L30 20 L15 30 L0 20 Z" fill={adenosineColor} stroke="none" />
                    <path d="M30 0 L45 -5 L50 15 L30 20" fill={adenosineColor} stroke="none" />
                    <text x="25" y="15" fontSize="10" fill="white" fontWeight="bold" textAnchor="middle">A</text>

                    {/* Ribose */}
                    <path d="M50 15 L70 15 L75 35 L55 40 L45 25" fill={riboseColor} stroke="none" />
                    <text x="60" y="30" fontSize="8" fill="white" textAnchor="middle">R</text>

                    {/* Phosphate Chain */}
                    {/* P1 */}
                    <circle cx="90" cy="25" r="12" fill={phosphateColor} stroke="#ca8a04" strokeWidth="2" />
                    <text x="90" y="28" fontSize="10" fill="#713f12" fontWeight="bold" textAnchor="middle">P</text>
                    <line x1="75" y1="25" x2="78" y2="25" stroke="#94a3b8" strokeWidth="3" />

                    {/* P2 */}
                    <circle cx="120" cy="25" r="12" fill={phosphateColor} stroke="#ca8a04" strokeWidth="2" />
                    <text x="120" y="28" fontSize="10" fill="#713f12" fontWeight="bold" textAnchor="middle">P</text>
                    <line x1="102" y1="25" x2="108" y2="25" stroke="#94a3b8" strokeWidth="3" />

                    {/* P3 (Only for ATP) */}
                    <AnimatePresence>
                        {state === 'ATP' && (
                            <motion.g
                                initial={{ x: 20, opacity: 0 }}
                                animate={{ x: 0, opacity: 1 }}
                                exit={{ x: 40, opacity: 0, scale: 0.5 }}
                                transition={{ duration: 0.5 }}
                            >
                                <line x1="132" y1="25" x2="138" y2="25" stroke="#ef4444" strokeWidth="3" strokeDasharray="2,2" /> {/* High energy bond */}
                                <circle cx="150" cy="25" r="12" fill={phosphateColor} stroke="#ca8a04" strokeWidth="2" />
                                <text x="150" y="28" fontSize="10" fill="#713f12" fontWeight="bold" textAnchor="middle">P</text>
                                {/* Energy Spark visual hint */}
                                <circle cx="141" cy="25" r="4" fill="#ef4444" className="animate-pulse" opacity="0.6" />
                            </motion.g>
                        )}
                    </AnimatePresence>
                </g>
            );
        };

        const App = () => {
            const [atpCount, setAtpCount] = useState(50); // 0-100%
            const [cycleState, setCycleState] = useState('idle'); // idle, hydrolysis, phosphorylation
            const [activeProcess, setActiveProcess] = useState(null); // 'muscle', 'transport', 'respiration'
            
            // Animation Refs
            const [flash, setFlash] = useState(false);

            // Actions
            const consumeEnergy = (process) => {
                if (atpCount <= 0 || cycleState !== 'idle') return;
                setActiveProcess(process);
                setCycleState('hydrolysis');
                setFlash(true);
                
                setTimeout(() => {
                    setAtpCount(prev => Math.max(0, prev - 10));
                    setFlash(false);
                    setCycleState('idle');
                    setActiveProcess(null);
                }, 1500);
            };

            const produceEnergy = () => {
                if (atpCount >= 100 || cycleState !== 'idle') return;
                setActiveProcess('respiration');
                setCycleState('phosphorylation');
                
                setTimeout(() => {
                    setAtpCount(prev => Math.min(100, prev + 10));
                    setCycleState('idle');
                    setActiveProcess(null);
                }, 1500);
            };

            // Chart Data
            const data = [
                { name: 'ATP', value: atpCount, color: '#34d399' },
                { name: 'ADP', value: 100 - atpCount, color: '#94a3b8' }
            ];

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="battery-charging" className="text-yellow-400" /> ATP Cycle
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Energy Currency of Cell</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto">
                            
                            {/* Energy Meter */}
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex flex-col items-center">
                                <div className="text-xs font-bold text-slate-500 uppercase mb-2">Energy Charge</div>
                                <div className="w-32 h-32 relative">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie
                                                data={data}
                                                cx="50%"
                                                cy="50%"
                                                innerRadius={40}
                                                outerRadius={55}
                                                startAngle={90}
                                                endAngle={-270}
                                                dataKey="value"
                                                stroke="none"
                                            >
                                                {data.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={entry.color} />
                                                ))}
                                            </Pie>
                                        </PieChart>
                                    </ResponsiveContainer>
                                    <div className="absolute inset-0 flex items-center justify-center font-mono font-bold text-xl text-emerald-400">
                                        {atpCount}%
                                    </div>
                                </div>
                                <div className="flex gap-4 text-xs mt-2">
                                    <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-emerald-400"></div> ATP</div>
                                    <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-slate-400"></div> ADP</div>
                                </div>
                            </div>

                            {/* Consumers */}
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1 mb-2 block">Use Energy (Hydrolysis)</label>
                                <div className="space-y-2">
                                    <button 
                                        onClick={() => consumeEnergy('muscle')}
                                        disabled={cycleState !== 'idle' || atpCount === 0}
                                        className="w-full p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-xl flex items-center gap-3 transition-all disabled:opacity-50 disabled:cursor-not-allowed group"
                                    >
                                        <div className="p-2 bg-red-500/20 rounded-lg text-red-400 group-hover:bg-red-500 group-hover:text-white transition-colors"><Icon name="activity" size={18}/></div>
                                        <div className="text-left">
                                            <div className="font-bold text-sm">Muscle Contraction</div>
                                            <div className="text-[10px] text-slate-400">ATP &rarr; ADP + Pi + Energy</div>
                                        </div>
                                    </button>

                                    <button 
                                        onClick={() => consumeEnergy('transport')}
                                        disabled={cycleState !== 'idle' || atpCount === 0}
                                        className="w-full p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-xl flex items-center gap-3 transition-all disabled:opacity-50 disabled:cursor-not-allowed group"
                                    >
                                        <div className="p-2 bg-blue-500/20 rounded-lg text-blue-400 group-hover:bg-blue-500 group-hover:text-white transition-colors"><Icon name="zap" size={18}/></div>
                                        <div className="text-left">
                                            <div className="font-bold text-sm">Active Transport</div>
                                            <div className="text-[10px] text-slate-400">ATP &rarr; ADP + Pi + Energy</div>
                                        </div>
                                    </button>

                                    <button 
                                        onClick={() => consumeEnergy('synthesis')}
                                        disabled={cycleState !== 'idle' || atpCount === 0}
                                        className="w-full p-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-xl flex items-center gap-3 transition-all disabled:opacity-50 disabled:cursor-not-allowed group"
                                    >
                                        <div className="p-2 bg-purple-500/20 rounded-lg text-purple-400 group-hover:bg-purple-500 group-hover:text-white transition-colors"><Icon name="hammer" size={18}/></div>
                                        <div className="text-left">
                                            <div className="font-bold text-sm">Synthesis (Anabolism)</div>
                                            <div className="text-[10px] text-slate-400">ATP &rarr; ADP + Pi + Energy</div>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            {/* Producers */}
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1 mb-2 block">Make Energy (Phosphorylation)</label>
                                <button 
                                    onClick={produceEnergy}
                                    disabled={cycleState !== 'idle' || atpCount === 100}
                                    className="w-full p-3 bg-emerald-900/30 hover:bg-emerald-900/50 border border-emerald-500/50 rounded-xl flex items-center gap-3 transition-all disabled:opacity-50 disabled:cursor-not-allowed group"
                                >
                                    <div className="p-2 bg-emerald-500 rounded-lg text-white shadow-lg shadow-emerald-500/50 group-hover:scale-110 transition-transform"><Icon name="factory" size={18}/></div>
                                    <div className="text-left">
                                        <div className="font-bold text-sm text-emerald-300">Cellular Respiration</div>
                                        <div className="text-[10px] text-emerald-400/70">ADP + Pi + Energy &rarr; ATP</div>
                                    </div>
                                </button>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 relative bg-[#020617] flex flex-col items-center justify-center p-4 overflow-hidden">
                        
                        {/* Animation Canvas */}
                        <div className="relative w-full max-w-2xl aspect-video bg-slate-900/50 rounded-3xl border border-slate-800 flex items-center justify-center overflow-hidden shadow-2xl">
                            
                            {/* Central Cycle */}
                            <div className="relative">
                                {/* Molecule Visual */}
                                <svg width="400" height="200" viewBox="0 0 300 100" className="overflow-visible">
                                    <Molecule 
                                        state={cycleState === 'hydrolysis' ? 'ADP' : 'ATP'} 
                                        x={50} y={30} 
                                    />
                                    
                                    {/* Floating Pi - Only Visible During Hydrolysis */}
                                    <AnimatePresence>
                                        {cycleState === 'hydrolysis' && (
                                            <motion.g 
                                                initial={{ x: 200, y: 55, opacity: 0 }} 
                                                animate={{ x: 240, y: 20, opacity: 1 }}
                                                exit={{ opacity: 0 }}
                                                transition={{ duration: 1.0 }}
                                                className="pointer-events-none"
                                            >
                                                <circle cx="0" cy="0" r="12" fill="#facc15" stroke="#ca8a04" strokeWidth="2" />
                                                <text x="0" y="3" fontSize="10" fill="#713f12" fontWeight="bold" textAnchor="middle">Pi</text>
                                            </motion.g>
                                        )}
                                    </AnimatePresence>
                                </svg>

                                {/* Energy Burst Effect */}
                                {flash && (
                                    <div className="absolute top-10 left-40 w-20 h-20 bg-yellow-400 rounded-full blur-2xl opacity-0 energy-burst"></div>
                                )}
                            </div>

                            {/* Process Indicators */}
                            <div className="absolute bottom-8 w-full text-center">
                                <AnimatePresence mode='wait'>
                                    {activeProcess === 'muscle' && (
                                        <motion.div 
                                            initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }}
                                            className="inline-flex items-center gap-2 px-4 py-2 bg-red-900/50 border border-red-500/50 rounded-full text-red-300 text-sm font-bold"
                                        >
                                            <Icon name="activity"/> Muscle Contracting...
                                        </motion.div>
                                    )}
                                    {activeProcess === 'transport' && (
                                        <motion.div 
                                            initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }}
                                            className="inline-flex items-center gap-2 px-4 py-2 bg-blue-900/50 border border-blue-500/50 rounded-full text-blue-300 text-sm font-bold"
                                        >
                                            <Icon name="zap"/> Pumping Ions...
                                        </motion.div>
                                    )}
                                    {activeProcess === 'synthesis' && (
                                        <motion.div 
                                            initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }}
                                            className="inline-flex items-center gap-2 px-4 py-2 bg-purple-900/50 border border-purple-500/50 rounded-full text-purple-300 text-sm font-bold"
                                        >
                                            <Icon name="hammer"/> Building Molecules...
                                        </motion.div>
                                    )}
                                    {activeProcess === 'respiration' && (
                                        <motion.div 
                                            initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }}
                                            className="inline-flex items-center gap-2 px-4 py-2 bg-emerald-900/50 border border-emerald-500/50 rounded-full text-emerald-300 text-sm font-bold"
                                        >
                                            <Icon name="factory"/> Mitochondria Generating ATP...
                                        </motion.div>
                                    )}
                                </AnimatePresence>
                            </div>

                            {/* Background Context */}
                            <div className="absolute top-4 right-4 text-xs text-slate-500 font-mono">
                                Cytoplasm View
                            </div>

                        </div>
                        
                        <div className="mt-8 text-center max-w-lg text-slate-400 text-sm leading-relaxed">
                            ATP (Adenosine Triphosphate) stores energy in high-energy phosphate bonds. 
                            <br/>
                            Breaking the bond releases energy for cell work (Hydrolysis). 
                            <br/>
                            Respiration recharges ADP back to ATP (Phosphorylation).
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
