<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meiosis Visualizer | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Smooth Transitions */
        .cell-transition { transition: all 1s ease-in-out; }
        .chromosome-transition { transition: all 1s ease-in-out; }
        
        /* Glow Effect for Crossing Over */
        .glow { filter: drop-shadow(0 0 5px rgba(250, 204, 21, 0.8)); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATA: Meiosis Stages ---
        const STAGES = [
            { 
                id: 'prophase1', name: 'Prophase I', 
                desc: 'Homologous chromosomes pair up (Synapsis). Crossing over occurs to exchange genetic material.',
                label: 'Homologous Pairing & Crossing Over',
                state: 'crossing_over' 
            },
            { 
                id: 'metaphase1', name: 'Metaphase I', 
                desc: 'Homologous pairs align at the equator. Independent assortment occurs here.',
                label: 'Homologous Pairs Align at Equator',
                state: 'align_pairs'
            },
            { 
                id: 'anaphase1', name: 'Anaphase I', 
                desc: 'Homologous chromosomes separate and move to opposite poles. Sister chromatids stay together.',
                label: 'Homologous Chromosomes Separate',
                state: 'separate_pairs'
            },
            { 
                id: 'telophase1', name: 'Telophase I', 
                desc: 'Two haploid cells form. Each chromosome still consists of two chromatids.',
                label: 'Two Haploid Cells Form',
                state: 'two_cells'
            },
            { 
                id: 'metaphase2', name: 'Metaphase II', 
                desc: 'Chromosomes align at the equator in both cells.',
                label: 'Chromosomes Align Individually',
                state: 'align_chromosomes'
            },
            { 
                id: 'anaphase2', name: 'Anaphase II', 
                desc: 'Sister chromatids separate and move to opposite poles.',
                label: 'Sister Chromatids Separate',
                state: 'separate_chromatids'
            },
            { 
                id: 'telophase2', name: 'Telophase II', 
                desc: 'Four haploid daughter cells form, each genetically unique.',
                label: 'Four Unique Haploid Cells',
                state: 'four_cells'
            }
        ];

        // --- COMPONENTS ---

        // Single Chromosome (X-shape)
        const Chromosome = ({ x, y, color, rotation, scale = 1, leftArmColor, rightArmColor, isSeparated = false, separationDist = 0 }) => {
            // Base colors
            const c1 = leftArmColor || color;
            const c2 = rightArmColor || color;
            
            // If separated (Anaphase II), we draw two chromatids apart
            if (isSeparated) {
                return (
                    <g transform={`translate(${x}, ${y}) rotate(${rotation}) scale(${scale})`}>
                        {/* Left Chromatid moving left */}
                        <g transform={`translate(${-separationDist}, 0)`}>
                            <path d="M-2 -20 Q -10 0 -2 20" stroke={c1} strokeWidth="8" fill="none" strokeLinecap="round" />
                            <circle cx="-2" cy="0" r="3" fill="white" />
                        </g>
                        {/* Right Chromatid moving right */}
                        <g transform={`translate(${separationDist}, 0)`}>
                            <path d="M2 -20 Q 10 0 2 20" stroke={c2} strokeWidth="8" fill="none" strokeLinecap="round" />
                            <circle cx="2" cy="0" r="3" fill="white" />
                        </g>
                    </g>
                );
            }

            return (
                <g transform={`translate(${x}, ${y}) rotate(${rotation}) scale(${scale})`}>
                    {/* Left Chromatid */}
                    <path d="M-2 -25 Q -15 0 -2 25" stroke={c1} strokeWidth="8" fill="none" strokeLinecap="round" />
                    {/* Right Chromatid */}
                    <path d="M2 -25 Q 15 0 2 25" stroke={c2} strokeWidth="8" fill="none" strokeLinecap="round" />
                    {/* Centromere */}
                    <circle cx="0" cy="0" r="4" fill="white" stroke="#333" strokeWidth="1" />
                </g>
            );
        };

        // Helper for single chromatid in Telophase II
        const SingleChromatid = ({ x, y, color, rotation, scale = 1 }) => (
            <g transform={`translate(${x}, ${y}) rotate(${rotation}) scale(${scale})`}>
                <path d="M0 -20 Q -8 0 0 20" stroke={color} strokeWidth="6" fill="none" strokeLinecap="round" />
                <circle cx="0" cy="0" r="3" fill="white" stroke="#333" strokeWidth="1" />
            </g>
        );

        // Main Visualization Canvas
        const MeiosisCanvas = ({ stageIdx, crossedOver }) => {
            const state = STAGES[stageIdx].state;
            
            // --- CONFIG ---
            const cx = 300;
            const cy = 250;
            
            // Colors
            const paternalColor = "#3b82f6"; // Blue
            const maternalColor = "#ef4444"; // Red
            
            const pColor = crossedOver ? "url(#gradP)" : paternalColor;
            const mColor = crossedOver ? "url(#gradM)" : maternalColor;

            // --- RENDER LOGIC ---
            const renderContent = () => {
                switch (state) {
                    case 'crossing_over':
                        return (
                            <>
                                <circle cx={cx} cy={cy} r="140" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                {/* Pair 1 (Large) */}
                                <g className={crossedOver ? "" : "animate-pulse"}> {/* Pulse to suggest interaction */}
                                    <Chromosome x={cx-15} y={cy} color={pColor} rotation={10} scale={1.2} />
                                    <Chromosome x={cx+15} y={cy} color={mColor} rotation={-10} scale={1.2} />
                                </g>
                                {/* Pair 2 (Small) - simplified for clarity */}
                                <Chromosome x={cx-50} y={cy+60} color={pColor} rotation={45} scale={0.8} />
                                <Chromosome x={cx+20} y={cy-60} color={mColor} rotation={-45} scale={0.8} />
                                
                                {!crossedOver && (
                                    <text x={cx} y={cy+160} textAnchor="middle" fill="#fbbf24" fontSize="14" fontWeight="bold" className="animate-bounce">
                                        Click 'Apply Crossing Over' to mix genes!
                                    </text>
                                )}
                            </>
                        );

                    case 'align_pairs':
                        return (
                            <>
                                <circle cx={cx} cy={cy} r="140" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                {/* Spindle Fibers */}
                                <line x1={cx-140} y1={cy} x2={cx-20} y2={cy} stroke="#64748b" strokeWidth="1" strokeDasharray="4,4" />
                                <line x1={cx+140} y1={cy} x2={cx+20} y2={cy} stroke="#64748b" strokeWidth="1" strokeDasharray="4,4" />
                                
                                {/* Aligned Pairs at Equator (Vertical) */}
                                {/* Large Pair */}
                                <Chromosome x={cx-15} y={cy-20} color={pColor} rotation={90} scale={1.2} />
                                <Chromosome x={cx+15} y={cy-20} color={mColor} rotation={90} scale={1.2} />
                                {/* Small Pair */}
                                <Chromosome x={cx-15} y={cy+50} color={mColor} rotation={90} scale={0.8} /> {/* Independent assortment: random side */}
                                <Chromosome x={cx+15} y={cy+50} color={pColor} rotation={90} scale={0.8} />
                            </>
                        );

                    case 'separate_pairs':
                        return (
                            <>
                                <circle cx={cx} cy={cy} r="140" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                {/* Separating */}
                                <Chromosome x={cx-60} y={cy-20} color={pColor} rotation={90} scale={1.2} />
                                <Chromosome x={cx+60} y={cy-20} color={mColor} rotation={90} scale={1.2} />
                                
                                <Chromosome x={cx-60} y={cy+50} color={mColor} rotation={90} scale={0.8} />
                                <Chromosome x={cx+60} y={cy+50} color={pColor} rotation={90} scale={0.8} />
                            </>
                        );

                    case 'two_cells':
                        return (
                            <>
                                {/* Cell 1 */}
                                <circle cx={cx-80} cy={cy} r="70" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <Chromosome x={cx-80} y={cy-15} color={pColor} rotation={Math.random()*180} scale={1.2} />
                                <Chromosome x={cx-80} y={cy+25} color={mColor} rotation={Math.random()*180} scale={0.8} />
                                
                                {/* Cell 2 */}
                                <circle cx={cx+80} cy={cy} r="70" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <Chromosome x={cx+80} y={cy-15} color={mColor} rotation={Math.random()*180} scale={1.2} />
                                <Chromosome x={cx+80} y={cy+25} color={pColor} rotation={Math.random()*180} scale={0.8} />
                            </>
                        );

                    case 'align_chromosomes':
                        return (
                            <>
                                {/* Cell 1 */}
                                <circle cx={cx-80} cy={cy} r="70" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <Chromosome x={cx-80} y={cy-15} color={pColor} rotation={0} scale={1.2} />
                                <Chromosome x={cx-80} y={cy+25} color={mColor} rotation={0} scale={0.8} />

                                {/* Cell 2 */}
                                <circle cx={cx+80} cy={cy} r="70" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <Chromosome x={cx+80} y={cy-15} color={mColor} rotation={0} scale={1.2} />
                                <Chromosome x={cx+80} y={cy+25} color={pColor} rotation={0} scale={0.8} />
                                
                                <line x1={cx-80} y1={cy-80} x2={cx-80} y2={cy+80} stroke="#64748b" strokeWidth="1" strokeDasharray="2,2" />
                                <line x1={cx+80} y1={cy-80} x2={cx+80} y2={cy+80} stroke="#64748b" strokeWidth="1" strokeDasharray="2,2" />
                            </>
                        );

                    case 'separate_chromatids':
                        return (
                            <>
                                {/* Cell 1 Separating */}
                                <circle cx={cx-80} cy={cy} r="70" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <Chromosome x={cx-80} y={cy-15} color={pColor} rotation={0} scale={1.2} isSeparated={true} separationDist={20} />
                                <Chromosome x={cx-80} y={cy+25} color={mColor} rotation={0} scale={0.8} isSeparated={true} separationDist={20} />

                                {/* Cell 2 Separating */}
                                <circle cx={cx+80} cy={cy} r="70" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <Chromosome x={cx+80} y={cy-15} color={mColor} rotation={0} scale={1.2} isSeparated={true} separationDist={20} />
                                <Chromosome x={cx+80} y={cy+25} color={pColor} rotation={0} scale={0.8} isSeparated={true} separationDist={20} />
                            </>
                        );
                    
                    case 'four_cells':
                         return (
                            <g transform={`translate(${cx}, ${cy})`}>
                                {/* Top Left Cell */}
                                <circle cx="-100" cy="-60" r="50" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <circle cx="-100" cy="-60" r="35" fill="none" stroke="#64748b" strokeWidth="1" strokeDasharray="3,3" /> {/* Nucleus */}
                                <SingleChromatid x="-100" y="-75" color={pColor} rotation={-10} scale={1.0} />
                                <SingleChromatid x="-100" y="-45" color={mColor} rotation={10} scale={0.7} />
                                <text x="-100" y="-60" textAnchor="middle" fontSize="40" fill="white" opacity="0.1" fontWeight="bold">n</text>
                                
                                {/* Top Right Cell */}
                                <circle cx="100" cy="-60" r="50" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <circle cx="100" cy="-60" r="35" fill="none" stroke="#64748b" strokeWidth="1" strokeDasharray="3,3" />
                                <SingleChromatid x="100" y="-75" color={pColor} rotation={10} scale={1.0} />
                                <SingleChromatid x="100" y="-45" color={mColor} rotation={-10} scale={0.7} />
                                <text x="100" y="-60" textAnchor="middle" fontSize="40" fill="white" opacity="0.1" fontWeight="bold">n</text>
                                
                                {/* Bottom Left Cell */}
                                <circle cx="-100" cy="60" r="50" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <circle cx="-100" cy="60" r="35" fill="none" stroke="#64748b" strokeWidth="1" strokeDasharray="3,3" />
                                <SingleChromatid x="-100" y="45" color={mColor} rotation={-10} scale={1.0} />
                                <SingleChromatid x="-100" y="75" color={pColor} rotation={10} scale={0.7} />
                                <text x="-100" y="60" textAnchor="middle" fontSize="40" fill="white" opacity="0.1" fontWeight="bold">n</text>

                                {/* Bottom Right Cell */}
                                <circle cx="100" cy="60" r="50" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                                <circle cx="100" cy="60" r="35" fill="none" stroke="#64748b" strokeWidth="1" strokeDasharray="3,3" />
                                <SingleChromatid x="100" y="45" color={mColor} rotation={10} scale={1.0} />
                                <SingleChromatid x="100" y="75" color={pColor} rotation={-10} scale={0.7} />
                                <text x="100" y="60" textAnchor="middle" fontSize="40" fill="white" opacity="0.1" fontWeight="bold">n</text>
                            </g>
                         );
                     
                    default: return null;
                }
            };

            return (
                <svg width="100%" height="100%" viewBox="0 0 600 500" className="bg-slate-900 rounded-2xl shadow-inner border border-slate-800">
                    <defs>
                        {/* Gradients for Crossing Over Effect */}
                        <linearGradient id="gradP" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stopColor="#ef4444" /> {/* Red Tip */}
                            <stop offset="20%" stopColor="#3b82f6" /> {/* Blue Body */}
                            <stop offset="80%" stopColor="#3b82f6" />
                            <stop offset="100%" stopColor="#ef4444" /> {/* Red Tip */}
                        </linearGradient>
                        <linearGradient id="gradM" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stopColor="#3b82f6" /> {/* Blue Tip */}
                            <stop offset="20%" stopColor="#ef4444" /> {/* Red Body */}
                            <stop offset="80%" stopColor="#ef4444" />
                            <stop offset="100%" stopColor="#3b82f6" /> {/* Blue Tip */}
                        </linearGradient>
                    </defs>
                    {renderContent()}
                </svg>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [stage, setStage] = useState(0);
            const [crossedOver, setCrossedOver] = useState(false);
            const [isPlaying, setIsPlaying] = useState(false);

            // Auto-play
            useEffect(() => {
                let interval;
                if (isPlaying) {
                    interval = setInterval(() => {
                        setStage(s => {
                            if (s >= STAGES.length - 1) {
                                setIsPlaying(false);
                                return s;
                            }
                            // Auto trigger crossing over at stage 0
                            if (s === 0) setCrossedOver(true);
                            return s + 1;
                        });
                    }, 2000);
                }
                return () => clearInterval(interval);
            }, [isPlaying]);

            const nextStage = () => setStage(s => Math.min(s + 1, STAGES.length - 1));
            const prevStage = () => setStage(s => Math.max(0, s - 1));
            const reset = () => { setStage(0); setCrossedOver(false); setIsPlaying(false); };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="dna" className="text-purple-400" /> Meiosis Sim
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Cell Division & Variation</p>
                        </div>

                        <div className="p-6 flex-1 overflow-y-auto space-y-6">
                            
                            {/* Stage Indicator */}
                            <div>
                                <div className="flex justify-between text-xs font-bold text-slate-500 uppercase mb-2">
                                    <span>Progress</span>
                                    <span>{stage + 1} / {STAGES.length}</span>
                                </div>
                                <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                                    <div className="h-full bg-purple-500 transition-all duration-500" style={{width: `${((stage + 1) / STAGES.length) * 100}%`}}></div>
                                </div>
                            </div>

                            {/* Info Box */}
                            <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-lg">
                                <div className="text-xs font-bold text-slate-500 uppercase mb-2">Current Phase</div>
                                <div className="text-xl font-black text-white mb-1">{STAGES[stage].name}</div>
                                <div className="text-xs font-bold text-emerald-400 mb-3">{STAGES[stage].label}</div>
                                <p className="text-sm text-slate-300 leading-relaxed border-t border-slate-700 pt-3">
                                    {STAGES[stage].desc}
                                </p>
                            </div>

                            {/* Crossing Over Control */}
                            {stage === 0 && (
                                <div className="bg-blue-900/20 p-4 rounded-xl border border-blue-500/30 animate-in fade-in">
                                    <div className="flex justify-between items-center mb-2">
                                        <div className="text-xs font-bold text-blue-400 uppercase flex items-center gap-2">
                                            <Icon name="shuffle" size={14} /> Variation
                                        </div>
                                        <span className={`text-xs font-mono px-2 py-0.5 rounded ${crossedOver ? 'bg-green-500 text-white' : 'bg-slate-700 text-slate-400'}`}>
                                            {crossedOver ? 'ACTIVE' : 'OFF'}
                                        </span>
                                    </div>
                                    <button 
                                        onClick={() => setCrossedOver(!crossedOver)}
                                        className={`w-full py-2 rounded-lg font-bold text-sm transition-all border
                                            ${crossedOver ? 'bg-green-600 border-green-500 text-white' : 'bg-slate-800 border-slate-600 text-slate-300 hover:bg-slate-700'}
                                        `}
                                    >
                                        {crossedOver ? 'Crossing Over Applied' : 'Apply Crossing Over'}
                                    </button>
                                    <p className="text-[10px] text-slate-400 mt-2">
                                        Exchanges DNA between homologous chromosomes, creating genetic diversity.
                                    </p>
                                </div>
                            )}
                            
                            {/* Legend */}
                            <div className="flex gap-4 text-[10px] text-slate-400">
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded-full bg-blue-500"></div> Paternal
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded-full bg-red-500"></div> Maternal
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-4 overflow-hidden">
                        
                        {/* Visualizer */}
                        <div className="flex-1 flex items-center justify-center relative">
                            <MeiosisCanvas stageIdx={stage} crossedOver={crossedOver} />
                        </div>

                        {/* Control Bar */}
                        <div className="h-24 mt-4 flex items-center justify-center gap-6 shrink-0">
                            <button 
                                onClick={prevStage} 
                                disabled={stage === 0}
                                className="p-3 rounded-full bg-slate-800 hover:bg-slate-700 text-white disabled:opacity-30 transition-all border border-slate-700"
                            >
                                <Icon name="chevron-left" size={24} />
                            </button>

                            <button 
                                onClick={() => setIsPlaying(!isPlaying)}
                                className={`px-8 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all active:scale-95
                                    ${isPlaying ? 'bg-yellow-600 text-white' : 'bg-purple-600 hover:bg-purple-500 text-white'}
                                `}
                            >
                                <Icon name={isPlaying ? "pause" : "play"} fill="currentColor" />
                                {isPlaying ? 'Pause' : 'Auto Play'}
                            </button>

                            <button 
                                onClick={nextStage}
                                disabled={stage === STAGES.length - 1}
                                className="p-3 rounded-full bg-slate-800 hover:bg-slate-700 text-white disabled:opacity-30 transition-all border border-slate-700"
                            >
                                <Icon name="chevron-right" size={24} />
                            </button>

                            <button 
                                onClick={reset}
                                className="p-3 rounded-full bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white transition-all border border-slate-700 ml-4"
                                title="Reset"
                            >
                                <Icon name="rotate-ccw" size={20} />
                            </button>
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
