<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Flow Tracker | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- COMPONENTS ---
        
        const Connector = () => (
            <svg className="absolute top-full left-20 w-32 h-20 pointer-events-none" style={{ zIndex: 0, overflow: 'visible' }}>
                {/* L-Shape Connector Path */}
                <path d="M 0 0 V 40 H 60 V 80" stroke="#334155" strokeWidth="4" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                {/* Animated Energy Particle */}
                <circle r="3" fill="#10b981">
                    <animateMotion path="M 0 0 V 40 H 60 V 80" dur="1.5s" repeatCount="indefinite" />
                </circle>
                {/* Arrow Head */}
                <path d="M 55 75 L 60 82 L 65 75" fill="#334155" />
            </svg>
        );

        const TrophicLevel = ({ data, index, isLast }) => {
            const lossRespiration = data.energy * 0.6; // 60% Heat
            const lossWaste = data.energy * 0.3; // 30% Waste
            const transfer = data.energy * 0.1; // 10% Transfer

            return (
                <motion.div 
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: index * 0.1 }}
                    className={`relative flex items-start ${isLast ? 'mb-0' : 'mb-8'}`}
                    style={{ marginLeft: `${index * 60}px` }} // Staircase effect
                >
                    {/* 1. Main Organism Card */}
                    <div className={`w-40 h-40 bg-slate-800 rounded-2xl border-2 flex flex-col items-center justify-center shadow-xl z-10 shrink-0 relative`}
                         style={{ borderColor: data.color }}
                    >
                        <div className="mb-2" style={{ color: data.color }}>
                            <Icon name={data.icon} size={40} />
                        </div>
                        <div className="text-sm font-bold text-white mb-1 text-center px-2">{data.name}</div>
                        <div className="text-lg font-mono font-black" style={{ color: data.color }}>
                            {data.energy.toLocaleString()} J
                        </div>
                        {/* Corner Label */}
                        <div className="absolute top-2 left-2 text-[10px] text-slate-500 font-bold uppercase">
                            L{index + 1}
                        </div>
                        
                        {/* Connector to next level */}
                        {!isLast && <Connector />}
                    </div>

                    {/* 2. Data Details Panel (Right Side) */}
                    <div className="ml-6 mt-4 flex flex-col gap-3 min-w-[240px]">
                        {/* Heat Loss */}
                        <div className="flex items-center justify-between bg-red-900/10 border border-red-500/20 p-2 rounded-lg">
                            <div className="flex items-center gap-2 text-red-400">
                                <Icon name="flame" size={16}/>
                                <span className="text-xs font-bold">Heat Loss (60%)</span>
                            </div>
                            <span className="text-xs font-mono text-red-300">-{lossRespiration.toLocaleString()} J</span>
                        </div>

                        {/* Waste */}
                        <div className="flex items-center justify-between bg-slate-700/20 border border-slate-600/30 p-2 rounded-lg">
                            <div className="flex items-center gap-2 text-slate-400">
                                <Icon name="trash-2" size={16}/>
                                <span className="text-xs font-bold">Waste (30%)</span>
                            </div>
                            <span className="text-xs font-mono text-slate-400">-{lossWaste.toLocaleString()} J</span>
                        </div>

                        {/* Transfer (Next Level) */}
                        {!isLast && (
                            <div className="flex items-center justify-between bg-emerald-900/10 border border-emerald-500/20 p-2 rounded-lg mt-1">
                                <div className="flex items-center gap-2 text-emerald-400">
                                    <Icon name="arrow-right-circle" size={16}/>
                                    <span className="text-xs font-bold">Transfer (10%)</span>
                                </div>
                                <span className="text-xs font-mono text-emerald-300">{transfer.toLocaleString()} J</span>
                            </div>
                        )}
                    </div>

                </motion.div>
            );
        };

        const SunNode = () => (
            <div className="relative flex items-start mb-8">
                {/* Sun Card */}
                <div className="w-40 h-40 bg-yellow-900/20 rounded-full border-4 border-yellow-500 flex flex-col items-center justify-center shadow-[0_0_30px_rgba(234,179,8,0.2)] z-10 shrink-0 animate-pulse-slow">
                    <Icon name="sun" size={48} className="text-yellow-400 mb-2" />
                    <div className="text-lg font-black text-yellow-400">SUN</div>
                    <div className="text-[10px] text-yellow-200/70">Ultimate Source</div>
                    <Connector />
                </div>
                
                {/* Sun Info */}
                <div className="ml-6 mt-12 text-sm text-slate-400 max-w-xs">
                    Solar energy enters the ecosystem. Producers capture ~1% for photosynthesis.
                </div>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [sunEnergy, setSunEnergy] = useState(100000); // Joules (Input to producers)

            // Calculate Energy at each level (10% Rule)
            const producerEnergy = sunEnergy; 
            const primaryEnergy = Math.floor(producerEnergy * 0.1);
            const secondaryEnergy = Math.floor(primaryEnergy * 0.1);
            const tertiaryEnergy = Math.floor(secondaryEnergy * 0.1);

            const levels = [
                { id: 'producer', name: 'Producer', icon: 'leaf', color: '#22c55e', energy: producerEnergy },
                { id: 'primary', name: 'Primary Consumer', icon: 'rabbit', color: '#eab308', energy: primaryEnergy },
                { id: 'secondary', name: 'Secondary Consumer', icon: 'worm', color: '#f97316', energy: secondaryEnergy },
                { id: 'tertiary', name: 'Tertiary Consumer', icon: 'bird', color: '#ef4444', energy: tertiaryEnergy }
            ];

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col overflow-hidden font-sans">
                    
                    {/* Header / Controls */}
                    <div className="h-20 bg-slate-900 border-b border-slate-800 flex items-center px-8 justify-between shrink-0 z-30 shadow-md">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-emerald-500/20 rounded-lg text-emerald-400">
                                <Icon name="zap" size={24}/>
                            </div>
                            <div>
                                <h1 className="text-xl font-black tracking-tight">Energy Flow Tracker</h1>
                                <p className="text-xs text-slate-400">The 10% Rule in Ecosystems</p>
                            </div>
                        </div>

                        <div className="flex items-center gap-4 bg-slate-800 p-2 px-4 rounded-xl border border-slate-700">
                            <label className="text-[10px] font-bold text-slate-500 uppercase">START ENERGY (PRODUCERS)</label>
                            <div className="flex items-center gap-3 w-64">
                                <input 
                                    type="range" 
                                    min="1000" max="1000000" step="1000"
                                    value={sunEnergy}
                                    onChange={(e) => setSunEnergy(parseInt(e.target.value))}
                                    className="w-full accent-emerald-500 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"
                                />
                                <span className="font-mono font-bold text-emerald-400 w-24 text-right text-sm">{sunEnergy.toLocaleString()} J</span>
                            </div>
                        </div>
                    </div>

                    {/* Main Stage: Staircase Layout */}
                    <div className="flex-1 overflow-y-auto overflow-x-auto p-12 custom-scrollbar relative">
                        
                        {/* Background Grid */}
                        <div className="absolute inset-0 opacity-5 pointer-events-none" 
                            style={{backgroundImage: 'radial-gradient(#475569 1px, transparent 1px)', backgroundSize: '30px 30px'}}>
                        </div>

                        <div className="min-w-max pb-10">
                            
                            {/* 1. Sun */}
                            <SunNode />

                            {/* 2. Trophic Levels */}
                            {levels.map((level, i) => (
                                <TrophicLevel 
                                    key={level.id} 
                                    data={level} 
                                    index={i + 1} // Offset for sun
                                    isLast={i === levels.length - 1} 
                                />
                            ))}

                        </div>
                    </div>

                    {/* Footer Legend */}
                    <div className="bg-slate-900 border-t border-slate-800 p-3 flex justify-center gap-8 text-xs text-slate-400 shrink-0 z-30">
                        <div className="flex items-center gap-2">
                            <Icon name="flame" size={14} className="text-red-500"/>
                            <span><strong>90% Loss:</strong> Heat (Respiration), Movement, Excretion, Uneaten parts.</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <Icon name="arrow-right-circle" size={14} className="text-emerald-500"/>
                            <span><strong>10% Transfer:</strong> Stored as biomass (Growth) available for next level.</span>
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
