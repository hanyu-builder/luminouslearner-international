<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathing Mechanism Simulator - LuminousLearner International</title>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Air Particle Flow */
        .air-particle {
            transition: transform 0.5s linear;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- ANATOMY CANVAS ---
        const BreathingCanvas = ({ state }) => { 
            // state: 0 (Full Exhale) to 1 (Full Inhale)
            
            // Dimensions
            const width = 500;
            const height = 600;
            const cx = width / 2;

            // --- DYNAMIC VALUES ---
            // Rib Cage Expansion (Up and Out)
            const ribWidth = 260 + (state * 60); 
            const ribY = 150 - (state * 40); 
            
            // Diaphragm Movement 
            // Inhale (state 1): Moves DOWN (High Y value), Flattens
            // Exhale (state 0): Moves UP (Low Y value), Domes
            const diaEdgeY = 480; // Fixed anchor points at body wall
            const diaCenterY = 380 + (state * 100); // 380 (Dome) -> 480 (Flat)

            // Lung Volume
            // Scale from 0.75 to 1.05
            const lungScale = 0.75 + (state * 0.3); 

            return (
                <svg viewBox="0 0 500 600" className="w-full h-full drop-shadow-2xl">
                    
                    {/* Trachea (Fixed Position) */}
                    <rect x={cx-15} y="20" width="30" height="150" fill="#cbd5e1" stroke="#64748b" strokeWidth="2" />
                    {[...Array(6)].map((_, i) => (
                        <path key={i} d={`M ${cx-15} ${40+i*20} Q ${cx} ${45+i*20} ${cx+15} ${40+i*20}`} stroke="#94a3b8" fill="none" />
                    ))}

                    {/* Lungs (Left & Right) - Anchor top to trachea end */}
                    <g transform={`translate(${cx}, 170) scale(${lungScale})`}>
                        {/* Right Lung */}
                        <path d="M 10 0 C 80 0 100 50 100 150 C 100 220 50 240 10 240 Z" fill="#fca5a5" stroke="#ef4444" strokeWidth="2" />
                        {/* Left Lung */}
                        <path d="M -10 0 C -80 0 -100 50 -100 150 C -100 220 -50 240 -10 240 Z" fill="#fca5a5" stroke="#ef4444" strokeWidth="2" />
                    </g>

                    {/* Rib Cage */}
                    <g transform={`translate(${cx}, ${ribY})`}>
                        {/* Left Ribs */}
                        {[...Array(5)].map((_, i) => (
                            <path key={`l-${i}`} 
                                d={`M -40 ${i*50} Q ${-ribWidth/2} ${i*50+20} ${-ribWidth/2 - 10} ${i*50+60}`} 
                                fill="none" stroke="#e2e8f0" strokeWidth="8" strokeLinecap="round" 
                            />
                        ))}
                        {/* Right Ribs */}
                        {[...Array(5)].map((_, i) => (
                            <path key={`r-${i}`} 
                                d={`M 40 ${i*50} Q ${ribWidth/2} ${i*50+20} ${ribWidth/2 + 10} ${i*50+60}`} 
                                fill="none" stroke="#e2e8f0" strokeWidth="8" strokeLinecap="round" 
                            />
                        ))}
                    </g>

                    {/* Diaphragm (Muscle Sheet) */}
                    <path 
                        d={`M ${cx - ribWidth/2 - 20} ${diaEdgeY} Q ${cx} ${diaCenterY} ${cx + ribWidth/2 + 20} ${diaEdgeY}`} 
                        fill="none" stroke="#ef4444" strokeWidth="12" strokeLinecap="round"
                    />
                    {/* Muscle Texture */}
                    <path 
                        d={`M ${cx - ribWidth/2 - 20} ${diaEdgeY} Q ${cx} ${diaCenterY} ${cx + ribWidth/2 + 20} ${diaEdgeY}`} 
                        fill="none" stroke="#fca5a5" strokeWidth="6" strokeLinecap="round"
                    />

                    {/* Air Flow Particles */}
                    <g className="air-particles">
                        {[...Array(10)].map((_, i) => {
                            // Calculate position based on state to simulate flow direction
                            // state > 0.5 (Inhaling) -> particles move down
                            // state < 0.5 (Exhaling) -> particles move up
                            // Using a simple visual loop here for effect
                            
                            const cycleTime = 2000;
                            const offset = (Date.now() % cycleTime) / cycleTime;
                            
                            // Visual placeholder for flow - React re-renders handle animation state better in parent
                            // Here we just render static for snapshot or use CSS class if passed
                            return (
                                <circle key={i} cx={cx + (i%2===0 ? 5 : -5)} cy={50 + i*15} r="3" fill="#38bdf8" opacity={0.7} />
                            );
                        })}
                    </g>

                    {/* Labels */}
                    <text x={cx + ribWidth/2 + 60} y={ribY + 100} fill="#94a3b8" fontSize="14" fontWeight="bold">Rib Cage</text>
                    <text x={cx + ribWidth/2 + 60} y={diaEdgeY} fill="#f87171" fontSize="14" fontWeight="bold">Diaphragm</text>

                </svg>
            );
        };

        const BellJarModel = ({ state }) => {
            // Bell Jar Sim
            // Pull rubber sheet down -> Balloons expand
            const sheetY = 350 + (state * 50); // 350 (relaxed) -> 400 (pulled)
            const balloonScale = 0.8 + (state * 0.4);

            return (
                <svg viewBox="0 0 400 500" className="w-full h-full drop-shadow-xl">
                    {/* Jar */}
                    <path d="M 100 50 L 100 350 L 300 350 L 300 50 Q 200 -20 100 50" fill="rgba(255,255,255,0.1)" stroke="#94a3b8" strokeWidth="4" />
                    
                    {/* Y-tube */}
                    <path d="M 200 0 L 200 100 M 200 100 L 160 150 M 200 100 L 240 150" stroke="#cbd5e1" strokeWidth="6" fill="none" />
                    
                    {/* Balloons */}
                    <g transform={`translate(160, 150) scale(${balloonScale})`}>
                        <circle cx="0" cy="30" r="30" fill="#f87171" />
                    </g>
                    <g transform={`translate(240, 150) scale(${balloonScale})`}>
                        <circle cx="0" cy="30" r="30" fill="#f87171" />
                    </g>

                    {/* Rubber Sheet (Diaphragm) */}
                    <path d={`M 100 350 Q 200 ${sheetY + 50} 300 350`} fill="#fcd34d" stroke="#d97706" strokeWidth="2" />
                    
                    {/* Handle */}
                    <line x1="200" y1={sheetY + 25} x2="200" y2={sheetY + 80} stroke="#94a3b8" strokeWidth="4" />
                    <circle cx="200" cy={sheetY + 85} r="5" fill="#94a3b8" />
                    
                    {/* Arrow indicating pull */}
                    {state > 0.1 && (
                        <g transform={`translate(230, ${sheetY + 50})`}>
                            <path d="M 0 0 L 0 30 M -5 25 L 0 30 L 5 25" stroke="#ef4444" strokeWidth="2" fill="none" />
                            <text x="10" y="20" fill="#ef4444" fontSize="12" fontWeight="bold">Pull</text>
                        </g>
                    )}
                    
                    {/* Labels */}
                    <text x="50" y="100" fill="#94a3b8" fontSize="12">Glass Jar (Thorax)</text>
                    <text x="320" y="150" fill="#f87171" fontSize="12">Balloons (Lungs)</text>
                    <text x="320" y="400" fill="#fcd34d" fontSize="12">Rubber Sheet (Diaphragm)</text>
                </svg>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [viewMode, setViewMode] = useState('anatomy'); // anatomy, belljar
            const [breathState, setBreathState] = useState(0.5); // 0 to 1 Slider
            const [isPlaying, setIsPlaying] = useState(false);
            
            // Auto-breathe loop
            useEffect(() => {
                let animationFrame;
                let startTime;
                
                const animate = (time) => {
                    if (!startTime) startTime = time;
                    const elapsed = time - startTime;
                    // Sine wave 0 to 1 to 0
                    const cycle = (Math.sin(elapsed * 0.002) + 1) / 2; 
                    setBreathState(cycle);
                    
                    if (isPlaying) {
                        animationFrame = requestAnimationFrame(animate);
                    }
                };

                if (isPlaying) {
                    animationFrame = requestAnimationFrame(animate);
                }

                return () => cancelAnimationFrame(animationFrame);
            }, [isPlaying]);

            // Determine Phase
            const phase = breathState > 0.55 ? 'Inhalation' : breathState < 0.45 ? 'Exhalation' : 'Pause';
            // Simple pressure simulation (Inverse to volume)
            // 760 mmHg base. Inhale (vol up) -> Pressure down (<760). Exhale (vol down) -> Pressure up (>760).
            // Let's say state 0 (Exhale) = 765, state 1 (Inhale) = 755
            // But wait, during inhalation (state going up), pressure drops.
            // Let's simplify: High Volume (state 1) is achieved because pressure WAS low.
            const pressureVal = 760 - (breathState - 0.5) * 10; 

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-96 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="wind" className="text-sky-400" /> Breathing Sim
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Mechanism of Ventilation</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto">
                            
                            {/* Mode Switch */}
                            <div className="bg-slate-800 p-1 rounded-xl flex border border-slate-700">
                                <button 
                                    onClick={() => setViewMode('anatomy')}
                                    className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${viewMode === 'anatomy' ? 'bg-sky-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Human Anatomy
                                </button>
                                <button 
                                    onClick={() => setViewMode('belljar')}
                                    className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${viewMode === 'belljar' ? 'bg-orange-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Bell Jar Model
                                </button>
                            </div>

                            {/* Controls */}
                            <div className="space-y-6">
                                <button 
                                    onClick={() => setIsPlaying(!isPlaying)}
                                    className={`w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg
                                        ${isPlaying ? 'bg-red-600 hover:bg-red-500' : 'bg-emerald-600 hover:bg-emerald-500'}
                                    `}
                                >
                                    {isPlaying ? <><Icon name="pause" size={18}/> Stop Breathing</> : <><Icon name="play" size={18}/> Auto Breathe</>}
                                </button>

                                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                    <div className="flex justify-between text-xs mb-2">
                                        <span className="text-slate-400 font-bold">Manual Control</span>
                                        <span className={`font-mono font-bold ${phase === 'Inhalation' ? 'text-sky-400' : phase === 'Exhalation' ? 'text-orange-400' : 'text-slate-400'}`}>{phase}</span>
                                    </div>
                                    <input 
                                        type="range" min="0" max="1" step="0.01"
                                        value={breathState}
                                        disabled={isPlaying}
                                        onChange={(e) => setBreathState(parseFloat(e.target.value))}
                                        className="w-full accent-sky-500 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500 mt-2">
                                        <span>Full Exhale</span>
                                        <span>Full Inhale</span>
                                    </div>
                                </div>
                            </div>

                            {/* Metrics */}
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-inner">
                                <div className="flex justify-between items-center mb-3">
                                    <span className="text-xs font-bold text-slate-500 uppercase flex items-center gap-2">
                                        <Icon name="gauge" size={14}/> Thoracic Pressure
                                    </span>
                                    <span className={`text-lg font-mono font-bold ${pressureVal < 760 ? 'text-sky-400' : 'text-red-400'}`}>
                                        {pressureVal.toFixed(1)} mmHg
                                    </span>
                                </div>
                                <div className="w-full bg-slate-900 h-4 rounded-full overflow-hidden relative border border-slate-700">
                                    <div className="absolute top-0 bottom-0 left-1/2 w-0.5 bg-slate-500 z-10"></div> {/* 760 mark */}
                                    <div 
                                        className={`absolute top-0 bottom-0 transition-all duration-100 ${pressureVal < 760 ? 'bg-sky-500 right-1/2' : 'bg-red-500 left-1/2'}`}
                                        style={{ width: `${Math.abs(pressureVal - 760) * 2}%` }} // Scale factor
                                    ></div>
                                </div>
                                <div className="text-center text-[10px] text-slate-500 mt-1">Atmospheric Pressure (760)</div>
                            </div>

                            {/* Key Info */}
                            <div className="space-y-2 text-xs text-slate-300 bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                <div className="font-bold text-slate-400 uppercase mb-2 flex items-center gap-2"><Icon name="info" size={14}/> Mechanism Details</div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <span className="block text-sky-400 font-bold mb-1">Inhalation</span>
                                        <ul className="list-disc pl-3 space-y-1 opacity-80">
                                            <li>Ribs: Up & Out</li>
                                            <li>Diaphragm: Flat (Contract)</li>
                                            <li>Vol: Increase</li>
                                            <li>Pres: Decrease</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <span className="block text-orange-400 font-bold mb-1">Exhalation</span>
                                        <ul className="list-disc pl-3 space-y-1 opacity-80">
                                            <li>Ribs: Down & In</li>
                                            <li>Diaphragm: Dome (Relax)</li>
                                            <li>Vol: Decrease</li>
                                            <li>Pres: Increase</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-8 overflow-hidden">
                        
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center p-4">
                            
                            {/* Canvas Area */}
                            <div className="w-full h-full max-w-lg">
                                {viewMode === 'anatomy' ? (
                                    <BreathingCanvas state={breathState} />
                                ) : (
                                    <BellJarModel state={breathState} />
                                )}
                            </div>

                            {/* Overlay Label */}
                            <div className={`absolute bottom-8 px-6 py-2 backdrop-blur rounded-full border border-white/10 text-sm font-bold shadow-lg transition-colors duration-300
                                ${phase === 'Inhalation' ? 'bg-sky-500/20 text-sky-300 border-sky-500/50' : phase === 'Exhalation' ? 'bg-orange-500/20 text-orange-300 border-orange-500/50' : 'bg-slate-800 text-slate-400'}
                            `}>
                                {phase}
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
