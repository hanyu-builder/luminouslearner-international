<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCR Cycle Animator - LuminousLearner International</title>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Polymerase Glow */
        .taq-glow {
            filter: drop-shadow(0 0 5px #facc15);
        }
        
        /* Heat Wave */
        .heat-wave {
            animation: heat 2s infinite linear;
        }
        @keyframes heat {
            0% { opacity: 0; transform: translateY(10px) scale(0.8); }
            50% { opacity: 0.5; }
            100% { opacity: 0; transform: translateY(-20px) scale(1.2); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = window.Recharts;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- CONSTANTS ---
        const CYCLES = [
            { id: 'denaturation', temp: 95, name: 'Denaturation', desc: 'Hydrogen bonds break. DNA strands separate.', duration: 2000 },
            { id: 'annealing', temp: 55, name: 'Annealing', desc: 'Primers bind to complementary sequences.', duration: 2000 },
            { id: 'extension', temp: 72, name: 'Extension', desc: 'Taq polymerase synthesizes new DNA strands.', duration: 3000 }
        ];

        // --- COMPONENTS ---

        const DNAStrand = ({ x, y, width, isDouble, isSeparate, separationDist, progress = 0, hasPrimers = false, isExtending = false }) => {
            
            const renderStrand = (offsetY, isTop, extensionProgress = 0) => (
                <g transform={`translate(0, ${offsetY})`}>
                    {/* Backbone */}
                    <line x1="0" y1="0" x2={width} y2="0" stroke={isTop ? "#38bdf8" : "#fbbf24"} strokeWidth="4" strokeLinecap="round" />
                    
                    {/* Bases */}
                    {[...Array(10)].map((_, i) => (
                        <line 
                            key={i} 
                            x1={20 + i * (width/10)} 
                            y1="0" 
                            x2={20 + i * (width/10)} 
                            y2={isTop ? 15 : -15} 
                            stroke={isTop ? "#38bdf8" : "#fbbf24"} 
                            strokeWidth="2" 
                        />
                    ))}

                    {/* Primer (Short segment) */}
                    {hasPrimers && (
                        <motion.line 
                            initial={{ opacity: 0 }}
                            animate={{ opacity: 1 }}
                            x1={isTop ? width - 40 : 20} 
                            y1={isTop ? 25 : -25} 
                            x2={isTop ? width - 20 : 40} 
                            y2={isTop ? 25 : -25} 
                            stroke="#f472b6" 
                            strokeWidth="4" 
                            strokeLinecap="round"
                        />
                    )}

                    {/* New Strand Extension */}
                    {isExtending && (
                        <motion.line 
                            initial={{ x2: isTop ? width - 40 : 40 }}
                            animate={{ x2: isTop ? 20 : width - 20 }}
                            transition={{ duration: 2, ease: "linear" }}
                            x1={isTop ? width - 40 : 40} 
                            y1={isTop ? 25 : -25} 
                            y2={isTop ? 25 : -25} 
                            stroke="#f472b6" 
                            strokeWidth="4" 
                            strokeLinecap="round"
                            strokeDasharray="4 2"
                        />
                    )}

                    {/* Taq Polymerase */}
                    {isExtending && (
                        <motion.circle 
                            r="12" 
                            fill="#facc15" 
                            className="taq-glow"
                            initial={{ cx: isTop ? width - 40 : 40 }}
                            animate={{ cx: isTop ? 20 : width - 20 }}
                            cy={isTop ? 25 : -25}
                            transition={{ duration: 2, ease: "linear" }}
                        />
                    )}
                </g>
            );

            return (
                <g transform={`translate(${x}, ${y})`}>
                    <motion.g animate={{ y: isSeparate ? -separationDist : 0 }}>
                        {renderStrand(0, true, isExtending && isSeparate ? 1 : 0)}
                    </motion.g>
                    <motion.g animate={{ y: isSeparate ? separationDist : 15 }}>
                        {renderStrand(0, false, isExtending && isSeparate ? 1 : 0)}
                    </motion.g>
                </g>
            );
        };

        const Thermometer = ({ temp }) => {
            // Visual height mapping: 0-100C -> 0-100% height
            return (
                <div className="w-16 h-64 bg-slate-800 rounded-full border-4 border-slate-600 relative flex flex-col justify-end items-center p-1">
                    {/* Liquid */}
                    <motion.div 
                        className="w-full bg-red-500 rounded-b-full rounded-t-sm"
                        initial={{ height: '20%' }}
                        animate={{ height: `${temp}%` }}
                        transition={{ duration: 0.5 }}
                    />
                    {/* Bulb */}
                    <div className="w-20 h-20 bg-red-500 rounded-full absolute -bottom-8 border-4 border-slate-600 -z-10"></div>
                    
                    {/* Text */}
                    <div className="absolute top-1/2 left-full ml-4 text-2xl font-mono font-bold text-white whitespace-nowrap">
                        {temp}°C
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [currentCycle, setCurrentCycle] = useState(0);
            const [stageIdx, setStageIdx] = useState(0); // 0, 1, 2
            const [isPlaying, setIsPlaying] = useState(false);
            const [dnaCount, setDnaCount] = useState(1);
            
            // Animation States
            const currentStage = CYCLES[stageIdx];

            useEffect(() => {
                let timer;
                if (isPlaying) {
                    timer = setTimeout(() => {
                        if (stageIdx < 2) {
                            setStageIdx(prev => prev + 1);
                        } else {
                            // Cycle Complete
                            setStageIdx(0);
                            setCurrentCycle(prev => prev + 1);
                            setDnaCount(prev => prev * 2);
                        }
                    }, currentStage.duration);
                }
                return () => clearTimeout(timer);
            }, [isPlaying, stageIdx]);

            // Chart Data
            const chartData = useMemo(() => {
                const data = [];
                for(let i=0; i<=currentCycle + (stageIdx > 0 ? 1 : 0); i++) {
                    data.push({ cycle: i, count: Math.pow(2, i) });
                }
                // Pad with future projection
                for(let i=data.length; i<=10; i++) {
                    data.push({ cycle: i, count: null });
                }
                return data;
            }, [currentCycle, stageIdx]);

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-96 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="dna" className="text-emerald-400" /> PCR Lab
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Polymerase Chain Reaction</p>
                        </div>

                        <div className="p-6 flex-1 overflow-y-auto custom-scrollbar space-y-8">
                            
                            {/* Cycle Monitor */}
                            <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-lg text-center">
                                <div className="text-xs font-bold text-slate-500 uppercase mb-2">Cycle Count</div>
                                <div className="text-5xl font-mono font-black text-white">{currentCycle}</div>
                                <div className="text-xs text-emerald-400 font-bold mt-2">
                                    DNA Copies: {dnaCount.toLocaleString()}
                                </div>
                            </div>

                            {/* Stage Info */}
                            <AnimatePresence mode='wait'>
                                <motion.div 
                                    key={currentStage.id}
                                    initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }}
                                    className="bg-blue-900/20 p-5 rounded-2xl border border-blue-500/30"
                                >
                                    <div className="flex justify-between items-center mb-2">
                                        <div className="text-xs font-bold text-blue-400 uppercase">Current Step</div>
                                        <div className="text-xl font-bold text-white">{currentStage.temp}°C</div>
                                    </div>
                                    <h2 className="text-lg font-bold text-white mb-2">{currentStage.name}</h2>
                                    <p className="text-sm text-slate-300 leading-relaxed">
                                        {currentStage.desc}
                                    </p>
                                </motion.div>
                            </AnimatePresence>

                            {/* Controls */}
                            <div className="grid grid-cols-2 gap-3">
                                <button 
                                    onClick={() => setIsPlaying(!isPlaying)}
                                    className={`py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg
                                        ${isPlaying ? 'bg-red-600 hover:bg-red-500 text-white' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}
                                    `}
                                >
                                    <Icon name={isPlaying ? "pause" : "play"} size={18} fill="currentColor"/> {isPlaying ? 'Pause' : 'Start Cycle'}
                                </button>
                                <button 
                                    onClick={() => { setIsPlaying(false); setCurrentCycle(0); setStageIdx(0); setDnaCount(1); }}
                                    className="py-3 bg-slate-800 hover:bg-slate-700 rounded-xl text-slate-300 font-bold flex items-center justify-center gap-2 border border-slate-600"
                                >
                                    <Icon name="rotate-ccw" size={18}/> Reset
                                </button>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-6 overflow-hidden gap-6">
                        
                        {/* Simulation View */}
                        <div className="flex-[2] bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center p-8">
                            
                            {/* Thermometer Visual */}
                            <div className="absolute left-8 top-1/2 -translate-y-1/2">
                                <Thermometer temp={currentStage.temp} />
                            </div>

                            {/* Main DNA Animation */}
                            <div className="relative w-full max-w-lg h-64 flex items-center justify-center">
                                {/* Visualizing 1 DNA splitting into 2 */}
                                <svg width="500" height="300" viewBox="0 0 500 300" className="overflow-visible">
                                    <DNAStrand 
                                        x={100} y={150} width={300} 
                                        isSeparate={stageIdx >= 1} // Separate at Annealing (technically separated at Denaturation)
                                        separationDist={40}
                                        hasPrimers={stageIdx >= 1} // Primers attach at Annealing
                                        isExtending={stageIdx === 2} // Extend at Extension
                                    />
                                    
                                    {/* Heat Waves Effect for Denaturation */}
                                    {stageIdx === 0 && (
                                        <g>
                                            {[...Array(5)].map((_, i) => (
                                                <text key={i} x={150 + i*50} y={150} fill="red" fontSize="20" className="heat-wave" style={{animationDelay: `${i*0.2}s`}}>
                                                    sss
                                                </text>
                                            ))}
                                        </g>
                                    )}
                                </svg>
                            </div>
                            
                            {/* Legend */}
                            <div className="absolute bottom-6 flex gap-6 text-xs text-slate-400">
                                <div className="flex items-center gap-2"><div className="w-3 h-1 bg-sky-400"></div> Template DNA</div>
                                <div className="flex items-center gap-2"><div className="w-3 h-1 bg-pink-400"></div> Primer / New Strand</div>
                                <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-yellow-400"></div> Taq Polymerase</div>
                            </div>

                        </div>

                        {/* Exponential Graph */}
                        <div className="flex-1 bg-slate-900 rounded-2xl border border-slate-800 p-4 flex flex-col relative">
                             <div className="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                                <Icon name="trending-up" size={14}/> Amplification Curve
                            </div>
                            <div className="flex-1 min-h-0">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={chartData}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                                        <XAxis dataKey="cycle" stroke="#64748b" fontSize={10} label={{ value: 'Cycles', position: 'insideBottom', offset: -5, fill: '#64748b', fontSize: 10 }} />
                                        <YAxis stroke="#64748b" fontSize={10} scale="log" domain={['auto', 'auto']} label={{ value: 'DNA Copies (Log)', angle: -90, position: 'insideLeft', fill: '#64748b', fontSize: 10 }} />
                                        <Tooltip 
                                            contentStyle={{ backgroundColor: '#1e293b', borderColor: '#475569', fontSize: '12px' }}
                                            itemStyle={{ color: '#fff' }}
                                            formatter={(val) => val.toLocaleString()}
                                        />
                                        <Line type="monotone" dataKey="count" stroke="#10b981" strokeWidth={2} dot={{r:3}} animationDuration={500} />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
