<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recombinant DNA Builder | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Glow Effect for DNA */
        .dna-glow { filter: drop-shadow(0 0 5px rgba(56, 189, 248, 0.5)); }
        .gene-glow { filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5)); }
        
        /* Ligase Sparkle */
        .sparkle { animation: sparkle 0.5s linear infinite; }
        @keyframes sparkle {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- COMPONENTS ---

        const Plasmid = ({ stage, isCut, hasGene, isLigated }) => {
            // SVG Path Logic
            // Full Circle (Radius 100)
            const r = 100;
            const cx = 200;
            const cy = 200;
            
            // Cut Gap: Top (Angle -90 deg)
            // Gap angle width
            const gapAngle = 40; // degrees
            
            // Calculate start/end points for open circle
            // Start: -90 + gap/2, End: -90 - gap/2
            // Convert to radians
            const toRad = (deg) => (deg - 90) * Math.PI / 180;
            
            const startAngle = gapAngle / 2;
            const endAngle = 360 - gapAngle / 2;
            
            const x1 = cx + r * Math.cos(toRad(startAngle));
            const y1 = cy + r * Math.sin(toRad(startAngle));
            
            const x2 = cx + r * Math.cos(toRad(endAngle));
            const y2 = cy + r * Math.sin(toRad(endAngle));
            
            // Path D for open circle (Large arc flag = 1)
            const openPath = `M ${x1} ${y1} A ${r} ${r} 0 1 1 ${x2} ${y2}`;
            const closedPath = `M 200 100 A 100 100 0 1 1 199.9 100 Z`; // Full circle approx

            // Gene Segment (Arc) to fill the gap
            // It needs to fit perfectly in the gap
            // To make it distinct, we draw it separately
            const genePath = `M ${x2} ${y2} A ${r} ${r} 0 0 1 ${x1} ${y1}`;

            return (
                <div className="relative w-[400px] h-[400px] flex items-center justify-center">
                    <svg width="400" height="400" viewBox="0 0 400 400" className="overflow-visible">
                        
                        {/* 1. Plasmid Backbone (Blue) */}
                        <motion.path 
                            d={isCut ? openPath : closedPath}
                            stroke="#38bdf8" 
                            strokeWidth="12" 
                            fill="none" 
                            strokeLinecap="butt"
                            className="dna-glow"
                            animate={{ d: isCut ? openPath : closedPath }}
                            transition={{ duration: 1, type: "spring" }}
                        />
                        
                        {/* Features on Backbone */}
                        {/* AmpR Gene (Yellow segment) */}
                        <path d="M 286 250 A 100 100 0 0 1 200 300" stroke="#facc15" strokeWidth="12" fill="none" />
                        <text x="250" y="320" fill="#facc15" fontSize="12" fontWeight="bold">AmpR</text>

                        {/* Ori (Green segment) */}
                        <path d="M 113 250 A 100 100 0 0 0 140 280" stroke="#4ade80" strokeWidth="12" fill="none" />
                        <text x="100" y="300" fill="#4ade80" fontSize="12" fontWeight="bold">ori</text>

                        {/* Restriction Site (Scissors Icon Location) */}
                        {!isCut && (
                            <g transform="translate(200, 100)">
                                <circle r="4" fill="#ef4444" />
                                <text x="10" y="-10" fill="#94a3b8" fontSize="10">EcoRI Site</text>
                            </g>
                        )}
                        
                        {/* Sticky Ends Visual (When cut) */}
                        {isCut && !hasGene && (
                            <g>
                                {/* Left End */}
                                <text x={x2-20} y={y2-10} fill="#38bdf8" fontSize="10" className="font-mono">AATT</text>
                                {/* Right End */}
                                <text x={x1+5} y={y1-10} fill="#38bdf8" fontSize="10" className="font-mono">TTAA</text>
                            </g>
                        )}

                        {/* 2. Target Gene (Red) */}
                        <AnimatePresence>
                            {hasGene && (
                                <motion.g
                                    initial={{ opacity: 0, scale: 2, y: -100 }}
                                    animate={{ opacity: 1, scale: 1, y: 0 }}
                                    transition={{ duration: 0.8, type: "spring" }}
                                >
                                    <path 
                                        d={genePath} 
                                        stroke="#ef4444" 
                                        strokeWidth="12" 
                                        fill="none" 
                                        className="gene-glow"
                                    />
                                    <text x="200" y="75" fill="#ef4444" fontSize="12" fontWeight="bold" textAnchor="middle">Insulin Gene</text>
                                    
                                    {/* Ligation Spots */}
                                    {isLigated ? (
                                        <g>
                                            <circle cx={x1} cy={y1} r="4" fill="#ffffff" />
                                            <circle cx={x2} cy={y2} r="4" fill="#ffffff" />
                                        </g>
                                    ) : (
                                        <g>
                                            {/* Gaps before ligation */}
                                            <line x1={x1} y1={y1} x2={x1+2} y2={y1} stroke="black" strokeWidth="2" />
                                            <line x1={x2} y1={y2} x2={x2-2} y2={y2} stroke="black" strokeWidth="2" />
                                        </g>
                                    )}
                                </motion.g>
                            )}
                        </AnimatePresence>

                        {/* Ligase Effect */}
                        {stage === 'ligated' && !isLigated && ( // Show sparkles briefly? No, stick to stage
                             <g>
                                {/* Just a visual trigger for sparkles when stage transitions */}
                            </g>
                        )}
                        {/* Always show sparkles if we just ligated? No, maybe just static indicator or css animation */}
                         {/* Let's animate sparkles on the connection points if stage is 'ligated' */}
                         {stage === 'ligated' && (
                             <g>
                                 <motion.circle cx={x1} cy={y1} r="10" fill="#facc15" className="sparkle" />
                                 <motion.circle cx={x2} cy={y2} r="10" fill="#facc15" className="sparkle" style={{animationDelay: '0.2s'}} />
                             </g>
                         )}

                    </svg>
                    
                    {/* Center Label */}
                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
                        <div className="text-xl font-black text-slate-500">
                            {isLigated ? "Recombinant Plasmid" : "Plasmid Vector"}
                        </div>
                        {isLigated && <div className="text-xs text-emerald-400 font-bold mt-1">Ready for Transformation</div>}
                    </div>
                </div>
            );
        };

        const ToolTray = ({ stage, onAction }) => {
            return (
                <div className="flex gap-4 items-center justify-center p-4 bg-slate-900 rounded-xl border border-slate-700 shadow-lg">
                    
                    {/* Step 1: Enzyme */}
                    <button 
                        onClick={() => onAction('cut')}
                        disabled={stage !== 'start'}
                        className={`p-4 rounded-xl flex flex-col items-center gap-2 transition-all w-28
                            ${stage === 'start' ? 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg scale-105' : 'bg-slate-800 text-slate-500 opacity-50'}
                        `}
                    >
                        <Icon name="scissors" size={24} />
                        <span className="text-xs font-bold text-center">1. Restriction Enzyme</span>
                    </button>

                    <Icon name="arrow-right" className="text-slate-600" />

                    {/* Step 2: Gene */}
                    <button 
                        onClick={() => onAction('insert')}
                        disabled={stage !== 'cut'}
                        className={`p-4 rounded-xl flex flex-col items-center gap-2 transition-all w-28
                            ${stage === 'cut' ? 'bg-red-600 hover:bg-red-500 text-white shadow-lg scale-105' : 'bg-slate-800 text-slate-500 opacity-50'}
                        `}
                    >
                        <Icon name="dna" size={24} />
                        <span className="text-xs font-bold text-center">2. Target Gene</span>
                    </button>

                    <Icon name="arrow-right" className="text-slate-600" />

                    {/* Step 3: Ligase */}
                    <button 
                        onClick={() => onAction('ligate')}
                        disabled={stage !== 'inserted'}
                        className={`p-4 rounded-xl flex flex-col items-center gap-2 transition-all w-28
                            ${stage === 'inserted' ? 'bg-yellow-600 hover:bg-yellow-500 text-white shadow-lg scale-105' : 'bg-slate-800 text-slate-500 opacity-50'}
                        `}
                    >
                        <Icon name="zap" size={24} />
                        <span className="text-xs font-bold text-center">3. DNA Ligase</span>
                    </button>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            // Stages: start -> cut -> inserted -> ligated
            const [stage, setStage] = useState('start');
            const [message, setMessage] = useState("Start by cutting the plasmid vector.");

            const handleAction = (action) => {
                if (action === 'cut') {
                    setStage('cut');
                    setMessage("Plasmid cut with EcoRI. Sticky ends produced.");
                } else if (action === 'insert') {
                    setStage('inserted');
                    setMessage("Target gene inserted. Base pairing occurs at sticky ends (Annealing).");
                } else if (action === 'ligate') {
                    setMessage("Adding DNA Ligase...");
                    // Simulate processing time
                    setTimeout(() => {
                        setStage('ligated');
                        setMessage("Success! Sugar-phosphate backbone sealed. Recombinant Plasmid formed.");
                    }, 1500);
                }
            };

            const reset = () => {
                setStage('start');
                setMessage("Start by cutting the plasmid vector.");
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="construction" className="text-blue-400" /> DNA Builder
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Recombinant DNA Technology</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Status Panel */}
                            <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-lg">
                                <div className="text-xs font-bold text-slate-500 uppercase mb-2">Current Status</div>
                                <div className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                    {stage === 'start' && <span className="text-slate-400">Intact Vector</span>}
                                    {stage === 'cut' && <span className="text-blue-400">Linearized Vector</span>}
                                    {stage === 'inserted' && <span className="text-yellow-400">Annealed</span>}
                                    {stage === 'ligated' && <span className="text-emerald-400">Recombinant DNA</span>}
                                </div>
                                <div className="p-3 bg-slate-900 rounded-lg border border-slate-700 text-sm text-slate-300 min-h-[60px]">
                                    {message}
                                </div>
                            </div>

                            {/* Concept Info */}
                            <div className="bg-blue-900/20 p-4 rounded-xl border border-blue-500/30 text-xs text-slate-300 space-y-3">
                                <div className="font-bold text-blue-400 uppercase mb-1 flex items-center gap-2"><Icon name="book-open" size={14}/> Key Concepts</div>
                                <p>
                                    <strong>Restriction Enzyme:</strong> Molecular scissors that cut DNA at specific sites.
                                </p>
                                <p>
                                    <strong>Sticky Ends:</strong> Single-stranded overhangs that allow complementary DNA fragments to pair up.
                                </p>
                                <p>
                                    <strong>DNA Ligase:</strong> Molecular glue that seals the backbone (phosphodiester bonds).
                                </p>
                            </div>

                            <button 
                                onClick={reset}
                                className="w-full py-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-xl text-slate-300 font-bold flex items-center justify-center gap-2 transition-all"
                            >
                                <Icon name="rotate-ccw" size={16}/> Restart Process
                            </button>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-6 overflow-hidden gap-6">
                        
                        {/* Visualization */}
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center p-4">
                            <Plasmid 
                                stage={stage} 
                                isCut={stage !== 'start'} 
                                hasGene={stage === 'inserted' || stage === 'ligated'}
                                isLigated={stage === 'ligated'}
                            />
                        </div>

                        {/* Tools Deck */}
                        <div className="shrink-0 flex justify-center">
                            <ToolTray stage={stage} onAction={handleAction} />
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
