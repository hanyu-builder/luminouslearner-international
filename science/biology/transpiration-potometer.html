<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transpiration Potometer | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Bubble Animation */
        .air-bubble {
            transition: left 0.1s linear;
        }
        
        /* Fan Animation */
        .spin { animation: spin 0.5s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Heat Haze */
        .heat-haze { animation: shimmer 1s infinite; }
        @keyframes shimmer { 
            0% { opacity: 0.3; transform: translateY(0); } 
            50% { opacity: 0.6; transform: translateY(-2px); }
            100% { opacity: 0.3; transform: translateY(0); } 
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LabelList } = window.Recharts;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- MAIN APP ---
        const App = () => {
            // Environmental Conditions
            const [fan, setFan] = useState(false); // Wind
            const [lamp, setLamp] = useState(false); // Light
            const [humidity, setHumidity] = useState('normal'); // 'dry', 'normal', 'humid'
            const [temp, setTemp] = useState('room'); // 'cool', 'room', 'hot'

            // Simulation State
            const [bubblePos, setBubblePos] = useState(0); // 0 to 100 (distance)
            const [time, setTime] = useState(0);
            const [isRunning, setIsRunning] = useState(false);
            const [rate, setRate] = useState(0); // calculated rate
            
            // Data Logging
            const [history, setHistory] = useState([]); // { condition, rate }

            // Constants
            const MAX_DIST = 100; // mm

            // Logic: Calculate Transpiration Rate based on factors
            const calculateCurrentRate = () => {
                let baseRate = 1.0; // Normal condition

                // 1. Light (Stomata open)
                if (lamp) baseRate *= 2.5;
                else baseRate *= 0.2; // Dark -> stomata close

                // 2. Wind (Removes diffusion shell)
                if (fan) baseRate *= 2.0;

                // 3. Humidity (Concentration gradient)
                if (humidity === 'dry') baseRate *= 1.5;
                else if (humidity === 'humid') baseRate *= 0.3;

                // 4. Temperature (Evaporation rate)
                if (temp === 'hot') baseRate *= 1.8;
                else if (temp === 'cool') baseRate *= 0.6;

                return baseRate;
            };

            // Simulation Loop
            useEffect(() => {
                let interval;
                if (isRunning) {
                    interval = setInterval(() => {
                        const currentSpeed = calculateCurrentRate();
                        setRate(currentSpeed);

                        setBubblePos(prev => {
                            const next = prev + (currentSpeed * 0.1); // scaling factor
                            if (next >= MAX_DIST) {
                                setIsRunning(false);
                                return MAX_DIST;
                            }
                            return next;
                        });
                        setTime(t => t + 0.1);
                    }, 100);
                }
                return () => clearInterval(interval);
            }, [isRunning, fan, lamp, humidity, temp]);

            // Record Data
            const recordData = () => {
                // Create a label for current condition
                const labels = [];
                if (lamp) labels.push('Light'); else labels.push('Dark');
                if (fan) labels.push('Windy');
                if (humidity !== 'normal') labels.push(humidity === 'dry' ? 'Dry' : 'Humid');
                if (temp !== 'room') labels.push(temp === 'hot' ? 'Hot' : 'Cool');
                if (labels.length === 1 && labels[0] === 'Dark') labels[0] = 'Control (Dark/Normal)'; 
                
                // If all normal/off, maybe 'Control (Light)'? Let's be smart
                let label = labels.join(' + ');
                if (label === 'Dark') label = 'Dark (Control)';
                if (label === 'Light') label = 'Light (Normal)';

                const finalRate = bubblePos / (time > 0 ? time : 1); // distance/time

                setHistory(prev => [...prev, { 
                    name: label, 
                    rate: parseFloat(finalRate.toFixed(2)),
                    fill: lamp ? '#eab308' : '#64748b' // Yellow for light, grey for dark based
                }]);
                resetSim();
            };

            const resetSim = () => {
                setIsRunning(false);
                setBubblePos(0);
                setTime(0);
                setRate(0);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="thermometer-sun" className="text-emerald-400" /> Potometer
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Transpiration Rate Lab</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Controls */}
                            <div className="space-y-4">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">Conditions</label>
                                
                                {/* Light */}
                                <button 
                                    onClick={() => setLamp(!lamp)}
                                    className={`w-full p-3 rounded-xl border flex items-center justify-between transition-all
                                        ${lamp ? 'bg-yellow-900/30 border-yellow-500 text-yellow-300' : 'bg-slate-800 border-slate-700 text-slate-400'}
                                    `}
                                >
                                    <div className="flex items-center gap-3">
                                        <Icon name="sun" size={18}/>
                                        <span className="text-sm font-bold">Light Source</span>
                                    </div>
                                    <div className={`w-8 h-4 rounded-full p-0.5 transition-colors ${lamp ? 'bg-yellow-500' : 'bg-slate-600'}`}>
                                        <div className={`w-3 h-3 bg-white rounded-full shadow-md transform transition-transform ${lamp ? 'translate-x-4' : 'translate-x-0'}`}></div>
                                    </div>
                                </button>

                                {/* Wind */}
                                <button 
                                    onClick={() => setFan(!fan)}
                                    className={`w-full p-3 rounded-xl border flex items-center justify-between transition-all
                                        ${fan ? 'bg-blue-900/30 border-blue-500 text-blue-300' : 'bg-slate-800 border-slate-700 text-slate-400'}
                                    `}
                                >
                                    <div className="flex items-center gap-3">
                                        <Icon name="wind" size={18}/>
                                        <span className="text-sm font-bold">Electric Fan</span>
                                    </div>
                                    <div className={`w-8 h-4 rounded-full p-0.5 transition-colors ${fan ? 'bg-blue-500' : 'bg-slate-600'}`}>
                                        <div className={`w-3 h-3 bg-white rounded-full shadow-md transform transition-transform ${fan ? 'translate-x-4' : 'translate-x-0'}`}></div>
                                    </div>
                                </button>

                                {/* Humidity */}
                                <div className="bg-slate-800 p-3 rounded-xl border border-slate-700">
                                    <div className="flex justify-between mb-2 text-xs text-slate-400">Humidity</div>
                                    <div className="flex gap-1">
                                        {['dry', 'normal', 'humid'].map(h => (
                                            <button 
                                                key={h}
                                                onClick={() => setHumidity(h)}
                                                className={`flex-1 py-1 rounded text-xs font-bold capitalize transition-colors
                                                    ${humidity === h ? 'bg-cyan-600 text-white' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'}
                                                `}
                                            >
                                                {h}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Temperature */}
                                <div className="bg-slate-800 p-3 rounded-xl border border-slate-700">
                                    <div className="flex justify-between mb-2 text-xs text-slate-400">Temperature</div>
                                    <div className="flex gap-1">
                                        {['cool', 'room', 'hot'].map(t => (
                                            <button 
                                                key={t}
                                                onClick={() => setTemp(t)}
                                                className={`flex-1 py-1 rounded text-xs font-bold capitalize transition-colors
                                                    ${temp === t ? (t==='hot'?'bg-red-600':'bg-emerald-600') + ' text-white' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'}
                                                `}
                                            >
                                                {t}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                            </div>

                            {/* Actions */}
                            <div className="grid grid-cols-2 gap-3">
                                <button 
                                    onClick={() => setIsRunning(!isRunning)}
                                    className={`py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all
                                        ${isRunning ? 'bg-red-600 hover:bg-red-500' : 'bg-emerald-600 hover:bg-emerald-500'}
                                    `}
                                >
                                    <Icon name={isRunning ? "pause" : "play"} size={18} fill="currentColor"/> {isRunning ? 'Pause' : 'Start'}
                                </button>
                                <button 
                                    onClick={recordData}
                                    disabled={bubblePos === 0}
                                    className="py-3 bg-slate-700 hover:bg-slate-600 disabled:opacity-50 rounded-xl font-bold text-slate-200 flex items-center justify-center gap-2"
                                >
                                    <Icon name="save" size={18}/> Record
                                </button>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-6 overflow-hidden gap-6">
                        
                        {/* Visualizer */}
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center">
                            
                            {/* Plant & Potometer Setup */}
                            <div className="relative w-[600px] h-[300px] bg-slate-800/50 rounded-2xl border border-slate-700/50 p-4">
                                
                                {/* Plant */}
                                <div className="absolute left-8 bottom-20 flex flex-col items-center z-10">
                                    <div className={`transition-transform duration-[2s] ${fan ? 'skew-x-2' : ''}`}>
                                        <Icon name="sprout" size={64} className="text-emerald-500" />
                                    </div>
                                    {/* Bag for humidity */}
                                    {humidity === 'humid' && (
                                        <div className="absolute -top-2 -left-2 w-20 h-24 bg-white/10 rounded-full border border-white/20 backdrop-blur-sm"></div>
                                    )}
                                </div>

                                {/* Environmental Effects */}
                                {lamp && (
                                    <div className="absolute top-4 left-4 text-yellow-400 animate-pulse">
                                        <Icon name="sun" size={48} fill="currentColor" />
                                        <div className="absolute top-full left-1/2 w-32 h-32 -translate-x-1/2 bg-yellow-500/10 blur-3xl rounded-full pointer-events-none"></div>
                                    </div>
                                )}
                                {fan && (
                                    <div className="absolute top-10 left-32 text-blue-300">
                                        <Icon name="fan" size={40} className="spin" />
                                        <div className="text-[10px] text-center mt-1 font-bold">WIND</div>
                                    </div>
                                )}
                                {temp === 'hot' && (
                                    <div className="absolute inset-0 pointer-events-none heat-haze bg-orange-500/5"></div>
                                )}

                                {/* Capillary Tube (The Potometer) */}
                                <div className="absolute bottom-10 left-20 right-10 h-4 bg-blue-200/20 rounded-full overflow-hidden border border-slate-500 flex items-center">
                                    {/* Water Column */}
                                    <div className="w-full h-full bg-blue-500/30 relative">
                                        {/* The Air Bubble */}
                                        <div 
                                            className="absolute top-0 bottom-0 w-3 bg-white rounded-full shadow-sm border border-slate-300 air-bubble z-10"
                                            style={{ left: `${bubblePos}%` }}
                                        ></div>
                                        {/* Ruler Marks */}
                                        <div className="absolute inset-0 flex justify-between px-2">
                                            {[...Array(21)].map((_, i) => (
                                                <div key={i} className="w-px h-full bg-slate-400/50 relative">
                                                    {i % 5 === 0 && <span className="absolute -top-4 -left-1 text-[8px] text-slate-400">{i*5}</span>}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Labels */}
                                <div className="absolute bottom-2 right-10 text-xs text-slate-500 font-mono">Distance (mm)</div>

                            </div>

                            {/* Live Stats */}
                            <div className="flex gap-8 mt-6 text-sm font-mono">
                                <div className="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                                    <span className="text-slate-400 mr-2">Distance:</span>
                                    <span className="text-white font-bold">{bubblePos.toFixed(1)} mm</span>
                                </div>
                                <div className="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                                    <span className="text-slate-400 mr-2">Time:</span>
                                    <span className="text-white font-bold">{time.toFixed(1)} min</span>
                                </div>
                                <div className="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                                    <span className="text-slate-400 mr-2">Est. Rate:</span>
                                    <span className="text-emerald-400 font-bold">
                                        {time > 0 ? (bubblePos/time).toFixed(2) : '0.00'} mm/min
                                    </span>
                                </div>
                            </div>

                        </div>

                        {/* Results Graph */}
                        <div className="h-48 bg-slate-900 rounded-2xl border border-slate-800 p-4 relative">
                            <div className="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                                <Icon name="bar-chart-2" size={14}/> Transpiration Rates Comparison
                            </div>
                            {history.length > 0 ? (
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={history} layout="vertical" margin={{ left: 40, right: 40 }}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#334155" horizontal={false} />
                                        <XAxis type="number" stroke="#64748b" fontSize={10} unit=" mm/min" />
                                        <YAxis dataKey="name" type="category" width={100} stroke="#94a3b8" fontSize={10} hide />
                                        <Tooltip 
                                            cursor={{fill: 'rgba(255,255,255,0.05)'}}
                                            contentStyle={{ backgroundColor: '#1e293b', borderColor: '#475569', fontSize: '12px' }}
                                            itemStyle={{ color: '#fff' }}
                                        />
                                        <Bar dataKey="rate" fill="#38bdf8" radius={[0, 4, 4, 0]} barSize={20}>
                                            <LabelList dataKey="name" position="insideLeft" fill="#fff" fontSize={10} />
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            ) : (
                                <div className="h-full flex items-center justify-center text-slate-600 text-sm italic">
                                    Run a simulation and click "Record" to see data.
                                </div>
                            )}
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
