<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photosynthesis Stage Explorer - LuminousLearner International</title>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        
        /* Glow Effects */
        .glow-sun { filter: drop-shadow(0 0 15px #facc15); }
        .glow-electron { filter: drop-shadow(0 0 5px #38bdf8); }
        .glow-atp { filter: drop-shadow(0 0 5px #fbbf24); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATA ---
        const LIGHT_STEPS = [
            { id: 'photon', title: '1. Photo-excitation', desc: 'Light energy hits Photosystem II (PSII), exciting electrons to a higher energy level.' },
            { id: 'photolysis', title: '2. Photolysis of Water', desc: 'Water splits into Oxygen (O₂), Protons (H⁺), and electrons to replace those lost by PSII.' },
            { id: 'etc', title: '3. Electron Transport Chain', desc: 'Excited electrons move down the ETC, pumping H⁺ into the thylakoid space to create a gradient.' },
            { id: 'psi', title: '4. Photosystem I', desc: 'Electrons are re-energized by light at PSI.' },
            { id: 'nadph', title: '5. NADPH Formation', desc: 'High-energy electrons combine with NADP⁺ and H⁺ to form NADPH (Reduced NADP).' },
            { id: 'atp', title: '6. Chemiosmosis (ATP)', desc: 'H⁺ flow back through ATP Synthase, driving the phosphorylation of ADP to ATP.' }
        ];

        const CALVIN_STEPS = [
            { id: 'fixation', title: '1. Carbon Fixation', desc: 'CO₂ combines with RuBP (5C sugar) catalyzed by Rubisco enzyme to form unstable 6C, which splits into two 3-PGA (3C).' },
            { id: 'reduction', title: '2. Reduction', desc: 'ATP and NADPH (from Light Reaction) are used to convert 3-PGA into G3P (Triose Phosphate).' },
            { id: 'output', title: '3. Sugar Production', desc: 'One G3P molecule leaves the cycle to form glucose and other carbohydrates.' },
            { id: 'regeneration', title: '4. Regeneration of RuBP', desc: 'Remaining G3P molecules are rearranged (using ATP) to regenerate RuBP so the cycle can continue.' }
        ];

        // --- COMPONENTS ---

        const LightReactionView = ({ step }) => {
            return (
                <svg viewBox="0 0 800 500" className="w-full h-full">
                    {/* Background */}
                    <rect x="0" y="0" width="800" height="300" fill="#f0fdf4" fillOpacity="0.05" /> {/* Stroma */}
                    <rect x="0" y="300" width="800" height="200" fill="#064e3b" fillOpacity="0.3" /> {/* Thylakoid Space */}
                    
                    {/* Membrane */}
                    <rect x="0" y="280" width="800" height="40" fill="#22c55e" stroke="#14532d" strokeWidth="2" opacity="0.8" />
                    
                    {/* Photosystems & Proteins */}
                    {/* PSII */}
                    <g transform="translate(100, 260)">
                        <rect x="0" y="0" width="60" height="80" rx="10" fill="#15803d" stroke="#86efac" strokeWidth="2" />
                        <text x="30" y="45" textAnchor="middle" fill="white" fontSize="12" fontWeight="bold">PSII</text>
                        {step === 'photon' && (
                            <motion.path 
                                d="M 30 -50 L 30 0" 
                                stroke="#facc15" strokeWidth="4" strokeDasharray="4,4"
                                animate={{ opacity: [0, 1, 0], y: [0, 20, 0] }} transition={{ repeat: Infinity, duration: 1 }}
                            />
                        )}
                    </g>
                    
                    {/* Cytochrome */}
                    <g transform="translate(250, 270)">
                        <rect x="0" y="0" width="50" height="60" rx="5" fill="#047857" />
                        <text x="25" y="35" textAnchor="middle" fill="white" fontSize="10">Cyt</text>
                    </g>

                    {/* PSI */}
                    <g transform="translate(400, 260)">
                        <rect x="0" y="0" width="60" height="80" rx="10" fill="#15803d" stroke="#86efac" strokeWidth="2" />
                        <text x="30" y="45" textAnchor="middle" fill="white" fontSize="12" fontWeight="bold">PSI</text>
                        {(step === 'psi' || step === 'nadph') && (
                            <motion.path 
                                d="M 30 -50 L 30 0" 
                                stroke="#facc15" strokeWidth="4" strokeDasharray="4,4"
                                animate={{ opacity: [0, 1, 0], y: [0, 20, 0] }} transition={{ repeat: Infinity, duration: 1 }}
                            />
                        )}
                    </g>

                    {/* ATP Synthase */}
                    <g transform="translate(600, 250)">
                        <path d="M 0 0 L 60 0 L 50 50 L 10 50 Z" fill="#d97706" /> {/* Top */}
                        <rect x="20" y="50" width="20" height="60" fill="#b45309" /> {/* Stalk */}
                        <rect x="10" y="110" width="40" height="30" fill="#d97706" /> {/* Base */}
                        <text x="30" y="40" textAnchor="middle" fill="white" fontSize="10" fontWeight="bold">ATP Synthase</text>
                    </g>

                    {/* ANIMATIONS */}
                    
                    {/* Electron Flow */}
                    {(step === 'photon' || step === 'etc' || step === 'psi' || step === 'nadph') && (
                        <motion.circle 
                            r="5" fill="#38bdf8" className="glow-electron"
                            animate={{ 
                                cx: [130, 275, 430, 500], 
                                cy: [300, 300, 300, 250],
                                opacity: [1, 1, 1, 0]
                            }}
                            transition={{ duration: 4, repeat: Infinity, ease: "linear" }}
                        />
                    )}

                    {/* Photolysis */}
                    {step === 'photolysis' && (
                        <g transform="translate(100, 360)">
                            <text x="0" y="0" fill="#60a5fa" fontSize="14" fontWeight="bold">H₂O</text>
                            <motion.g animate={{ opacity: [0, 1, 0], y: [0, -20, 0] }} transition={{ duration: 2, repeat: Infinity }}>
                                <text x="30" y="-20" fill="#ef4444" fontSize="12" fontWeight="bold">O₂</text>
                                <text x="-10" y="-20" fill="white" fontSize="12" fontWeight="bold">H⁺</text>
                            </motion.g>
                        </g>
                    )}

                    {/* Proton Pumping */}
                    {step === 'etc' && (
                        <motion.circle 
                            cx="275" cy="250" r="4" fill="white"
                            animate={{ cy: 350 }} transition={{ duration: 1.5, repeat: Infinity }}
                        />
                    )}

                    {/* NADPH Formation */}
                    {step === 'nadph' && (
                        <g transform="translate(500, 240)">
                            <text x="0" y="0" fill="#60a5fa" fontSize="12">NADP⁺</text>
                            <motion.text x="50" y="0" fill="#f472b6" fontSize="14" fontWeight="bold"
                                animate={{ scale: [1, 1.2, 1], opacity: [0.5, 1, 0.5] }} transition={{ duration: 1, repeat: Infinity }}
                            >NADPH</motion.text>
                        </g>
                    )}

                    {/* ATP Formation */}
                    {step === 'atp' && (
                        <g transform="translate(630, 220)">
                            <motion.g animate={{ rotate: 360 }} style={{ originX: "30px", originY: "80px" }} transition={{ duration: 2, repeat: Infinity, ease: "linear" }}>
                                {/* Visual spinner effect on synthase could be added here */}
                            </motion.g>
                            
                            {/* Protons moving up */}
                            <motion.circle cx="30" cy="150" r="4" fill="white" animate={{ cy: 0 }} transition={{ duration: 1, repeat: Infinity }} />
                            
                            {/* ATP popping out */}
                            <motion.text x="40" y="0" fill="#fbbf24" fontSize="16" fontWeight="bold" className="glow-atp"
                                animate={{ y: -30, opacity: [0, 1, 0] }} transition={{ duration: 1.5, repeat: Infinity }}
                            >ATP</motion.text>
                        </g>
                    )}

                    {/* Labels */}
                    <text x="50" y="50" fill="#94a3b8" fontSize="14" fontWeight="bold">STROMA (Low H⁺)</text>
                    <text x="50" y="450" fill="#4ade80" fontSize="14" fontWeight="bold">THYLAKOID SPACE (High H⁺)</text>

                </svg>
            );
        };

        const CalvinCycleView = ({ step }) => {
            const cx = 400, cy = 250, r = 150;
            
            return (
                <svg viewBox="0 0 800 500" className="w-full h-full">
                    {/* Cycle Circle */}
                    <circle cx={cx} cy={cy} r={r} fill="none" stroke="#334155" strokeWidth="2" strokeDasharray="5,5" />
                    
                    {/* Labels for Stages */}
                    <text x={cx} y={cy-r-20} textAnchor="middle" fill="#ef4444" fontWeight="bold">Carbon Fixation</text>
                    <text x={cx+r+20} y={cy+50} textAnchor="start" fill="#3b82f6" fontWeight="bold">Reduction</text>
                    <text x={cx-r-20} y={cy+50} textAnchor="end" fill="#eab308" fontWeight="bold">Regeneration</text>

                    {/* Molecules Positioned on Circle */}
                    {/* 12 o'clock: 3-PGA */}
                    <g transform={`translate(${cx}, ${cy-r})`}>
                        <circle r="20" fill="#94a3b8" />
                        <text y="5" textAnchor="middle" fontSize="10" fontWeight="bold" fill="black">3-PGA</text>
                    </g>

                    {/* 4 o'clock: G3P */}
                    <g transform={`translate(${cx + r*0.866}, ${cy + r*0.5})`}>
                        <circle r="20" fill="#86efac" />
                        <text y="5" textAnchor="middle" fontSize="10" fontWeight="bold" fill="black">G3P</text>
                    </g>

                    {/* 8 o'clock: RuBP */}
                    <g transform={`translate(${cx - r*0.866}, ${cy + r*0.5})`}>
                        <circle r="20" fill="#fca5a5" />
                        <text y="5" textAnchor="middle" fontSize="10" fontWeight="bold" fill="black">RuBP</text>
                    </g>

                    {/* Animations based on Step */}
                    
                    {/* Fixation: CO2 enters */}
                    {step === 'fixation' && (
                        <motion.g 
                            initial={{ x: cx, y: cy - r - 80, opacity: 0 }}
                            animate={{ y: cy - r, opacity: 1 }}
                            transition={{ duration: 1, repeat: Infinity }}
                        >
                            <text textAnchor="middle" fill="white" fontWeight="bold">CO₂</text>
                            <text y="20" textAnchor="middle" fill="#94a3b8" fontSize="10">(Rubisco)</text>
                        </motion.g>
                    )}

                    {/* Reduction: ATP/NADPH usage */}
                    {step === 'reduction' && (
                        <motion.g 
                            initial={{ x: cx + 60, y: cy - 60, opacity: 0 }}
                            animate={{ x: cx + 120, y: cy, opacity: 1 }}
                            transition={{ duration: 1.5, repeat: Infinity }}
                        >
                            <text fill="#fbbf24" fontSize="12" fontWeight="bold">ATP</text>
                            <text y="15" fill="#f472b6" fontSize="12" fontWeight="bold">NADPH</text>
                        </motion.g>
                    )}

                    {/* Output: Sugar leaves */}
                    {step === 'output' && (
                        <motion.g 
                            initial={{ x: cx + r*0.866, y: cy + r*0.5 }}
                            animate={{ x: cx + r*0.866 + 50, y: cy + r*0.5 + 50, opacity: 0 }}
                            transition={{ duration: 2, repeat: Infinity }}
                        >
                            <rect width="40" height="20" rx="5" fill="#22c55e" />
                            <text x="20" y="15" textAnchor="middle" fill="white" fontSize="10" fontWeight="bold">Sugar</text>
                        </motion.g>
                    )}

                    {/* Regeneration: ATP usage */}
                    {step === 'regeneration' && (
                        <motion.g 
                            initial={{ x: cx - 60, y: cy + 60, opacity: 0 }}
                            animate={{ x: cx - 120, y: cy, opacity: 1 }}
                            transition={{ duration: 1.5, repeat: Infinity }}
                        >
                            <text fill="#fbbf24" fontSize="12" fontWeight="bold">ATP</text>
                        </motion.g>
                    )}
                    
                    {/* Cycle Arrow */}
                    <motion.path 
                        d={`M ${cx} ${cy-r+30} A ${r-30} ${r-30} 0 1 1 ${cx-5} ${cy-r+30}`} // Partial circle
                        fill="none" stroke="#475569" strokeWidth="4" strokeLinecap="round"
                        animate={{ rotate: 360 }}
                        transition={{ duration: 20, repeat: Infinity, ease: "linear" }}
                        style={{ originX: "50%", originY: "50%" }}
                    />

                </svg>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [mode, setMode] = useState('light'); // 'light' or 'calvin'
            const [currentStepIdx, setCurrentStepIdx] = useState(0);

            const steps = mode === 'light' ? LIGHT_STEPS : CALVIN_STEPS;
            const currentStepData = steps[currentStepIdx];

            const nextStep = () => setCurrentStepIdx(prev => (prev + 1) % steps.length);
            const prevStep = () => setCurrentStepIdx(prev => (prev - 1 + steps.length) % steps.length);

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="sun" className="text-yellow-400" /> Photosynthesis
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Stage Explorer</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto">
                            
                            {/* Mode Toggle */}
                            <div className="bg-slate-800 p-1 rounded-xl flex border border-slate-700">
                                <button 
                                    onClick={() => { setMode('light'); setCurrentStepIdx(0); }}
                                    className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${mode === 'light' ? 'bg-emerald-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Light Reaction
                                </button>
                                <button 
                                    onClick={() => { setMode('calvin'); setCurrentStepIdx(0); }}
                                    className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${mode === 'calvin' ? 'bg-emerald-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Calvin Cycle
                                </button>
                            </div>

                            {/* Step Indicator */}
                            <div className="space-y-4">
                                <div className="flex justify-between text-xs font-bold text-slate-500 uppercase">
                                    <span>Sequence</span>
                                    <span>{currentStepIdx + 1} / {steps.length}</span>
                                </div>
                                <div className="space-y-2">
                                    {steps.map((s, i) => (
                                        <button 
                                            key={s.id}
                                            onClick={() => setCurrentStepIdx(i)}
                                            className={`w-full text-left p-3 rounded-xl border transition-all text-xs font-bold flex items-center gap-3
                                                ${i === currentStepIdx 
                                                    ? 'bg-slate-800 border-emerald-500 text-emerald-400 ring-1 ring-emerald-500/50' 
                                                    : 'bg-slate-900/50 border-slate-700 text-slate-500 hover:bg-slate-800'}
                                            `}
                                        >
                                            <div className={`w-6 h-6 rounded-full flex items-center justify-center shrink-0 ${i === currentStepIdx ? 'bg-emerald-500/20 text-emerald-400' : 'bg-slate-800 text-slate-600'}`}>
                                                {i + 1}
                                            </div>
                                            {s.title}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            {/* Location Info */}
                            <div className="bg-blue-900/20 p-4 rounded-xl border border-blue-500/30">
                                <div className="flex items-center gap-2 mb-2 text-blue-400 font-bold text-xs uppercase">
                                    <Icon name="map-pin" size={14} /> Location
                                </div>
                                <p className="text-xs text-slate-300 leading-relaxed font-bold">
                                    {mode === 'light' ? 'Thylakoid Membrane (Granum)' : 'Stroma (Chloroplast Matrix)'}
                                </p>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-4 overflow-hidden">
                        
                        {/* Animation Area */}
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col">
                            {mode === 'light' ? (
                                <LightReactionView step={currentStepData.id} />
                            ) : (
                                <CalvinCycleView step={currentStepData.id} />
                            )}
                        </div>

                        {/* Control Bar */}
                        <div className="h-32 mt-4 flex gap-4">
                            
                            <div className="flex-1 bg-slate-800 rounded-2xl border border-slate-700 p-6 flex flex-col justify-center">
                                <div className="text-emerald-400 font-bold text-lg mb-2">{currentStepData.title}</div>
                                <p className="text-slate-300 text-sm leading-relaxed">{currentStepData.desc}</p>
                            </div>

                            <div className="w-40 flex flex-col gap-2">
                                <button onClick={prevStep} className="flex-1 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 flex items-center justify-center text-slate-300 hover:text-white transition-colors">
                                    <Icon name="chevron-left"/> Prev
                                </button>
                                <button onClick={nextStep} className="flex-1 bg-emerald-600 hover:bg-emerald-500 rounded-xl border border-emerald-500 flex items-center justify-center text-white font-bold shadow-lg transition-colors">
                                    Next <Icon name="chevron-right" className="ml-1"/>
                                </button>
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
