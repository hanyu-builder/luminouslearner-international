<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synapse Transmission Animator | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Neurotransmitter Glow */
        .glow-particle { filter: drop-shadow(0 0 4px #fbbf24); }
        
        /* Electric Pulse */
        .electric-pulse {
            animation: pulse-travel 1s linear forwards;
        }
        @keyframes pulse-travel {
            0% { stroke-dashoffset: 100; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { stroke-dashoffset: -100; opacity: 0; }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATA ---
        const STEPS = [
            { id: 'resting', title: 'Resting State', desc: 'Synapse is ready. Vesicles contain neurotransmitters.' },
            { id: 'arrival', title: 'Impulse Arrival', desc: 'Action potential reaches the axon terminal. Calcium channels open.' },
            { id: 'release', title: 'Release', desc: 'Vesicles fuse with membrane, releasing neurotransmitters into the cleft.' },
            { id: 'binding', title: 'Binding', desc: 'Neurotransmitters bind to receptors on the post-synaptic membrane.' },
            { id: 'activation', title: 'Activation', desc: 'Ion channels open. New impulse generated in the next neuron.' },
            { id: 'cleanup', title: 'Cleanup', desc: 'Neurotransmitters are broken down or reabsorbed to stop the signal.' }
        ];

        const DRUGS = {
            none: { name: 'Normal', effect: 'Standard transmission rate.' },
            stimulant: { name: 'Stimulant', effect: 'Increases release or blocks reuptake. Signal is amplified.', speed: 2, amount: 2 },
            depressant: { name: 'Depressant', effect: 'Blocks receptors. Signal is weak or stopped.', speed: 0.5, amount: 0.5 }
        };

        // --- VISUAL COMPONENT ---
        const SynapseCanvas = ({ step, drugType, onNext }) => {
            // Config based on drug
            const ntAmount = drugType === 'stimulant' ? 12 : drugType === 'depressant' ? 3 : 6;
            const animSpeed = drugType === 'stimulant' ? 0.5 : drugType === 'depressant' ? 2 : 1;

            return (
                <svg viewBox="0 0 600 500" className="w-full h-full drop-shadow-2xl">
                    
                    {/* --- Pre-synaptic Neuron (Axon Terminal) --- */}
                    <path 
                        d="M 150 0 L 150 150 Q 150 250 300 250 Q 450 250 450 150 L 450 0" 
                        fill="#1e293b" stroke="#cbd5e1" strokeWidth="3" 
                    />
                    <text x="300" y="100" textAnchor="middle" fill="#64748b" fontSize="14" fontWeight="bold">Axon Terminal</text>

                    {/* Incoming Impulse (Step: Arrival) */}
                    {step === 'arrival' && (
                        <motion.path 
                            d="M 300 0 L 300 200" 
                            stroke="#fbbf24" strokeWidth="4" strokeDasharray="20,10"
                            initial={{ pathLength: 0, opacity: 0 }}
                            animate={{ pathLength: 1, opacity: 1 }}
                            transition={{ duration: 0.5 }}
                        />
                    )}

                    {/* Synaptic Vesicles */}
                    <AnimatePresence>
                        {step !== 'release' && step !== 'binding' && step !== 'activation' && step !== 'cleanup' && (
                            <motion.g initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                                <circle cx="250" cy="180" r="15" fill="none" stroke="#fbbf24" strokeWidth="2" />
                                <circle cx="350" cy="180" r="15" fill="none" stroke="#fbbf24" strokeWidth="2" />
                                {/* NTs inside */}
                                <circle cx="250" cy="180" r="3" fill="#fbbf24" />
                                <circle cx="350" cy="180" r="3" fill="#fbbf24" />
                            </motion.g>
                        )}
                    </AnimatePresence>

                    {/* --- Synaptic Cleft --- */}
                    {/* Neurotransmitters (Step: Release -> Binding) */}
                    <AnimatePresence>
                        {(step === 'release' || step === 'binding' || step === 'activation') && (
                            <g>
                                {[...Array(ntAmount)].map((_, i) => (
                                    <motion.circle 
                                        key={i}
                                        r="4" fill="#fbbf24" className="glow-particle"
                                        initial={{ cx: 300 + (Math.random()-0.5)*100, cy: 240 }} // Start at membrane
                                        animate={{ 
                                            cy: step === 'release' ? 300 + (Math.random()-0.5)*50 : // Move to cleft
                                                step === 'binding' || step === 'activation' ? 400 : // Move to receptors
                                                240 // Fallback
                                        }}
                                        transition={{ duration: 1 * animSpeed, ease: "easeOut", delay: i*0.05 }}
                                    />
                                ))}
                            </g>
                        )}
                    </AnimatePresence>

                    {/* Cleanup Phase (Enzymes / Reuptake) */}
                    {step === 'cleanup' && (
                        <motion.g 
                            initial={{ opacity: 0 }} animate={{ opacity: 1 }}
                            className="pointer-events-none"
                        >
                            {/* Enzymatic breakdown visualization - Pacman like enzymes */}
                            {[...Array(3)].map((_, i) => (
                                <motion.path 
                                    key={i}
                                    d="M 0 0 L 10 -5 A 10 10 0 1 1 10 5 Z" 
                                    fill="#ef4444" 
                                    transform={`translate(${250 + i*50}, 320) rotate(${Date.now() % 360})`}
                                    animate={{ x: [0, 20, -20, 0], rotate: 360 }}
                                    transition={{ duration: 2, repeat: Infinity }}
                                />
                            ))}
                            <text x="300" y="300" textAnchor="middle" fill="#ef4444" fontSize="12">Enzymes degrading NTs</text>
                        </motion.g>
                    )}


                    {/* --- Post-synaptic Neuron (Dendrite) --- */}
                    <path 
                        d="M 0 400 Q 150 380 300 400 Q 450 420 600 400 L 600 500 L 0 500 Z" 
                        fill="#0f172a" stroke="#64748b" strokeWidth="3" 
                    />
                    <text x="300" y="460" textAnchor="middle" fill="#64748b" fontSize="14" fontWeight="bold">Dendrite (Post-synaptic)</text>

                    {/* Receptors */}
                    {[200, 300, 400].map((x, i) => (
                        <g key={i} transform={`translate(${x}, 400)`}>
                            {/* Receptor Cup */}
                            <path d="M -10 0 Q 0 15 10 0" fill="none" stroke="#3b82f6" strokeWidth="4" />
                            
                            {/* Blocker Drug Effect */}
                            {drugType === 'depressant' && (
                                <rect x="-8" y="-5" width="16" height="8" fill="#ef4444" rx="2" />
                            )}
                            
                            {/* Channel Opening Animation */}
                            {step === 'activation' && drugType !== 'depressant' && (
                                <motion.path 
                                    d="M 0 10 L 0 50" 
                                    stroke="#38bdf8" strokeWidth="2" strokeDasharray="4,2"
                                    animate={{ opacity: [0, 1, 0] }}
                                    transition={{ duration: 0.5, repeat: Infinity }}
                                />
                            )}
                        </g>
                    ))}

                    {/* New Impulse (Step: Activation) */}
                    {step === 'activation' && drugType !== 'depressant' && (
                        <motion.path 
                            d="M 0 450 L 600 450" 
                            stroke="#fbbf24" strokeWidth="4" strokeDasharray="20,10"
                            initial={{ pathLength: 0, opacity: 0 }}
                            animate={{ pathLength: 1, opacity: 1 }}
                            transition={{ duration: 0.5 }}
                        />
                    )}

                </svg>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [currentStepIdx, setCurrentStepIdx] = useState(0);
            const [drug, setDrug] = useState('none');
            const [autoPlay, setAutoPlay] = useState(false);

            const currentStep = STEPS[currentStepIdx];

            const nextStep = () => {
                setCurrentStepIdx(prev => (prev + 1) % STEPS.length);
            };

            const prevStep = () => {
                setCurrentStepIdx(prev => (prev - 1 + STEPS.length) % STEPS.length);
            };

            // Auto-play logic
            useEffect(() => {
                let interval;
                if (autoPlay) {
                    interval = setInterval(() => {
                        setCurrentStepIdx(prev => (prev + 1) % STEPS.length);
                    }, 2000);
                }
                return () => clearInterval(interval);
            }, [autoPlay]);

            // Reset on drug change
            useEffect(() => {
                setCurrentStepIdx(0);
                setAutoPlay(false);
            }, [drug]);

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="zap" className="text-yellow-400" /> Synapse Lab
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Neurotransmission Sim</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Drug Control */}
                            <div className="space-y-3">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">Condition</label>
                                <div className="grid grid-cols-1 gap-2">
                                    {Object.entries(DRUGS).map(([key, info]) => (
                                        <button 
                                            key={key}
                                            onClick={() => setDrug(key)}
                                            className={`w-full text-left p-3 rounded-xl border transition-all flex items-center justify-between group
                                                ${drug === key 
                                                    ? 'bg-slate-800 border-yellow-500 text-white shadow-lg' 
                                                    : 'bg-slate-900/50 border-slate-700 text-slate-400 hover:bg-slate-800'}
                                            `}
                                        >
                                            <div>
                                                <div className="text-sm font-bold">{info.name}</div>
                                                <div className="text-[10px] opacity-70 mt-1 leading-tight">{info.effect}</div>
                                            </div>
                                            {drug === key && <Icon name="check-circle" size={16} className="text-yellow-400 shrink-0"/>}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Info Card */}
                            <AnimatePresence mode='wait'>
                                <motion.div 
                                    key={currentStep.id}
                                    initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -10 }}
                                    className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-lg"
                                >
                                    <div className="flex justify-between items-start mb-2">
                                        <span className="text-xs font-bold text-emerald-400 uppercase border border-emerald-500/30 px-2 py-0.5 rounded bg-emerald-900/20">
                                            Step {currentStepIdx + 1}
                                        </span>
                                    </div>
                                    <h2 className="text-lg font-bold text-white mb-2">{currentStep.title}</h2>
                                    <p className="text-sm text-slate-300 leading-relaxed">
                                        {currentStep.desc}
                                    </p>
                                </motion.div>
                            </AnimatePresence>

                            {/* Controls */}
                            <div className="flex flex-col gap-3 pt-4 border-t border-slate-800">
                                <div className="flex gap-2">
                                    <button onClick={prevStep} className="p-3 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-600 text-white transition-all">
                                        <Icon name="chevron-left" size={20}/>
                                    </button>
                                    <button onClick={nextStep} className="flex-1 p-3 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-bold flex items-center justify-center gap-2 transition-all shadow-lg">
                                        Next Step <Icon name="chevron-right" size={20}/>
                                    </button>
                                </div>
                                <button 
                                    onClick={() => setAutoPlay(!autoPlay)}
                                    className={`w-full py-2 rounded-lg text-xs font-bold border transition-all
                                        ${autoPlay ? 'bg-red-900/30 border-red-500/50 text-red-300' : 'bg-slate-800 border-slate-700 text-slate-400 hover:text-white'}
                                    `}
                                >
                                    {autoPlay ? 'Stop Auto-Play' : 'Auto Play Animation'}
                                </button>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-6 overflow-hidden gap-6">
                        
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center p-4">
                            
                            <div className="w-full h-full max-w-2xl relative">
                                <SynapseCanvas step={currentStep.id} drugType={drug} />
                                
                                {/* Direction Arrow */}
                                <div className="absolute left-4 top-1/2 -translate-y-1/2 flex flex-col items-center gap-2 opacity-30 pointer-events-none">
                                    <span className="text-xs font-bold writing-vertical-rl text-slate-400 rotate-180">SIGNAL FLOW</span>
                                    <Icon name="arrow-down" size={32} className="text-slate-400"/>
                                </div>
                            </div>

                            <div className="absolute bottom-6 right-6 text-xs text-slate-500 font-mono bg-black/40 px-3 py-1 rounded-full border border-white/10 pointer-events-none">
                                Microscopic View (x10000)
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
