<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nervous System Pathfinder | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Nerve Impulse Glow */
        .impulse {
            filter: drop-shadow(0 0 8px #fbbf24);
        }

        /* Synapse Particles */
        .neurotransmitter {
            animation: diffuse 1.5s linear infinite;
        }
        @keyframes diffuse {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(20px); opacity: 0; }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATA ---
        const SCENARIOS = {
            reflex: {
                id: 'reflex',
                name: 'Reflex Arc',
                stimulus: 'Touch Hot Object',
                path: [
                    { id: 'receptor', name: 'Receptor (Skin)', desc: 'Detects stimulus (heat) and generates impulse.', pos: {x: 100, y: 400} },
                    { id: 'sensory', name: 'Sensory Neuron', desc: 'Transmits impulse from receptor to CNS.', pos: {x: 200, y: 300} },
                    { id: 'spinal', name: 'Spinal Cord (CNS)', desc: 'Integrates signal. Contains Interneuron which relays signal to motor neuron.', pos: {x: 300, y: 200} }, // Interneuron here
                    { id: 'motor', name: 'Motor Neuron', desc: 'Transmits impulse from CNS to effector.', pos: {x: 400, y: 300} },
                    { id: 'effector', name: 'Effector (Muscle)', desc: 'Responds to stimulus (contracts to pull hand away).', pos: {x: 500, y: 400} }
                ],
                desc: 'Rapid, involuntary response. Signal bypasses the brain for speed.',
                time: 'Fast (~0.1s)'
            },
            voluntary: {
                id: 'voluntary',
                name: 'Voluntary Action',
                stimulus: 'See & Grab',
                path: [
                    { id: 'receptor_eye', name: 'Receptor (Eye)', desc: 'Photoreceptors in retina detect light.', pos: {x: 100, y: 100} },
                    { id: 'sensory_optic', name: 'Optic Nerve', desc: 'Carries visual information to the brain.', pos: {x: 200, y: 100} },
                    { id: 'brain', name: 'Brain (Processing)', desc: 'Cerebrum processes info and decides to act.', pos: {x: 300, y: 100} },
                    { id: 'spinal_cord', name: 'Spinal Cord', desc: 'Transmits signal down to the relevant body part.', pos: {x: 300, y: 200} },
                    { id: 'motor', name: 'Motor Neuron', desc: 'Carries command to muscles.', pos: {x: 400, y: 300} },
                    { id: 'effector', name: 'Effector (Muscle)', desc: 'Muscle contracts to grab object.', pos: {x: 500, y: 400} }
                ],
                desc: 'Conscious decision involving the brain. Slower than reflexes.',
                time: 'Variable (~0.3s+)'
            }
        };

        // --- COMPONENTS ---
        
        // Synapse Modal Component
        const SynapseView = ({ onClose }) => {
            return (
                <div className="absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-8 backdrop-blur-md animate-in fade-in">
                    <div className="bg-slate-900 border border-slate-700 rounded-2xl p-8 w-full max-w-2xl relative shadow-2xl">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white">
                            <Icon name="x" size={24}/>
                        </button>
                        
                        <h3 className="text-2xl font-bold text-yellow-400 mb-6 flex items-center gap-2">
                            <Icon name="zap" /> Synaptic Transmission
                        </h3>

                        <div className="flex gap-8 h-64">
                            <div className="flex-1 relative border-r border-slate-700 pr-4">
                                {/* Animation Canvas (Simplified SVG) */}
                                <svg viewBox="0 0 200 200" className="w-full h-full">
                                    {/* Pre-synaptic Neuron */}
                                    <path d="M 50 0 L 50 50 Q 50 80 100 80 Q 150 80 150 50 L 150 0" fill="#334155" stroke="#94a3b8" strokeWidth="2" />
                                    {/* Vesicles */}
                                    <circle cx="80" cy="40" r="5" fill="#fbbf24" />
                                    <circle cx="120" cy="50" r="5" fill="#fbbf24" />
                                    
                                    {/* Synaptic Cleft Space */}
                                    
                                    {/* Post-synaptic Neuron */}
                                    <path d="M 20 150 Q 100 120 180 150 L 180 200 L 20 200 Z" fill="#1e293b" stroke="#64748b" strokeWidth="2" />
                                    
                                    {/* Neurotransmitters Animating */}
                                    <g className="neurotransmitter">
                                        <circle cx="80" cy="90" r="3" fill="#fbbf24" />
                                        <circle cx="100" cy="100" r="3" fill="#fbbf24" />
                                        <circle cx="120" cy="95" r="3" fill="#fbbf24" />
                                    </g>

                                    <text x="10" y="40" fill="#94a3b8" fontSize="10">Axon Ending</text>
                                    <text x="10" y="180" fill="#94a3b8" fontSize="10">Dendrite</text>
                                </svg>
                            </div>
                            
                            <div className="flex-1 flex flex-col justify-center space-y-4 text-sm text-slate-300">
                                <div className="flex gap-3 items-start">
                                    <span className="bg-slate-800 px-2 py-0.5 rounded text-yellow-400 font-bold">1</span>
                                    <span>Electrical impulse reaches axon ending.</span>
                                </div>
                                <div className="flex gap-3 items-start">
                                    <span className="bg-slate-800 px-2 py-0.5 rounded text-yellow-400 font-bold">2</span>
                                    <span>Neurotransmitters released into synaptic cleft.</span>
                                </div>
                                <div className="flex gap-3 items-start">
                                    <span className="bg-slate-800 px-2 py-0.5 rounded text-yellow-400 font-bold">3</span>
                                    <span>Chemicals diffuse across and bind to receptors on next neuron.</span>
                                </div>
                                <div className="flex gap-3 items-start">
                                    <span className="bg-slate-800 px-2 py-0.5 rounded text-yellow-400 font-bold">4</span>
                                    <span>New electrical impulse generated.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Animated Path Component
        const NervePath = ({ scenario, isPlaying, onComplete, onNodeClick, selectedNodeId }) => {
            const pathPoints = scenario.path.map(p => `${p.pos.x},${p.pos.y}`).join(' L ');
            const pathD = `M ${pathPoints}`;
            const xKeyframes = scenario.path.map(p => p.pos.x);
            const yKeyframes = scenario.path.map(p => p.pos.y);

            const times = useMemo(() => {
                let totalDist = 0;
                const dists = [0];
                for(let i=0; i<scenario.path.length-1; i++) {
                    const p1 = scenario.path[i].pos;
                    const p2 = scenario.path[i+1].pos;
                    const d = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
                    totalDist += d;
                    dists.push(totalDist);
                }
                return dists.map(d => d / totalDist);
            }, [scenario]);

            return (
                <svg viewBox="0 0 600 500" className="w-full h-full drop-shadow-2xl overflow-visible">
                    <path d={pathD} stroke="#334155" strokeWidth="4" fill="none" strokeDasharray="5,5" />

                    {/* Nodes */}
                    {scenario.path.map((node, i) => (
                        <g 
                            key={node.id} 
                            transform={`translate(${node.pos.x}, ${node.pos.y})`}
                            onClick={() => onNodeClick(node)}
                            className="cursor-pointer hover:opacity-80 transition-opacity"
                        >
                            {/* Selection Halo */}
                            {selectedNodeId === node.id && (
                                <circle r="22" fill="none" stroke="#fbbf24" strokeWidth="2" className="animate-pulse" />
                            )}
                            
                            <circle r="15" fill={selectedNodeId === node.id ? "#1e293b" : "#0f172a"} stroke={selectedNodeId === node.id ? "#fbbf24" : "#64748b"} strokeWidth="2" />
                            <text y="30" textAnchor="middle" fontSize="10" fill="#94a3b8" className="font-bold pointer-events-none">{node.name}</text>
                            
                            {node.id.includes('receptor') && <circle r="8" fill="#ef4444" />}
                            {node.id.includes('brain') && <circle r="12" fill="#8b5cf6" opacity="0.5"/>}
                            {node.id.includes('spinal') && <rect x="-10" y="-10" width="20" height="20" fill="#3b82f6" opacity="0.5" rx="4"/>}
                            {node.id.includes('effector') && <rect x="-10" y="-10" width="20" height="20" fill="#10b981" opacity="0.5" rx="4"/>}
                        </g>
                    ))}

                    {isPlaying && (
                        <motion.circle 
                            r="8" fill="#fbbf24" className="impulse"
                            initial={{ cx: xKeyframes[0], cy: yKeyframes[0] }}
                            animate={{ cx: xKeyframes, cy: yKeyframes }}
                            transition={{ duration: scenario.id === 'reflex' ? 1.5 : 3, ease: "linear", times: times }}
                            onAnimationComplete={onComplete}
                        />
                    )}
                </svg>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [mode, setMode] = useState('reflex');
            const [isPlaying, setIsPlaying] = useState(false);
            const [status, setStatus] = useState('Ready');
            const [selectedNode, setSelectedNode] = useState(null); // For dynamic explanation
            const [showSynapse, setShowSynapse] = useState(false); // Modal toggle
            
            const currentScenario = SCENARIOS[mode];

            // Reset selection when mode changes
            useEffect(() => {
                setSelectedNode(null);
                setStatus('Ready');
            }, [mode]);

            const handleStart = () => {
                if (isPlaying) return;
                setIsPlaying(true);
                setStatus('Signal Transmitting...');
                setSelectedNode(null); // Clear selection during play for focus
            };

            const handleComplete = () => {
                setIsPlaying(false);
                setStatus('Response Complete!');
                setTimeout(() => setStatus('Ready'), 2000);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="zap" className="text-yellow-400" /> Nerve Path
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Reflex vs Voluntary Actions</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Mode Selection */}
                            <div className="space-y-3">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">Select Action Type</label>
                                <div className="flex flex-col gap-2">
                                    {Object.values(SCENARIOS).map(s => (
                                        <button 
                                            key={s.id}
                                            onClick={() => { setMode(s.id); setIsPlaying(false); }}
                                            className={`w-full text-left p-3 rounded-xl border transition-all flex items-center justify-between group
                                                ${mode === s.id 
                                                    ? 'bg-slate-800 border-blue-500 text-white shadow-lg' 
                                                    : 'bg-slate-900/50 border-slate-700 text-slate-400 hover:bg-slate-800'}
                                            `}
                                        >
                                            <span className="text-sm font-bold">{s.name.split(' (')[0]}</span>
                                            {mode === s.id && <Icon name="check-circle" size={16} className="text-blue-400"/>}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* DYNAMIC Info Card - Updates on Click */}
                            <AnimatePresence mode='wait'>
                                <motion.div 
                                    key={selectedNode ? selectedNode.id : mode}
                                    initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -10 }}
                                    className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-lg"
                                >
                                    {selectedNode ? (
                                        // Node Details
                                        <>
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-xs font-bold text-emerald-400 uppercase">Structure Detail</span>
                                                <button onClick={()=>setSelectedNode(null)} className="text-slate-500 hover:text-white"><Icon name="x" size={16}/></button>
                                            </div>
                                            <h2 className="text-lg font-bold text-white mb-2">{selectedNode.name}</h2>
                                            <p className="text-sm text-slate-300 leading-relaxed">{selectedNode.desc}</p>
                                        </>
                                    ) : (
                                        // Scenario Overview
                                        <>
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-xs font-bold text-yellow-400 uppercase">Stimulus</span>
                                            </div>
                                            <h2 className="text-lg font-bold text-white mb-2">{currentScenario.stimulus}</h2>
                                            <p className="text-xs text-slate-300 leading-relaxed mb-4">{currentScenario.desc}</p>
                                            <div className="flex items-center justify-between pt-3 border-t border-slate-700">
                                                <span className="text-xs text-slate-500 font-bold uppercase">Reaction Time</span>
                                                <span className="text-sm font-mono font-bold text-emerald-400">{currentScenario.time}</span>
                                            </div>
                                        </>
                                    )}
                                </motion.div>
                            </AnimatePresence>
                            
                            {/* Synapse Button */}
                            <button 
                                onClick={() => setShowSynapse(true)}
                                className="w-full py-3 rounded-xl border border-slate-600 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all flex items-center justify-center gap-2 text-sm font-bold"
                            >
                                <Icon name="microscope" size={18}/> View Synapse Detail
                            </button>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#020617] relative flex flex-col p-6 overflow-hidden">
                        
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center p-8">
                            
                            <div className="w-full h-full max-w-3xl relative">
                                <NervePath 
                                    scenario={currentScenario} 
                                    isPlaying={isPlaying} 
                                    onComplete={handleComplete}
                                    onNodeClick={setSelectedNode}
                                    selectedNodeId={selectedNode?.id}
                                />
                                
                                {/* Background Hints */}
                                {mode === 'voluntary' && (
                                    <div className="absolute top-[15%] left-[50%] -translate-x-1/2 text-slate-700 font-black text-6xl opacity-10 pointer-events-none">BRAIN</div>
                                )}
                                <div className="absolute top-[35%] left-[50%] -translate-x-1/2 text-slate-700 font-black text-6xl opacity-10 pointer-events-none">SPINAL CORD</div>

                                {/* Instruction Overlay if nothing selected */}
                                {!selectedNode && !isPlaying && (
                                    <div className="absolute top-4 left-4 text-slate-500 text-xs italic bg-black/40 px-3 py-1 rounded-full backdrop-blur pointer-events-none">
                                        Click on any node to see details
                                    </div>
                                )}
                            </div>

                            {/* Control Bar */}
                            <div className="absolute bottom-8 flex flex-col items-center gap-4">
                                <div className={`text-sm font-mono font-bold px-4 py-1 rounded-full border transition-colors
                                    ${status === 'Ready' ? 'text-slate-400 border-slate-600 bg-slate-800' : 
                                      status.includes('Transmitting') ? 'text-yellow-400 border-yellow-500 bg-yellow-900/30 animate-pulse' :
                                      'text-emerald-400 border-emerald-500 bg-emerald-900/30'}
                                `}>
                                    {status}
                                </div>
                                
                                <button 
                                    onClick={handleStart}
                                    disabled={isPlaying}
                                    className={`px-8 py-3 rounded-full font-bold shadow-lg transition-transform active:scale-95 flex items-center gap-2
                                        ${isPlaying ? 'bg-slate-700 text-slate-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-500 text-white'}
                                    `}
                                >
                                    <Icon name="zap" size={18} fill="currentColor"/> Stimulate
                                </button>
                            </div>

                        </div>
                    </div>

                    {/* Synapse Modal */}
                    {showSynapse && <SynapseView onClose={() => setShowSynapse(false)} />}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
