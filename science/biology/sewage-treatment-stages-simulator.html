<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sewage Treatment Stages | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Water Flow Animation */
        .water-surface {
            animation: wave 3s linear infinite;
            background: repeat-x;
            background-size: 50% 100%;
        }
        @keyframes wave {
            0% { background-position: 0 0; }
            100% { background-position: 100% 0; }
        }

        /* Bubbles in Aeration Tank */
        .aeration-bubble {
            animation: bubble-rise 2s infinite ease-in;
        }
        @keyframes bubble-rise {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATA ---
        const STAGES = [
            {
                id: 'screening',
                title: 'Screening',
                type: 'Preliminary',
                desc: 'Metal grids remove large solid objects (e.g., rags, wood, plastics) to protect pumps.',
                removal: 'Large Solids',
                waterColor: '#5f4b32' // Very dirty brown
            },
            {
                id: 'primary',
                title: 'Primary Sedimentation',
                type: 'Primary Treatment (Physical)',
                desc: 'Sewage flows slowly. Suspended solids settle by gravity to form primary sludge. Grease floats to top.',
                removal: '~50% Suspended Solids',
                waterColor: '#856948' // Dirty brown
            },
            {
                id: 'aeration',
                title: 'Aeration Tank',
                type: 'Secondary Treatment (Biological)',
                desc: 'Air is pumped in. Aerobic bacteria digest organic matter (activated sludge process). Reduces BOD.',
                removal: 'Dissolved Organic Matter',
                waterColor: '#a89f72' // Murky green-brown
            },
            {
                id: 'final',
                title: 'Final Sedimentation',
                type: 'Secondary Treatment (Biological)',
                desc: 'Bacteria (activated sludge) settle down. Some sludge is recycled to aeration tank; rest goes to digester.',
                removal: 'Bacteria & Remaining Solids',
                waterColor: '#60a5fa' // Clearer blue
            },
            {
                id: 'disinfection',
                title: 'Disinfection',
                type: 'Tertiary/Final',
                desc: 'Chlorine or UV light kills pathogens (bacteria/viruses) before discharge into the sea.',
                removal: 'Pathogens',
                waterColor: '#38bdf8' // Clean blue
            },
            {
                id: 'sludge',
                title: 'Sludge Digestion',
                type: 'Solids Treatment',
                desc: 'Anaerobic bacteria break down sludge, producing methane (biogas) for energy.',
                removal: 'Sludge Volume Reduction',
                waterColor: '#3f2e18' // Dark sludge
            }
        ];

        // --- VISUAL COMPONENTS ---
        
        const WaterParticle = ({ type, x, y }) => {
            // type: solid, organic, bacteria, pathogen
            
            if (type === 'solid') {
                return <rect x={x} y={y} width="8" height="8" fill="#3f2e18" transform={`rotate(${Math.random()*360} ${x+4} ${y+4})`} />;
            } else if (type === 'organic') {
                return <circle cx={x} cy={y} r="3" fill="#fbbf24" opacity="0.8" />;
            } else if (type === 'bacteria') {
                // Simple bacterium shape
                return <ellipse cx={x} cy={y} rx="4" ry="2" fill="#22c55e" />;
            } else if (type === 'pathogen') {
                // Red dot
                return <circle cx={x} cy={y} r="2.5" fill="#ef4444" />;
            }
            return null;
        };

        const Tank = ({ stage, isActive }) => {
            // Determine visual elements based on stage
            const isAeration = stage.id === 'aeration';
            const isSettling = stage.id === 'primary' || stage.id === 'final';
            const isScreen = stage.id === 'screening';
            
            return (
                <div className={`relative w-full h-48 border-b-4 border-x-4 border-slate-600 rounded-b-xl overflow-hidden transition-colors duration-500 ${isActive ? 'bg-slate-800' : 'bg-slate-900'}`}>
                    
                    {/* Water Body */}
                    <div 
                        className="absolute bottom-0 left-0 right-0 transition-all duration-1000 ease-in-out"
                        style={{ 
                            height: '80%', 
                            backgroundColor: stage.waterColor,
                            opacity: 0.8
                        }}
                    >
                        {/* Bubbles for Aeration */}
                        {isAeration && (
                            <div className="absolute inset-0 pointer-events-none">
                                {[...Array(10)].map((_, i) => (
                                    <div 
                                        key={i} 
                                        className="absolute w-2 h-2 bg-white/40 rounded-full aeration-bubble"
                                        style={{ left: `${10 + i*10}%`, animationDelay: `${i*0.2}s`, animationDuration: `${1.5 + Math.random()}s` }}
                                    ></div>
                                ))}
                                <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-full text-center text-[10px] text-white/50 mb-2 font-bold">AIR PUMP</div>
                            </div>
                        )}

                        {/* Sludge Layer for Sedimentation */}
                        {isSettling && (
                            <div className="absolute bottom-0 left-0 right-0 h-4 bg-[#3f2e18] opacity-80"></div>
                        )}
                        
                        {/* Screen Grid */}
                        {isScreen && (
                            <div className="absolute right-0 top-0 bottom-0 w-2 bg-slate-400 flex flex-col justify-around z-10">
                                {[...Array(5)].map((_,i) => <div key={i} className="w-full h-1 bg-slate-800"></div>)}
                            </div>
                        )}

                        {/* Disinfection Rays */}
                        {stage.id === 'disinfection' && (
                            <div className="absolute top-0 left-0 right-0 h-full bg-gradient-to-b from-purple-500/20 to-transparent"></div>
                        )}
                    </div>
                    
                    {/* Label */}
                    <div className="absolute top-2 left-2 bg-black/50 px-2 py-1 rounded text-[10px] text-white font-bold z-20">
                        {stage.title}
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [currentStageIdx, setCurrentStageIdx] = useState(0);
            const [particles, setParticles] = useState([]);
            const requestRef = useRef();
            
            const currentStage = STAGES[currentStageIdx];

            // Initialize Particles
            useEffect(() => {
                const p = [];
                // Initial Load: Solids, Organic matter, Bacteria, Pathogens
                // Quantities vary by stage to simulate removal process
                
                const width = 400; // Approx width of SVG viewBox
                const waterTop = 50; // Approximate water surface in viewBox Y

                // Logic:
                // Stage 0 (Screening): Everything present
                // Stage 1 (Primary): Solids removed/settled. Organics present.
                // Stage 2 (Aeration): Organics consumed, Bacteria added.
                // Stage 3 (Final): Bacteria removed.
                // Stage 4 (Disinfection): Pathogens removed.
                
                // Simulating content *entering* or *present in* this stage
                const solidCount = currentStageIdx === 0 ? 15 : 0;
                const organicCount = currentStageIdx <= 2 ? 30 : currentStageIdx === 3 ? 10 : 0;
                const bacteriaCount = currentStageIdx === 2 ? 40 : currentStageIdx === 3 ? 20 : 0; // Activated sludge high in aeration
                const pathogenCount = currentStageIdx <= 4 ? 15 : 0; // Present until disinfection completes

                for(let i=0; i<solidCount; i++) p.push({ id: Math.random(), type: 'solid', x: Math.random()*width, y: Math.random()*100 + waterTop, vx: 0.5, vy: 0.2 });
                for(let i=0; i<organicCount; i++) p.push({ id: Math.random(), type: 'organic', x: Math.random()*width, y: Math.random()*100 + waterTop, vx: 0.5, vy: 0.1 });
                for(let i=0; i<bacteriaCount; i++) p.push({ id: Math.random(), type: 'bacteria', x: Math.random()*width, y: Math.random()*100 + waterTop, vx: 0.5, vy: 0 });
                for(let i=0; i<pathogenCount; i++) p.push({ id: Math.random(), type: 'pathogen', x: Math.random()*width, y: Math.random()*100 + waterTop, vx: 0.5, vy: 0 });
                
                setParticles(p);
            }, [currentStageIdx]);

            // Animation Loop
            const update = () => {
                setParticles(prev => prev.map(p => {
                    let nx = p.x + p.vx;
                    let ny = p.y + p.vy;
                    
                    // Stage specific physics
                    if (currentStage.id === 'primary' || currentStage.id === 'final') {
                        // Settle down
                        if (p.type === 'solid' || (currentStage.id === 'final' && p.type === 'bacteria')) {
                            ny += 0.5;
                        }
                    }
                    if (currentStage.id === 'aeration') {
                        // Churning
                        ny += Math.sin(Date.now() * 0.005 + p.x) * 0.5;
                    }

                    // Bounds (ViewBox 0-400, Water roughly 50-180)
                    if (nx > 400) nx = 0; // Loop
                    if (ny > 170) ny = 170; // Bottom
                    if (ny < 50) ny = 50; // Top surface

                    return { ...p, x: nx, y: ny };
                }));
                requestRef.current = requestAnimationFrame(update);
            };

            useEffect(() => {
                requestRef.current = requestAnimationFrame(update);
                return () => cancelAnimationFrame(requestRef.current);
            }, [currentStageIdx]);

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="factory" className="text-blue-400" /> Sewage Treatment
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Water Purification Process</p>
                        </div>

                        <div className="p-6 flex-1 overflow-y-auto custom-scrollbar space-y-6">
                            
                            {/* Flow Map */}
                            <div className="space-y-2 relative">
                                <div className="absolute left-3 top-4 bottom-4 w-0.5 bg-slate-700"></div>
                                {STAGES.map((s, i) => (
                                    <button
                                        key={s.id}
                                        onClick={() => setCurrentStageIdx(i)}
                                        className={`relative w-full text-left p-3 pl-8 rounded-xl border transition-all flex flex-col gap-1 group
                                            ${currentStageIdx === i 
                                                ? 'bg-slate-800 border-blue-500 shadow-lg' 
                                                : 'bg-transparent border-transparent hover:bg-slate-800/50'}
                                        `}
                                    >
                                        <div className={`absolute left-[6px] top-1/2 -translate-y-1/2 w-3 h-3 rounded-full border-2 z-10 ${currentStageIdx >= i ? 'bg-blue-500 border-blue-500' : 'bg-slate-900 border-slate-600'}`}></div>
                                        <span className={`text-xs font-bold uppercase ${currentStageIdx === i ? 'text-blue-400' : 'text-slate-500'}`}>{s.type}</span>
                                        <span className="text-sm font-bold text-white">{s.title}</span>
                                    </button>
                                ))}
                            </div>

                            {/* Legend */}
                            <div className="bg-slate-800/50 p-3 rounded-xl border border-slate-700 text-xs text-slate-400 space-y-2">
                                <div className="font-bold text-white mb-1">Particle Key</div>
                                <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-[#3f2e18]"></div> Solid Waste</div>
                                <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-[#fbbf24]"></div> Organic Matter</div>
                                <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-[#22c55e]"></div> Bacteria (Good)</div>
                                <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-[#ef4444]"></div> Pathogen (Bad)</div>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-[#0F172A] relative flex flex-col p-6 overflow-hidden gap-6">
                        
                        {/* Stage Visualizer */}
                        <div className="flex-1 bg-slate-900 rounded-3xl border border-slate-800 shadow-xl relative overflow-hidden flex flex-col items-center justify-center p-8">
                            
                            {/* Tank Container */}
                            <div className="w-full max-w-2xl relative">
                                <Tank stage={currentStage} isActive={true} />
                                
                                {/* Particle Layer (SVG Overlay) */}
                                <svg className="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 400 200" preserveAspectRatio="none">
                                    {particles.map(p => (
                                        <WaterParticle key={p.id} type={p.type} x={p.x} y={p.y} />
                                    ))}
                                </svg>
                            </div>

                            {/* Info Card */}
                            <div className="mt-8 max-w-2xl w-full">
                                <AnimatePresence mode='wait'>
                                    <motion.div 
                                        key={currentStage.id}
                                        initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }}
                                        className="bg-slate-800 p-6 rounded-2xl border border-slate-700"
                                    >
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <div className="text-xs font-bold text-blue-400 uppercase mb-1">Current Process</div>
                                                <h2 className="text-2xl font-black text-white">{currentStage.title}</h2>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-xs font-bold text-slate-500 uppercase mb-1">Removes</div>
                                                <div className="text-sm font-mono text-emerald-400 bg-emerald-900/20 px-2 py-1 rounded border border-emerald-500/30">
                                                    {currentStage.removal}
                                                </div>
                                            </div>
                                        </div>
                                        <p className="text-sm text-slate-300 leading-relaxed">
                                            {currentStage.desc}
                                        </p>
                                    </motion.div>
                                </AnimatePresence>
                            </div>

                            {/* Navigation Footer */}
                            <div className="absolute bottom-6 flex gap-4">
                                <button 
                                    onClick={() => setCurrentStageIdx(p => Math.max(0, p - 1))}
                                    disabled={currentStageIdx === 0}
                                    className="p-3 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-600 disabled:opacity-50 transition-all"
                                >
                                    <Icon name="arrow-left" />
                                </button>
                                <button 
                                    onClick={() => setCurrentStageIdx(p => Math.min(STAGES.length - 1, p + 1))}
                                    disabled={currentStageIdx === STAGES.length - 1}
                                    className="px-8 py-3 rounded-full bg-blue-600 hover:bg-blue-500 text-white font-bold shadow-lg flex items-center gap-2 disabled:bg-slate-700 disabled:text-slate-500"
                                >
                                    Next Stage <Icon name="arrow-right" size={18}/>
                                </button>
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
