<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Test Virtual Lab | LuminousLearner</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            950: '#0F172A', // LuminousLearner Dark Mode Background
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Test Tube Liquid Animation */
        .liquid { transition: height 1s ease-out, background-color 1.5s ease-in-out, opacity 1s ease; }
        
        /* Boiling Animation */
        .boil { animation: boil 0.1s infinite alternate; }
        @keyframes boil {
            0% { transform: translateY(0); }
            100% { transform: translateY(-2px); }
        }
        
        .bubble {
            position: absolute;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            animation: rise 0.8s infinite ease-in;
        }
        @keyframes rise {
            0% { bottom: 0; transform: scale(0.5); opacity: 0; }
            50% { opacity: 0.8; }
            100% { bottom: 100%; transform: scale(1.5); opacity: 0; }
        }

        /* Precipitate Particles */
        .precipitate {
            position: absolute;
            background: rgba(255,255,255,0.6);
            width: 4px; 
            height: 4px;
            border-radius: 50%;
            animation: sink 2s ease-out forwards;
        }
        @keyframes sink {
            0% { top: 0; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 90%; opacity: 0.8; }
        }

        /* Emulsion Cloudiness */
        .cloudy {
            background-image: radial-gradient(rgba(255,255,255,0.8) 1px, transparent 1px);
            background-size: 4px 4px;
            backdrop-filter: blur(4px);
        }
        
        /* Shaking Animation */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATA ---
        const SAMPLES = [
            { id: 'glucose', name: 'Glucose Solution', content: { sugar: true, starch: false, protein: false, lipid: false, vitC: false }, color: 'bg-transparent' },
            { id: 'starch', name: 'Starch Solution', content: { sugar: false, starch: true, protein: false, lipid: false, vitC: false }, color: 'bg-white/20' }, // Slightly cloudy
            { id: 'egg', name: 'Egg White', content: { sugar: false, starch: false, protein: true, lipid: false, vitC: false }, color: 'bg-yellow-100/20' },
            { id: 'oil', name: 'Vegetable Oil', content: { sugar: false, starch: false, protein: false, lipid: true, vitC: false }, color: 'bg-yellow-200/40' },
            { id: 'orange', name: 'Orange Juice', content: { sugar: true, starch: false, protein: false, lipid: false, vitC: true }, color: 'bg-orange-400/60' },
            { id: 'water', name: 'Distilled Water', content: { sugar: false, starch: false, protein: false, lipid: false, vitC: false }, color: 'bg-blue-50/10' },
            { id: 'unknown', name: 'Unknown Sample X', content: { sugar: true, starch: true, protein: false, lipid: false, vitC: false }, color: 'bg-slate-200/30' } // Mixed
        ];

        const TESTS = {
            benedict: {
                id: 'benedict', name: 'Benedict\'s Test', target: 'Reducing Sugars',
                reagentColor: 'bg-blue-500/60', 
                posColor: 'bg-orange-600', negColor: 'bg-blue-500/60', // Blue -> Brick Red
                needsHeat: true,
                desc: 'Detects reducing sugars like glucose.'
            },
            iodine: {
                id: 'iodine', name: 'Iodine Test', target: 'Starch',
                reagentColor: 'bg-yellow-600/60', // Brown/Orange
                posColor: 'bg-blue-950', negColor: 'bg-yellow-600/60', // Brown -> Blue-black
                needsHeat: false,
                desc: 'Detects starch.'
            },
            biuret: {
                id: 'biuret', name: 'Biuret Test', target: 'Proteins',
                reagentColor: 'bg-blue-400/60', 
                posColor: 'bg-purple-600', negColor: 'bg-blue-400/60', // Blue -> Purple
                needsHeat: false,
                desc: 'Detects peptide bonds in proteins.'
            },
            ethanol: {
                id: 'ethanol', name: 'Ethanol Emulsion', target: 'Lipids',
                reagentColor: 'bg-white/10', // Clear ethanol
                posColor: 'bg-white/90', negColor: 'bg-transparent', // Clear -> Cloudy White
                isEmulsion: true,
                needsHeat: false,
                desc: 'Detects lipids (fats/oils).'
            },
            dcpip: {
                id: 'dcpip', name: 'DCPIP Test', target: 'Vitamin C',
                reagentColor: 'bg-blue-600', // Deep Blue
                posColor: 'bg-transparent', negColor: 'bg-blue-600', // Blue -> Colorless
                needsHeat: false,
                desc: 'Detects Vitamin C (Ascorbic Acid).'
            }
        };

        const App = () => {
            const [sample, setSample] = useState(SAMPLES[0]);
            const [test, setTest] = useState(TESTS.benedict);
            const [step, setStep] = useState(0); // 0: Ready, 1: Sample Added, 2: Reagent Added, 3: Heated/Mixed (Result)
            const [isHeating, setIsHeating] = useState(false);
            const [isShaking, setIsShaking] = useState(false);

            const handleReset = () => {
                setStep(0);
                setIsHeating(false);
                setIsShaking(false);
            };

            const handleAddSample = () => setStep(1);
            
            const handleAddReagent = () => {
                setStep(2);
            };

            const handleProcess = () => {
                if (test.needsHeat) {
                    setIsHeating(true);
                    setTimeout(() => {
                        setIsHeating(false);
                        setStep(3);
                    }, 2000);
                } else {
                    setIsShaking(true);
                    setTimeout(() => {
                        setIsShaking(false);
                        setStep(3);
                    }, 1000);
                }
            };

            // --- DETERMINE RESULT ---
            const getResultVisuals = () => {
                if (step < 3) {
                    return test.reagentColor; 
                }

                const hasTarget = 
                    (test.id === 'benedict' && sample.content.sugar) ||
                    (test.id === 'iodine' && sample.content.starch) ||
                    (test.id === 'biuret' && sample.content.protein) ||
                    (test.id === 'ethanol' && sample.content.lipid) ||
                    (test.id === 'dcpip' && sample.content.vitC);

                if (hasTarget) {
                    return test.posColor + (test.isEmulsion ? ' cloudy' : '');
                } else {
                    return test.negColor;
                }
            };
            
            const getObservationText = () => {
                if (step < 3) return "Waiting for reaction...";
                
                const hasTarget = 
                    (test.id === 'benedict' && sample.content.sugar) ||
                    (test.id === 'iodine' && sample.content.starch) ||
                    (test.id === 'biuret' && sample.content.protein) ||
                    (test.id === 'ethanol' && sample.content.lipid) ||
                    (test.id === 'dcpip' && sample.content.vitC);

                if (hasTarget) {
                    if (test.id === 'benedict') return 'Brick-red precipitate formed (Positive)';
                    if (test.id === 'iodine') return 'Turned blue-black (Positive)';
                    if (test.id === 'biuret') return 'Turned purple (Positive)';
                    if (test.id === 'ethanol') return 'White emulsion formed (Positive)';
                    if (test.id === 'dcpip') return 'Blue solution decolourised (Positive)';
                } else {
                    if (test.id === 'benedict') return 'Remains blue (Negative)';
                    if (test.id === 'iodine') return 'Remains brown/orange (Negative)';
                    if (test.id === 'biuret') return 'Remains blue (Negative)';
                    if (test.id === 'ethanol') return 'Remains clear (Negative)';
                    if (test.id === 'dcpip') return 'Remains blue (Negative)';
                }
                return "No change";
            };

            const currentVisual = step === 0 ? 'bg-transparent' : step === 1 ? sample.color : getResultVisuals();
            const isTransparentResult = step === 3 && test.id === 'dcpip' && sample.content.vitC;
            const showPrecipitate = step === 3 && test.id === 'benedict' && sample.content.sugar;

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden font-sans">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="flask-conical" className="text-emerald-400" /> Food Test Lab
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Biological Molecules Identification</p>
                        </div>

                        <div className="p-6 space-y-6 flex-1 overflow-y-auto custom-scrollbar">
                            
                            {/* Sample Selection */}
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">1. Select Sample</label>
                                <select 
                                    value={sample.id} 
                                    onChange={(e) => { setSample(SAMPLES.find(s => s.id === e.target.value)); handleReset(); }}
                                    className="w-full bg-slate-800 text-white p-3 rounded-xl border border-slate-600 focus:border-emerald-500 outline-none"
                                >
                                    {SAMPLES.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                </select>
                            </div>

                            {/* Test Selection */}
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">2. Select Test</label>
                                <div className="grid grid-cols-1 gap-2">
                                    {Object.values(TESTS).map(t => (
                                        <button 
                                            key={t.id}
                                            onClick={() => { setTest(t); handleReset(); }}
                                            className={`w-full text-left p-3 rounded-xl border transition-all flex items-center justify-between group
                                                ${test.id === t.id 
                                                    ? 'bg-slate-800 border-blue-500 text-white shadow-lg' 
                                                    : 'bg-slate-900/50 border-slate-700 text-slate-400 hover:bg-slate-800'}
                                            `}
                                        >
                                            <div>
                                                <span className="font-bold text-sm block">{t.name}</span>
                                                <span className="text-[10px] text-slate-500 uppercase">Target: {t.target}</span>
                                            </div>
                                            {test.id === t.id && <Icon name="check-circle" size={16} className="text-blue-400"/>}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Info Box */}
                            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700 mt-4">
                                <div className="flex items-center gap-2 mb-2 text-yellow-400 font-bold text-xs uppercase">
                                    <Icon name="lightbulb" size={14} /> Principle
                                </div>
                                <p className="text-xs text-slate-400 leading-relaxed">
                                    {test.desc}
                                    {test.needsHeat && <span className="block mt-1 text-red-400 font-bold"><Icon name="flame" size={12} className="inline"/> Requires Heating (Water Bath)</span>}
                                </p>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-slate-950 relative flex flex-col items-center justify-center p-8 overflow-hidden">
                        
                        {/* Test Tube Rack Area */}
                        <div className="relative flex items-end justify-center h-[500px] w-full max-w-lg">
                            
                            {/* The Test Tube */}
                            <div className={`relative w-24 h-64 border-x-4 border-b-4 border-slate-500/30 rounded-b-full bg-white/5 backdrop-blur-sm overflow-hidden z-10 transition-transform duration-300 ${isShaking ? 'shake' : ''}`}>
                                
                                {/* Liquid Content */}
                                <div 
                                    className={`absolute bottom-0 w-full liquid ${currentVisual} ${isHeating ? 'boil' : ''} ${isTransparentResult ? 'opacity-0' : 'opacity-90'}`}
                                    style={{ height: step === 0 ? '0%' : step === 1 ? '30%' : '60%' }}
                                >
                                    {/* Bubbles during heating */}
                                    {isHeating && (
                                        <div className="absolute inset-0">
                                            {[...Array(8)].map((_, i) => (
                                                <div key={i} className="bubble" style={{ left: `${Math.random()*80+10}%`, width: Math.random()*6+4, height: Math.random()*6+4, animationDelay: `${Math.random()}s` }}></div>
                                            ))}
                                        </div>
                                    )}

                                    {/* Precipitate for Benedict's */}
                                    {showPrecipitate && (
                                        <div className="absolute inset-0">
                                            {[...Array(20)].map((_, i) => (
                                                <div key={i} className="precipitate" style={{ left: `${Math.random()*90}%`, animationDelay: `${Math.random()}s`, backgroundColor: '#c2410c' }}></div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Glass Highlights */}
                                <div className="absolute top-4 left-2 w-2 h-48 bg-white/10 rounded-full"></div>
                                <div className="absolute top-4 right-2 w-1 h-48 bg-white/5 rounded-full"></div>
                            </div>

                            {/* Bunsen Burner (Only if heating) */}
                            {isHeating && (
                                <div className="absolute bottom-[-60px] flex flex-col items-center animate-in fade-in slide-in-from-bottom-4">
                                    <div className="w-16 h-24 bg-gradient-to-t from-orange-500 via-yellow-400 to-transparent blur-md opacity-80 animate-pulse"></div>
                                    <div className="text-red-500 font-bold text-xs mt-2">HEATING...</div>
                                </div>
                            )}

                        </div>

                        {/* Action Panel */}
                        <div className="mt-8 w-full max-w-xl">
                            
                            {/* Step Indicator */}
                            <div className="flex justify-between mb-6 px-8 relative">
                                <div className="absolute top-1/2 left-8 right-8 h-1 bg-slate-800 -z-10"></div>
                                {['Empty', 'Add Sample', 'Add Reagent', test.needsHeat ? 'Heat' : 'Shake'].map((label, i) => (
                                    <div key={i} className={`flex flex-col items-center gap-2 transition-all ${step >= i ? 'opacity-100' : 'opacity-30'}`}>
                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs 
                                            ${step > i ? 'bg-emerald-500 text-white' : step === i ? 'bg-blue-500 text-white ring-4 ring-blue-500/20' : 'bg-slate-700 text-slate-500'}`}>
                                            {step > i ? <Icon name="check" size={14}/> : i + 1}
                                        </div>
                                        <span className="text-[10px] font-bold uppercase tracking-wider text-slate-400">{label}</span>
                                    </div>
                                ))}
                            </div>

                            {/* Action Buttons */}
                            <div className="grid grid-cols-2 gap-4">
                                {step === 0 && (
                                    <button onClick={handleAddSample} className="col-span-2 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-bold shadow-lg transition-all flex items-center justify-center gap-2">
                                        <Icon name="plus" /> Add {sample.name}
                                    </button>
                                )}
                                {step === 1 && (
                                    <button onClick={handleAddReagent} className="col-span-2 py-4 bg-purple-600 hover:bg-purple-500 text-white rounded-2xl font-bold shadow-lg transition-all flex items-center justify-center gap-2">
                                        <Icon name="flask-conical" /> Add {test.name} Reagent
                                    </button>
                                )}
                                {step === 2 && (
                                    <button onClick={handleProcess} className={`col-span-2 py-4 rounded-2xl font-bold shadow-lg transition-all flex items-center justify-center gap-2 
                                        ${test.needsHeat ? 'bg-orange-600 hover:bg-orange-500 text-white' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}`}>
                                        <Icon name={test.needsHeat ? "flame" : "vibrate"} /> 
                                        {test.needsHeat ? 'Heat in Water Bath' : 'Shake & Observe'}
                                    </button>
                                )}
                                {step === 3 && (
                                    <>
                                        <div className="col-span-2 bg-slate-800 border border-slate-700 p-4 rounded-2xl text-center animate-in fade-in slide-in-from-bottom-2">
                                            <div className="text-xs font-bold text-slate-500 uppercase mb-1">Observation</div>
                                            <div className="text-xl font-bold text-white">{getObservationText()}</div>
                                        </div>
                                        <button onClick={handleReset} className="col-span-2 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold transition-all flex items-center justify-center gap-2">
                                            <Icon name="rotate-ccw" size={18}/> New Test
                                        </button>
                                    </>
                                )}
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
