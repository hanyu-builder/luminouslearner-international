<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Parameter Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-indigo::-webkit-slider-thumb { background: #6366f1; }
        .thumb-rose::-webkit-slider-thumb { background: #f43f5e; }
        .thumb-emerald::-webkit-slider-thumb { background: #10b981; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 800;
    const CANVAS_HEIGHT = 350;
    const CENTER_Y = CANVAS_HEIGHT / 2;
    const PIXELS_PER_METER = 50; // Visual scale

    const App = () => {
        // --- State ---
        const [freq, setFreq] = useState(1.0); // Hz
        const [wavelength, setWavelength] = useState(4.0); // meters
        const [amplitude, setAmplitude] = useState(1.0); // meters
        const [isRunning, setIsRunning] = useState(true);

        // Calculated Physics
        const waveSpeed = freq * wavelength; // v = f * lambda

        const canvasRef = useRef(null);
        const requestRef = useRef();
        const timeRef = useRef(0);
        const lastTimeRef = useRef(0);

        // --- Logic ---
        const resetSim = () => {
            setFreq(1.0);
            setWavelength(4.0);
            setAmplitude(1.0);
            timeRef.current = 0;
            // Keep running state as is, or reset to true? Let's keep it running for smoothness
        };

        const toggleSim = () => {
            setIsRunning(!isRunning);
            if (!isRunning) {
                lastTimeRef.current = performance.now();
                requestRef.current = requestAnimationFrame(loop);
            } else {
                cancelAnimationFrame(requestRef.current);
            }
        };

        const loop = (timestamp) => {
            if (!isRunning) return;
            
            const dt = (timestamp - lastTimeRef.current) / 1000;
            lastTimeRef.current = timestamp;

            // Prevent huge jumps if tab was inactive
            const safeDt = Math.min(dt, 0.1);
            timeRef.current += safeDt;

            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Rendering ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            const t = timeRef.current;
            
            // Clear
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // 1. Grid & Axis
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 1;
            // Center Line
            ctx.beginPath();
            ctx.moveTo(0, CENTER_Y);
            ctx.lineTo(CANVAS_WIDTH, CENTER_Y);
            ctx.stroke();

            // 2. Draw Wave
            // y = A sin(kx - wt)
            // k = 2PI / lambda
            // w = 2PI * f
            
            const ampPx = amplitude * 50; // Scale up for visibility
            const lambdaPx = wavelength * PIXELS_PER_METER;
            const k = (2 * Math.PI) / lambdaPx;
            const w = 2 * Math.PI * freq;

            ctx.beginPath();
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#38bdf8'; // Sky Blue
            
            for (let x = 0; x < CANVAS_WIDTH; x+=2) {
                const y = CENTER_Y - ampPx * Math.sin(k * x - w * t);
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // 3. Draw Annotations (Amplitude)
            // Find first peak visible
            // sin(kx - wt) = 1 => kx - wt = PI/2 + 2nPI => kx = wt + PI/2 => x = (wt + PI/2)/k
            // We want x > 50 to show label nicely
            
            const phase = w * t;
            let peakX = ((phase + Math.PI/2) / k) % lambdaPx;
            if (peakX < 50) peakX += lambdaPx;
            
            const peakY = CENTER_Y - ampPx;

            // Amplitude Line
            ctx.beginPath();
            ctx.strokeStyle = '#f43f5e'; // Rose
            ctx.lineWidth = 2;
            ctx.moveTo(peakX, CENTER_Y);
            ctx.lineTo(peakX, peakY);
            ctx.stroke();
            
            // Amplitude Label
            ctx.fillStyle = '#f43f5e';
            ctx.font = 'bold 12px sans-serif';
            ctx.fillText(`A = ${amplitude}m`, peakX + 5, (CENTER_Y + peakY)/2);

            // 4. Draw Annotations (Wavelength)
            // Distance between peakX and peakX + lambda
            const nextPeakX = peakX + lambdaPx;
            if (nextPeakX < CANVAS_WIDTH - 20) {
                const guideY = peakY - 20;
                
                ctx.beginPath();
                ctx.strokeStyle = '#10b981'; // Emerald
                ctx.lineWidth = 2;
                // Horizontal line
                ctx.moveTo(peakX, guideY);
                ctx.lineTo(nextPeakX, guideY);
                // Vertical ticks
                ctx.moveTo(peakX, guideY - 5); ctx.lineTo(peakX, guideY + 5);
                ctx.moveTo(nextPeakX, guideY - 5); ctx.lineTo(nextPeakX, guideY + 5);
                ctx.stroke();

                // Label
                ctx.fillStyle = '#10b981';
                ctx.textAlign = 'center';
                ctx.fillText(`λ = ${wavelength}m`, (peakX + nextPeakX)/2, guideY - 8);
                ctx.textAlign = 'left'; // Reset
            }

        };

        // Init loop
        useEffect(() => {
            lastTimeRef.current = performance.now();
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [freq, wavelength, amplitude, isRunning]); // Re-bind if state changes that loop uses? No, loop uses refs/state. 
        // Actually loop closes over state if not careful.
        // But here we read state inside render (draw) is called by loop? No, draw is defined in render scope.
        // To be safe, we should update the draw function or use refs for physics vars.
        // Let's rely on React re-render updating the closure for `draw` but loop needs to be robust.
        // Simpler: Just force redraw on state change, loop handles time.
        
        // Better pattern for values inside loop:
        const paramsRef = useRef({ freq: 1, wavelength: 4, amplitude: 1 });
        useEffect(() => {
            paramsRef.current = { freq, wavelength, amplitude };
            draw(); // Immediate draw on change
        }, [freq, wavelength, amplitude]);

        // Init Icons
        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        return (
            <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-12">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                    <div className="flex items-center space-x-3">
                        <div className="bg-indigo-500/20 p-2 rounded-lg">
                            <i data-lucide="activity" className="w-6 h-6 text-indigo-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Wave Parameter Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Wave Properties
                    </div>
                </nav>

                <main className="max-w-5xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Simulation Canvas */}
                    <div className="lg:col-span-12">
                        <div className="bg-slate-800 rounded-2xl border border-slate-700 p-1 shadow-2xl relative overflow-hidden">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-auto bg-slate-950 rounded-xl"
                            />
                            
                            {/* Velocity Display */}
                            <div className="absolute top-4 right-4 bg-slate-900/90 px-5 py-3 rounded-xl border border-slate-700 shadow-lg text-right">
                                <div className="text-xs text-slate-400 font-bold uppercase mb-1">Wave Speed (v)</div>
                                <div className="text-3xl font-mono font-bold text-white">
                                    {waveSpeed.toFixed(1)} <span className="text-sm text-slate-500">m/s</span>
                                </div>
                                <div className="text-[10px] text-indigo-400 mt-1 font-mono">v = f × λ</div>
                            </div>
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="lg:col-span-8 space-y-6">
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 flex flex-col gap-6">
                            
                            {/* Frequency */}
                            <div>
                                <label className="flex justify-between text-sm font-bold text-indigo-300 mb-2">
                                    <span className="flex items-center gap-2"><i data-lucide="zap" className="w-4 h-4"></i> Frequency (f)</span>
                                    <span className="text-white bg-slate-700 px-2 py-0.5 rounded">{freq.toFixed(1)} Hz</span>
                                </label>
                                <input 
                                    type="range" min="0.1" max="5.0" step="0.1" 
                                    value={freq} 
                                    onChange={(e) => setFreq(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb thumb-indigo" 
                                />
                            </div>

                            {/* Wavelength */}
                            <div>
                                <label className="flex justify-between text-sm font-bold text-emerald-300 mb-2">
                                    <span className="flex items-center gap-2"><i data-lucide="ruler" className="w-4 h-4"></i> Wavelength (λ)</span>
                                    <span className="text-white bg-slate-700 px-2 py-0.5 rounded">{wavelength.toFixed(1)} m</span>
                                </label>
                                <input 
                                    type="range" min="1.0" max="10.0" step="0.5" 
                                    value={wavelength} 
                                    onChange={(e) => setWavelength(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb thumb-emerald" 
                                />
                            </div>

                            {/* Amplitude */}
                            <div>
                                <label className="flex justify-between text-sm font-bold text-rose-300 mb-2">
                                    <span className="flex items-center gap-2"><i data-lucide="bar-chart-2" className="w-4 h-4"></i> Amplitude (A)</span>
                                    <span className="text-white bg-slate-700 px-2 py-0.5 rounded">{amplitude.toFixed(1)} m</span>
                                </label>
                                <input 
                                    type="range" min="0.1" max="2.0" step="0.1" 
                                    value={amplitude} 
                                    onChange={(e) => setAmplitude(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb thumb-rose" 
                                />
                            </div>

                        </div>
                    </div>

                    {/* Action Buttons */}
                    <div className="lg:col-span-4 flex flex-col justify-center gap-4">
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 h-full flex flex-col justify-center gap-4">
                            <button 
                                onClick={toggleSim}
                                className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all shadow-lg ${isRunning ? 'bg-slate-700 text-slate-300 border border-slate-600' : 'bg-indigo-600 hover:bg-indigo-500 text-white'}`}
                            >
                                <i data-lucide={isRunning ? "pause" : "play"} className="w-5 h-5"></i>
                                {isRunning ? "Pause Wave" : "Start Wave"}
                            </button>
                            
                            <button 
                                onClick={resetSim}
                                className="w-full py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold text-lg transition-colors flex items-center justify-center gap-2"
                            >
                                <i data-lucide="rotate-ccw" className="w-5 h-5"></i>
                                Reset
                            </button>
                        </div>
                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
