<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maxwell-Boltzmann Distribution Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts (Stable Version) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-orange::-webkit-slider-thumb { background: #f97316; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;
    const { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer, ReferenceLine, ReferenceArea } = Recharts;

    const CANVAS_WIDTH = 800;
    const CANVAS_HEIGHT = 550;
    
    // Physics Constants
    const R = 8.314; // Gas Constant
    const MOLAR_MASS = 0.028; // kg/mol (Nitrogen N2 approx)

    const App = () => {
        // --- State ---
        const [temperature, setTemperature] = useState(300); // Kelvin
        const [showRMS, setShowRMS] = useState(true);
        const [showActivation, setShowActivation] = useState(false);
        const [activationEnergy, setActivationEnergy] = useState(1000); // m/s threshold

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Particle System
        const particlesRef = useRef([]);

        // Derived Values
        // v_mp (Most Probable) = sqrt(2RT/M)
        const v_mp = Math.sqrt((2 * R * temperature) / MOLAR_MASS);
        // v_avg (Average) = sqrt(8RT/piM)
        const v_avg = Math.sqrt((8 * R * temperature) / (Math.PI * MOLAR_MASS));
        // v_rms (Root Mean Square) = sqrt(3RT/M)
        const v_rms = Math.sqrt((3 * R * temperature) / MOLAR_MASS);

        // --- Physics Engine (Particle Box) ---
        const initParticles = () => {
            const ps = [];
            for(let i=0; i<150; i++) {
                ps.push({
                    x: Math.random() * CANVAS_WIDTH,
                    y: Math.random() * CANVAS_HEIGHT,
                    vx: (Math.random() - 0.5) * 500, // Initial random
                    vy: (Math.random() - 0.5) * 500,
                    radius: 3
                });
            }
            particlesRef.current = ps;
        };

        const updateParticles = () => {
            const dt = 0.016;
            // Target speed factor based on temperature
            // Scale visual speed: sqrt(T)
            const speedScale = Math.sqrt(temperature) / 20; 

            particlesRef.current.forEach(p => {
                // Move
                // Re-normalize velocity to match temperature "roughly" for visual stability
                // In real simulation, collisions redistribute energy. Here we cheat slightly for visual flow.
                const currentSpeed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
                if (currentSpeed === 0) p.vx = 10;
                
                // Drift towards target speed distribution? 
                // Simplification: Just scale their existing random vector to match the Temp Scale
                // This keeps them moving faster at higher T
                const nx = p.vx / currentSpeed;
                const ny = p.vy / currentSpeed;
                
                // Apply motion
                p.x += nx * speedScale * 60 * dt;
                p.y += ny * speedScale * 60 * dt;

                // Bounce
                if (p.x < 0 || p.x > CANVAS_WIDTH) {
                    p.vx *= -1; // Reflect logic handled by normalized vector next frame? 
                    // Actually need to flip the vector stored
                    p.x = Math.max(0, Math.min(CANVAS_WIDTH, p.x));
                    // Simple hack: regenerate random direction in opposite hemisphere
                    p.vx *= -1; 
                }
                if (p.y < 0 || p.y > CANVAS_HEIGHT) {
                    p.vy *= -1;
                    p.y = Math.max(0, Math.min(CANVAS_HEIGHT, p.y));
                }
            });
        };

        const loop = () => {
            updateParticles();
            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Drawing ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw Box Border
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw Particles
            particlesRef.current.forEach(p => {
                // Color based on speed?
                // Scale visual speed again
                // Let's use a simple gradient from Blue (Slow) to Red (Fast)
                // Base speed at 300K is approx factor 1. 1000K is factor 1.8.
                // Speed scale used above: speedScale.
                // Range approx 0.5 to 2.0
                
                // Visualize: Blue < 300K, Red > 800K
                // Let's use Temperature directly for global tint, but individual variance is nice
                // For this simple sim, global tint based on T is clearer.
                
                const tRatio = (temperature - 100) / 900; // 0 to 1
                const r = Math.min(255, Math.floor(tRatio * 255));
                const b = Math.min(255, Math.floor((1-tRatio) * 255));
                
                ctx.fillStyle = `rgb(${r}, 100, ${b})`;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
                ctx.fill();
            });
            
            // Temperature Label in Canvas
            ctx.font = 'bold 40px sans-serif';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.textAlign = 'center';
            ctx.fillText(`${temperature} K`, CANVAS_WIDTH/2, CANVAS_HEIGHT/2);
        };

        useEffect(() => {
            initParticles();
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [temperature]); // Re-init not needed, but update loop uses temp state

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        // Graph Data Generator (Maxwell-Boltzmann Formula)
        // f(v) = 4*pi * (M/(2*pi*R*T))^(3/2) * v^2 * exp(-M*v^2 / (2*R*T))
        const graphData = useMemo(() => {
            const data = [];
            const step = 20;
            const maxV = 2000; // Plot up to 2000 m/s
            
            const a = Math.pow(MOLAR_MASS / (2 * Math.PI * R * temperature), 1.5) * 4 * Math.PI;
            const b = -MOLAR_MASS / (2 * R * temperature);

            for (let v = 0; v <= maxV; v += step) {
                const prob = a * v * v * Math.exp(b * v * v);
                // Scale prob for chart visibility (it's very small numbers)
                data.push({ v: v, p: prob * 1000 }); 
            }
            return data;
        }, [temperature]);

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-orange-500/20 p-1.5 rounded-lg">
                            <i data-lucide="flame" className="w-5 h-5 text-orange-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Maxwell-Boltzmann Distribution</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Heat & Gases
                    </div>
                </nav>

                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas (Particle Box) */}
                        <div className="lg:col-span-1 bg-slate-950 relative border-r border-slate-700 hidden lg:block">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-cover opacity-80"
                            />
                            <div className="absolute bottom-4 left-4 right-4 bg-slate-900/80 p-3 rounded-xl border border-slate-700 text-xs text-slate-400">
                                <p className="mb-1"><strong>Kinetic Theory:</strong></p>
                                <p>Higher Temperature = Faster Random Motion</p>
                            </div>
                        </div>

                        {/* CENTER/RIGHT: Graph & Controls */}
                        <div className="lg:col-span-3 bg-slate-900 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            {/* 1. Main Graph */}
                            <div className="flex-1 min-h-[300px] relative p-4">
                                <ResponsiveContainer width="100%" height="100%">
                                    <AreaChart data={graphData} margin={{ top: 20, right: 30, left: 0, bottom: 20 }}>
                                        <defs>
                                            <linearGradient id="colorP" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#f97316" stopOpacity={0.8}/>
                                                <stop offset="95%" stopColor="#f97316" stopOpacity={0}/>
                                            </linearGradient>
                                        </defs>
                                        <XAxis dataKey="v" type="number" tick={{fontSize: 10, fill: '#94a3b8'}} label={{ value: 'Speed (m/s)', position: 'bottom', offset: 0, fill: '#94a3b8', fontSize: 12 }} />
                                        <YAxis tick={{fontSize: 10, fill: '#94a3b8'}} label={{ value: 'Probability', angle: -90, position: 'insideLeft', fill: '#94a3b8', fontSize: 12 }} />
                                        <Tooltip 
                                            contentStyle={{backgroundColor: '#1e293b', border: '1px solid #475569', fontSize: '12px'}}
                                            labelFormatter={(v) => `${v} m/s`}
                                        />
                                        <Area type="monotone" dataKey="p" stroke="#f97316" fillOpacity={1} fill="url(#colorP)" />
                                        
                                        {/* Speed Markers */}
                                        {showRMS && (
                                            <>
                                                <ReferenceLine x={v_mp} stroke="#3b82f6" strokeDasharray="3 3">
                                                    <Label value="Vmp" position="top" fill="#3b82f6" fontSize={10} />
                                                </ReferenceLine>
                                                <ReferenceLine x={v_avg} stroke="#22c55e" strokeDasharray="3 3">
                                                    <Label value="Vavg" position="top" fill="#22c55e" fontSize={10} />
                                                </ReferenceLine>
                                                <ReferenceLine x={v_rms} stroke="#ef4444" strokeDasharray="3 3">
                                                    <Label value="Vrms" position="top" fill="#ef4444" fontSize={10} />
                                                </ReferenceLine>
                                            </>
                                        )}

                                        {/* Activation Energy Shade */}
                                        {showActivation && (
                                            <ReferenceArea x1={activationEnergy} x2={2000} fill="#f43f5e" fillOpacity={0.3} />
                                        )}
                                    </AreaChart>
                                </ResponsiveContainer>
                                
                                {showActivation && (
                                    <div className="absolute top-10 right-10 text-rose-400 text-xs font-bold text-right">
                                        Particles with E &gt; Ea
                                        <br/>
                                        (Reacting Molecules)
                                    </div>
                                )}
                            </div>

                            {/* 2. Controls & Stats */}
                            <div className="bg-slate-800 border-t border-slate-700 p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                                
                                {/* Temperature Control */}
                                <div className="space-y-4">
                                    <label className="flex justify-between text-sm font-bold text-orange-400">
                                        Temperature (T)
                                        <span>{temperature} K</span>
                                    </label>
                                    <input 
                                        type="range" min="100" max="1000" step="10" 
                                        value={temperature} onChange={(e) => setTemperature(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg slider-thumb thumb-orange" 
                                    />
                                    <div className="flex justify-between text-xs text-slate-500">
                                        <span>100K (Cold)</span>
                                        <span>1000K (Hot)</span>
                                    </div>

                                    {/* Calculated Values */}
                                    <div className="grid grid-cols-3 gap-2 mt-4">
                                        <div className="bg-slate-900 p-2 rounded border border-slate-700 text-center">
                                            <div className="text-[10px] text-blue-400 mb-1">Most Probable</div>
                                            <div className="font-mono text-sm text-white">{v_mp.toFixed(0)}</div>
                                        </div>
                                        <div className="bg-slate-900 p-2 rounded border border-slate-700 text-center">
                                            <div className="text-[10px] text-green-400 mb-1">Average</div>
                                            <div className="font-mono text-sm text-white">{v_avg.toFixed(0)}</div>
                                        </div>
                                        <div className="bg-slate-900 p-2 rounded border border-slate-700 text-center">
                                            <div className="text-[10px] text-red-400 mb-1">RMS Speed</div>
                                            <div className="font-mono text-sm text-white">{v_rms.toFixed(0)}</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Options & Activation Energy */}
                                <div className="space-y-4">
                                    <div className="flex gap-4">
                                        <label className="flex items-center gap-2 text-xs text-slate-300 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                checked={showRMS} 
                                                onChange={() => setShowRMS(!showRMS)}
                                                className="w-4 h-4 rounded text-orange-500 bg-slate-900 border-slate-600 focus:ring-0"
                                            />
                                            Show Speed Markers (Vmp, Vavg, Vrms)
                                        </label>
                                        <label className="flex items-center gap-2 text-xs text-slate-300 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                checked={showActivation} 
                                                onChange={() => setShowActivation(!showActivation)}
                                                className="w-4 h-4 rounded text-rose-500 bg-slate-900 border-slate-600 focus:ring-0"
                                            />
                                            Show Activation Energy (Ea)
                                        </label>
                                    </div>

                                    {showActivation && (
                                        <div className="animate-in fade-in slide-in-from-top-2">
                                            <label className="flex justify-between text-xs font-bold text-rose-300 mb-2">
                                                Activation Threshold
                                                <span>{activationEnergy} m/s</span>
                                            </label>
                                            <input 
                                                type="range" min="500" max="1500" step="50" 
                                                value={activationEnergy} onChange={(e) => setActivationEnergy(Number(e.target.value))}
                                                className="w-full h-2 bg-slate-700 rounded-lg slider-thumb bg-rose-500" 
                                            />
                                            <p className="text-[10px] text-slate-400 mt-2 leading-tight">
                                                Only molecules to the right of the red zone (faster than {activationEnergy} m/s) have enough energy to react. Note how increasing T drastically increases this area!
                                            </p>
                                        </div>
                                    )}
                                </div>

                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
