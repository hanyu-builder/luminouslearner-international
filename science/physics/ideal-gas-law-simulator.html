<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ideal Gas Simulator | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; background: #ffffff; cursor: pointer; border: 2px solid #3b82f6;
        }
        .slider-thumb-red::-webkit-slider-thumb { border-color: #ef4444; }
        .slider-thumb-green::-webkit-slider-thumb { border-color: #10b981; }
        .slider-thumb-blue::-webkit-slider-thumb { border-color: #3b82f6; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 400;
    const CANVAS_HEIGHT = 400;
    const CONTAINER_WIDTH = 250;
    const CONTAINER_BOTTOM = 350;
    const R_CONSTANT = 8.314; // J/(mol·K)

    const App = () => {
        // Independent Variables
        const [moles, setMoles] = useState(1.0); // mol (n)
        const [temp, setTemp] = useState(300);   // Kelvin (T)
        const [volume, setVolume] = useState(5.0); // Liters (V) - mapped to height

        // Dependent Variable
        const [pressure, setPressure] = useState(0); // kPa (P)

        const [particles, setParticles] = useState([]);
        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Physics Calculation: P = (nRT) / V
        useEffect(() => {
            // P in kPa, V in L, n in mol, T in K
            // Ideally P (kPa) * V (L) = n * R * T
            // Note: R=8.314 J/molK corresponds to Pa*m^3. 
            // 1 kPa * 1 L = 1000 Pa * 0.001 m^3 = 1 Pa*m^3 = 1 Joule.
            // So we can use standard units directly!
            
            const p = (moles * R_CONSTANT * temp) / volume;
            setPressure(p);
        }, [moles, temp, volume]);

        // Particle System Init & Update
        useEffect(() => {
            // Update particle count based on Moles
            // Let's say 1 mol = 50 particles
            const targetCount = Math.floor(moles * 50);
            
            setParticles(prev => {
                const current = [...prev];
                if (current.length < targetCount) {
                    // Add
                    const needed = targetCount - current.length;
                    for(let i=0; i<needed; i++) {
                        current.push({
                            x: CONTAINER_WIDTH/2,
                            y: CONTAINER_BOTTOM - 20,
                            vx: (Math.random() - 0.5) * 2,
                            vy: (Math.random() - 0.5) * 2
                        });
                    }
                } else if (current.length > targetCount) {
                    // Remove
                    current.splice(targetCount);
                }
                return current;
            });
        }, [moles]);

        // Animation Loop
        const updatePhysics = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Map Volume to Cylinder Height
            // 10L = 300px, 1L = 30px
            const cylinderHeight = volume * 30; 
            const pistonY = CONTAINER_BOTTOM - cylinderHeight;

            // Clear
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            
            const centerX = CANVAS_WIDTH / 2;
            const leftX = centerX - CONTAINER_WIDTH / 2;

            // Draw Container
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 4;
            ctx.fillStyle = 'rgba(255,255,255,0.05)';
            ctx.fillRect(leftX, pistonY, CONTAINER_WIDTH, cylinderHeight);
            ctx.beginPath();
            ctx.moveTo(leftX, 50); // Top of walls guide
            ctx.lineTo(leftX, CONTAINER_BOTTOM);
            ctx.lineTo(leftX + CONTAINER_WIDTH, CONTAINER_BOTTOM);
            ctx.lineTo(leftX + CONTAINER_WIDTH, 50);
            ctx.stroke();

            // Draw Piston
            ctx.fillStyle = '#475569';
            ctx.fillRect(leftX + 2, pistonY - 10, CONTAINER_WIDTH - 4, 10);
            // Piston Rod
            ctx.fillStyle = '#94a3b8';
            ctx.fillRect(centerX - 5, pistonY - 100, 10, 90);
            ctx.fillStyle = '#64748b';
            ctx.fillRect(centerX - 40, pistonY - 100, 80, 10);

            // Draw Heat Source
            if (temp > 300) {
                const intensity = (temp - 300) / 200;
                ctx.fillStyle = `rgba(239, 68, 68, ${intensity})`;
                ctx.beginPath();
                ctx.moveTo(centerX - 20, CONTAINER_BOTTOM + 5);
                ctx.lineTo(centerX, CONTAINER_BOTTOM - 15);
                ctx.lineTo(centerX + 20, CONTAINER_BOTTOM + 5);
                ctx.fill();
            } else if (temp < 300) {
                const intensity = (300 - temp) / 200;
                ctx.fillStyle = `rgba(59, 130, 246, ${intensity})`;
                ctx.fillRect(leftX, CONTAINER_BOTTOM + 2, CONTAINER_WIDTH, 10);
            }

            // Particle Physics
            // Speed factor V ~ sqrt(T)
            const speedFactor = Math.sqrt(temp) / 10;

            ctx.fillStyle = temp > 400 ? '#fca5a5' : temp < 200 ? '#93c5fd' : '#e2e8f0';

            particles.forEach(p => {
                p.x += p.vx * speedFactor;
                p.y += p.vy * speedFactor;

                // Walls
                if (p.x < leftX + 5) { p.x = leftX + 5; p.vx *= -1; }
                if (p.x > leftX + CONTAINER_WIDTH - 5) { p.x = leftX + CONTAINER_WIDTH - 5; p.vx *= -1; }

                // Floor
                if (p.y > CONTAINER_BOTTOM - 5) { p.y = CONTAINER_BOTTOM - 5; p.vy *= -1; }
                
                // Piston
                if (p.y < pistonY + 5) { 
                    p.y = pistonY + 5; 
                    p.vy *= -1; 
                }

                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            requestRef.current = requestAnimationFrame(updatePhysics);
        };

        useEffect(() => {
            requestRef.current = requestAnimationFrame(updatePhysics);
            return () => cancelAnimationFrame(requestRef.current);
        }, [temp, volume, particles]);

        return (
            <div className="min-h-screen bg-slate-900 pb-12 font-sans text-slate-200">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                        <div className="bg-indigo-500/20 p-2 rounded-lg">
                            <i data-lucide="atom" className="w-6 h-6 text-indigo-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Ideal Gas Simulator</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Thermodynamics
                    </div>
                </nav>

                <main className="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Left: Simulation & Visuals */}
                    <div className="lg:col-span-5 flex flex-col gap-6">
                        <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl relative">
                            <div className="absolute top-4 left-4 bg-slate-900/80 px-3 py-1 rounded border border-slate-600 text-xs text-slate-400">
                                Chamber
                            </div>
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-auto"
                            />
                            
                            {/* Pressure Gauge Overlay */}
                            <div className="absolute top-6 right-6 bg-slate-900 p-3 rounded-xl border border-slate-600 shadow-lg w-32 text-center">
                                <div className="text-[10px] text-slate-400 uppercase tracking-widest mb-1">Pressure</div>
                                <div className="text-2xl font-bold text-white font-mono">{pressure.toFixed(0)}</div>
                                <div className="text-xs text-indigo-400">kPa</div>
                                {/* Bar */}
                                <div className="w-full h-1.5 bg-slate-700 rounded-full mt-2 overflow-hidden">
                                    <div 
                                        className="h-full bg-indigo-500 transition-all duration-300" 
                                        style={{width: `${Math.min(100, pressure/10)}%`}}
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Right: Controls & Equation */}
                    <div className="lg:col-span-7 space-y-6">
                        
                        {/* The Equation Dashboard */}
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <h2 className="text-white font-bold mb-6 flex items-center">
                                <i data-lucide="calculator" className="w-5 h-5 mr-2 text-indigo-400"></i>
                                Equation Verification
                            </h2>
                            
                            <div className="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-8 font-mono text-lg md:text-2xl bg-slate-900 p-6 rounded-xl border border-slate-800">
                                <div className="flex items-center gap-2">
                                    <span className="text-indigo-400 font-bold">{pressure.toFixed(0)}</span>
                                    <span className="text-slate-500 text-sm">P</span>
                                    <span className="text-slate-600">×</span>
                                    <span className="text-blue-400 font-bold">{volume.toFixed(1)}</span>
                                    <span className="text-slate-500 text-sm">V</span>
                                </div>
                                
                                <div className="text-white font-bold">=</div>
                                
                                <div className="flex items-center gap-2">
                                    <span className="text-green-400 font-bold">{moles.toFixed(1)}</span>
                                    <span className="text-slate-500 text-sm">n</span>
                                    <span className="text-slate-600">×</span>
                                    <span className="text-slate-400">8.31</span>
                                    <span className="text-slate-500 text-sm">R</span>
                                    <span className="text-slate-600">×</span>
                                    <span className="text-red-400 font-bold">{temp.toFixed(0)}</span>
                                    <span className="text-slate-500 text-sm">T</span>
                                </div>
                            </div>

                            <div className="flex justify-between mt-4 px-4 text-sm font-mono">
                                <div className="text-indigo-300">PV = {(pressure * volume).toFixed(0)} J</div>
                                <div className="text-green-300">nRT = {(moles * R_CONSTANT * temp).toFixed(0)} J</div>
                            </div>
                        </div>

                        {/* Controls Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            
                            {/* Moles Control */}
                            <div className="bg-slate-800 p-5 rounded-xl border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <label className="text-slate-300 font-bold text-sm">Moles (n)</label>
                                    <span className="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-mono">{moles} mol</span>
                                </div>
                                <input 
                                    type="range" min="0.1" max="2.0" step="0.1"
                                    value={moles}
                                    onChange={(e) => setMoles(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb slider-thumb-green"
                                />
                                <div className="text-xs text-slate-500 mt-2">Adjust Particle Count</div>
                            </div>

                            {/* Temp Control */}
                            <div className="bg-slate-800 p-5 rounded-xl border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <label className="text-slate-300 font-bold text-sm">Temp (T)</label>
                                    <span className="bg-red-500/20 text-red-400 px-2 py-1 rounded text-xs font-mono">{temp} K</span>
                                </div>
                                <input 
                                    type="range" min="100" max="500" step="10"
                                    value={temp}
                                    onChange={(e) => setTemp(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb slider-thumb-red"
                                />
                                <div className="text-xs text-slate-500 mt-2">Adjust Kinetic Energy</div>
                            </div>

                            {/* Volume Control */}
                            <div className="bg-slate-800 p-5 rounded-xl border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <label className="text-slate-300 font-bold text-sm">Volume (V)</label>
                                    <span className="bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs font-mono">{volume} L</span>
                                </div>
                                <input 
                                    type="range" min="1.0" max="10.0" step="0.1"
                                    value={volume}
                                    onChange={(e) => setVolume(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb slider-thumb-blue"
                                />
                                <div className="text-xs text-slate-500 mt-2">Adjust Piston Height</div>
                            </div>

                        </div>

                        {/* Info / Legend */}
                        <div className="bg-blue-900/10 border border-blue-500/20 p-4 rounded-xl text-sm text-blue-200 flex gap-4 items-start">
                            <i data-lucide="info" className="w-5 h-5 shrink-0 mt-0.5"></i>
                            <div>
                                <p className="font-bold mb-1">How to use:</p>
                                <p className="text-slate-400 text-xs leading-relaxed">
                                    Change any independent variable (n, T, or V). The simulator automatically calculates the resulting Pressure (P) to satisfy the Ideal Gas Law. Watch the Equation Verification box to see the math in real-time!
                                </p>
                            </div>
                        </div>

                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    if (typeof lucide !== 'undefined') {
        setTimeout(() => lucide.createIcons(), 100);
    }
</script>
</body>
</html>
