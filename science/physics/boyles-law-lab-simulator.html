<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boyle's Law Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; background: #a855f7; cursor: pointer; border: 2px solid #ffffff;
        }
        /* Custom gauge needle animation */
        .needle { transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: bottom center; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    const CANVAS_WIDTH = 300;
    const CANVAS_HEIGHT = 400;
    const SYRINGE_WIDTH = 180;
    const SYRINGE_BOTTOM = 350;
    const PARTICLE_COUNT = 40;
    const CONSTANT_K = 2000; // P * V = 2000

    const App = () => {
        // State
        const [volume, setVolume] = useState(50); // mL (20 to 100)
        const [pressure, setPressure] = useState(40); // kPa (Calculated)
        const [particles, setParticles] = useState([]);
        
        const canvasRef = useRef(null);
        const graphCanvasRef = useRef(null);
        const requestRef = useRef();

        // Calculate Pressure whenever Volume changes
        useEffect(() => {
            // P = k / V
            const newP = CONSTANT_K / volume;
            setPressure(newP);
        }, [volume]);

        // Initialize Particles
        useEffect(() => {
            const ps = [];
            for(let i=0; i<PARTICLE_COUNT; i++) {
                ps.push({
                    x: Math.random() * (SYRINGE_WIDTH - 20),
                    y: Math.random() * 200, // Initial random Y
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4
                });
            }
            setParticles(ps);
        }, []);

        // --- Physics Loop ---
        const updatePhysics = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Calculate current syringe height based on volume
            // Map Volume 20-100 to Height in pixels
            // Let's say 100mL = 300px height, 20mL = 60px height
            const syringeHeight = (volume / 100) * 300;
            const pistonY = SYRINGE_BOTTOM - syringeHeight;

            // 1. Clear & Draw Syringe
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            
            const centerX = CANVAS_WIDTH / 2;
            const leftX = centerX - SYRINGE_WIDTH / 2;

            // Draw Cylinder Body (Glass)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 4;
            ctx.fillRect(leftX, pistonY, SYRINGE_WIDTH, syringeHeight); // Gas area
            ctx.strokeRect(leftX, 50, SYRINGE_WIDTH, 300); // Full tube outline (Top 50 to 350)
            
            // Draw Measurement Ticks
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 2;
            ctx.font = '10px Inter';
            ctx.fillStyle = '#94a3b8';
            ctx.textAlign = 'right';
            for(let v = 20; v <= 100; v+=10) {
                const h = (v / 100) * 300;
                const y = SYRINGE_BOTTOM - h;
                ctx.beginPath();
                ctx.moveTo(leftX, y);
                ctx.lineTo(leftX + 15, y);
                ctx.stroke();
                ctx.fillText(`${v}mL`, leftX - 5, y + 3);
            }

            // Draw Piston (Plunger)
            ctx.fillStyle = '#334155'; // Dark grey rubber
            ctx.fillRect(leftX + 2, pistonY - 20, SYRINGE_WIDTH - 4, 20); // Rubber head
            ctx.fillStyle = '#94a3b8'; // Metal rod
            ctx.fillRect(centerX - 10, pistonY - 300, 20, 280); // Rod going up
            ctx.fillStyle = '#cbd5e1'; // Handle
            ctx.fillRect(centerX - 40, pistonY - 300, 80, 10); // Top handle

            // 2. Particle Physics
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;

                // Walls (Left/Right)
                if (p.x < 0) { p.x = 0; p.vx *= -1; }
                if (p.x > SYRINGE_WIDTH - 20) { p.x = SYRINGE_WIDTH - 20; p.vx *= -1; }

                // Floor (Bottom)
                // Coordinates are relative to the syringe box internal area for drawing
                // Let's keep particle coordinates relative to (0,0) of the syringe area width
                // But Y needs to be checked against pistonY
            });

            // Draw Particles (shifted to canvas position)
            ctx.fillStyle = '#a855f7'; // Purple-500
            particles.forEach(p => {
                // Bounds check within the dynamic container
                // p.y is relative to the bottom of the container (0 = bottom)
                // Let's rework: p.y is height from bottom (0 to syringeHeight)
                
                // Update movement relative to height
                // If we compress, particles shouldn't just be clipped, they should bounce faster? 
                // For simplified Boyle's law visual, we just confine them.
                
                // Let's use absolute canvas coordinates for simulation simplicity
                // Constrain X
                if (p.x < leftX + 5) { p.x = leftX + 5; p.vx *= -1; }
                if (p.x > leftX + SYRINGE_WIDTH - 10) { p.x = leftX + SYRINGE_WIDTH - 10; p.vx *= -1; }
                
                // Constrain Y (Bottom fixed at SYRINGE_BOTTOM)
                if (p.y > SYRINGE_BOTTOM - 5) { p.y = SYRINGE_BOTTOM - 5; p.vy *= -1; }
                // Constrain Y (Top moves with Piston)
                if (p.y < pistonY + 5) { 
                    p.y = pistonY + 5; 
                    p.vy *= -1; 
                    // Add "Pressure" visual effect? (Particles turning white on impact?)
                }

                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            requestRef.current = requestAnimationFrame(updatePhysics);
        };

        // Graph Drawing Loop
        useEffect(() => {
            const ctx = graphCanvasRef.current?.getContext('2d');
            if (!ctx) return;
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;
            const padding = 40;

            // Clear
            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(0, 0, w, h);

            // Axes
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, 10);
            ctx.lineTo(padding, h - padding);
            ctx.lineTo(w - 10, h - padding);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#94a3b8';
            ctx.font = '10px Inter';
            ctx.fillText("Volume (mL) →", w - 80, h - 10);
            ctx.save();
            ctx.translate(15, h/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText("Pressure (kPa)", 0, 0);
            ctx.restore();

            // Draw Theoretical Curve (P = k/V)
            // Map V (20-100) to X, P (20-100) to Y
            const mapX = (v) => padding + ((v - 0) / 110) * (w - padding);
            const mapY = (p) => h - padding - ((p - 0) / 110) * (h - padding);

            ctx.beginPath();
            ctx.strokeStyle = '#475569';
            ctx.setLineDash([5, 5]);
            for(let v = 15; v <= 110; v+=2) {
                const p = CONSTANT_K / v;
                if (p > 110) continue;
                const x = mapX(v);
                const y = mapY(p);
                if (v === 15 || p > 109) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw Current Point
            const cx = mapX(volume);
            const cy = mapY(pressure);
            
            // Guide lines
            ctx.strokeStyle = '#a855f7';
            ctx.lineWidth = 1;
            ctx.globalAlpha = 0.5;
            ctx.beginPath();
            ctx.moveTo(padding, cy);
            ctx.lineTo(cx, cy);
            ctx.lineTo(cx, h - padding);
            ctx.stroke();
            ctx.globalAlpha = 1;

            // Dot
            ctx.fillStyle = '#a855f7';
            ctx.beginPath();
            ctx.arc(cx, cy, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(cx, cy, 2, 0, Math.PI * 2);
            ctx.fill();

        }, [volume, pressure]);

        useEffect(() => {
            requestRef.current = requestAnimationFrame(updatePhysics);
            return () => cancelAnimationFrame(requestRef.current);
        }, [volume]);

        return (
            <div className="min-h-screen bg-slate-900 pb-12 font-sans text-slate-200">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                        <div className="bg-purple-500/20 p-2 rounded-lg">
                            <i data-lucide="flask-conical" className="w-6 h-6 text-purple-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Boyle's Law Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Gas Laws
                    </div>
                </nav>

                <main className="max-w-6xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
                    
                    {/* Left: Syringe Visual */}
                    <div className="lg:col-span-5 flex flex-col gap-6">
                        <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl flex flex-col items-center">
                            <h2 className="text-purple-400 font-bold mb-4 w-full flex items-center">
                                <i data-lucide="microscope" className="w-5 h-5 mr-2"></i> Experiment Setup
                            </h2>
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-auto cursor-ns-resize"
                                title="Visual Representation"
                            />
                            <div className="text-xs text-slate-500 mt-2">
                                * Particles represent gas molecules. Temperature is constant.
                            </div>
                        </div>
                    </div>

                    {/* Right: Controls & Graph */}
                    <div className="lg:col-span-7 space-y-6">
                        
                        {/* Data Dashboard */}
                        <div className="grid grid-cols-3 gap-4">
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center">
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Volume (V)</div>
                                <div className="text-3xl font-bold text-white font-mono">{volume}<span className="text-sm ml-1 text-slate-500">mL</span></div>
                            </div>
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center">
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Pressure (P)</div>
                                <div className="text-3xl font-bold text-purple-400 font-mono">{pressure.toFixed(1)}<span className="text-sm ml-1 text-slate-500">kPa</span></div>
                            </div>
                            <div className="bg-purple-900/20 p-4 rounded-xl border border-purple-500/30 text-center">
                                <div className="text-purple-300 text-xs uppercase tracking-wider mb-1">Constant (k)</div>
                                <div className="text-3xl font-bold text-white font-mono">{(pressure * volume).toFixed(0)}</div>
                                <div className="text-[10px] text-purple-400 mt-1">P × V = constant</div>
                            </div>
                        </div>

                        {/* Control Slider */}
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <label className="flex justify-between text-sm mb-4 text-slate-300 font-bold">
                                <span>Adjust Piston (Volume)</span>
                                <span>{volume} mL</span>
                            </label>
                            <input 
                                type="range" min="20" max="100" step="1"
                                value={volume}
                                onChange={(e) => setVolume(Number(e.target.value))}
                                className="w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb"
                            />
                            <div className="flex justify-between text-xs text-slate-500 mt-2">
                                <span>Compressed</span>
                                <span>Expanded</span>
                            </div>
                        </div>

                        {/* P-V Graph */}
                        <div className="bg-slate-800 p-1 rounded-2xl border border-slate-700 shadow-xl relative">
                            <div className="absolute top-4 right-4 text-xs text-slate-500 font-mono pointer-events-none">
                                Isothermal Process (T = const)
                            </div>
                            <canvas 
                                ref={graphCanvasRef} 
                                width={600} 
                                height={350}
                                className="w-full h-full block rounded-xl"
                            />
                        </div>

                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    if (typeof lucide !== 'undefined') {
        setTimeout(() => lucide.createIcons(), 100);
    }
</script>
</body>
</html>
