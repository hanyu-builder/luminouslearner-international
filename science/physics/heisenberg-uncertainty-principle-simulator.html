<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Uncertainty Sim | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-purple::-webkit-slider-thumb { background: #a855f7; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;
    const { ScatterChart, Scatter, XAxis, YAxis, Tooltip, ResponsiveContainer, ReferenceLine, ReferenceDot } = Recharts;

    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 550;
    const CENTER_X = CANVAS_WIDTH / 2;
    const CENTER_Y = CANVAS_HEIGHT / 2;

    const App = () => {
        // --- State ---
        const [boxWidth, setBoxWidth] = useState(200); // Delta x (pixels)
        const [showMomentum, setShowMomentum] = useState(true);
        const [isPaused, setIsPaused] = useState(false);

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Physics Calculation
        // Uncertainty Principle: dx * dp >= h_bar / 2
        // Let's use visual units.
        // If boxWidth (dx) is small, momentumSpread (dp) is large.
        // Constant K = dx * dp
        const K = 10000; 
        const momentumSpread = K / Math.max(10, boxWidth);

        // --- Animation State ---
        const animRef = useRef({
            time: 0,
            particles: [] // Visualizing probability cloud
        });

        // Initialize particles
        useEffect(() => {
            const ps = [];
            for(let i=0; i<300; i++) {
                ps.push({
                    x: (Math.random() - 0.5) * boxWidth,
                    y: (Math.random() - 0.5) * 200, // Just visual vertical spread
                    phase: Math.random() * Math.PI * 2
                });
            }
            animRef.current.particles = ps;
        }, []); // Run once

        // --- Loop ---
        const loop = () => {
            if (!isPaused) {
                animRef.current.time += 0.05;
                
                // Update particles
                // Their motion speed should relate to momentumSpread
                const speedFactor = momentumSpread * 0.05;
                
                animRef.current.particles.forEach(p => {
                    // Random jitter based on momentum uncertainty
                    p.x += (Math.random() - 0.5) * speedFactor;
                    
                    // Constrain to box (infinite potential well)
                    // If visual box is centered at CENTER_X with width boxWidth
                    if (p.x > boxWidth/2) { p.x = boxWidth/2; }
                    if (p.x < -boxWidth/2) { p.x = -boxWidth/2; }
                });
            }

            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Drawing ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // --- 1. Position Space (Top Half) ---
            const topY = 150;
            
            // Draw Box Boundaries (Infinite Potential Walls)
            const leftWall = CENTER_X - boxWidth/2;
            const rightWall = CENTER_X + boxWidth/2;
            
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(0, 0, leftWall, 300); // Left solid
            ctx.fillRect(rightWall, 0, CANVAS_WIDTH - rightWall, 300); // Right solid
            
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(leftWall, 0); ctx.lineTo(leftWall, 300);
            ctx.moveTo(rightWall, 0); ctx.lineTo(rightWall, 300);
            ctx.stroke();

            // Draw Wave Function psi(x)
            ctx.beginPath();
            ctx.strokeStyle = '#38bdf8'; // Cyan
            ctx.lineWidth = 3;
            
            const sigma = boxWidth / 4; 
            
            for (let x = leftWall; x <= rightWall; x+=2) {
                // Local coordinate relative to center
                const localX = x - CENTER_X;
                // Gaussian envelope
                const env = Math.exp( - (localX*localX) / (2*sigma*sigma) );
                // Probability density |psi|^2
                const prob = env * env * 150; // Scale height
                
                const y = 280 - prob;
                if (x === leftWall) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Fill area under curve
            ctx.lineTo(rightWall, 280);
            ctx.lineTo(leftWall, 280);
            ctx.fillStyle = 'rgba(56, 189, 248, 0.2)';
            ctx.fill();

            // Draw Particle Cloud (Monte Carlo representation)
            ctx.fillStyle = momentumSpread > 100 ? '#f472b6' : '#fff'; // Pink if high energy/uncertainty
            animRef.current.particles.forEach(p => {
                let dx = p.x;
                if (dx > boxWidth/2) dx = boxWidth/2;
                if (dx < -boxWidth/2) dx = -boxWidth/2;
                
                const px = CENTER_X + dx;
                const py = 280 - Math.random() * 20; // Just bottom strip
                ctx.beginPath(); ctx.arc(px, py, 2, 0, Math.PI*2); ctx.fill();
            });
            
            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText("Position Space", 20, 30);
            
            // Delta X Measurement Line
            ctx.strokeStyle = '#38bdf8';
            ctx.lineWidth = 1;
            const measureY = 290;
            ctx.beginPath(); 
            ctx.moveTo(leftWall, measureY); ctx.lineTo(rightWall, measureY); 
            // Arrows
            ctx.moveTo(leftWall+5, measureY-3); ctx.lineTo(leftWall, measureY); ctx.lineTo(leftWall+5, measureY+3);
            ctx.moveTo(rightWall-5, measureY-3); ctx.lineTo(rightWall, measureY); ctx.lineTo(rightWall-5, measureY+3);
            ctx.stroke();
            ctx.fillStyle = '#38bdf8';
            ctx.textAlign = 'center';
            ctx.fillText(`Δx`, CENTER_X, measureY + 15);

            // --- 2. Momentum Space (Bottom Half) ---
            if (showMomentum) {
                const bottomBaseY = CANVAS_HEIGHT - 30;
                const pCenterY = bottomBaseY - 100;
                
                // Draw Momentum Axis
                ctx.strokeStyle = '#64748b';
                ctx.beginPath(); ctx.moveTo(50, bottomBaseY); ctx.lineTo(CANVAS_WIDTH-50, bottomBaseY); ctx.stroke();
                
                // Draw Momentum Distribution phi(p)
                const sigma_p = 4000 / boxWidth; 

                ctx.beginPath();
                ctx.strokeStyle = '#a855f7'; // Purple
                ctx.lineWidth = 3;
                
                for (let px = 50; px <= CANVAS_WIDTH - 50; px+=2) {
                    const localP = px - CENTER_X;
                    const envP = Math.exp( - (localP*localP) / (2*sigma_p*sigma_p) );
                    const probP = envP * envP * 150;
                    
                    const y = bottomBaseY - probP;
                    if (px === 50) ctx.moveTo(px, y);
                    else ctx.lineTo(px, y);
                }
                ctx.stroke();
                
                // Fill
                ctx.lineTo(CANVAS_WIDTH-50, bottomBaseY);
                ctx.lineTo(50, bottomBaseY);
                ctx.fillStyle = 'rgba(168, 85, 247, 0.2)';
                ctx.fill();

                // Labels
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'left';
                ctx.fillText("Momentum Space", 20, 340);
                
                // Delta P Measurement
                const pLeft = CENTER_X - sigma_p;
                const pRight = CENTER_X + sigma_p;
                const pMeasureY = bottomBaseY + 15;
                
                ctx.strokeStyle = '#a855f7';
                ctx.lineWidth = 1;
                ctx.beginPath(); 
                ctx.moveTo(pLeft, pMeasureY); ctx.lineTo(pRight, pMeasureY); 
                // Arrows
                ctx.moveTo(pLeft+5, pMeasureY-3); ctx.lineTo(pLeft, pMeasureY); ctx.lineTo(pLeft+5, pMeasureY+3);
                ctx.moveTo(pRight-5, pMeasureY-3); ctx.lineTo(pRight, pMeasureY); ctx.lineTo(pRight-5, pMeasureY+3);
                ctx.stroke();
                ctx.fillStyle = '#a855f7';
                ctx.textAlign = 'center';
                ctx.fillText(`Δp`, CENTER_X, pMeasureY + 15);
            }
        };

        useEffect(() => {
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [boxWidth, showMomentum, isPaused]);

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        // Generate Hyperbola Data for Graph (dx * dp = constant)
        const graphData = useMemo(() => {
            const data = [];
            for (let x = 10; x <= 400; x+=10) {
                // Calculate p based on K/x
                const p = K / x;
                data.push({ x: x, y: p });
            }
            return data;
        }, []);

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-purple-500/20 p-1.5 rounded-lg">
                            <i data-lucide="atom" className="w-5 h-5 text-purple-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Heisenberg Uncertainty Principle</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Quantum Physics
                    </div>
                </nav>

                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas */}
                        <div className="lg:col-span-3 bg-slate-950 relative border-r border-slate-700">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain"
                            />
                            
                            {/* Equation Overlay */}
                            <div className="absolute top-4 right-4 bg-slate-900/80 p-4 rounded-xl border border-slate-700 backdrop-blur shadow-2xl">
                                <div className="text-xl font-mono text-center mb-2 font-bold text-white">
                                    &Delta;x &middot; &Delta;p &ge; <span className="text-slate-400">ℏ/2</span>
                                </div>
                                <div className="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <div className="text-xs text-slate-400">Position Uncertainty</div>
                                        <div className="text-lg font-mono text-sky-400 font-bold">{boxWidth.toFixed(0)}</div>
                                        <div className="text-[10px] text-slate-500">pm</div>
                                    </div>
                                    <div>
                                        <div className="text-xs text-slate-400">Momentum Uncertainty</div>
                                        <div className="text-lg font-mono text-purple-400 font-bold">{momentumSpread.toFixed(1)}</div>
                                        <div className="text-[10px] text-slate-500">units</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* RIGHT: Controls */}
                        <div className="lg:col-span-1 bg-slate-900 border-l border-slate-700 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            {/* 1. Hyperbola Graph */}
                            <div className="h-48 w-full bg-slate-950 border-b border-slate-700 p-2 relative">
                                <div className="text-[9px] text-slate-500 absolute top-2 left-2 z-10">&Delta;p vs &Delta;x</div>
                                <ResponsiveContainer width="100%" height="100%">
                                    <ScatterChart margin={{ top: 20, right: 20, bottom: 20, left: 0 }}>
                                        <XAxis type="number" dataKey="x" name="dx" unit="pm" tick={{fontSize: 9}} domain={[0, 400]} />
                                        <YAxis type="number" dataKey="y" name="dp" tick={{fontSize: 9}} domain={[0, 1000]} />
                                        <Tooltip cursor={{ strokeDasharray: '3 3' }} contentStyle={{backgroundColor: '#1e293b', border: '1px solid #475569', fontSize: '10px'}} />
                                        <Scatter name="Uncertainty" data={graphData} fill="#8884d8" line shape="circle" />
                                        <ReferenceDot x={boxWidth} y={momentumSpread} r={5} fill="#f43f5e" stroke="white" />
                                    </ScatterChart>
                                </ResponsiveContainer>
                            </div>

                            {/* 2. Controls */}
                            <div className="p-5 space-y-6 flex-1">
                                
                                {/* Box Width Slider */}
                                <div>
                                    <label className="flex justify-between text-xs font-bold text-sky-400 mb-2">
                                        Box Width (&Delta;x)
                                        <span>{boxWidth} pm</span>
                                    </label>
                                    <input 
                                        type="range" min="20" max="400" step="5" 
                                        value={boxWidth} onChange={(e) => setBoxWidth(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg slider-thumb thumb-sky" 
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500 mt-1">
                                        <span>Narrow (High Precision)</span>
                                        <span>Wide (Low Precision)</span>
                                    </div>
                                    <p className="text-[10px] text-slate-400 mt-2">
                                        Try narrowing the box. Notice how the momentum wave packet (&Delta;p) widens!
                                    </p>
                                </div>

                                <div className="h-px bg-slate-800"></div>

                                {/* Analogy Box */}
                                <div className="bg-slate-800 p-3 rounded border border-slate-700">
                                    <h4 className="text-xs font-bold text-white mb-2 flex items-center">
                                        <i data-lucide="lightbulb" className="w-4 h-4 mr-2 text-yellow-400"></i>
                                        Intuitive Understanding
                                    </h4>
                                    <p className="text-[11px] text-slate-300 leading-relaxed">
                                        If you confine a particle to a very small space (&Delta;x &darr;), it becomes very "agitated", moving wildly, making it impossible to predict where it will go next (&Delta;p &uarr;).
                                    </p>
                                </div>

                                {/* Animation Control */}
                                <button 
                                    onClick={() => setIsPaused(!isPaused)}
                                    className={`w-full py-3 rounded-lg text-xs font-bold flex items-center justify-center gap-2 border transition-all 
                                        ${isPaused ? 'bg-amber-600 border-amber-500 text-white' : 'bg-slate-800 border-slate-700 text-slate-300'}`}
                                >
                                    <i data-lucide={isPaused ? "play" : "pause"} className="w-4 h-4"></i>
                                    {isPaused ? "Resume Simulation" : "Pause Simulation"}
                                </button>

                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
