<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinetic Theory Box | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; background: #ffffff; cursor: pointer; border: 2px solid #3b82f6;
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const BOX_WIDTH = 400;
    const BOX_HEIGHT = 300;
    // Physical constants for simulation scaling
    const PARTICLE_MASS = 1; 

    const App = () => {
        // --- State ---
        const [particleCount, setParticleCount] = useState(50); // N
        const [temperature, setTemperature] = useState(50); // Affects speed
        
        // Calculated Values
        const [density, setDensity] = useState(0); // rho = N / V
        const [meanSquareSpeed, setMeanSquareSpeed] = useState(0); // <c^2>
        const [theoreticalPressure, setTheoreticalPressure] = useState(0); // P = 1/3 * rho * <c^2>
        const [simulatedPressure, setSimulatedPressure] = useState(0); // From wall collisions

        // --- Refs ---
        const canvasRef = useRef(null);
        const requestRef = useRef();
        const simState = useRef({
            particles: [],
            impulseSum: 0, // Sum of momentum change on walls
            lastPressureCheck: 0
        });

        // Helper to create a single particle
        const createParticle = () => {
            return {
                x: Math.random() * (BOX_WIDTH - 10) + 5,
                y: Math.random() * (BOX_HEIGHT - 10) + 5,
                vx: (Math.random() - 0.5) * 2, // Initial slow speed
                vy: (Math.random() - 0.5) * 2
            };
        };

        // --- Init & Manage Particles ---
        // This effect handles both initialization and updates to particle count
        useEffect(() => {
            const current = simState.current.particles;
            const target = particleCount;
            
            if (current.length < target) {
                for(let i=current.length; i<target; i++) {
                    current.push(createParticle());
                }
            } else if (current.length > target) {
                current.splice(target);
            }
            // Recalculate density immediately for UI responsiveness
            // Area = BOX_WIDTH * BOX_HEIGHT (2D simulation)
            // Density = N / Area * Mass
            // Let's assume Area = 1 unit for simplified P=1/3 rho c^2 display mapping
            setDensity(particleCount * PARTICLE_MASS); 

        }, [particleCount]);

        // --- Physics Loop ---
        const updatePhysics = (time) => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;
            const state = simState.current;

            // 1. Clear Canvas
            ctx.clearRect(0, 0, BOX_WIDTH, BOX_HEIGHT);
            
            // Draw Box Background
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(0, 0, BOX_WIDTH, BOX_HEIGHT);
            
            // Draw Grid (optional for scale)
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 1;
            ctx.beginPath();
            for(let i=0; i<=BOX_WIDTH; i+=40) { ctx.moveTo(i, 0); ctx.lineTo(i, BOX_HEIGHT); }
            for(let i=0; i<=BOX_HEIGHT; i+=40) { ctx.moveTo(0, i); ctx.lineTo(BOX_WIDTH, i); }
            ctx.stroke();

            // 2. Update Particles
            // Target RMS speed based on Temperature slider
            // T ~ <c^2>
            const targetSpeedScale = 1 + (temperature / 100) * 5; 
            
            let totalSpeedSq = 0;

            state.particles.forEach(p => {
                // Adjust speed towards target temp (thermal bath)
                const currentSpeedSq = p.vx*p.vx + p.vy*p.vy;
                const currentSpeed = Math.sqrt(currentSpeedSq);
                
                // Drift speed towards target
                if (currentSpeed > 0) {
                     const ratio = targetSpeedScale / currentSpeed;
                     // Soft update (0.1 factor) to allow some variance
                     p.vx = p.vx * (1 - 0.05) + (p.vx * ratio) * 0.05;
                     p.vy = p.vy * (1 - 0.05) + (p.vy * ratio) * 0.05;
                } else {
                     p.vx = (Math.random()-0.5); 
                     p.vy = (Math.random()-0.5);
                }

                // Move
                p.x += p.vx;
                p.y += p.vy;
                
                // Accumulate speed squared for calculation
                totalSpeedSq += (p.vx*p.vx + p.vy*p.vy);

                // Wall Collisions & Momentum Transfer (Pressure)
                // dP = 2 * m * v_perp (Elastic collision)
                // Force = dP / dt
                if (p.x < 5) { 
                    p.x = 5; 
                    p.vx *= -1; 
                    state.impulseSum += 2 * PARTICLE_MASS * Math.abs(p.vx);
                }
                if (p.x > BOX_WIDTH - 5) { 
                    p.x = BOX_WIDTH - 5; 
                    p.vx *= -1; 
                    state.impulseSum += 2 * PARTICLE_MASS * Math.abs(p.vx);
                }
                if (p.y < 5) { 
                    p.y = 5; 
                    p.vy *= -1; 
                    state.impulseSum += 2 * PARTICLE_MASS * Math.abs(p.vy);
                }
                if (p.y > BOX_HEIGHT - 5) { 
                    p.y = BOX_HEIGHT - 5; 
                    p.vy *= -1; 
                    state.impulseSum += 2 * PARTICLE_MASS * Math.abs(p.vy);
                }

                // Draw Particle
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
                // Color based on speed
                const speed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
                const hue = Math.min(240, Math.max(0, 240 - speed * 30)); // Blue (slow) to Red (fast)
                ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                ctx.fill();
            });

            // Draw Box Border
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 4;
            ctx.strokeRect(0, 0, BOX_WIDTH, BOX_HEIGHT);

            // 3. Update Calculations (Every 500ms approx)
            if (time - state.lastPressureCheck > 500) {
                const c2 = totalSpeedSq / state.particles.length;
                setMeanSquareSpeed(c2);
                
                // Simulated Pressure Calculation
                // Pressure = Force / Area (Perimeter in 2D)
                // Force = Total Impulse / Time
                const dt = (time - state.lastPressureCheck); // ms
                // Scale factor to make numbers readable
                const force = state.impulseSum / dt; 
                const perimeter = (BOX_WIDTH + BOX_HEIGHT) * 2;
                const simP = (force / perimeter) * 50000; // Arbitrary scaling for readability

                setSimulatedPressure(prev => prev * 0.7 + simP * 0.3); // Smooth

                // Theoretical P for display (using 3D formula logic P ~ N * c^2)
                // P = (1/3) * (N * m / V) * c^2
                // We'll calculate a theoretical value that matches the scale of our simulation
                const rho = particleCount * PARTICLE_MASS;
                // Use a constant K to align units
                const theoreticalP = (1/2) * rho * c2 * 0.05; 
                setTheoreticalPressure(theoreticalP);

                // Reset accumulator
                state.impulseSum = 0;
                state.lastPressureCheck = time;
                
                // Update density state for display
                setDensity(rho);
            }

            requestRef.current = requestAnimationFrame((t) => updatePhysics(t));
        };

        useEffect(() => {
            requestRef.current = requestAnimationFrame((t) => updatePhysics(t));
            return () => cancelAnimationFrame(requestRef.current);
        }, [particleCount, temperature]);

        return (
            <div className="min-h-screen bg-slate-900 pb-12 font-sans text-slate-200">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                        <div className="bg-purple-500/20 p-2 rounded-lg">
                            <i data-lucide="box" className="w-6 h-6 text-purple-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Kinetic Theory Box</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Kinetic Model
                    </div>
                </nav>

                <main className="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Left: Simulation Canvas */}
                    <div className="lg:col-span-5 flex flex-col gap-6">
                        <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl flex justify-center">
                            <canvas 
                                ref={canvasRef} 
                                width={BOX_WIDTH} 
                                height={BOX_HEIGHT}
                                className="bg-slate-950 rounded border border-slate-700 shadow-inner"
                            />
                        </div>
                        
                        <div className="grid grid-cols-2 gap-4">
                            {/* Particle Count Control */}
                            <div className="bg-slate-800 p-5 rounded-xl border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <label className="text-slate-300 font-bold text-sm">Particles (N)</label>
                                    <span className="bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs font-mono">{particleCount}</span>
                                </div>
                                <input 
                                    type="range" min="10" max="200" step="10"
                                    value={particleCount}
                                    onChange={(e) => setParticleCount(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb"
                                />
                                <div className="text-xs text-slate-500 mt-2">Changes Density (ρ)</div>
                            </div>

                            {/* Temperature Control */}
                            <div className="bg-slate-800 p-5 rounded-xl border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <label className="text-slate-300 font-bold text-sm">Temperature</label>
                                    <span className="bg-red-500/20 text-red-400 px-2 py-1 rounded text-xs font-mono">{temperature}</span>
                                </div>
                                <input 
                                    type="range" min="10" max="100" step="5"
                                    value={temperature}
                                    onChange={(e) => setTemperature(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb"
                                />
                                <div className="text-xs text-slate-500 mt-2">Changes Speed (c²)</div>
                            </div>
                        </div>
                    </div>

                    {/* Right: The Math & Data */}
                    <div className="lg:col-span-7 space-y-6">
                        
                        {/* The Formula Card */}
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <h2 className="text-white font-bold mb-4 flex items-center">
                                <i data-lucide="function-square" className="w-5 h-5 mr-2 text-indigo-400"></i>
                                The Kinetic Theory Equation
                            </h2>
                            
                            <div className="flex flex-col items-center justify-center p-6 bg-slate-900 rounded-xl border border-slate-800">
                                <div className="text-3xl md:text-4xl font-mono text-white mb-2">
                                    P = <span className="text-slate-500">1/3</span> <span className="text-blue-400">ρ</span> <span className="text-red-400">&lt;c²&gt;</span>
                                </div>
                                <div className="text-xs text-slate-500 mt-2 italic">
                                    Pressure = 1/3 × Density × Mean Square Speed
                                </div>
                            </div>
                        </div>

                        {/* Real-time Data Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {/* Density */}
                            <div className="bg-blue-900/10 border border-blue-500/20 p-4 rounded-xl">
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Density (ρ)</div>
                                <div className="text-2xl font-bold text-blue-400 font-mono">{density}</div>
                                <div className="text-[10px] text-slate-500 mt-1">N × mass / Volume</div>
                            </div>

                            {/* Mean Square Speed */}
                            <div className="bg-red-900/10 border border-red-500/20 p-4 rounded-xl">
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Mean Sq Speed (&lt;c²&gt;)</div>
                                <div className="text-2xl font-bold text-red-400 font-mono">{meanSquareSpeed.toFixed(0)}</div>
                                <div className="text-[10px] text-slate-500 mt-1">Average KE proxy</div>
                            </div>

                            {/* Simulated Pressure */}
                            <div className="bg-indigo-900/10 border border-indigo-500/20 p-4 rounded-xl">
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Simulated Pressure</div>
                                <div className="text-2xl font-bold text-indigo-400 font-mono">{simulatedPressure.toFixed(0)}</div>
                                <div className="text-[10px] text-slate-500 mt-1">From Wall Impacts</div>
                            </div>
                        </div>

                        {/* Verification Section */}
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <h3 className="text-white font-bold mb-4">Verification</h3>
                            <div className="space-y-4">
                                <div>
                                    <div className="flex justify-between text-sm mb-1">
                                        <span className="text-slate-400">Simulated Pressure (Measured)</span>
                                        <span className="text-indigo-400 font-mono">{simulatedPressure.toFixed(0)}</span>
                                    </div>
                                    <div className="w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                                        <div className="h-full bg-indigo-500 transition-all duration-300" style={{width: `${Math.min(100, simulatedPressure/10)}%`}}></div>
                                    </div>
                                </div>
                                <div>
                                    <div className="flex justify-between text-sm mb-1">
                                        <span className="text-slate-400">Theoretical Calculation (ρ × &lt;c²&gt;)</span>
                                        <span className="text-emerald-400 font-mono">{theoreticalPressure.toFixed(0)}</span>
                                    </div>
                                    <div className="w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                                        <div className="h-full bg-emerald-500 transition-all duration-300" style={{width: `${Math.min(100, theoreticalPressure/10)}%`}}></div>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-4 p-3 bg-slate-900/50 rounded text-xs text-slate-400 leading-relaxed">
                                <i data-lucide="check-circle" className="w-3 h-3 inline mr-1 text-emerald-500"></i>
                                Notice how both bars move together! Increasing particle count (Density) OR increasing temperature (Speed) both result in higher Pressure, confirming the equation.
                            </div>
                        </div>

                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    if (typeof lucide !== 'undefined') {
        setTimeout(() => lucide.createIcons(), 100);
    }
</script>
</body>
</html>
