<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Fall & Air Resistance Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .vacuum-bg {
            background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
        }
        .air-bg {
            background-image: linear-gradient(to bottom, #dbeafe 0%, #eff6ff 100%);
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 400;
    const CANVAS_HEIGHT = 600;
    const PIXELS_PER_METER = 50; // Scale
    const G = 9.81;
    const DT = 0.016; // Time step (approx 60fps)

    const App = () => {
        // --- State ---
        const [isVacuum, setIsVacuum] = useState(false);
        const [simState, setSimState] = useState('idle'); // idle, running, finished
        const [time, setTime] = useState(0);
        
        // Physics Objects State
        // Values: y (m), v (m/s), a (m/s^2)
        const [ball, setBall] = useState({ y: 0, v: 0 });
        const [feather, setFeather] = useState({ y: 0, v: 0 });

        // Graph Data
        const [history, setHistory] = useState([]); // [{t, vBall, vFeather}]

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Physics Parameters
        // Ball: High Mass, Low Drag
        // Feather: Low Mass, High Drag
        const BALL_PROPS = { mass: 1.0, k: 0.05 }; // k = 0.5 * rho * Cd * A
        const FEATHER_PROPS = { mass: 0.05, k: 0.3 }; 

        // --- Physics Engine ---
        const updatePhysics = () => {
            if (simState !== 'running') return;

            setHistory(prev => {
                // Use refs or current state? For simple sim, functional updates are safer for consistency
                // But we need current values to calculate next step.
                // Let's use a mutable ref for the loop to avoid closure staleness, then sync to state for render.
                return prev; 
            });
        };

        // We use a ref to hold physics state during animation loop to avoid dependency hell
        const physicsRef = useRef({
            t: 0,
            ball: { y: 0, v: 0 },
            feather: { y: 0, v: 0 },
            history: []
        });

        const startSim = () => {
            physicsRef.current = {
                t: 0,
                ball: { y: 0, v: 0 },
                feather: { y: 0, v: 0 },
                history: []
            };
            setSimState('running');
            setBall({ y: 0, v: 0 });
            setFeather({ y: 0, v: 0 });
            setHistory([]);
            loop();
        };

        const resetSim = () => {
            setSimState('idle');
            cancelAnimationFrame(requestRef.current);
            setBall({ y: 0, v: 0 });
            setFeather({ y: 0, v: 0 });
            setTime(0);
            setHistory([]);
        };

        const loop = () => {
            const state = physicsRef.current;
            
            // Calculate forces
            // F_net = mg - kv^2 (Drag opposes motion)
            // a = g - (k/m)v^2
            
            const rhoFactor = isVacuum ? 0 : 1; // 0 density in vacuum

            // Ball Physics
            const fDragBall = rhoFactor * BALL_PROPS.k * state.ball.v * state.ball.v;
            const aBall = G - (fDragBall / BALL_PROPS.mass);
            state.ball.v += aBall * DT;
            state.ball.y += state.ball.v * DT;

            // Feather Physics
            const fDragFeather = rhoFactor * FEATHER_PROPS.k * state.feather.v * state.feather.v;
            const aFeather = G - (fDragFeather / FEATHER_PROPS.mass);
            state.feather.v += aFeather * DT;
            state.feather.y += state.feather.v * DT;

            state.t += DT;

            // Stop condition (Ground hit)
            const groundY = (CANVAS_HEIGHT - 50) / PIXELS_PER_METER;
            if (state.ball.y >= groundY && state.feather.y >= groundY) {
                setSimState('finished');
                return; 
            }
            // Clamp to ground
            if (state.ball.y > groundY) { state.ball.y = groundY; state.ball.v = 0; }
            if (state.feather.y > groundY) { state.feather.y = groundY; state.feather.v = 0; }

            // Update History (throttle recording)
            if (Math.floor(state.t * 100) % 5 === 0) {
                state.history.push({
                    t: state.t,
                    vBall: state.ball.v,
                    vFeather: state.feather.v
                });
            }

            // Sync to React State for render
            setBall({...state.ball});
            setFeather({...state.feather});
            setTime(state.t);
            setHistory([...state.history]);

            if (state.ball.y < groundY || state.feather.y < groundY) {
                requestRef.current = requestAnimationFrame(loop);
            } else {
                setSimState('finished');
            }
        };

        // --- Rendering ---
        useEffect(() => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw objects
            const groundY = CANVAS_HEIGHT - 50;
            
            // Ball
            const ballY = 50 + ball.y * PIXELS_PER_METER;
            ctx.beginPath();
            ctx.arc(CANVAS_WIDTH/3, ballY, 15, 0, Math.PI*2);
            ctx.fillStyle = '#475569'; // Slate-600
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Feather
            const featherY = 50 + feather.y * PIXELS_PER_METER;
            const fx = 2 * CANVAS_WIDTH/3;
            ctx.save();
            ctx.translate(fx, featherY);
            // Simple feather shape
            ctx.beginPath();
            ctx.fillStyle = '#fff';
            ctx.ellipse(0, 0, 10, 20, 0, 0, Math.PI*2);
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(0, -20);
            ctx.lineTo(0, 25);
            ctx.strokeStyle = '#cbd5e1';
            ctx.stroke();
            ctx.restore();

            // Ground
            ctx.fillStyle = '#334155';
            ctx.fillRect(0, groundY, CANVAS_WIDTH, 50);

        }, [ball, feather, isVacuum]); // Only re-draw on positon change

        // Init icons
        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        // Graph Component
        const Graph = ({ data }) => {
            const width = 300;
            const height = 150;
            const padding = 20;
            
            // Scales
            const maxT = data.length > 0 ? data[data.length-1].t : 5;
            const maxV = 15; // Fixed max for comparison

            const mapX = t => padding + (t / maxT) * (width - 2*padding);
            const mapY = v => height - padding - (v / maxV) * (height - 2*padding);

            return (
                <svg width="100%" height="100%" viewBox={`0 0 ${width} ${height}`} className="overflow-visible">
                    {/* Axes */}
                    <line x1={padding} y1={height-padding} x2={width-padding} y2={height-padding} stroke="#64748b" />
                    <line x1={padding} y1={height-padding} x2={padding} y2={padding} stroke="#64748b" />
                    
                    {/* Labels */}
                    <text x={width/2} y={height} fill="#64748b" fontSize="10" textAnchor="middle">Time (s)</text>
                    <text x="0" y={height/2} fill="#64748b" fontSize="10" textAnchor="middle" transform={`rotate(-90, 10, ${height/2})`}>Velocity (m/s)</text>

                    {/* Paths */}
                    {data.length > 1 && (
                        <>
                            <polyline 
                                points={data.map(d => `${mapX(d.t)},${mapY(d.vBall)}`).join(' ')}
                                fill="none" stroke="#475569" strokeWidth="2"
                            />
                            <polyline 
                                points={data.map(d => `${mapX(d.t)},${mapY(d.vFeather)}`).join(' ')}
                                fill="none" stroke="#fff" strokeWidth="2" strokeDasharray="4 2"
                            />
                        </>
                    )}
                </svg>
            );
        };

        return (
            <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-12">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                    <div className="flex items-center space-x-3">
                        <div className="bg-blue-500/20 p-2 rounded-lg">
                            <i data-lucide="feather" className="w-6 h-6 text-blue-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Free Fall Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Forces
                    </div>
                </nav>

                <main className="max-w-5xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Left: Controls & Data */}
                    <div className="lg:col-span-4 space-y-6">
                        
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <h2 className="text-white font-bold mb-4 flex items-center">
                                <i data-lucide="settings" className="w-4 h-4 mr-2 text-indigo-400"></i>
                                Environment
                            </h2>
                            
                            <div className="flex items-center justify-between bg-slate-900/50 p-1 rounded-lg border border-slate-700 mb-6">
                                <button 
                                    onClick={() => { setIsVacuum(false); resetSim(); }}
                                    className={`flex-1 py-2 rounded-md text-sm font-bold transition-all ${!isVacuum ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Atmosphere
                                </button>
                                <button 
                                    onClick={() => { setIsVacuum(true); resetSim(); }}
                                    className={`flex-1 py-2 rounded-md text-sm font-bold transition-all ${isVacuum ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Vacuum
                                </button>
                            </div>

                            <button 
                                onClick={simState === 'running' ? resetSim : startSim}
                                className={`w-full py-4 rounded-xl font-bold flex items-center justify-center transition-all ${simState === 'running' ? 'bg-red-500/20 text-red-400 border border-red-500/50' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}`}
                            >
                                <i data-lucide={simState === 'running' ? "rotate-ccw" : "play"} className="w-5 h-5 mr-2"></i>
                                {simState === 'running' ? 'Reset' : 'Drop Objects'}
                            </button>
                        </div>

                        {/* Real-time Data */}
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="w-3 h-3 rounded-full bg-slate-500"></div>
                                    <span className="text-xs text-slate-400 font-bold uppercase">Iron Ball</span>
                                </div>
                                <div className="text-2xl font-mono text-white">{ball.v.toFixed(2)} <span className="text-xs text-slate-500">m/s</span></div>
                            </div>
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="w-3 h-3 rounded-full bg-white border border-slate-400"></div>
                                    <span className="text-xs text-slate-400 font-bold uppercase">Feather</span>
                                </div>
                                <div className="text-2xl font-mono text-white">{feather.v.toFixed(2)} <span className="text-xs text-slate-500">m/s</span></div>
                            </div>
                        </div>

                        {/* Velocity Graph */}
                        <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 h-48 relative">
                            <div className="absolute top-2 right-2 text-[10px] text-slate-500 font-bold uppercase">Velocity vs Time</div>
                            <Graph data={history} />
                        </div>

                    </div>

                    {/* Right: Simulation Chamber */}
                    <div className="lg:col-span-8">
                        <div className={`rounded-2xl border border-slate-700 h-[600px] relative overflow-hidden shadow-2xl transition-colors duration-1000 ${isVacuum ? 'vacuum-bg border-indigo-900/50' : 'air-bg border-blue-200/20'}`}>
                            
                            {/* Environment Label */}
                            <div className="absolute top-6 left-1/2 -translate-x-1/2 px-4 py-1 rounded-full bg-black/20 backdrop-blur-sm border border-white/10 text-white/80 font-bold text-sm flex items-center gap-2">
                                {isVacuum ? <><i data-lucide="wind" className="w-4 h-4 opacity-50"></i> Vacuum Chamber (No Air)</> : <><i data-lucide="cloud" className="w-4 h-4 text-blue-300"></i> Standard Atmosphere</>}
                            </div>

                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain"
                            />
                        </div>
                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
