<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hooke's Law Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-teal::-webkit-slider-thumb { background: #14b8a6; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;
    const { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, ReferenceDot, ReferenceLine, Label } = Recharts;

    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 550;
    
    // Physics Constants
    const GRAVITY = 9.8;
    const PIXELS_PER_CM = 10; // Visual scale
    const NATURAL_LENGTH = 150; // Visual natural length in pixels

    // Spring Materials (Different k and Elastic Limits)
    const SPRINGS = [
        { name: "Soft Spring", k: 20, limit: 8, color: "#14b8a6" }, // k in N/m (scaled for sim), limit in Newtons
        { name: "Medium Spring", k: 40, limit: 12, color: "#3b82f6" },
        { name: "Stiff Spring", k: 80, limit: 16, color: "#a855f7" },
        { name: "Steel Wire", k: 200, limit: 20, color: "#64748b" }
    ];

    const App = () => {
        // --- State ---
        const [springType, setSpringType] = useState("Medium Spring");
        const [load, setLoad] = useState(0); // Applied Force (Newtons)
        const [permanentDeformation, setPermanentDeformation] = useState(0); // cm
        const [showRuler, setShowRuler] = useState(true);
        const [isBroken, setIsBroken] = useState(false);

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Physics State for Animation
        const animRef = useRef({
            currentExtension: 0, // cm
            velocity: 0
        });

        // Derived Values
        const currentSpring = SPRINGS.find(s => s.name === springType);
        
        // --- Physics Logic ---
        // Calculate theoretical extension based on Load and History (Plasticity)
        const calculateExtension = (force) => {
            if (isBroken) return animRef.current.currentExtension;

            // 1. Elastic Region (Hooke's Law: F = kx -> x = F/k)
            // Note: force is in Newtons. k is in N/cm for this visual scale?
            // Let's say k is N/m. To get cm: x(m) = F/k -> x(cm) = (F/k)*100
            // But for simple numbers, let's treat k as N/cm visually or scale appropriately.
            // Let's use simple units: x (cm) = Force / (k_visual)
            const k_visual = currentSpring.k / 10; // Adjust for reasonable screen cm
            
            let elasticExt = force / k_visual;
            
            // 2. Plastic Region Check
            if (force > currentSpring.limit) {
                // Determine plastic deformation
                // Simple model: Excess force causes permanent stretch
                const excess = force - currentSpring.limit;
                // Plastic deformation grows with excess force squared (simple approximation of yield)
                const newPlastic = excess * 0.5; 
                
                // Update permanent deformation only if it increases (plasticity is irreversible)
                if (newPlastic > permanentDeformation) {
                    setPermanentDeformation(newPlastic);
                }
                
                // Breaking Point? (e.g. 2x limit)
                if (force > currentSpring.limit * 1.5) {
                    setIsBroken(true);
                }
            }
            
            return elasticExt + permanentDeformation;
        };

        const targetExtension = calculateExtension(load);

        // --- Loop ---
        const loop = () => {
            const state = animRef.current;
            
            // Spring-Mass-Damper for smooth animation
            // a = (target - current) * stiffness - velocity * damping
            const k_spring = 0.1;
            const damping = 0.8;
            
            const diff = targetExtension - state.currentExtension;
            const acc = diff * k_spring;
            
            state.velocity += acc;
            state.velocity *= damping;
            state.currentExtension += state.velocity;

            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Drawing ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            const cx = 300; // Spring X position
            const supportY = 50; // Ceiling
            const extPx = animRef.current.currentExtension * PIXELS_PER_CM;
            const currentLen = NATURAL_LENGTH + extPx;

            // 1. Draw Support
            ctx.fillStyle = '#334155';
            ctx.fillRect(cx - 50, supportY - 10, 100, 10); // Ceiling bar
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            for(let i=-40; i<50; i+=10) {
                ctx.beginPath(); ctx.moveTo(cx + i, supportY - 10); ctx.lineTo(cx + i + 5, supportY - 20); ctx.stroke();
            }

            // 2. Draw Ruler
            if (showRuler) {
                const rulerX = cx + 80;
                ctx.fillStyle = '#e2e8f0';
                ctx.fillRect(rulerX, supportY, 40, 450);
                
                ctx.fillStyle = '#475569';
                ctx.font = '10px monospace';
                ctx.textAlign = 'right';
                
                for(let cm = 0; cm <= 40; cm += 1) {
                    const y = supportY + NATURAL_LENGTH + (cm * PIXELS_PER_CM);
                    if (y > supportY + 450) break;
                    
                    const tickLen = (cm % 5 === 0) ? 15 : 8;
                    ctx.fillRect(rulerX, y, tickLen, 1);
                    
                    if (cm % 5 === 0) {
                        ctx.fillText(cm, rulerX - 5, y + 3);
                    }
                }
                ctx.textAlign = 'center';
                ctx.fillText("cm", rulerX + 20, supportY + 15);
                
                // Zero line indicator (Natural Length)
                ctx.strokeStyle = '#94a3b8';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(cx - 60, supportY + NATURAL_LENGTH);
                ctx.lineTo(rulerX, supportY + NATURAL_LENGTH);
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = '#94a3b8';
                ctx.fillText("0", cx - 70, supportY + NATURAL_LENGTH + 3);
            }

            // 3. Draw Spring
            ctx.strokeStyle = currentSpring.color;
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();
            ctx.moveTo(cx, supportY);
            
            if (isBroken) {
                // Draw broken spring (two parts)
                // Top part
                drawCoil(ctx, cx, supportY, currentLen/2, 10, 20);
                // Gap
                // Bottom part falling? (Visual simplified: just hang loose or disappear)
                // Let's just draw half spring
            } else {
                drawCoil(ctx, cx, supportY, currentLen, 20, 30);
            }
            ctx.stroke();

            // 4. Draw Weights
            if (!isBroken) {
                const bottomY = supportY + currentLen;
                
                // Hook
                ctx.strokeStyle = '#cbd5e1';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(cx, bottomY);
                ctx.lineTo(cx, bottomY + 20);
                ctx.arc(cx, bottomY + 25, 5, -Math.PI/2, Math.PI * 1.5);
                ctx.stroke();

                // Mass Hanger
                if (load > 0) {
                    const massY = bottomY + 30;
                    ctx.fillStyle = '#64748b';
                    // Size proportional to load
                    const h = 20 + load * 2; 
                    const w = 40;
                    
                    // Trapezoid weight
                    ctx.beginPath();
                    ctx.moveTo(cx - w/2 + 5, massY);
                    ctx.lineTo(cx + w/2 - 5, massY);
                    ctx.lineTo(cx + w/2, massY + h);
                    ctx.lineTo(cx - w/2, massY + h);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 12px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${load}N`, cx, massY + h/2 + 4);
                }
            }

            // 5. Indicators
            // Pointer
            if (!isBroken) {
                const ptrY = supportY + currentLen;
                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.moveTo(cx + 20, ptrY);
                ctx.lineTo(cx + 60, ptrY - 5);
                ctx.lineTo(cx + 60, ptrY + 5);
                ctx.fill();
            }
        };

        const drawCoil = (ctx, x, y, len, coils, width) => {
            const step = len / (coils * 4);
            let cy = y;
            for (let i = 0; i < coils; i++) {
                ctx.bezierCurveTo(x + width, cy + step, x + width, cy + step * 3, x, cy + step * 4);
                cy += step * 4;
                if (i < coils - 1) {
                    ctx.bezierCurveTo(x - width, cy - step * 3, x - width, cy - step, x, cy);
                }
            }
        };

        // Graph Data Generation
        const graphData = useMemo(() => {
            const data = [];
            const k = currentSpring.k / 10; 
            const limit = currentSpring.limit;
            
            // Generate points up to 20N
            for (let f = 0; f <= 20; f += 0.5) {
                let ext = f / k; // Elastic
                let region = "Elastic";
                
                if (f > limit) {
                    const excess = f - limit;
                    ext += excess * 0.5; // Plastic addition
                    region = "Plastic";
                }
                
                // Stop plotting if broken
                if (f > limit * 1.5) break;

                data.push({ f, x: ext, region });
            }
            return data;
        }, [springType]);

        const reset = () => {
            setLoad(0);
            setPermanentDeformation(0);
            setIsBroken(false);
            animRef.current = { currentExtension: 0, velocity: 0 };
        };

        useEffect(() => {
            reset(); // Reset when spring changes
        }, [springType]);

        useEffect(() => {
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [load, springType, showRuler, isBroken]);

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-teal-500/20 p-1.5 rounded-lg">
                            <i data-lucide="scale" className="w-5 h-5 text-teal-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Hooke's Law & Elasticity</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Matter
                    </div>
                </nav>

                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas */}
                        <div className="lg:col-span-3 bg-slate-950 relative border-r border-slate-700">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain"
                            />
                            
                            {/* Warnings */}
                            {load > currentSpring.limit && !isBroken && (
                                <div className="absolute top-4 left-1/2 -translate-x-1/2 bg-rose-900/80 border border-rose-500 text-rose-200 px-4 py-2 rounded-lg text-sm animate-pulse flex items-center gap-2">
                                    <i data-lucide="alert-triangle" className="w-4 h-4"></i>
                                    Warning: Elastic Limit Exceeded!
                                </div>
                            )}
                            {isBroken && (
                                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-600 text-white px-6 py-4 rounded-xl text-xl font-bold shadow-2xl flex flex-col items-center gap-2">
                                    <i data-lucide="x-circle" className="w-8 h-8"></i>
                                    SPRING BROKEN
                                    <button onClick={reset} className="mt-2 text-xs bg-white text-red-600 px-3 py-1 rounded hover:bg-gray-100">
                                        Reset Experiment
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* RIGHT: Controls */}
                        <div className="lg:col-span-1 bg-slate-900 border-l border-slate-700 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            {/* 1. Data Panel */}
                            <div className="p-4 bg-slate-800/50 border-b border-slate-700 backdrop-blur sticky top-0 z-10">
                                <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Measurements</h3>
                                <div className="space-y-2">
                                    <div className="flex justify-between items-center bg-slate-900 p-2 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400">Force (Load)</div>
                                        <div className="font-mono font-bold text-white">{load} N</div>
                                    </div>
                                    <div className="flex justify-between items-center bg-slate-900 p-2 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400">Extension ($x$)</div>
                                        <div className="font-mono font-bold text-teal-400">
                                            {animRef.current.currentExtension.toFixed(1)} cm
                                        </div>
                                    </div>
                                    <div className={`flex justify-between items-center p-2 rounded border ${permanentDeformation > 0 ? 'bg-rose-900/20 border-rose-800' : 'bg-slate-900 border-slate-700'}`}>
                                        <div className="text-xs text-slate-400">Perm. Deformation</div>
                                        <div className={`font-mono font-bold ${permanentDeformation > 0 ? 'text-rose-400' : 'text-slate-500'}`}>
                                            {permanentDeformation.toFixed(1)} cm
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* 2. Controls */}
                            <div className="p-5 space-y-6 flex-1">
                                
                                {/* Spring Selector */}
                                <div>
                                    <label className="text-xs font-bold text-slate-300 mb-2 block">Spring Type</label>
                                    <select 
                                        value={springType} 
                                        onChange={(e) => setSpringType(e.target.value)}
                                        className="w-full bg-slate-800 border border-slate-600 text-slate-200 text-xs rounded p-2 outline-none focus:border-teal-500"
                                    >
                                        {SPRINGS.map(s => (
                                            <option key={s.name} value={s.name}>{s.name} (Limit: {s.limit}N)</option>
                                        ))}
                                    </select>
                                </div>

                                {/* Force Slider */}
                                <div>
                                    <label className="flex justify-between text-xs font-bold text-slate-300 mb-1">
                                        Applied Force
                                        <span>{load} N</span>
                                    </label>
                                    <input 
                                        type="range" min="0" max="25" step="1" 
                                        value={load} onChange={(e) => setLoad(Number(e.target.value))}
                                        disabled={isBroken}
                                        className="w-full h-2 bg-slate-700 rounded-lg slider-thumb thumb-teal disabled:opacity-50" 
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500 mt-1">
                                        <span>0N</span>
                                        <span>25N (Danger)</span>
                                    </div>
                                </div>

                                {/* Graph */}
                                <div className="h-40 w-full bg-slate-950 border border-slate-700 rounded-lg p-2 relative">
                                    <div className="text-[9px] text-slate-500 absolute top-2 left-2 z-10">Force vs Extension</div>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={graphData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
                                            <XAxis dataKey="x" type="number" tick={{fontSize: 9}} label={{ value: 'x (cm)', position: 'bottom', offset: 0, fontSize: 9 }} />
                                            <YAxis dataKey="f" type="number" tick={{fontSize: 9}} />
                                            <Tooltip 
                                                contentStyle={{backgroundColor: '#1e293b', border: '1px solid #475569', fontSize: '10px'}}
                                                itemStyle={{color: '#2dd4bf'}}
                                                labelFormatter={(x) => `Ext: ${x.toFixed(1)} cm`}
                                            />
                                            {/* Elastic Region */}
                                            <Line type="monotone" dataKey="f" stroke="#2dd4bf" strokeWidth={2} dot={false} />
                                            
                                            {/* Current State Dot */}
                                            {!isBroken && (
                                                <ReferenceDot x={animRef.current.currentExtension} y={load} r={4} fill={load > currentSpring.limit ? "#f43f5e" : "#fff"} stroke="none" />
                                            )}
                                            
                                            {/* Limit Line */}
                                            <ReferenceLine y={currentSpring.limit} stroke="#94a3b8" strokeDasharray="3 3">
                                                <Label value="Limit" position="insideTopRight" fontSize={9} fill="#94a3b8" />
                                            </ReferenceLine>
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>

                                <div className="mt-auto p-3 bg-indigo-900/10 border border-indigo-500/20 rounded-lg">
                                    <h4 className="text-indigo-400 font-bold text-xs mb-1">
                                        Hooke's Law: F = kx
                                    </h4>
                                    <p className="text-[10px] text-slate-400 leading-tight">
                                        Only valid in the straight-line "Elastic Region". Beyond the limit, the spring stretches permanently (Plasticity).
                                    </p>
                                </div>

                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
