<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pressure Law Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; background: #ef4444; cursor: pointer; border: 2px solid #ffffff;
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 300;
    const CANVAS_HEIGHT = 400;
    const FLASK_CENTER_X = 150;
    const FLASK_CENTER_Y = 220;
    const FLASK_RADIUS = 100;
    const PARTICLE_COUNT = 60;

    const App = () => {
        // State
        const [tempC, setTempC] = useState(25); // Celsius (-270 to 300)
        const [pressure, setPressure] = useState(100); // kPa (Calculated)
        const [showExtrapolation, setShowExtrapolation] = useState(false);
        const [particles, setParticles] = useState([]);

        const canvasRef = useRef(null);
        const graphCanvasRef = useRef(null);
        const requestRef = useRef();
        const gaugeRef = useRef(0); // For smooth needle animation

        // Initialize Particles
        useEffect(() => {
            const ps = [];
            for(let i=0; i<PARTICLE_COUNT; i++) {
                // Random point inside circle
                const angle = Math.random() * Math.PI * 2;
                const r = Math.sqrt(Math.random()) * (FLASK_RADIUS - 10);
                ps.push({
                    x: FLASK_CENTER_X + r * Math.cos(angle),
                    y: FLASK_CENTER_Y + r * Math.sin(angle),
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2
                });
            }
            setParticles(ps);
        }, []);

        // Calculate Pressure based on Pressure Law
        // P / T = k  =>  P = k * T
        // Assume P = 100 kPa at 25°C (298.15 K)
        // k = 100 / 298.15 = 0.3354
        useEffect(() => {
            const tempK = tempC + 273.15;
            // Ensure P doesn't go negative if user drags really low (physically impossible for T < 0K)
            const p = Math.max(0, 0.3354 * tempK);
            setPressure(p);
        }, [tempC]);

        // --- Physics Loop ---
        const updatePhysics = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // 1. Clear & Draw Environment
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            
            // Draw Rigid Container (Sphere/Flask)
            ctx.beginPath();
            ctx.arc(FLASK_CENTER_X, FLASK_CENTER_Y, FLASK_RADIUS, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.fill();
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#94a3b8'; // Metal/Glass color
            ctx.stroke();

            // Draw Neck to Gauge
            ctx.fillStyle = '#94a3b8';
            ctx.fillRect(FLASK_CENTER_X - 10, FLASK_CENTER_Y - FLASK_RADIUS - 20, 20, 25);

            // Draw Pressure Gauge Body
            const gaugeY = FLASK_CENTER_Y - FLASK_RADIUS - 50;
            ctx.beginPath();
            ctx.arc(FLASK_CENTER_X, gaugeY, 35, 0, Math.PI * 2);
            ctx.fillStyle = '#1e293b';
            ctx.fill();
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#cbd5e1';
            ctx.stroke();

            // Draw Gauge Ticks
            for(let i=0; i<=6; i++) {
                const angle = Math.PI + (i/6) * Math.PI; // Semicircle from PI to 2PI
                const x1 = FLASK_CENTER_X + 25 * Math.cos(angle);
                const y1 = gaugeY + 25 * Math.sin(angle);
                const x2 = FLASK_CENTER_X + 30 * Math.cos(angle);
                const y2 = gaugeY + 30 * Math.sin(angle);
                ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
            }

            // Draw Gauge Needle
            // Map Pressure 0-250 to Angle PI-2PI
            const targetAngle = Math.PI + (Math.min(pressure, 250) / 250) * Math.PI;
            // Smooth needle
            gaugeRef.current += (targetAngle - gaugeRef.current) * 0.1;
            
            const nx = FLASK_CENTER_X + 28 * Math.cos(gaugeRef.current);
            const ny = gaugeY + 28 * Math.sin(gaugeRef.current);
            
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(FLASK_CENTER_X, gaugeY); ctx.lineTo(nx, ny); ctx.stroke();
            ctx.beginPath(); ctx.arc(FLASK_CENTER_X, gaugeY, 3, 0, Math.PI*2); ctx.fillStyle='#ef4444'; ctx.fill();

            // Draw Heat Source / Ice
            const heaterY = FLASK_CENTER_Y + FLASK_RADIUS + 20;
            if (tempC > 25) {
                // Flame
                const intensity = Math.min(1, (tempC - 25) / 200);
                ctx.fillStyle = `rgba(239, 68, 68, ${intensity})`;
                ctx.beginPath();
                ctx.moveTo(FLASK_CENTER_X - 25, heaterY + 10);
                ctx.lineTo(FLASK_CENTER_X, heaterY - 20);
                ctx.lineTo(FLASK_CENTER_X + 25, heaterY + 10);
                ctx.fill();
                // Glow
                ctx.shadowColor = '#ef4444';
                ctx.shadowBlur = 20 * intensity;
                ctx.shadowBlur = 0;
            } else if (tempC < 25) {
                // Ice
                const intensity = Math.min(1, (25 - tempC) / 200);
                ctx.fillStyle = `rgba(56, 189, 248, ${intensity})`;
                ctx.fillRect(FLASK_CENTER_X - 60, FLASK_CENTER_Y + FLASK_RADIUS + 5, 120, 15);
                ctx.fillStyle = '#bae6fd';
                if(intensity > 0.2) ctx.fillText("❄️ Cooling ❄️", FLASK_CENTER_X - 35, heaterY + 15);
            }

            // 2. Particle Physics
            // Speed factor
            const tempK = tempC + 273.15;
            const speedFactor = Math.sqrt(Math.max(0, tempK)) / 10;
            
            ctx.fillStyle = tempC > 50 ? '#fca5a5' : tempC < 0 ? '#93c5fd' : '#cbd5e1';

            particles.forEach(p => {
                p.x += p.vx * speedFactor;
                p.y += p.vy * speedFactor;

                // Circular Collision (Bounce inside flask)
                const dx = p.x - FLASK_CENTER_X;
                const dy = p.y - FLASK_CENTER_Y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                
                if (dist > FLASK_RADIUS - 5) {
                    // Normalize normal vector
                    const nx = dx / dist;
                    const ny = dy / dist;
                    
                    // Reflect velocity vector: v' = v - 2(v.n)n
                    const dot = p.vx * nx + p.vy * ny;
                    p.vx = p.vx - 2 * dot * nx;
                    p.vy = p.vy - 2 * dot * ny;
                    
                    // Push back inside
                    p.x = FLASK_CENTER_X + nx * (FLASK_RADIUS - 5.1);
                    p.y = FLASK_CENTER_Y + ny * (FLASK_RADIUS - 5.1);
                    
                    // Flash effect on wall? (Optional)
                }

                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            requestRef.current = requestAnimationFrame(updatePhysics);
        };

        // --- Graph Drawing ---
        useEffect(() => {
            const ctx = graphCanvasRef.current?.getContext('2d');
            if (!ctx) return;
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;
            const padding = 40;

            // Clear
            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(0, 0, w, h);

            // Axes Configuration
            // X: Temp -300 to 300
            // Y: Pressure 0 to 250
            const xMin = -300, xMax = 300;
            const yMin = 0, yMax = 250;

            const mapX = (t) => padding + ((t - xMin) / (xMax - xMin)) * (w - 2 * padding);
            const mapY = (p) => h - padding - ((p - yMin) / (yMax - yMin)) * (h - 2 * padding);

            // Draw Axes
            ctx.strokeStyle = '#475569';
            ctx.lineWidth = 1;
            ctx.strokeRect(padding, padding, w - 2 * padding, h - 2 * padding);

            // Zero Lines
            const zeroX = mapX(0);
            const absZeroX = mapX(-273.15);
            
            ctx.strokeStyle = '#64748b';
            ctx.setLineDash([2, 4]);
            // 0 Celsius Line
            ctx.beginPath(); ctx.moveTo(zeroX, padding); ctx.lineTo(zeroX, h - padding); ctx.stroke();
            // Absolute Zero Line
            ctx.strokeStyle = '#ef4444';
            ctx.beginPath(); ctx.moveTo(absZeroX, padding); ctx.lineTo(absZeroX, h - padding); ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#94a3b8';
            ctx.font = '10px Inter';
            ctx.textAlign = 'center';
            ctx.fillText("-273°C", absZeroX, h - 25);
            ctx.fillText("0°C", zeroX, h - 25);
            ctx.fillText("300°C", mapX(300), h - 25);
            ctx.fillText("Temperature (°C)", w/2, h - 10);
            
            ctx.save();
            ctx.translate(15, h/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText("Pressure (kPa)", 0, 0);
            ctx.restore();

            // Draw Theoretical Line (P = kT)
            // P1(T=25) = 100. k = 0.3354
            const getP = (tC) => 0.3354 * (tC + 273.15);
            
            // Point 1: T=300
            const t1 = 300; const p1 = getP(300);
            // Point 2: T=-200 (Limit of slider)
            const t2 = -200; const p2 = getP(-200);

            ctx.beginPath();
            ctx.strokeStyle = '#f87171'; // Red
            ctx.lineWidth = 2;

            ctx.moveTo(mapX(t1), mapY(p1));
            
            if (showExtrapolation) {
                // Solid line to min slider
                ctx.lineTo(mapX(t2), mapY(p2));
                ctx.stroke();

                // Dashed to absolute zero
                ctx.beginPath();
                ctx.setLineDash([5, 5]);
                ctx.moveTo(mapX(t2), mapY(p2));
                ctx.lineTo(mapX(-273.15), mapY(0));
                ctx.stroke();
                ctx.setLineDash([]);
            } else {
                ctx.lineTo(mapX(t2), mapY(p2));
                ctx.stroke();
            }

            // Current Dot
            const cx = mapX(tempC);
            const cy = mapY(pressure);
            ctx.beginPath();
            ctx.arc(cx, cy, 6, 0, Math.PI*2);
            ctx.fillStyle = '#ef4444';
            ctx.fill();
            ctx.stroke();

        }, [tempC, pressure, showExtrapolation]);

        useEffect(() => {
            requestRef.current = requestAnimationFrame(updatePhysics);
            return () => cancelAnimationFrame(requestRef.current);
        }, [tempC]);

        return (
            <div className="min-h-screen bg-slate-900 pb-12 font-sans text-slate-200">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                        <div className="bg-red-500/20 p-2 rounded-lg">
                            <i data-lucide="gauge" className="w-6 h-6 text-red-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Pressure Law Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Gas Laws
                    </div>
                </nav>

                <main className="max-w-6xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
                    
                    {/* Left: Experiment Visual */}
                    <div className="lg:col-span-5 flex flex-col gap-6">
                        <div className="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl flex flex-col items-center">
                            <h2 className="text-red-400 font-bold mb-4 w-full flex items-center">
                                <i data-lucide="flask-round" className="w-5 h-5 mr-2"></i> Rigid Container Setup
                            </h2>
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-auto"
                            />
                            <div className="text-xs text-slate-500 mt-2 text-center">
                                Volume is <strong>CONSTANT</strong>. Heat increases kinetic energy of particles.
                            </div>
                        </div>
                    </div>

                    {/* Right: Controls & Graph */}
                    <div className="lg:col-span-7 space-y-6">
                        
                        {/* Dashboard */}
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-1 h-full bg-red-500"></div>
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Temperature (T)</div>
                                <div className="text-3xl font-bold text-white font-mono">{tempC}°C</div>
                                <div className="text-sm text-red-400">{(tempC + 273.15).toFixed(2)} K</div>
                            </div>
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Pressure (P)</div>
                                <div className="text-3xl font-bold text-white font-mono">{pressure.toFixed(1)}<span className="text-sm ml-1 text-slate-500">kPa</span></div>
                                <div className="text-xs text-slate-500 mt-1">P / T(K) = {(pressure / (tempC+273.15)).toFixed(4)}</div>
                            </div>
                        </div>

                        {/* Slider */}
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <label className="flex justify-between text-sm mb-4 text-slate-300 font-bold">
                                <span>Adjust Temperature</span>
                                <span className={tempC > 25 ? "text-red-400" : "text-blue-400"}>
                                    {tempC > 25 ? "Heating" : "Cooling"}
                                </span>
                            </label>
                            <input 
                                type="range" min="-200" max="300" step="1"
                                value={tempC}
                                onChange={(e) => setTempC(Number(e.target.value))}
                                className="w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb"
                            />
                            <div className="flex justify-between text-xs text-slate-500 mt-2">
                                <span>-200°C</span>
                                <span>25°C</span>
                                <span>300°C</span>
                            </div>
                        </div>

                        {/* Graph */}
                        <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700 shadow-xl relative">
                            <div className="flex justify-between items-center mb-2">
                                <h3 className="text-white font-bold text-sm">Pressure vs. Temperature Graph</h3>
                                <button 
                                    onClick={() => setShowExtrapolation(!showExtrapolation)}
                                    className={`text-xs px-3 py-1 rounded border transition-colors ${showExtrapolation ? 'bg-red-500/20 text-red-400 border-red-500' : 'bg-slate-700 text-slate-400 border-slate-600'}`}
                                >
                                    {showExtrapolation ? "Hide Extrapolation" : "Show Absolute Zero"}
                                </button>
                            </div>
                            <canvas 
                                ref={graphCanvasRef} 
                                width={600} 
                                height={350}
                                className="w-full h-full block rounded-xl bg-slate-900"
                            />
                        </div>

                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    if (typeof lucide !== 'undefined') {
        setTimeout(() => lucide.createIcons(), 100);
    }
</script>
</body>
</html>
