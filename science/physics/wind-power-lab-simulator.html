<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wind Power Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-sky::-webkit-slider-thumb { background: #38bdf8; }
        .thumb-emerald::-webkit-slider-thumb { background: #34d399; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;
    const { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, ReferenceDot } = Recharts;

    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 550;
    
    // Physics Constants
    const RHO = 1.225; // Air Density kg/m^3
    const CP = 0.4;    // Power Coefficient (Efficiency ~40%)

    const App = () => {
        // --- State ---
        const [windSpeed, setWindSpeed] = useState(8); // m/s
        const [bladeLength, setBladeLength] = useState(40); // m
        
        // Stats
        const [powerOutput, setPowerOutput] = useState(0);
        const [sweptArea, setSweptArea] = useState(0);

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Animation State
        const animRef = useRef({
            angle: 0,
            particles: []
        });

        // --- Logic ---
        // P = 0.5 * rho * A * v^3 * Cp
        const calculatePower = (v, r) => {
            const area = Math.PI * r * r;
            return 0.5 * RHO * area * Math.pow(v, 3) * CP;
        };

        useEffect(() => {
            const p = calculatePower(windSpeed, bladeLength);
            setPowerOutput(p);
            setSweptArea(Math.PI * bladeLength * bladeLength);
        }, [windSpeed, bladeLength]);

        // Generate Graph Data (Power vs Wind Speed for current Blade Length)
        const graphData = useMemo(() => {
            const data = [];
            for (let v = 0; v <= 25; v+=2) {
                const p = calculatePower(v, bladeLength);
                data.push({ v: v, p: p / 1000 }); // kW
            }
            return data;
        }, [bladeLength]);

        // --- Animation Loop ---
        const loop = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Physics Update
            // Rotation speed proportional to wind speed (simplified Tip Speed Ratio)
            // omega ~ v / r.  Let's just visually scale it.
            // visual speed = v * 0.02
            const rotationSpeed = windSpeed * 0.015; 
            animRef.current.angle += rotationSpeed;

            // Particle update
            if (animRef.current.particles.length < 50) {
                animRef.current.particles.push({
                    x: -50,
                    y: Math.random() * CANVAS_HEIGHT * 0.8,
                    speed: windSpeed * (0.5 + Math.random() * 0.5), // variation
                    size: Math.random() * 2 + 1
                });
            }
            animRef.current.particles.forEach(p => {
                p.x += p.speed * 2; // Visual scale
                // Reset if off screen
                if (p.x > CANVAS_WIDTH) {
                    p.x = -50;
                    p.y = Math.random() * CANVAS_HEIGHT * 0.8;
                    p.speed = windSpeed * (0.5 + Math.random() * 0.5);
                }
            });

            draw(ctx);
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Drawing ---
        const draw = (ctx) => {
            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw Sky/Ground
            const groundY = CANVAS_HEIGHT - 50;
            const gradSky = ctx.createLinearGradient(0, 0, 0, groundY);
            gradSky.addColorStop(0, '#0f172a');
            gradSky.addColorStop(1, '#1e293b');
            ctx.fillStyle = gradSky;
            ctx.fillRect(0, 0, CANVAS_WIDTH, groundY);

            ctx.fillStyle = '#334155'; // Ground
            ctx.fillRect(0, groundY, CANVAS_WIDTH, 50);

            // Draw Wind Particles
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            animRef.current.particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fill();
                // Trail
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p.x - p.speed*10, p.y); ctx.stroke();
            });

            // Draw Turbine
            const centerX = CANVAS_WIDTH / 2;
            const centerY = groundY - 250; // Hub height
            const scale = 3; // Visual pixel per meter scaling

            // Tower
            ctx.fillStyle = '#94a3b8';
            ctx.beginPath();
            ctx.moveTo(centerX - 5, centerY);
            ctx.lineTo(centerX + 5, centerY);
            ctx.lineTo(centerX + 15, groundY);
            ctx.lineTo(centerX - 15, groundY);
            ctx.fill();

            // Blades (Rotate)
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(animRef.current.angle);

            // Draw 3 Blades
            const visualBladeLen = bladeLength * scale;
            ctx.fillStyle = '#f8fafc';
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                // Simple blade shape
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(15, -visualBladeLen/2, 0, -visualBladeLen);
                ctx.quadraticCurveTo(-15, -visualBladeLen/2, 0, 0);
                ctx.fill();
                ctx.rotate((Math.PI * 2) / 3);
            }
            
            // Hub cap
            ctx.fillStyle = '#e2e8f0';
            ctx.beginPath(); ctx.arc(0, 0, 8, 0, Math.PI*2); ctx.fill();
            
            ctx.restore();

            // Dimensions Visuals
            // Draw swept area circle (dashed)
            ctx.strokeStyle = 'rgba(56, 189, 248, 0.2)';
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, visualBladeLen, 0, Math.PI*2);
            ctx.stroke();
            ctx.setLineDash([]);

            // Radius Label
            ctx.fillStyle = '#38bdf8';
            ctx.font = '12px sans-serif';
            ctx.fillText(`r = ${bladeLength}m`, centerX + visualBladeLen + 10, centerY);
            ctx.beginPath(); 
            ctx.moveTo(centerX, centerY); 
            ctx.lineTo(centerX + visualBladeLen, centerY); 
            ctx.strokeStyle = '#38bdf8'; 
            ctx.stroke();
        };

        useEffect(() => {
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [windSpeed, bladeLength]);

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        // Formatting Power
        const formatPower = (w) => {
            if (w >= 1000000) return (w / 1000000).toFixed(2) + " MW";
            if (w >= 1000) return (w / 1000).toFixed(2) + " kW";
            return w.toFixed(0) + " W";
        };

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-sky-500/20 p-1.5 rounded-lg">
                            <i data-lucide="wind" className="w-5 h-5 text-sky-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Wind Power Formula</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Energy Resources
                    </div>
                </nav>

                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas */}
                        <div className="lg:col-span-3 bg-slate-950 relative border-r border-slate-700">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain"
                            />
                            {/* Overlay Info */}
                            <div className="absolute top-4 left-4">
                                <div className="bg-slate-900/80 backdrop-blur px-3 py-2 rounded-lg border border-slate-700 shadow-lg mb-2">
                                    <div className="text-[10px] text-slate-400 uppercase tracking-wider mb-1">Theoretical Power Output</div>
                                    <div className="text-2xl font-mono font-bold text-emerald-400">{formatPower(powerOutput)}</div>
                                </div>
                            </div>
                        </div>

                        {/* RIGHT: Controls */}
                        <div className="lg:col-span-1 bg-slate-900 border-l border-slate-700 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            {/* Controls */}
                            <div className="p-5 space-y-6">
                                
                                {/* Wind Speed */}
                                <div>
                                    <label className="flex justify-between text-xs font-bold mb-2 text-sky-300">
                                        Wind Speed ($v$)
                                        <span>{windSpeed} m/s</span>
                                    </label>
                                    <input 
                                        type="range" min="0" max="25" step="0.5" 
                                        value={windSpeed} onChange={(e) => setWindSpeed(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg slider-thumb thumb-sky mb-1" 
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500">
                                        <span>Calm</span>
                                        <span>Storm</span>
                                    </div>
                                    <p className="text-[10px] text-slate-400 mt-2">
                                        Power grows as <strong>Cube ($v^3$)</strong>. Doubling speed = 8x Power!
                                    </p>
                                </div>

                                {/* Blade Length */}
                                <div>
                                    <label className="flex justify-between text-xs font-bold mb-2 text-emerald-300">
                                        Blade Length ($r$)
                                        <span>{bladeLength} m</span>
                                    </label>
                                    <input 
                                        type="range" min="10" max="80" step="1" 
                                        value={bladeLength} onChange={(e) => setBladeLength(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg slider-thumb thumb-emerald mb-1" 
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500">
                                        <span>Home</span>
                                        <span>Offshore</span>
                                    </div>
                                    <p className="text-[10px] text-slate-400 mt-2">
                                        Power grows as <strong>Square ($r^2$)</strong>. Affects Swept Area ($A$).
                                    </p>
                                </div>

                                <div className="h-px bg-slate-800 my-2"></div>

                                {/* Area Stats */}
                                <div className="bg-slate-800 p-3 rounded border border-slate-700">
                                    <div className="text-[10px] text-slate-500 mb-1">Swept Area ($A=\pi r^2$)</div>
                                    <div className="font-mono font-bold text-white">{sweptArea.toFixed(0)} mÂ²</div>
                                </div>

                                {/* Graph */}
                                <div className="h-40 w-full bg-slate-950 border border-slate-700 rounded-lg p-2 relative mt-4">
                                    <div className="text-[9px] text-slate-500 absolute top-2 left-2 z-10">Power vs Wind Speed Curve</div>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={graphData} margin={{ top: 20, right: 10, left: -20, bottom: 0 }}>
                                            <XAxis dataKey="v" tick={{fontSize: 10, fill: '#64748b'}} interval={4} />
                                            <YAxis tick={{fontSize: 10, fill: '#64748b'}} />
                                            <Tooltip 
                                                contentStyle={{backgroundColor: '#1e293b', border: '1px solid #475569', fontSize: '10px', color: '#fff'}}
                                                labelFormatter={(v) => `Wind: ${v} m/s`}
                                                formatter={(val) => [`${val.toFixed(0)} kW`, 'Power']}
                                            />
                                            <Line type="monotone" dataKey="p" stroke="#38bdf8" strokeWidth={2} dot={false} />
                                            <ReferenceDot x={windSpeed} y={powerOutput/1000} r={4} fill="#emerald-400" stroke="white" />
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>

                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
