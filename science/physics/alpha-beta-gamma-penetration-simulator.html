<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiation Penetration Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Digital-7&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .digital-font { font-family: 'Courier New', monospace; letter-spacing: -1px; }
        .canvas-container { cursor: default; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 800;
    const CANVAS_HEIGHT = 450;
    const CENTER_Y = CANVAS_HEIGHT / 2;
    
    const SOURCE_X = 100;
    const BARRIER_X = 400;
    const DETECTOR_X = 700;

    const App = () => {
        // --- State ---
        const [sourceType, setSourceType] = useState('alpha'); // alpha, beta, gamma
        const [barrierType, setBarrierType] = useState('none'); // none, paper, aluminium, lead
        const [thickness, setThickness] = useState(5); // mm (visual width)
        const [isRunning, setIsRunning] = useState(true);
        const [soundEnabled, setSoundEnabled] = useState(false);
        
        // Data
        const [cpm, setCpm] = useState(0); // Counts Per Minute
        
        // Use Ref for particles to allow synchronous updates in loop
        const particlesRef = useRef([]);

        const canvasRef = useRef(null);
        const requestRef = useRef();
        const audioCtxRef = useRef(null);
        
        // Refs for loop access to current state
        const paramsRef = useRef({ sourceType, barrierType });

        // Sync params
        useEffect(() => {
            paramsRef.current = { sourceType, barrierType };
            // Clear particles on source change to avoid confusion? Optional.
            // particlesRef.current = []; 
        }, [sourceType, barrierType]);

        // --- Physics Logic ---
        const getPenetrationChance = (type, barrier) => {
            if (barrier === 'none') return 1.0; 

            if (type === 'alpha') {
                if (barrier === 'paper') return 0.0;
                if (barrier === 'aluminium') return 0.0;
                if (barrier === 'lead') return 0.0;
            }
            if (type === 'beta') {
                if (barrier === 'paper') return 0.95;
                if (barrier === 'aluminium') return 0.0;
                if (barrier === 'lead') return 0.0;
            }
            if (type === 'gamma') {
                if (barrier === 'paper') return 1.0;
                if (barrier === 'aluminium') return 0.95;
                if (barrier === 'lead') return 0.1;
            }
            return 1.0;
        };

        // --- Audio ---
        const playClick = () => {
            if (!soundEnabled) return;
            
            if (!audioCtxRef.current) {
                audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtxRef.current.state === 'suspended') audioCtxRef.current.resume();

            const osc = audioCtxRef.current.createOscillator();
            const gain = audioCtxRef.current.createGain();

            osc.type = 'square';
            osc.frequency.value = 800 + Math.random() * 200;
            
            gain.gain.setValueAtTime(0.1, audioCtxRef.current.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtxRef.current.currentTime + 0.05);

            osc.connect(gain);
            gain.connect(audioCtxRef.current.destination);
            
            osc.start();
            osc.stop(audioCtxRef.current.currentTime + 0.05);
        };

        // --- Simulation Loop ---
        const loop = (timestamp) => {
            if (!isRunning) return;

            const { sourceType: currentSource, barrierType: currentBarrier } = paramsRef.current;

            // 1. Spawn Particles
            if (Math.random() < 0.3) {
                particlesRef.current.push({
                    x: SOURCE_X + 40,
                    y: CENTER_Y + (Math.random() - 0.5) * 40,
                    vx: (5 + Math.random() * 2),
                    vy: (Math.random() - 0.5) * 0.5,
                    type: currentSource,
                    dead: false,
                    passed: false
                });
            }

            // 2. Update Particles
            let hits = 0;
            
            particlesRef.current = particlesRef.current.map(p => {
                if (p.dead) return p;

                let nextX = p.x + p.vx;
                let nextY = p.y + p.vy;
                let isDead = false;

                // Barrier Collision
                if (!p.passed && nextX >= BARRIER_X - thickness && nextX <= BARRIER_X + thickness) {
                    const chance = getPenetrationChance(p.type, currentBarrier);
                    if (Math.random() > chance) { // Blocked
                        isDead = true; 
                        nextX = BARRIER_X - Math.random() * 5; 
                    } else {
                        p.passed = true; // Passed through
                    }
                }

                // Detector Collision
                if (nextX >= DETECTOR_X - 20 && nextX <= DETECTOR_X + 20 && Math.abs(nextY - CENTER_Y) < 40) {
                    isDead = true;
                    hits++;
                    playClick();
                }

                // Out of bounds
                if (nextX > CANVAS_WIDTH) isDead = true;

                return { ...p, x: nextX, y: nextY, dead: isDead };
            }).filter(p => p.x < CANVAS_WIDTH + 50 && !(p.dead && Math.random() > 0.9));

            // 3. Update CPM
            if (hits > 0) {
                setCpm(prev => prev + hits * 50); 
            }
            // Decay
            setCpm(prev => Math.max(0, prev * 0.95)); 

            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Rendering ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            const { sourceType: currentSource, barrierType: currentBarrier } = paramsRef.current;

            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // 1. Source Block
            ctx.fillStyle = '#334155';
            ctx.fillRect(SOURCE_X - 40, CENTER_Y - 40, 80, 80);
            ctx.fillStyle = '#facc15';
            ctx.beginPath();
            ctx.moveTo(SOURCE_X, CENTER_Y - 20);
            ctx.lineTo(SOURCE_X + 20, CENTER_Y + 15);
            ctx.lineTo(SOURCE_X - 20, CENTER_Y + 15);
            ctx.fill();
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(currentSource.toUpperCase(), SOURCE_X, CENTER_Y + 50);

            // 2. Barrier
            if (currentBarrier !== 'none') {
                if (currentBarrier === 'paper') ctx.fillStyle = '#fefce8';
                else if (currentBarrier === 'aluminium') ctx.fillStyle = '#94a3b8';
                else if (currentBarrier === 'lead') ctx.fillStyle = '#475569';
                
                ctx.fillRect(BARRIER_X - thickness, CENTER_Y - 100, thickness * 2, 200);
                
                ctx.fillStyle = '#fff';
                ctx.fillText(currentBarrier.charAt(0).toUpperCase() + currentBarrier.slice(1), BARRIER_X, CENTER_Y - 110);
            }

            // 3. Detector
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(DETECTOR_X, CENTER_Y - 40, 80, 80);
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 2;
            ctx.strokeRect(DETECTOR_X, CENTER_Y - 40, 10, 80); 
            ctx.beginPath(); ctx.moveTo(DETECTOR_X + 80, CENTER_Y); ctx.lineTo(CANVAS_WIDTH, CENTER_Y); ctx.stroke();

            // 4. Particles
            particlesRef.current.forEach(p => {
                ctx.beginPath();
                
                if (p.type === 'alpha') {
                    ctx.fillStyle = '#ef4444';
                    ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
                } else if (p.type === 'beta') {
                    ctx.fillStyle = '#3b82f6';
                    ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
                } else {
                    ctx.strokeStyle = '#facc15';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(p.x - 5, p.y);
                    ctx.quadraticCurveTo(p.x, p.y - 3, p.x + 5, p.y);
                    ctx.stroke();
                    return; 
                }
                ctx.fill();
            });
        };

        useEffect(() => {
            if (isRunning) {
                requestRef.current = requestAnimationFrame(loop);
            } else {
                cancelAnimationFrame(requestRef.current);
            }
            return () => cancelAnimationFrame(requestRef.current);
        }, [isRunning]); // No other deps needed for loop

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        // Config buttons
        const setBarrier = (type) => {
            setBarrierType(type);
            if (type === 'paper') setThickness(2);
            else if (type === 'aluminium') setThickness(10);
            else if (type === 'lead') setThickness(40);
        };

        return (
            <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-12">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                    <div className="flex items-center space-x-3">
                        <div className="bg-yellow-500/20 p-2 rounded-lg">
                            <i data-lucide="radio" className="w-6 h-6 text-yellow-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Radiation Penetration Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Nuclear Physics
                    </div>
                </nav>

                <main className="max-w-6xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Left: Simulation Canvas */}
                    <div className="lg:col-span-9 flex flex-col gap-6">
                        <div className="bg-slate-950 rounded-2xl border border-slate-700 p-1 shadow-2xl relative overflow-hidden h-[450px]">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain bg-slate-950 rounded-xl"
                            />
                            
                            {/* Counter Display */}
                            <div className="absolute top-4 right-4 bg-black border-2 border-slate-600 rounded-lg p-4 shadow-lg w-48">
                                <div className="text-xs text-slate-400 uppercase font-bold mb-1">Geiger Counter</div>
                                <div className="font-mono text-3xl text-emerald-400 text-right">{Math.floor(cpm)} <span className="text-sm text-slate-500">CPM</span></div>
                                <div className="w-full h-2 bg-slate-800 mt-2 rounded-full overflow-hidden">
                                    <div className="h-full bg-emerald-500 transition-all duration-100" style={{width: `${Math.min(100, cpm/50)}%`}}></div>
                                </div>
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 flex flex-wrap gap-8 items-start">
                            
                            {/* Source Select */}
                            <div className="space-y-3">
                                <h3 className="text-xs font-bold text-slate-400 uppercase">Radiation Source</h3>
                                <div className="flex gap-2">
                                    <button onClick={() => setSourceType('alpha')} className={`px-4 py-2 rounded text-sm font-bold border transition ${sourceType==='alpha' ? 'bg-red-600 border-red-500 text-white' : 'bg-slate-700 border-slate-600 text-slate-300'}`}>Alpha (α)</button>
                                    <button onClick={() => setSourceType('beta')} className={`px-4 py-2 rounded text-sm font-bold border transition ${sourceType==='beta' ? 'bg-blue-600 border-blue-500 text-white' : 'bg-slate-700 border-slate-600 text-slate-300'}`}>Beta (β)</button>
                                    <button onClick={() => setSourceType('gamma')} className={`px-4 py-2 rounded text-sm font-bold border transition ${sourceType==='gamma' ? 'bg-yellow-600 border-yellow-500 text-white' : 'bg-slate-700 border-slate-600 text-slate-300'}`}>Gamma (γ)</button>
                                </div>
                            </div>

                            {/* Barrier Select */}
                            <div className="space-y-3">
                                <h3 className="text-xs font-bold text-slate-400 uppercase">Barrier Material</h3>
                                <div className="flex gap-2">
                                    <button onClick={() => setBarrier('none')} className={`px-3 py-2 rounded text-sm font-bold border transition ${barrierType==='none' ? 'bg-slate-600 border-slate-400 text-white' : 'bg-slate-700 border-slate-600 text-slate-300'}`}>None</button>
                                    <button onClick={() => setBarrier('paper')} className={`px-3 py-2 rounded text-sm font-bold border transition ${barrierType==='paper' ? 'bg-white text-slate-900 border-white' : 'bg-slate-700 border-slate-600 text-slate-300'}`}>Paper</button>
                                    <button onClick={() => setBarrier('aluminium')} className={`px-3 py-2 rounded text-sm font-bold border transition ${barrierType==='aluminium' ? 'bg-slate-400 text-slate-900 border-slate-400' : 'bg-slate-700 border-slate-600 text-slate-300'}`}>Aluminium</button>
                                    <button onClick={() => setBarrier('lead')} className={`px-3 py-2 rounded text-sm font-bold border transition ${barrierType==='lead' ? 'bg-slate-800 text-white border-slate-500' : 'bg-slate-700 border-slate-600 text-slate-300'}`}>Lead</button>
                                </div>
                            </div>

                            <div className="flex-1 flex justify-end items-center gap-4 pt-6">
                                <label className="flex items-center gap-2 cursor-pointer bg-slate-700/50 px-3 py-2 rounded-lg border border-slate-600 hover:bg-slate-700 transition">
                                    <div className="flex items-center gap-2">
                                        <i data-lucide={soundEnabled ? "volume-2" : "volume-x"} className="w-4 h-4 text-slate-400"></i>
                                        <span className="text-sm font-bold text-slate-300">Audio</span>
                                    </div>
                                    <input type="checkbox" checked={soundEnabled} onChange={() => setSoundEnabled(!soundEnabled)} className="w-5 h-5 rounded text-emerald-500 focus:ring-0" />
                                </label>
                                
                                <button 
                                    onClick={() => { setIsRunning(!isRunning); particlesRef.current = []; }}
                                    className={`px-6 py-2 rounded-lg font-bold text-sm shadow-lg transition-all flex items-center gap-2 ${isRunning ? 'bg-slate-700 text-slate-300' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}`}
                                >
                                    <i data-lucide={isRunning ? "pause" : "play"} className="w-4 h-4"></i>
                                    {isRunning ? "Pause" : "Start"}
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Right: Info */}
                    <div className="lg:col-span-3 space-y-6">
                        
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <h2 className="text-white font-bold mb-4 flex items-center">
                                <i data-lucide="info" className="w-5 h-5 mr-2 text-indigo-400"></i>
                                Properties
                            </h2>
                            
                            <div className="space-y-4 text-sm text-slate-300">
                                <div className="p-3 bg-red-900/10 border border-red-500/20 rounded-lg">
                                    <strong className="text-red-400 block mb-1">Alpha (α)</strong>
                                    <p className="text-xs">Helium nuclei (2p, 2n). Heavy, slow, highly ionizing. Stopped by paper.</p>
                                </div>
                                <div className="p-3 bg-blue-900/10 border border-blue-500/20 rounded-lg">
                                    <strong className="text-blue-400 block mb-1">Beta (β)</strong>
                                    <p className="text-xs">High-speed electrons. Lighter, faster. Stopped by aluminium.</p>
                                </div>
                                <div className="p-3 bg-yellow-900/10 border border-yellow-500/20 rounded-lg">
                                    <strong className="text-yellow-400 block mb-1">Gamma (γ)</strong>
                                    <p className="text-xs">Electromagnetic waves (Photons). Very penetrating. Reduced by thick lead.</p>
                                </div>
                            </div>
                        </div>

                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
