<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potential Divider Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-amber::-webkit-slider-thumb { background: #f59e0b; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .circuit-line { stroke: #94a3b8; stroke-width: 2; fill: none; }
        .resistor-path { stroke: #cbd5e1; stroke-width: 6; stroke-linecap: round; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 550;
    
    // Circuit Layout Constants
    const SCHEMATIC_X = 200;
    const REALISTIC_X = 600;
    const CENTER_Y = CANVAS_HEIGHT / 2;

    const App = () => {
        // --- State ---
        const [vin, setVin] = useState(12); // Input Voltage (V)
        const [sliderPos, setSliderPos] = useState(50); // 0 (Bottom) to 100 (Top)
        const [totalR, setTotalR] = useState(10); // Total Resistance kOhm
        const [loadConnected, setLoadConnected] = useState(false);
        const [loadR, setLoadR] = useState(10); // Load Resistance kOhm

        const canvasRef = useRef(null);
        const requestRef = useRef();

        // --- Calculations ---
        const physics = useMemo(() => {
            // R1 is Top part, R2 is Bottom part (where Vout is measured)
            // sliderPos 100 = Top (R1=0, R2=Total) -> Vout = Vin
            // sliderPos 0 = Bottom (R1=Total, R2=0) -> Vout = 0
            
            const r2_raw = (sliderPos / 100) * totalR; 
            const r1_raw = totalR - r2_raw;

            let r2_effective = r2_raw;
            let parallelR = null;

            // Load Effect
            if (loadConnected) {
                // R2 is in parallel with Load
                // 1/Req = 1/R2 + 1/RL
                if (r2_raw > 0) {
                    r2_effective = (r2_raw * loadR) / (r2_raw + loadR);
                    parallelR = r2_effective;
                } else {
                    r2_effective = 0;
                }
            }

            const total_circuit_R = r1_raw + r2_effective;
            const current = total_circuit_R > 0 ? vin / total_circuit_R : 0; // mA (since R is kOhm)
            const vout = current * r2_effective;

            return {
                r1: r1_raw,
                r2: r2_raw,
                r2_eff: r2_effective,
                vout,
                current
            };
        }, [vin, sliderPos, totalR, loadConnected, loadR]);

        // --- Drawing ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // --- 1. Schematic Diagram (Left) ---
            const sx = SCHEMATIC_X;
            const sy = CENTER_Y;
            const w = 120;
            const h = 200;

            // Main Loop
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Battery (Left side)
            ctx.moveTo(sx - w, sy - h/2); ctx.lineTo(sx - w, sy + h/2); // Left vertical wire
            // Top Wire
            ctx.moveTo(sx - w, sy - h/2); ctx.lineTo(sx, sy - h/2);
            // Bottom Wire
            ctx.moveTo(sx - w, sy + h/2); ctx.lineTo(sx, sy + h/2);
            ctx.stroke();

            // Battery Symbol
            drawBattery(ctx, sx - w, sy, vin);

            // Resistor (Vertical Zigzag)
            drawResistor(ctx, sx, sy - h/2, sx, sy + h/2);

            // Potentiometer Slider Arrow
            // Map sliderPos (0-100) to Y position (bottom to top)
            const sliderY = (sy + h/2) - (sliderPos / 100) * h;
            
            ctx.strokeStyle = '#f59e0b'; // Amber
            ctx.lineWidth = 3;
            ctx.beginPath();
            // Arrow pointing to resistor
            ctx.moveTo(sx + 30, sliderY); ctx.lineTo(sx, sliderY);
            // Arrowhead
            ctx.moveTo(sx + 5, sliderY - 5); ctx.lineTo(sx, sliderY); ctx.lineTo(sx + 5, sliderY + 5);
            ctx.stroke();

            // Output Circuit (Vout)
            ctx.strokeStyle = '#38bdf8'; // Sky blue
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Top Vout wire (from slider)
            ctx.moveTo(sx + 30, sliderY); ctx.lineTo(sx + 80, sliderY);
            // Bottom Vout wire (from ground)
            ctx.moveTo(sx, sy + h/2); ctx.lineTo(sx + 80, sy + h/2);
            ctx.stroke();

            // Voltmeter
            drawVoltmeter(ctx, sx + 80, (sliderY + (sy + h/2)) / 2, physics.vout);
            
            // Connect Voltmeter
            ctx.beginPath();
            ctx.moveTo(sx + 80, sliderY); ctx.lineTo(sx + 80, (sliderY + (sy + h/2)) / 2 - 20);
            ctx.moveTo(sx + 80, sy + h/2); ctx.lineTo(sx + 80, (sliderY + (sy + h/2)) / 2 + 20);
            ctx.stroke();

            // Load (Bulb) if connected
            if (loadConnected) {
                const lx = sx + 140;
                const ly = (sliderY + (sy + h/2)) / 2;
                
                ctx.strokeStyle = '#e2e8f0';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                // Top wire
                ctx.moveTo(sx + 80, sliderY); ctx.lineTo(lx, sliderY); ctx.lineTo(lx, ly - 20);
                // Bottom wire
                ctx.moveTo(sx + 80, sy + h/2); ctx.lineTo(lx, sy + h/2); ctx.lineTo(lx, ly + 20);
                ctx.stroke();
                ctx.setLineDash([]);

                // Draw Bulb
                drawBulb(ctx, lx, ly, physics.vout);
            }

            // --- 2. Realistic View (Right) ---
            const rx = REALISTIC_X;
            const ry = CENTER_Y;
            const rw = 40; // resistor width
            const rh = 250; // resistor height

            // Draw Resistor Body
            const grad = ctx.createLinearGradient(rx - rw/2, 0, rx + rw/2, 0);
            grad.addColorStop(0, '#334155');
            grad.addColorStop(0.5, '#475569');
            grad.addColorStop(1, '#334155');
            ctx.fillStyle = grad;
            ctx.fillRect(rx - rw/2, ry - rh/2, rw, rh);
            
            // Wire windings visual
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;
            for(let i=0; i<rh; i+=4) {
                ctx.beginPath(); ctx.moveTo(rx - rw/2, ry - rh/2 + i); ctx.lineTo(rx + rw/2, ry - rh/2 + i + 2); ctx.stroke();
            }

            // Slider Handle (Physical)
            const handleY = (ry + rh/2) - (sliderPos / 100) * rh;
            ctx.fillStyle = '#f59e0b';
            ctx.fillRect(rx - rw/2 - 10, handleY - 10, rw + 20, 20);
            
            // Terminals
            // Top (Vin)
            drawTerminal(ctx, rx, ry - rh/2 - 10, '#ef4444'); // Red
            // Bottom (GND)
            drawTerminal(ctx, rx, ry + rh/2 + 10, '#000000'); // Black
            // Slider (Vout)
            drawTerminal(ctx, rx + rw/2 + 15, handleY, '#38bdf8'); // Blue

            // Wires connecting terminals
            ctx.strokeStyle = '#ef4444'; ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(rx, ry - rh/2 - 10); ctx.lineTo(rx, ry - rh/2 - 50); ctx.stroke();
            ctx.fillStyle = '#ef4444'; ctx.fillText(`+${vin}V`, rx - 10, ry - rh/2 - 60);

            ctx.strokeStyle = '#64748b'; ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(rx, ry + rh/2 + 10); ctx.lineTo(rx, ry + rh/2 + 50); ctx.stroke();
            ctx.fillStyle = '#94a3b8'; ctx.fillText(`0V`, rx - 5, ry + rh/2 + 65);

            // Output Wire
            ctx.strokeStyle = '#38bdf8';
            ctx.beginPath(); 
            // Curve wire from slider to right
            ctx.moveTo(rx + rw/2 + 15, handleY); 
            ctx.bezierCurveTo(rx + 100, handleY, rx + 100, ry, rx + 150, ry);
            ctx.stroke();

            // Label Physical R1/R2
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'right';
            if (sliderPos < 95) ctx.fillText(`R1: ${physics.r1.toFixed(1)}kΩ`, rx - 40, (ry - rh/2 + handleY)/2);
            if (sliderPos > 5) ctx.fillText(`R2: ${physics.r2.toFixed(1)}kΩ`, rx - 40, (ry + rh/2 + handleY)/2);

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText("Schematic Diagram", sx, 50);
            ctx.fillText("Physical Wiring", rx, 50);
        };

        // --- Drawing Helpers ---
        const drawBattery = (ctx, x, y, v) => {
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            const h = 20;
            // Clear wire behind
            ctx.clearRect(x-10, y-15, 20, 30);
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(x-10, y-15, 20, 30);
            
            // Long line (Positive)
            ctx.beginPath(); ctx.moveTo(x-10, y-10); ctx.lineTo(x+10, y-10); ctx.stroke();
            // Short line (Negative)
            ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(x-6, y+5); ctx.lineTo(x+6, y+5); ctx.stroke();
            
            ctx.font = '12px monospace'; ctx.fillStyle = '#cbd5e1'; 
            ctx.fillText(`${v}V`, x - 30, y);
        };

        const drawResistor = (ctx, x, y1, x2, y2) => {
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 2;
            ctx.beginPath();
            const h = y2 - y1;
            const step = h / 10;
            ctx.moveTo(x, y1);
            for(let i=1; i<10; i++) {
                const offset = (i%2 === 0) ? -8 : 8;
                ctx.lineTo(x + offset, y1 + i*step);
            }
            ctx.lineTo(x, y2);
            ctx.stroke();
        };

        const drawVoltmeter = (ctx, x, y, v) => {
            ctx.fillStyle = '#020617';
            ctx.strokeStyle = '#38bdf8';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.arc(x, y, 20, 0, Math.PI*2); ctx.fill(); ctx.stroke();
            
            ctx.fillStyle = '#38bdf8';
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(v.toFixed(1) + "V", x, y + 4);
        };

        const drawTerminal = (ctx, x, y, color) => {
            ctx.fillStyle = color;
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1;
            ctx.beginPath(); ctx.arc(x, y, 6, 0, Math.PI*2); ctx.fill(); ctx.stroke();
        };

        const drawBulb = (ctx, x, y, v) => {
            // Brightness based on V
            // Max brightness at 12V?
            const brightness = Math.min(1, v / 12);
            
            ctx.fillStyle = `rgba(253, 224, 71, ${0.1 + brightness * 0.9})`; // Yellow glow
            ctx.shadowColor = '#facc15';
            ctx.shadowBlur = brightness * 30;
            
            ctx.beginPath(); ctx.arc(x, y, 15, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;
            
            ctx.strokeStyle = '#fbbf24';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Filament
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 1;
            ctx.beginPath(); 
            ctx.moveTo(x-8, y+10); 
            ctx.lineTo(x-5, y); 
            ctx.lineTo(x, y-5);
            ctx.lineTo(x+5, y);
            ctx.lineTo(x+8, y+10);
            ctx.stroke();
        };

        useEffect(() => {
            draw();
        }, [physics, sliderPos]); // Redraw on calculation update

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        // Safe percentage calc
        const ratioPercent = (physics.r1 + physics.r2_eff) > 0 
            ? (physics.r2_eff / (physics.r1 + physics.r2_eff) * 100).toFixed(1) 
            : "0.0";

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-amber-500/20 p-1.5 rounded-lg">
                            <i data-lucide="zap" className="w-5 h-5 text-amber-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Potential Divider Lab</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Circuit Theory
                    </div>
                </nav>

                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas */}
                        <div className="lg:col-span-3 bg-slate-950 relative border-r border-slate-700">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain"
                            />
                            {/* Drag Instructions Overlay */}
                            <div className="absolute top-1/2 left-[60%] -translate-x-1/2 mt-32 text-[10px] text-slate-500 pointer-events-none animate-pulse">
                                Use slider on right to move &uarr;
                            </div>
                        </div>

                        {/* RIGHT: Controls */}
                        <div className="lg:col-span-1 bg-slate-900 border-l border-slate-700 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            {/* 1. Results */}
                            <div className="p-4 bg-slate-800/50 border-b border-slate-700 backdrop-blur sticky top-0 z-10">
                                <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Output ($V_{out}$)</h3>
                                <div className="bg-slate-900 p-4 rounded-xl border border-slate-700 text-center">
                                    <div className="text-4xl font-mono font-bold text-sky-400">{physics.vout.toFixed(2)} V</div>
                                    <div className="text-[10px] text-slate-500 mt-1">
                                        Ratio: {ratioPercent}% of $V_{in}$
                                    </div>
                                </div>
                            </div>

                            {/* 2. Primary Controls */}
                            <div className="p-5 space-y-6 flex-1">
                                
                                {/* Slider Position (Potentiometer) */}
                                <div>
                                    <label className="flex justify-between text-xs font-bold text-amber-400 mb-2">
                                        Slider Position
                                        <span>{sliderPos}%</span>
                                    </label>
                                    <div className="flex items-center gap-2">
                                        <span className="text-[10px] text-slate-500">0V</span>
                                        <input 
                                            type="range" min="0" max="100" step="1" 
                                            value={sliderPos} onChange={(e) => setSliderPos(Number(e.target.value))}
                                            className="flex-1 h-3 bg-slate-700 rounded-lg slider-thumb thumb-amber" 
                                        />
                                        <span className="text-[10px] text-slate-500">Max</span>
                                    </div>
                                    <p className="text-[10px] text-slate-400 mt-1">
                                        Moves the contact point Up/Down.
                                    </p>
                                </div>

                                <div className="h-px bg-slate-800"></div>

                                {/* Input Voltage */}
                                <div>
                                    <label className="flex justify-between text-xs font-bold text-slate-300 mb-1">
                                        Input Voltage ($V_{in}$)
                                        <span className="font-mono">{vin}V</span>
                                    </label>
                                    <input 
                                        type="range" min="1" max="24" step="1" 
                                        value={vin} onChange={(e) => setVin(Number(e.target.value))}
                                        className="w-full h-1.5 bg-slate-700 rounded-lg slider-thumb" 
                                    />
                                </div>

                                {/* Load Control */}
                                <div className="bg-slate-800 p-3 rounded border border-slate-700">
                                    <div className="flex items-center justify-between mb-3">
                                        <span className="text-xs font-bold text-white flex items-center gap-2">
                                            <i data-lucide="lightbulb" className="w-4 h-4 text-yellow-400"></i>
                                            External Load
                                        </span>
                                        <button 
                                            onClick={() => setLoadConnected(!loadConnected)}
                                            className={`px-3 py-1 rounded text-[10px] font-bold transition ${loadConnected ? 'bg-green-600 text-white' : 'bg-slate-700 text-slate-400'}`}
                                        >
                                            {loadConnected ? "ON" : "OFF"}
                                        </button>
                                    </div>
                                    
                                    {loadConnected && (
                                        <div className="animate-in fade-in slide-in-from-top-1">
                                            <label className="flex justify-between text-[10px] text-slate-400 mb-1">
                                                Load Resistance ($R_L$)
                                                <span>{loadR} kΩ</span>
                                            </label>
                                            <input 
                                                type="range" min="1" max="50" step="1" 
                                                value={loadR} onChange={(e) => setLoadR(Number(e.target.value))}
                                                className="w-full h-1.5 bg-slate-900 rounded-lg slider-thumb" 
                                            />
                                            <p className="text-[9px] text-rose-400 mt-2 leading-tight">
                                                <strong>Notice:</strong> Connecting a load lowers $V_{out}$ because it reduces the effective resistance of the bottom section.
                                            </p>
                                        </div>
                                    )}
                                </div>

                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
