<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Parallax Lab | Luminous Learner</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-indigo::-webkit-slider-thumb { background: #6366f1; }
        .canvas-container { cursor: crosshair; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 500;
    const CENTER_Y = CANVAS_HEIGHT / 2;
    // Split screen setup
    const VIEW_1_WIDTH = CANVAS_WIDTH * 0.6; // Top down view
    const VIEW_2_START = VIEW_1_WIDTH; // Telescope view start

    const App = () => {
        // --- State ---
        const [starDistance, setStarDistance] = useState(150); // Pixel distance from Sun
        const [isPaused, setIsPaused] = useState(false);
        const [showLines, setShowLines] = useState(true);
        
        // Real-time Data
        const [month, setMonth] = useState("Jan");
        const [parallaxAngle, setParallaxAngle] = useState(0); // Arcseconds (simulated)

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Physics Logic Refs (Mutable)
        const simRef = useRef({
            earthAngle: 0, // Radians
            speed: 0.005,
        });

        // --- Logic ---
        const loop = () => {
            if (!isPaused) {
                simRef.current.earthAngle += simRef.current.speed;
            }
            
            // Calculate Month based on angle (0 = Jan, PI = July)
            const deg = (simRef.current.earthAngle % (2 * Math.PI)) * (180 / Math.PI);
            const monthIndex = Math.floor((deg / 360) * 12);
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            setMonth(months[monthIndex] || "Jan");

            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Rendering ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.fillStyle = '#020617'; // Darker slate for space
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // --- 1. LEFT PANEL: Top-Down Solar System ---
            // Draw Divider
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(VIEW_1_WIDTH, 0);
            ctx.lineTo(VIEW_1_WIDTH, CANVAS_HEIGHT);
            ctx.stroke();

            const sunX = VIEW_1_WIDTH / 2;
            const sunY = CANVAS_HEIGHT - 100; // Sun at bottom
            const earthOrbitRadius = 80;

            // Background Stars (Distant)
            drawBackgroundStars(ctx, 0, 0, VIEW_1_WIDTH, CANVAS_HEIGHT - 150);

            // Sun
            ctx.fillStyle = '#f59e0b'; // Amber Sun
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#f59e0b';
            ctx.beginPath(); ctx.arc(sunX, sunY, 20, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // Earth Orbit Path
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 1;
            ctx.beginPath(); ctx.arc(sunX, sunY, earthOrbitRadius, 0, Math.PI*2); ctx.stroke();

            // Earth Position
            const ex = sunX + Math.cos(simRef.current.earthAngle - Math.PI/2) * earthOrbitRadius;
            const ey = sunY + Math.sin(simRef.current.earthAngle - Math.PI/2) * earthOrbitRadius;

            // Draw Earth
            ctx.fillStyle = '#3b82f6'; // Blue Earth
            ctx.beginPath(); ctx.arc(ex, ey, 8, 0, Math.PI*2); ctx.fill();

            // Target Star Position (Controlled by Slider)
            // The star is "above" the solar system in this 2D projection
            const starX = sunX; 
            const starY = sunY - 150 - starDistance; // Base distance + slider

            // Draw Target Star (Pink)
            ctx.fillStyle = '#f43f5e';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#f43f5e';
            ctx.beginPath();
            
            // Star shape
            drawStar(ctx, starX, starY, 5, 8, 4);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Line of Sight (Earth to Star)
            if (showLines) {
                ctx.strokeStyle = 'rgba(244, 63, 94, 0.4)'; // Pink transparent
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(ex, ey);
                ctx.lineTo(starX, starY);
                // Extend line to "background" (top of screen)
                // Calculate slope
                const slope = (starY - ey) / (starX - ex);
                // y = mx + c => c = y - mx
                // Intersection with y = 50 (background plane)
                const bgY = 50;
                // x = (y - c) / m
                // Need to handle vertical line case
                let bgX = starX;
                if (Math.abs(starX - ex) > 0.1) {
                     const c = ey - slope * ex;
                     bgX = (bgY - c) / slope;
                }
                ctx.lineTo(bgX, bgY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw Background Plane Line
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.beginPath(); ctx.moveTo(50, bgY); ctx.lineTo(VIEW_1_WIDTH-50, bgY); ctx.stroke();
            }

            // --- 2. RIGHT PANEL: Telescope View ---
            const view2W = CANVAS_WIDTH - VIEW_1_WIDTH;
            const center2X = VIEW_1_WIDTH + view2W / 2;
            const center2Y = CANVAS_HEIGHT / 2;

            // Draw Telescope Circle Mask
            ctx.save();
            ctx.beginPath();
            ctx.arc(center2X, center2Y, 180, 0, Math.PI*2);
            ctx.clip();

            // Sky Background
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(VIEW_1_WIDTH, 0, view2W, CANVAS_HEIGHT);

            // Background Stars (Fixed in telescope view)
            drawBackgroundStars(ctx, VIEW_1_WIDTH, 0, view2W, CANVAS_HEIGHT);

            // Calculate Parallax Shift
            // Shift depends on Earth's X position relative to Sun
            // Max shift happens when Earth is max Left/Right
            // Parallax Angle approx = Baseline / Distance
            const baseline = ex - sunX; // -80 to +80
            // The visual shift is inversely proportional to distance
            const shiftFactor = 8000 / (starDistance + 150); 
            const apparentX = center2X - (baseline * shiftFactor / 80) * 15; 
            
            // Update Data State (Simulated Angle)
            // Angle = arctan(1 AU / d)
            // Just for display, map slider 0-300 to realistic-ish arcseconds
            // Closer (0) = Larger angle. 
            const simulatedAngle = 1000 / (starDistance + 50);
            
            // Draw Target Star in Telescope
            ctx.fillStyle = '#f43f5e'; // Pink
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#f43f5e';
            ctx.beginPath();
            drawStar(ctx, apparentX, center2Y, 5, 12, 6);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Crosshair
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(center2X, center2Y - 20); ctx.lineTo(center2X, center2Y + 20);
            ctx.moveTo(center2X - 20, center2Y); ctx.lineTo(center2X + 20, center2Y);
            ctx.stroke();

            ctx.restore(); // End Clip

            // Labels
            ctx.fillStyle = '#94a3b8';
            ctx.font = "bold 14px sans-serif";
            ctx.fillText("Top-Down View", 20, 30);
            ctx.fillText("Telescope View", VIEW_1_WIDTH + 20, 30);

            // Sync React State (throttle slightly usually good, but here ok)
            setParallaxAngle(simulatedAngle);
        };

        const drawStar = (ctx, cx, cy, spikes, outerRadius, innerRadius) => {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            let step = Math.PI / spikes;

            ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
        }

        // Static background stars cache? Or just random draw (performance is fine for this count)
        const starsCache = useRef([]);
        if (starsCache.current.length === 0) {
            for(let i=0; i<100; i++) {
                starsCache.current.push({
                    x: Math.random(),
                    y: Math.random(),
                    size: Math.random() * 2
                });
            }
        }

        const drawBackgroundStars = (ctx, startX, startY, w, h) => {
            ctx.fillStyle = '#ffffff';
            starsCache.current.forEach(s => {
                // Map 0-1 to actual coords
                const sx = startX + s.x * w;
                const sy = startY + s.y * h;
                ctx.globalAlpha = 0.3 + Math.random() * 0.5; // Twinkle
                ctx.beginPath();
                ctx.arc(sx, sy, s.size, 0, Math.PI*2);
                ctx.fill();
            });
            ctx.globalAlpha = 1.0;
        }

        useEffect(() => {
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [isPaused, starDistance, showLines]); // Dependencies

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        return (
            <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-12">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                    <div className="flex items-center space-x-3">
                        <div className="bg-indigo-500/20 p-2 rounded-lg">
                            <i data-lucide="telescope" className="w-6 h-6 text-indigo-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Stellar Parallax Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Astrophysics
                    </div>
                </nav>

                <main className="max-w-7xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Left: Simulation Canvas */}
                    <div className="lg:col-span-12">
                        <div className="bg-slate-950 rounded-2xl border border-slate-700 p-1 shadow-2xl relative overflow-hidden h-[500px]">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain bg-slate-950 rounded-xl canvas-container"
                            />
                            
                            {/* Overlay Info */}
                            <div className="absolute top-4 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur px-4 py-2 rounded-lg border border-slate-700 text-xs shadow-lg flex gap-6">
                                <div className="text-center">
                                    <div className="text-slate-400 uppercase text-[10px] font-bold">Current Month</div>
                                    <div className="text-white font-mono text-lg font-bold w-12">{month}</div>
                                </div>
                                <div className="w-px bg-slate-700"></div>
                                <div className="text-center">
                                    <div className="text-slate-400 uppercase text-[10px] font-bold">Parallax Angle ($p$)</div>
                                    <div className="text-emerald-400 font-mono text-lg font-bold">{parallaxAngle.toFixed(2)}"</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="lg:col-span-8 flex flex-col gap-6">
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                            
                            {/* Distance Slider */}
                            <div>
                                <label className="flex justify-between text-xs text-indigo-300 font-bold mb-2">
                                    Star Distance (Light Years)
                                    <span>{((starDistance + 50) / 10).toFixed(1)} ly</span>
                                </label>
                                <div className="relative flex items-center gap-4">
                                    <span className="text-xs text-slate-500">Near</span>
                                    <input 
                                        type="range" min="0" max="300" step="1" 
                                        value={starDistance} onChange={(e) => setStarDistance(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg slider-thumb thumb-indigo" 
                                    />
                                    <span className="text-xs text-slate-500">Far</span>
                                </div>
                                <p className="text-[11px] text-slate-400 mt-2">
                                    Drag to change how far the target star (pink) is from Earth.
                                </p>
                            </div>

                            {/* Toggles */}
                            <div className="flex gap-4 justify-end">
                                <button 
                                    onClick={() => setIsPaused(!isPaused)}
                                    className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg ${!isPaused ? 'bg-slate-700 hover:bg-slate-600 text-white' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}`}
                                >
                                    <i data-lucide={isPaused ? "play" : "pause"} className="w-5 h-5"></i>
                                    {isPaused ? "Resume Orbit" : "Pause Orbit"}
                                </button>
                                
                                <label className="flex items-center gap-3 p-3 bg-slate-700/50 rounded-lg border border-slate-600 cursor-pointer hover:bg-slate-700 transition select-none">
                                    <input 
                                        type="checkbox" 
                                        checked={showLines} 
                                        onChange={() => setShowLines(!showLines)}
                                        className="w-5 h-5 rounded text-indigo-500 bg-slate-800 border-slate-500 focus:ring-0"
                                    />
                                    <span className="text-sm font-bold text-slate-300">Show Sight Lines</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    {/* Right: Educational Context */}
                    <div className="lg:col-span-4 flex flex-col gap-4">
                        <div className="bg-indigo-900/10 border border-indigo-500/20 p-5 rounded-2xl">
                            <h3 className="text-indigo-300 font-bold text-sm mb-2 flex items-center">
                                <i data-lucide="eye" className="w-4 h-4 mr-2"></i> What am I seeing?
                            </h3>
                            <p className="text-xs text-slate-300 leading-relaxed mb-4">
                                <strong>Left:</strong> Top-down view of our Solar System. The pink star is the "Target". The background line represents distant stars that never move.
                            </p>
                            <p className="text-xs text-slate-300 leading-relaxed">
                                <strong>Right:</strong> What the telescope sees. Notice how the pink star "wobbles" left and right against the background stars as Earth moves from January to June.
                            </p>
                        </div>

                        <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700">
                             <h3 className="text-slate-200 font-bold text-sm mb-3">Lab Challenge</h3>
                             <ul className="text-xs text-slate-400 space-y-2 list-disc pl-4">
                                <li>Pause the simulation in <strong>January</strong> (Left side). Note the star's position.</li>
                                <li>Wait for <strong>July</strong> (Right side). Note the shift.</li>
                                <li><strong>Experiment:</strong> Increase the "Star Distance". Does the star wobble <em>more</em> or <em>less</em>?</li>
                             </ul>
                        </div>
                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
