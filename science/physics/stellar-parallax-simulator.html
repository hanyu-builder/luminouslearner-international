<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Parallax Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; /* Prevent body scroll inside iframe */ }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-indigo::-webkit-slider-thumb { background: #6366f1; }
        .canvas-container { cursor: crosshair; }
        
        /* Custom Scrollbar for sidebar if height exceeds */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Internal resolution (High res for sharpness, scaled down by CSS)
    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 550; // Slightly taller to fit telescope view comfortably
    
    // Split screen setup
    const VIEW_1_WIDTH = CANVAS_WIDTH * 0.55; // 55% for Solar System
    // View 2 (Telescope) takes the rest

    const App = () => {
        // --- State ---
        const [starDistance, setStarDistance] = useState(150); // Pixel distance from Sun
        const [isPaused, setIsPaused] = useState(false);
        const [showLines, setShowLines] = useState(true);
        
        // Real-time Data
        const [month, setMonth] = useState("Jan");
        const [parallaxAngle, setParallaxAngle] = useState(0); // Arcseconds (simulated)

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Physics Logic Refs
        const simRef = useRef({
            earthAngle: 0, 
            speed: 0.005,
        });

        // --- Logic ---
        const loop = () => {
            if (!isPaused) {
                simRef.current.earthAngle += simRef.current.speed;
            }
            
            // Calculate Month
            const deg = (simRef.current.earthAngle % (2 * Math.PI)) * (180 / Math.PI);
            const monthIndex = Math.floor((deg / 360) * 12);
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            setMonth(months[monthIndex] || "Jan");

            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Rendering ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear Background
            ctx.fillStyle = '#020617'; 
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // --- 1. LEFT PANEL: Top-Down Solar System ---
            const sunX = VIEW_1_WIDTH / 2;
            const sunY = CANVAS_HEIGHT - 120; // Lower Sun position
            const earthOrbitRadius = 90;

            // Divider Line
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(VIEW_1_WIDTH, 0); ctx.lineTo(VIEW_1_WIDTH, CANVAS_HEIGHT); ctx.stroke();

            // Background Stars (Static)
            drawBackgroundStars(ctx, 0, 0, VIEW_1_WIDTH, CANVAS_HEIGHT - 150);

            // Sun
            ctx.fillStyle = '#f59e0b';
            ctx.shadowBlur = 20; ctx.shadowColor = '#f59e0b';
            ctx.beginPath(); ctx.arc(sunX, sunY, 22, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // Earth Orbit
            ctx.strokeStyle = '#334155'; ctx.lineWidth = 1;
            ctx.beginPath(); ctx.arc(sunX, sunY, earthOrbitRadius, 0, Math.PI*2); ctx.stroke();

            // Earth
            const ex = sunX + Math.cos(simRef.current.earthAngle - Math.PI/2) * earthOrbitRadius;
            const ey = sunY + Math.sin(simRef.current.earthAngle - Math.PI/2) * earthOrbitRadius;
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath(); ctx.arc(ex, ey, 9, 0, Math.PI*2); ctx.fill();

            // Target Star (Actual Position)
            const starX = sunX; 
            const starY = sunY - 180 - starDistance; // Relative to Sun
            
            ctx.fillStyle = '#f43f5e';
            ctx.shadowBlur = 15; ctx.shadowColor = '#f43f5e';
            ctx.beginPath(); drawStar(ctx, starX, starY, 5, 9, 4); ctx.fill();
            ctx.shadowBlur = 0;

            // Sight Lines
            if (showLines) {
                ctx.strokeStyle = 'rgba(244, 63, 94, 0.4)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath(); ctx.moveTo(ex, ey); ctx.lineTo(starX, starY);
                // Extend to background
                const bgY = 40;
                const slope = (starY - ey) / (starX - ex);
                let bgX = starX;
                if (Math.abs(starX - ex) > 0.1) {
                     const c = ey - slope * ex;
                     bgX = (bgY - c) / slope;
                }
                ctx.lineTo(bgX, bgY); ctx.stroke();
                ctx.setLineDash([]);
                
                // Background Plane
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.beginPath(); ctx.moveTo(40, bgY); ctx.lineTo(VIEW_1_WIDTH-40, bgY); ctx.stroke();
                ctx.fillStyle = '#64748b'; ctx.font = "10px sans-serif"; ctx.fillText("Background Stars", 40, bgY - 10);
            }

            // --- 2. RIGHT PANEL: Telescope View ---
            const view2W = CANVAS_WIDTH - VIEW_1_WIDTH;
            const center2X = VIEW_1_WIDTH + view2W / 2;
            const center2Y = CANVAS_HEIGHT / 2;

            // Scope Mask
            ctx.save();
            ctx.beginPath(); ctx.arc(center2X, center2Y, 180, 0, Math.PI*2); ctx.clip();
            
            // Scope BG
            ctx.fillStyle = '#0f172a'; ctx.fillRect(VIEW_1_WIDTH, 0, view2W, CANVAS_HEIGHT);
            drawBackgroundStars(ctx, VIEW_1_WIDTH, 0, view2W, CANVAS_HEIGHT);

            // Parallax Calculation
            const baseline = ex - sunX; 
            const shiftFactor = 8000 / (starDistance + 150); 
            const apparentX = center2X - (baseline * shiftFactor / 80) * 15; 
            
            // Draw Target Star (Apparent)
            ctx.fillStyle = '#f43f5e'; 
            ctx.shadowBlur = 20; ctx.shadowColor = '#f43f5e';
            ctx.beginPath(); drawStar(ctx, apparentX, center2Y, 5, 14, 7); ctx.fill();
            ctx.shadowBlur = 0;

            // Crosshair
            ctx.strokeStyle = 'rgba(255,255,255,0.15)'; ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(center2X, center2Y - 180); ctx.lineTo(center2X, center2Y + 180);
            ctx.moveTo(center2X - 180, center2Y); ctx.lineTo(center2X + 180, center2Y);
            ctx.stroke();
            ctx.restore();

            // Labels
            ctx.fillStyle = '#94a3b8'; ctx.font = "bold 16px sans-serif";
            ctx.fillText("1. Top-Down View", 30, 40);
            ctx.fillText("2. Telescope View", VIEW_1_WIDTH + 30, 40);

            // Update State
            const simulatedAngle = 1000 / (starDistance + 50);
            setParallaxAngle(simulatedAngle);
        };

        const drawStar = (ctx, cx, cy, spikes, outerRadius, innerRadius) => {
            let rot = Math.PI / 2 * 3;
            let x = cx; let y = cy; let step = Math.PI / spikes;
            ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius; y = cy + Math.sin(rot) * outerRadius; ctx.lineTo(x, y); rot += step;
                x = cx + Math.cos(rot) * innerRadius; y = cy + Math.sin(rot) * innerRadius; ctx.lineTo(x, y); rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius); ctx.closePath();
        }

        const starsCache = useRef([]);
        if (starsCache.current.length === 0) {
            for(let i=0; i<80; i++) starsCache.current.push({ x: Math.random(), y: Math.random(), size: Math.random() * 2 });
        }
        const drawBackgroundStars = (ctx, startX, startY, w, h) => {
            ctx.fillStyle = '#ffffff';
            starsCache.current.forEach(s => {
                const sx = startX + s.x * w;
                const sy = startY + s.y * h;
                ctx.globalAlpha = 0.3 + Math.random() * 0.5;
                ctx.beginPath(); ctx.arc(sx, sy, s.size, 0, Math.PI*2); ctx.fill();
            });
            ctx.globalAlpha = 1.0;
        }

        useEffect(() => {
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [isPaused, starDistance, showLines]);

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                {/* Compact Navbar */}
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-indigo-500/20 p-1.5 rounded-lg">
                            <i data-lucide="telescope" className="w-5 h-5 text-indigo-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Stellar Parallax Lab</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Astrophysics
                    </div>
                </nav>

                {/* Main Content - Dashboard Layout */}
                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas (Takes 3/4 space) */}
                        <div className="lg:col-span-3 bg-slate-950 relative border-r border-slate-700">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain"
                            />
                        </div>

                        {/* RIGHT: Controls & Stats (Takes 1/4 space) */}
                        <div className="lg:col-span-1 bg-slate-900 border-l border-slate-700 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            {/* 1. Live Stats Panel */}
                            <div className="p-4 bg-slate-800/50 border-b border-slate-700">
                                <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Live Data</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-slate-900 p-2 rounded border border-slate-700 text-center">
                                        <div className="text-[10px] text-slate-500 mb-1">Month</div>
                                        <div className="text-white font-mono font-bold text-lg">{month}</div>
                                    </div>
                                    <div className="bg-slate-900 p-2 rounded border border-slate-700 text-center">
                                        <div className="text-[10px] text-slate-500 mb-1">Angle ($p$)</div>
                                        <div className="text-emerald-400 font-mono font-bold text-lg">{parallaxAngle.toFixed(2)}"</div>
                                    </div>
                                </div>
                            </div>

                            {/* 2. Controls */}
                            <div className="p-5 flex-1 flex flex-col gap-6">
                                {/* Distance Slider */}
                                <div>
                                    <label className="flex justify-between text-xs font-bold text-indigo-300 mb-2">
                                        Star Distance
                                        <span>{((starDistance + 50) / 10).toFixed(0)} ly</span>
                                    </label>
                                    <input 
                                        type="range" min="0" max="300" step="1" 
                                        value={starDistance} onChange={(e) => setStarDistance(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg slider-thumb thumb-indigo mb-1" 
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500">
                                        <span>Near</span>
                                        <span>Far</span>
                                    </div>
                                </div>

                                {/* Toggles */}
                                <div className="space-y-3">
                                    <button 
                                        onClick={() => setIsPaused(!isPaused)}
                                        className={`w-full py-3 rounded-lg font-bold text-sm flex items-center justify-center gap-2 transition-all ${!isPaused ? 'bg-slate-700 hover:bg-slate-600 text-white' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}`}
                                    >
                                        <i data-lucide={isPaused ? "play" : "pause"} className="w-4 h-4"></i>
                                        {isPaused ? "Resume Orbit" : "Pause Orbit"}
                                    </button>
                                    
                                    <label className="flex items-center gap-3 p-3 bg-slate-800 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-750 transition">
                                        <input 
                                            type="checkbox" 
                                            checked={showLines} 
                                            onChange={() => setShowLines(!showLines)}
                                            className="w-4 h-4 rounded text-indigo-500 bg-slate-900 border-slate-600 focus:ring-0"
                                        />
                                        <span className="text-xs font-bold text-slate-300">Show Lines of Sight</span>
                                    </label>
                                </div>

                                {/* Info Box */}
                                <div className="mt-auto bg-indigo-900/20 border border-indigo-500/20 p-3 rounded-lg">
                                    <h4 className="text-indigo-300 font-bold text-xs mb-1 flex items-center">
                                        <i data-lucide="info" className="w-3 h-3 mr-1"></i> Lab Challenge
                                    </h4>
                                    <p className="text-[11px] text-slate-400 leading-snug">
                                        Increase the star distance. Does the star wobble <em>more</em> or <em>less</em> in the telescope view?
                                    </p>
                                </div>
                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
