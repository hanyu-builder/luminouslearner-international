<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Parallax Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-indigo::-webkit-slider-thumb { background: #6366f1; }
        .stars-bg {
            background-image: 
                radial-gradient(1px 1px at 20px 30px, #eee, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 40px 70px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 50px 160px, #ddd, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 90px 40px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 130px 80px, #fff, rgba(0,0,0,0));
            background-size: 200px 200px;
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 800;
    const CANVAS_HEIGHT = 450;
    const CENTER_X = CANVAS_WIDTH / 2;
    const CENTER_Y = CANVAS_HEIGHT / 2;

    const App = () => {
        // --- State ---
        const [distance, setDistance] = useState(5.0); // Parsecs (Simulated scale)
        const [earthAngle, setEarthAngle] = useState(0);
        const [isRunning, setIsRunning] = useState(true);
        const [showLines, setShowLines] = useState(true);

        // Calculated
        // Parallax angle p is inversely proportional to distance d
        // In simulation: shift amount ~ 1/distance
        const parallaxAngle = 10 / distance; // Degrees for visual

        const orbitCanvasRef = useRef(null);
        const skyCanvasRef = useRef(null);
        const requestRef = useRef();
        
        // --- Loop ---
        const loop = () => {
            setEarthAngle(prev => (prev + 0.01) % (2 * Math.PI));
            requestRef.current = requestAnimationFrame(loop);
        };

        useEffect(() => {
            if (isRunning) {
                requestRef.current = requestAnimationFrame(loop);
            } else {
                cancelAnimationFrame(requestRef.current);
            }
            return () => cancelAnimationFrame(requestRef.current);
        }, [isRunning]);

        // --- Rendering ---
        useEffect(() => {
            drawOrbitView();
            drawSkyView();
        }, [earthAngle, distance, showLines]);

        const drawOrbitView = () => {
            const ctx = orbitCanvasRef.current?.getContext('2d');
            if (!ctx) return;
            const w = orbitCanvasRef.current.width;
            const h = orbitCanvasRef.current.height;
            const cx = w/2;
            const cy = h - 50; // Sun at bottom

            ctx.clearRect(0, 0, w, h);

            // 1. Sun
            ctx.fillStyle = '#facc15';
            ctx.shadowColor = '#facc15'; ctx.shadowBlur = 20;
            ctx.beginPath(); ctx.arc(cx, cy, 15, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // 2. Earth Orbit
            const orbitRadius = 60;
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.beginPath(); ctx.arc(cx, cy, orbitRadius, 0, Math.PI*2); ctx.stroke();

            // 3. Earth Position
            // earthAngle 0 = Right, PI/2 = Top (closest to star), PI = Left
            // We want Earth to orbit around Sun
            const ex = cx + Math.cos(earthAngle) * orbitRadius;
            const ey = cy + Math.sin(earthAngle) * orbitRadius; // Standard orbit in 2D plane
            
            // Wait, for parallax diagram, usually Sun is center, Star is Up.
            // Earth orbits in X-Z plane. We look from Top.
            // Star is at (cx, cy - distance_pixels).
            const starDistPx = distance * 50; // Scale distance
            const starX = cx;
            const starY = cy - starDistPx;

            // Earth
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath(); ctx.arc(ex, ey, 6, 0, Math.PI*2); ctx.fill();

            // 4. Target Star
            ctx.fillStyle = '#f472b6'; // Pink
            ctx.shadowColor = '#f472b6'; ctx.shadowBlur = 10;
            ctx.beginPath(); 
            // Draw star shape
            ctx.arc(starX, starY, 6, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.fillStyle = 'white'; ctx.font = '10px sans-serif'; ctx.fillText("Target Star", starX + 10, starY);

            // 5. Background Stars (Infinite distance)
            const bgY = 20;
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            for(let i=-2; i<=2; i++) {
                ctx.beginPath(); ctx.arc(cx + i*80, bgY, 2, 0, Math.PI*2); ctx.fill();
            }
            ctx.fillText("Background Stars (âˆž)", cx + 160, bgY + 15);

            // 6. Sight Lines
            if (showLines) {
                ctx.strokeStyle = 'rgba(59, 130, 246, 0.4)';
                ctx.setLineDash([5, 5]);
                ctx.lineWidth = 1;
                
                // Line from Earth to Target Star extended to Background
                // Vector E -> S
                const dx = starX - ex;
                const dy = starY - ey;
                // Extend to top of screen (y=0)
                // x = ex + t*dx, y = ey + t*dy. Find t when y=bgY
                const t = (bgY - ey) / dy;
                const hitX = ex + t * dx;

                ctx.beginPath();
                ctx.moveTo(ex, ey);
                ctx.lineTo(hitX, bgY);
                ctx.stroke();
                
                // Mark "hit" on background
                ctx.fillStyle = 'rgba(244, 114, 182, 0.5)'; // Pink ghost
                ctx.beginPath(); ctx.arc(hitX, bgY, 4, 0, Math.PI*2); ctx.fill();

                // Draw Triangle for Parallax Angle (p)
                // Only when Earth is at extreme left/right (Angle 0 or PI)
                // Let's draw baseline
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.beginPath(); ctx.moveTo(cx - orbitRadius, cy); ctx.lineTo(cx + orbitRadius, cy); ctx.stroke();
                
                // Draw line from Sun to Star
                ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx, starY); ctx.stroke();
                
                ctx.setLineDash([]);
            }
        };

        const drawSkyView = () => {
            const ctx = skyCanvasRef.current?.getContext('2d');
            if (!ctx) return;
            const w = skyCanvasRef.current.width;
            const h = skyCanvasRef.current.height;
            const cx = w/2;
            const cy = h/2;

            ctx.clearRect(0, 0, w, h);

            // 1. Telescope Field
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, w, h);
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.arc(cx, cy, 140, 0, Math.PI*2); ctx.stroke();
            
            // Crosshair
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.beginPath(); ctx.moveTo(cx-140, cy); ctx.lineTo(cx+140, cy); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(cx, cy-140); ctx.lineTo(cx, cy+140); ctx.stroke();

            // 2. Background Stars (Fixed)
            // They correspond to the background layer in Orbit View
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            const starPositions = [-100, -50, 0, 50, 100];
            starPositions.forEach(x => {
                // Random Y for "sky" look
                const y = Math.sin(x)*20; 
                ctx.beginPath(); ctx.arc(cx + x, cy + y, 1.5, 0, Math.PI*2); ctx.fill();
            });

            // 3. Target Star (Moving)
            // The apparent shift is opposite to Earth's X position relative to Sun
            // Earth X = cos(angle) * orbitR
            // Shift = -EarthX * (Scaling factor depending on distance)
            // Ideally shift ~ 1/d
            
            const maxShift = 120; // Pixels on screen
            const shiftAmount = maxShift / distance;
            const apparentX = -Math.cos(earthAngle) * shiftAmount;
            
            // Draw Target
            ctx.fillStyle = '#f472b6';
            ctx.shadowColor = '#f472b6'; ctx.shadowBlur = 15;
            ctx.beginPath(); ctx.arc(cx + apparentX, cy, 8, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // 4. Parallax Angle Indicator
            // Draw horizontal arrow indicating the total shift (2p)
            if (showLines) {
                const y = cy + 40;
                ctx.strokeStyle = '#facc15';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(cx - shiftAmount, y);
                ctx.lineTo(cx + shiftAmount, y);
                ctx.stroke();
                // Ends
                ctx.fillRect(cx - shiftAmount, y-3, 1, 6);
                ctx.fillRect(cx + shiftAmount, y-3, 1, 6);
                
                ctx.fillStyle = '#facc15';
                ctx.textAlign = 'center';
                ctx.font = '12px monospace';
                ctx.fillText(`2p = ${(20/distance).toFixed(2)}"`, cx, y + 15);
            }
        };

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        return (
            <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-12">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                    <div className="flex items-center space-x-3">
                        <div className="bg-indigo-500/20 p-2 rounded-lg">
                            <i data-lucide="telescope" className="w-6 h-6 text-indigo-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Stellar Parallax Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Astronomy
                    </div>
                </nav>

                <main className="max-w-6xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Left: Orbit View */}
                    <div className="lg:col-span-6 flex flex-col gap-6">
                        <div className="bg-slate-950 rounded-2xl border border-slate-700 p-1 shadow-2xl relative overflow-hidden h-[400px]">
                            <div className="absolute top-2 left-2 bg-slate-900/80 px-2 py-1 rounded text-[10px] text-slate-400 font-bold border border-slate-700">ORBITAL VIEW (Top-Down)</div>
                            <canvas 
                                ref={orbitCanvasRef} 
                                width={400} 
                                height={400} 
                                className="w-full h-full object-contain"
                            />
                        </div>
                    </div>

                    {/* Right: Telescope View */}
                    <div className="lg:col-span-6 flex flex-col gap-6">
                        <div className="bg-black rounded-2xl border-4 border-slate-800 p-1 shadow-2xl relative overflow-hidden h-[400px] flex items-center justify-center">
                            <div className="absolute top-2 left-2 bg-slate-900/80 px-2 py-1 rounded text-[10px] text-slate-400 font-bold border border-slate-700">TELESCOPE VIEW (Earth Sky)</div>
                            <canvas 
                                ref={skyCanvasRef} 
                                width={400} 
                                height={400} 
                                className="w-full h-full object-contain"
                            />
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="lg:col-span-8 space-y-6">
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 flex flex-wrap gap-8 items-center">
                            
                            <div className="flex-1 min-w-[200px]">
                                <label className="flex justify-between text-sm font-bold text-indigo-300 mb-2">
                                    <span>Star Distance ($d$)</span>
                                    <span className="text-white">{distance.toFixed(1)} pc</span>
                                </label>
                                <input 
                                    type="range" min="1.0" max="20.0" step="0.5" 
                                    value={distance} onChange={(e) => setDistance(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb thumb-indigo" 
                                />
                                <div className="flex justify-between text-[10px] text-slate-500 mt-1">
                                    <span>Near (Large Shift)</span>
                                    <span>Far (Tiny Shift)</span>
                                </div>
                            </div>

                            <div className="flex gap-4">
                                <label className="flex items-center gap-2 cursor-pointer bg-slate-700/50 px-3 py-2 rounded-lg border border-slate-600 hover:bg-slate-700 transition">
                                    <input type="checkbox" checked={showLines} onChange={() => setShowLines(!showLines)} className="rounded text-indigo-500 focus:ring-0 bg-slate-800 border-slate-500" />
                                    <span className="text-sm font-bold text-slate-300">Show Sight Lines</span>
                                </label>
                                <button 
                                    onClick={() => setIsRunning(!isRunning)}
                                    className={`px-6 py-2 rounded-lg font-bold text-sm flex items-center justify-center gap-2 transition-all shadow-lg ${isRunning ? 'bg-slate-700 text-slate-300' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}`}
                                >
                                    <i data-lucide={isRunning ? "pause" : "play"} className="w-4 h-4"></i>
                                    {isRunning ? "Pause Orbit" : "Orbit"}
                                </button>
                            </div>

                        </div>
                    </div>

                    {/* Data Panel */}
                    <div className="lg:col-span-4 space-y-6">
                        <div className="bg-indigo-900/10 border border-indigo-500/20 p-5 rounded-2xl h-full">
                            <h3 className="text-indigo-300 font-bold text-sm mb-4 flex items-center">
                                <i data-lucide="calculator" className="w-4 h-4 mr-2"></i> Parallax Formula
                            </h3>
                            
                            <div className="space-y-4 font-mono text-sm">
                                <div className="flex justify-between items-center p-3 rounded bg-slate-900/50 border border-slate-700/50">
                                    <span className="text-slate-400">Angle ($p$)</span>
                                    <span className="text-yellow-400 font-bold">{(10/distance).toFixed(2)}"</span>
                                </div>
                                <div className="flex justify-between items-center p-3 rounded bg-slate-900/50 border border-slate-700/50">
                                    <span className="text-slate-400">Distance ($d$)</span>
                                    <span className="text-white font-bold">{distance.toFixed(1)} pc</span>
                                </div>
                                <div className="pt-2 border-t border-indigo-500/30 text-center text-xs text-indigo-200">
                                    $d (\text{parsec}) = \frac{1}{p (\text{arcsec})}$
                                </div>
                            </div>
                        </div>
                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
