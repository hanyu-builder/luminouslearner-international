<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluid Pressure Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-cyan::-webkit-slider-thumb { background: #06b6d4; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 550;
    const SURFACE_Y = 50; // Water surface position
    const GRAVITY = 9.8;
    const ATM_PRESSURE = 101325; // Pa

    const FLUIDS = [
        { name: "Fresh Water", density: 1000, color: "rgba(56, 189, 248, 0.3)" },
        { name: "Sea Water", density: 1030, color: "rgba(14, 165, 233, 0.4)" },
        { name: "Oil", density: 800, color: "rgba(234, 179, 8, 0.3)" },
        { name: "Mercury", density: 13600, color: "rgba(148, 163, 184, 0.8)" },
        { name: "Gasoline", density: 700, color: "rgba(249, 115, 22, 0.3)" }
    ];

    const App = () => {
        // --- State ---
        const [fluid, setFluid] = useState("Fresh Water");
        const [showAtm, setShowAtm] = useState(true); // Include Atmospheric Pressure?
        const [showDam, setShowDam] = useState(false); // Dam view toggle
        const [gaugeY, setGaugeY] = useState(150); // Pixel Y position
        const [isDragging, setIsDragging] = useState(false);

        const canvasRef = useRef(null);
        const requestRef = useRef();

        // Derived Values
        const currentFluid = FLUIDS.find(f => f.name === fluid);
        // Map pixels to meters. Let's say screen height (500px) = 10 meters depth
        // So 1 meter = 50 pixels
        const PIXELS_PER_METER = 50;
        
        const depth = Math.max(0, (gaugeY - SURFACE_Y) / PIXELS_PER_METER); // meters
        const fluidPressure = currentFluid.density * GRAVITY * depth; // Pa
        const totalPressure = fluidPressure + (showAtm ? ATM_PRESSURE : 0); // Pa

        // --- Drawing ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // 1. Draw Sky/Atmosphere
            const skyGrad = ctx.createLinearGradient(0, 0, 0, SURFACE_Y);
            skyGrad.addColorStop(0, '#0f172a');
            skyGrad.addColorStop(1, '#1e293b');
            ctx.fillStyle = skyGrad;
            ctx.fillRect(0, 0, CANVAS_WIDTH, SURFACE_Y);

            // 2. Draw Fluid
            ctx.fillStyle = currentFluid.color;
            ctx.fillRect(0, SURFACE_Y, CANVAS_WIDTH, CANVAS_HEIGHT - SURFACE_Y);
            
            // Surface Line
            ctx.beginPath();
            ctx.moveTo(0, SURFACE_Y);
            ctx.lineTo(CANVAS_WIDTH, SURFACE_Y);
            ctx.strokeStyle = '#38bdf8';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Depth Markers (Ruler)
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.font = '10px monospace';
            ctx.textAlign = 'right';
            for(let y = SURFACE_Y; y < CANVAS_HEIGHT; y += PIXELS_PER_METER) {
                const d = (y - SURFACE_Y) / PIXELS_PER_METER;
                ctx.fillRect(40, y, 10, 1);
                ctx.fillText(`${d.toFixed(0)}m`, 35, y + 3);
            }

            if (showDam) {
                drawDamMode(ctx);
            } else {
                drawGaugeMode(ctx);
            }
        };

        const drawGaugeMode = (ctx) => {
            const cx = CANVAS_WIDTH / 2; // Center horizontally? Or allow drag X too?
            // Let's fix X for simplicity, or allow drag.
            // Let's simulate a probe hanging from a wire or just floating.
            const x = 300; 
            const y = gaugeY;

            // Wire
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, y);
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Gauge Body
            ctx.fillStyle = '#1e293b';
            ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Pressure Arrows (Pascal's Principle - Pressure acts in all directions)
            // Length proportional to pressure
            const arrowLen = Math.min(60, 10 + fluidPressure / 5000); 
            const directions = [0, 45, 90, 135, 180, 225, 270, 315];
            
            directions.forEach(deg => {
                const rad = deg * Math.PI / 180;
                // Draw arrow pointing INWARDS to the gauge center
                // Start: (x + cos * r + len), End: (x + cos * r)
                const r = 25;
                const startX = x + Math.cos(rad) * (r + arrowLen);
                const startY = y + Math.sin(rad) * (r + arrowLen);
                const endX = x + Math.cos(rad) * r;
                const endY = y + Math.sin(rad) * r;
                
                drawArrow(ctx, startX, startY, endX, endY, '#ef4444');
            });

            // Digital Readout Box nearby
            ctx.fillStyle = 'rgba(15, 23, 42, 0.9)';
            ctx.strokeStyle = '#38bdf8';
            ctx.lineWidth = 1;
            ctx.fillRect(x + 40, y - 25, 140, 50);
            ctx.strokeRect(x + 40, y - 25, 140, 50);
            
            ctx.fillStyle = '#38bdf8';
            ctx.font = 'bold 16px monospace';
            ctx.textAlign = 'left';
            ctx.fillText(`${(totalPressure/1000).toFixed(1)} kPa`, x + 50, y + 5);
            ctx.fillStyle = '#94a3b8';
            ctx.font = '10px sans-serif';
            ctx.fillText(`Depth: ${depth.toFixed(2)}m`, x + 50, y - 10);
        };

        const drawDamMode = (ctx) => {
            const damX = 600;
            const bottomW = 150;
            const topW = 30;
            
            // Draw Dam Structure (Trapezoid)
            ctx.fillStyle = '#64748b'; // Concrete
            ctx.beginPath();
            ctx.moveTo(damX, SURFACE_Y - 20); // Top left (slightly above water)
            ctx.lineTo(damX + topW, SURFACE_Y - 20); // Top right
            ctx.lineTo(damX + bottomW, CANVAS_HEIGHT); // Bottom right
            ctx.lineTo(damX, CANVAS_HEIGHT); // Bottom left (vertical face facing water)
            ctx.closePath();
            ctx.fill();
            
            // Texture
            ctx.strokeStyle = '#475569';
            ctx.lineWidth = 1;
            ctx.stroke();

            // Draw Force Profile (Triangular Load)
            // Arrows pushing against the vertical face
            ctx.strokeStyle = '#ef4444';
            ctx.fillStyle = '#ef4444';
            ctx.lineWidth = 2;
            
            for(let y = SURFACE_Y; y < CANVAS_HEIGHT; y += 40) {
                const d = (y - SURFACE_Y) / PIXELS_PER_METER;
                const p = currentFluid.density * GRAVITY * d;
                const len = p / 2000; // Scale for visual
                
                if (len > 5) {
                    drawArrow(ctx, damX - len, y, damX, y, '#ef4444');
                }
            }
            
            // Label
            ctx.fillStyle = '#fff';
            ctx.textAlign = 'center';
            ctx.fillText("Force increases with depth", damX - 100, CANVAS_HEIGHT - 50);
        };

        const drawArrow = (ctx, x1, y1, x2, y2, color) => {
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = color;
            ctx.stroke();

            const angle = Math.atan2(y2 - y1, x2 - x1);
            const headLen = 6;
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI/6), y2 - headLen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI/6), y2 - headLen * Math.sin(angle + Math.PI/6));
            ctx.fillStyle = color;
            ctx.fill();
        };

        // --- Interaction ---
        const handleMouseDown = (e) => {
            if (showDam) return;
            const rect = canvasRef.current.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // Hit test gauge (simple x check around 300)
            if (Math.abs(mouseX - 300) < 50 && Math.abs(mouseY - gaugeY) < 50) {
                setIsDragging(true);
            }
        };

        const handleMouseMove = (e) => {
            if (isDragging) {
                const rect = canvasRef.current.getBoundingClientRect();
                let newY = e.clientY - rect.top;
                // Clamp
                newY = Math.max(SURFACE_Y - 50, Math.min(CANVAS_HEIGHT - 20, newY));
                setGaugeY(newY);
            }
        };

        const handleMouseUp = () => {
            setIsDragging(false);
        };

        useEffect(() => {
            requestRef.current = requestAnimationFrame(draw);
            return () => cancelAnimationFrame(requestRef.current);
        }, [fluid, gaugeY, showAtm, showDam]);

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-cyan-500/20 p-1.5 rounded-lg">
                            <i data-lucide="droplets" className="w-5 h-5 text-cyan-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Fluid Pressure Lab</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Mechanics
                    </div>
                </nav>

                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas */}
                        <div className="lg:col-span-3 bg-slate-950 relative border-r border-slate-700">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className={`w-full h-full object-contain ${showDam ? '' : 'cursor-ns-resize'}`}
                                onMouseDown={handleMouseDown}
                                onMouseMove={handleMouseMove}
                                onMouseUp={handleMouseUp}
                                onMouseLeave={handleMouseUp}
                            />
                            {/* Overlay Prompt */}
                            {!showDam && (
                                <div className="absolute top-20 left-1/2 -translate-x-1/2 pointer-events-none text-slate-400/50 text-xs animate-bounce">
                                    Drag Gauge Up/Down
                                </div>
                            )}
                        </div>

                        {/* RIGHT: Controls */}
                        <div className="lg:col-span-1 bg-slate-900 border-l border-slate-700 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            {/* 1. Results Panel */}
                            <div className="p-4 bg-slate-800/50 border-b border-slate-700 backdrop-blur sticky top-0 z-10">
                                <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Measurements</h3>
                                <div className="space-y-2">
                                    <div className="flex justify-between items-center bg-slate-900 p-2 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400">Depth ($h$)</div>
                                        <div className="font-mono font-bold text-white">{depth.toFixed(2)} m</div>
                                    </div>
                                    <div className="flex justify-between items-center bg-slate-900 p-2 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400">Fluid Density ($\rho$)</div>
                                        <div className="font-mono font-bold text-cyan-400">{currentFluid.density} kg/mÂ³</div>
                                    </div>
                                    <div className="flex justify-between items-center bg-slate-900 p-2 rounded border border-slate-700">
                                        <div className="text-xs text-slate-400">Pressure ($P$)</div>
                                        <div className="font-mono font-bold text-emerald-400">{(totalPressure/1000).toFixed(1)} kPa</div>
                                    </div>
                                </div>
                            </div>

                            {/* 2. Controls */}
                            <div className="p-5 space-y-6 flex-1">
                                
                                {/* Fluid Selection */}
                                <div>
                                    <label className="text-xs font-bold text-slate-300 mb-2 block">Fluid Type</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        {FLUIDS.map(f => (
                                            <button
                                                key={f.name}
                                                onClick={() => setFluid(f.name)}
                                                className={`py-2 px-1 text-[10px] rounded border transition-all
                                                    ${fluid === f.name 
                                                        ? 'bg-cyan-600 border-cyan-500 text-white shadow-lg' 
                                                        : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700'}
                                                `}
                                            >
                                                {f.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="h-px bg-slate-800"></div>

                                {/* Toggles */}
                                <div className="space-y-3">
                                    <label className="flex items-center justify-between p-3 bg-slate-800 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-750 transition">
                                        <span className="text-xs font-bold text-slate-300">Atmospheric Pressure</span>
                                        <div className={`w-10 h-5 rounded-full relative transition-colors ${showAtm ? 'bg-cyan-600' : 'bg-slate-600'}`}>
                                            <input 
                                                type="checkbox" 
                                                checked={showAtm} 
                                                onChange={() => setShowAtm(!showAtm)}
                                                className="opacity-0 w-full h-full absolute cursor-pointer"
                                            />
                                            <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all ${showAtm ? 'left-6' : 'left-1'}`}></div>
                                        </div>
                                    </label>

                                    <button 
                                        onClick={() => setShowDam(!showDam)}
                                        className={`w-full py-3 rounded-lg text-xs font-bold flex items-center justify-center gap-2 border transition-all 
                                            ${showDam ? 'bg-amber-600 border-amber-500 text-white' : 'bg-slate-800 border-slate-700 text-slate-300'}`}
                                    >
                                        <i data-lucide={showDam ? "gauge" : "brick-wall"} className="w-4 h-4"></i>
                                        {showDam ? "Back to Gauge Mode" : "Switch to Dam View"}
                                    </button>
                                </div>

                                {/* Formula Box */}
                                <div className="mt-auto p-3 bg-cyan-900/10 border border-cyan-500/20 rounded-lg text-center">
                                    <p className="font-mono text-lg text-cyan-400 mb-1">P = h &rho; g</p>
                                    <p className="text-[10px] text-slate-400">
                                        Pressure depends only on depth ($h$) and density ($\rho$), not the shape of the container!
                                    </p>
                                </div>

                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
