<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coulomb's Law Lab | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            border-radius: 50%; cursor: pointer; border: 2px solid #ffffff;
        }
        .thumb-blue::-webkit-slider-thumb { background: #3b82f6; }
        .thumb-red::-webkit-slider-thumb { background: #ef4444; }
        .thumb-purple::-webkit-slider-thumb { background: #a855f7; }
        .canvas-container { cursor: pointer; }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CANVAS_WIDTH = 800;
    const CANVAS_HEIGHT = 450;
    const CENTER_X = CANVAS_WIDTH / 2;
    const CENTER_Y = CANVAS_HEIGHT / 2;
    const K = 8.98755e9; // Coulomb constant N·m²/C²
    const PIXELS_PER_METER = 2000; // 100px = 5cm = 0.05m -> 1m = 2000px

    const App = () => {
        // --- State ---
        // Charges in microCoulombs (uC)
        const [q1, setQ1] = useState(-4); 
        const [q2, setQ2] = useState(8); 
        const [distanceCm, setDistanceCm] = useState(6); // cm

        const [force, setForce] = useState(0); // Newtons
        const [isDragging, setIsDragging] = useState(false);

        const canvasRef = useRef(null);

        // --- Physics Logic ---
        useEffect(() => {
            // F = k * |q1*q2| / r^2
            // Convert units: uC -> C (1e-6), cm -> m (1e-2)
            const r_m = distanceCm / 100;
            const q1_c = q1 * 1e-6;
            const q2_c = q2 * 1e-6;
            
            const f = (K * Math.abs(q1_c * q2_c)) / (r_m * r_m);
            setForce(f);
        }, [q1, q2, distanceCm]);

        // --- Interaction ---
        const handleMouseDown = (e) => {
            const rect = canvasRef.current.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Check if clicking near charges (simplified to dragging the right charge)
            const r_px = (distanceCm / 100) * PIXELS_PER_METER;
            const x2 = CENTER_X + r_px/2;
            
            if (Math.abs(x - x2) < 40 && Math.abs(y - CENTER_Y) < 40) {
                setIsDragging(true);
            }
        };

        const handleMouseMove = (e) => {
            if (!isDragging) return;
            const rect = canvasRef.current.getBoundingClientRect();
            const x = e.clientX - rect.left;
            
            // Calculate new distance based on mouse X relative to center
            // Left charge is at CENTER_X - r/2
            // Right charge (dragged) is at x
            // Center is fixed? No, let's fix distance symmetrical for simplicity logic in dragging
            // Or fix Left charge and move Right charge.
            // Let's keep them symmetrical around CENTER_X visually.
            
            // Distance = 2 * |x - CENTER_X|? 
            // Better: Dragging right charge.
            // Current pos of right charge is x.
            // Distance = (x - (CENTER_X - r_current/2))? No.
            // Let's assume we are dragging the distance slider effectively.
            
            let newDistPx = (x - CENTER_X) * 2;
            if (newDistPx < 40) newDistPx = 40; // Min dist 2cm visually
            if (newDistPx > 600) newDistPx = 600; // Max dist
            
            // Convert px back to cm
            const newDistCm = (newDistPx / PIXELS_PER_METER) * 100;
            setDistanceCm(newDistCm);
        };

        const handleMouseUp = () => setIsDragging(false);

        // --- Rendering ---
        useEffect(() => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            const r_px = (distanceCm / 100) * PIXELS_PER_METER;
            const x1 = CENTER_X - r_px / 2;
            const x2 = CENTER_X + r_px / 2;
            const cy = CENTER_Y;

            // 1. Draw Grid / Scale
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x1, cy + 60);
            ctx.lineTo(x2, cy + 60);
            ctx.stroke();
            // Ticks
            ctx.beginPath();
            ctx.moveTo(x1, cy + 55); ctx.lineTo(x1, cy + 65);
            ctx.moveTo(x2, cy + 55); ctx.lineTo(x2, cy + 65);
            ctx.stroke();
            // Label
            ctx.fillStyle = '#94a3b8';
            ctx.font = '12px monospace';
            ctx.textAlign = 'center';
            ctx.fillText(`r = ${(distanceCm/100).toFixed(2)} m`, CENTER_X, cy + 80);

            // 2. Draw Charges
            const drawCharge = (x, y, q, isDraggingTarget) => {
                const radius = 25;
                const color = q > 0 ? '#ef4444' : q < 0 ? '#3b82f6' : '#94a3b8';
                const glowColor = q > 0 ? 'rgba(239, 68, 68, 0.4)' : q < 0 ? 'rgba(59, 130, 246, 0.4)' : 'rgba(148, 163, 184, 0.2)';
                
                // Glow
                const grad = ctx.createRadialGradient(x, y, radius*0.5, x, y, radius*3);
                grad.addColorStop(0, glowColor);
                grad.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = grad;
                ctx.beginPath(); ctx.arc(x, y, radius*3, 0, Math.PI*2); ctx.fill();

                // Body
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI*2);
                ctx.fill();
                
                // Sign
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px sans-serif';
                ctx.textBaseline = 'middle';
                ctx.fillText(q > 0 ? '+' : q < 0 ? '-' : '0', x, y+2);
                
                // Label
                ctx.font = 'bold 12px sans-serif';
                ctx.fillStyle = color;
                ctx.fillText(`${q > 0 ? '+' : ''}${q} µC`, x, y - 40);

                // Drag Hint
                if (isDraggingTarget) {
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([4, 4]);
                    ctx.beginPath(); ctx.arc(x, y, radius + 5, 0, Math.PI*2); ctx.stroke();
                    ctx.setLineDash([]);
                }
            };

            drawCharge(x1, cy, q1, false);
            drawCharge(x2, cy, q2, true); // Right one is draggable

            // 3. Draw Force Vectors
            if (force > 0 && q1 !== 0 && q2 !== 0) {
                // Determine direction: Like charges repel (Out), Opposite attract (In)
                const isRepulsive = (q1 * q2) > 0;
                
                // Scale arrow length log-ish or clamped linear for visual
                // Force can range from ~0 to 1000s of N. 
                // Let's map 0-500N to 0-100px.
                const arrowLen = Math.min(150, 40 + Math.log10(force + 1) * 30);
                
                const drawArrow = (x, dirIsRight) => {
                    const dir = dirIsRight ? 1 : -1;
                    const startX = x + (dir * 30); // Start from edge of charge
                    const endX = startX + (dir * arrowLen);
                    
                    ctx.beginPath();
                    ctx.moveTo(startX, cy);
                    ctx.lineTo(endX, cy);
                    ctx.strokeStyle = '#facc15'; // Yellow
                    ctx.lineWidth = 4;
                    ctx.stroke();

                    // Arrowhead
                    ctx.beginPath();
                    ctx.moveTo(endX, cy);
                    ctx.lineTo(endX - (dir * 10), cy - 6);
                    ctx.lineTo(endX - (dir * 10), cy + 6);
                    ctx.fillStyle = '#facc15';
                    ctx.fill();
                    
                    // Label F
                    ctx.fillStyle = '#facc15';
                    ctx.font = 'bold 12px sans-serif';
                    ctx.fillText('F', endX + (dir*15), cy);
                };

                if (isRepulsive) {
                    drawArrow(x1, false); // Left Force points Left
                    drawArrow(x2, true);  // Right Force points Right
                } else {
                    drawArrow(x1, true);  // Left Force points Right
                    drawArrow(x2, false); // Right Force points Left
                }
            }

        }, [q1, q2, distanceCm, force, isDragging]);

        // Init icons
        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        // Format Scientific Notation
        const formatSci = (num) => {
            if (num === 0) return "0";
            if (Math.abs(num) < 0.01 || Math.abs(num) > 1000) {
                return num.toExponential(2);
            }
            return num.toFixed(1);
        };

        return (
            <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-12">
                <nav className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                    <div className="flex items-center space-x-3">
                        <div className="bg-blue-500/20 p-2 rounded-lg">
                            <i data-lucide="zap" className="w-6 h-6 text-blue-400"></i>
                        </div>
                        <h1 className="text-xl font-bold text-white tracking-wide">Coulomb's Law Lab</h1>
                    </div>
                    <div className="text-xs text-slate-400 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700">
                        Topic: Electrostatics
                    </div>
                </nav>

                <main className="max-w-6xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
                    
                    {/* Left: Simulation Canvas */}
                    <div className="lg:col-span-8 flex flex-col gap-6">
                        <div className="bg-slate-950 rounded-2xl border border-slate-700 p-1 shadow-2xl relative overflow-hidden h-[450px]">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                onMouseDown={handleMouseDown}
                                onMouseMove={handleMouseMove}
                                onMouseUp={handleMouseUp}
                                onMouseLeave={handleMouseUp}
                                className="w-full h-full object-contain cursor-ew-resize"
                            />
                            
                            <div className="absolute top-4 left-4 bg-slate-900/80 px-4 py-2 rounded-lg border border-slate-700 text-xs text-slate-300 pointer-events-none">
                                Drag the <strong>Right Charge</strong> to change distance ($r$).
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 grid grid-cols-1 md:grid-cols-2 gap-8">
                            
                            {/* Charge 1 */}
                            <div className="space-y-4">
                                <h3 className="text-sm font-bold text-blue-400 flex items-center">
                                    <span className="w-2 h-2 rounded-full bg-blue-500 mr-2"></span> Left Charge ($q_1$)
                                </h3>
                                <div>
                                    <div className="flex justify-between text-xs text-slate-400 mb-1">
                                        <span>Charge</span>
                                        <span className="text-white font-mono">{q1} µC</span>
                                    </div>
                                    <input 
                                        type="range" min="-10" max="10" step="1" 
                                        value={q1} onChange={(e) => setQ1(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb thumb-blue"
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500 mt-1">
                                        <span>-10µC</span>
                                        <span>0</span>
                                        <span>+10µC</span>
                                    </div>
                                </div>
                            </div>

                            {/* Charge 2 */}
                            <div className="space-y-4">
                                <h3 className="text-sm font-bold text-red-400 flex items-center">
                                    <span className="w-2 h-2 rounded-full bg-red-500 mr-2"></span> Right Charge ($q_2$)
                                </h3>
                                <div>
                                    <div className="flex justify-between text-xs text-slate-400 mb-1">
                                        <span>Charge</span>
                                        <span className="text-white font-mono">{q2} µC</span>
                                    </div>
                                    <input 
                                        type="range" min="-10" max="10" step="1" 
                                        value={q2} onChange={(e) => setQ2(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb thumb-red"
                                    />
                                    <div className="flex justify-between text-[10px] text-slate-500 mt-1">
                                        <span>-10µC</span>
                                        <span>0</span>
                                        <span>+10µC</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* Right: Analysis */}
                    <div className="lg:col-span-4 space-y-6">
                        
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                            <h2 className="text-white font-bold mb-6 flex items-center">
                                <i data-lucide="calculator" className="w-5 h-5 mr-2 text-indigo-400"></i>
                                Force Calculation
                            </h2>
                            
                            <div className="space-y-6 font-mono text-sm">
                                <div className="p-4 rounded-xl bg-slate-900 border border-slate-700 text-center">
                                    <div className="text-xs text-slate-500 uppercase tracking-widest mb-2">Electrostatic Force ($F$)</div>
                                    <div className="text-3xl font-bold text-yellow-400 mb-1">
                                        {formatSci(force)} <span className="text-lg text-slate-400">N</span>
                                    </div>
                                    <div className="text-xs text-slate-500">
                                        {(q1*q2) > 0 ? "Repulsive (Push)" : (q1*q2) < 0 ? "Attractive (Pull)" : "No Force"}
                                    </div>
                                </div>

                                <div className="space-y-3 pt-4 border-t border-slate-700">
                                    <div className="flex justify-between items-center text-xs">
                                        <span className="text-slate-400">Constant ($k$)</span>
                                        <span className="text-indigo-300">8.99 × 10⁹</span>
                                    </div>
                                    <div className="flex justify-between items-center text-xs">
                                        <span className="text-slate-400">Distance ($r$)</span>
                                        <span className="text-white">{(distanceCm/100).toFixed(2)} m</span>
                                    </div>
                                    <div className="flex justify-between items-center text-xs">
                                        <span className="text-slate-400">Product ($|q_1 q_2|$)</span>
                                        <span className="text-white">{Math.abs(q1*q2).toFixed(0)} × 10⁻¹² C²</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-indigo-900/10 border border-indigo-500/20 p-5 rounded-2xl">
                            <h3 className="text-indigo-300 font-bold text-sm mb-2 flex items-center">
                                <i data-lucide="lightbulb" className="w-4 h-4 mr-2"></i> Inverse Square Law
                            </h3>
                            <p className="text-xs text-slate-300 leading-relaxed">
                                Notice how quickly the force drops as you move the charges apart?
                                <br/><br/>
                                If you <strong>double</strong> the distance ($2r$), the force becomes <strong>4 times weaker</strong> ($1/2^2 = 1/4$).
                            </p>
                        </div>

                    </div>

                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
