<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleming's Left-Hand Rule | Luminous Learner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; overflow-y: hidden; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .btn-toggle { transition: all 0.2s; }
        .btn-toggle:active { transform: scale(0.95); }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    const CANVAS_WIDTH = 900;
    const CANVAS_HEIGHT = 550;
    const CENTER_X = CANVAS_WIDTH / 2;
    const CENTER_Y = CANVAS_HEIGHT / 2;

    const App = () => {
        // --- State ---
        // fieldDir: 1 (Down/South), -1 (Up/North) -- Visualized as Top Magnet to Bottom Magnet
        // Actually, let's do: 1 = N at Top, S at Bottom (Field Down). -1 = S at Top, N at Bottom (Field Up).
        const [fieldDir, setFieldDir] = useState(1); 
        
        // currentDir: 1 (Right), -1 (Left) -- Visualized as flowing along the wire
        const [currentDir, setCurrentDir] = useState(1);
        
        // currentOn: Is the switch closed?
        const [currentOn, setCurrentOn] = useState(true);

        const canvasRef = useRef(null);
        const requestRef = useRef();
        
        // Animation State
        const animRef = useRef({
            wireY: 0, // Vertical displacement of wire
            wireV: 0, // Velocity
            particles: [] // Current flow particles
        });

        // --- Physics Logic ---
        // Fleming's Left Hand Rule:
        // First Finger = Field (B)
        // Second Finger = Current (I)
        // Thumb = Force (F) -> Motion
        
        // Setup:
        // Field is Vertical (Y axis). 1 = Down, -1 = Up.
        // Current is Horizontal (X axis). 1 = Right, -1 = Left.
        // Force is Z axis (Into/Out of screen)? 
        // Wait, for 2D screen clarity, let's rotate the perspective.
        
        // PERSPECTIVE 2:
        // Field (Magnet Left/Right): X axis. 
        // Current (Wire Into/Out): Z axis.
        // Force (Wire Up/Down): Y axis. -> This is best for animation (wire jumps up/down).
        
        // Let's implement Perspective 2:
        // Magnets are Left and Right.
        // fieldDir 1: Left is N, Right is S. Field -> Right.
        // fieldDir -1: Left is S, Right is N. Field <- Left.
        
        // currentDir 1: Into Screen (X).
        // currentDir -1: Out of Screen (Dot).
        
        // Vector Cross Product: F = I x B
        // I vector: (0, 0, currentDir)  [Z-axis]
        // B vector: (fieldDir, 0, 0)    [X-axis]
        // F = z * x ... 
        // k x i = j (Z x X = Y).
        // So Force is along Y axis.
        
        // Calculation:
        // If I is Into (Z+), B is Right (X+). F is Up (Y+).
        // Let's verify Left Hand Rule:
        // First (Field) -> Right.
        // Second (Current) -> Into Screen (away from you).
        // Thumb -> Down? 
        // Let's re-check standard basis.
        // x=Right, y=Up, z=Out.
        // i x j = k. j x k = i. k x i = j.
        // I (Into) = -z. B (Right) = +x.
        // F = I x B = (-k) x (i) = -(k x i) = -j = Down.
        
        // Let's stick to the visual mnemonic logic:
        // B = Right (1). I = Into (1).
        // Left Hand: Index Right. Middle Into page. Thumb points DOWN.
        // So forceDir = -1.
        
        // If I = Out (-1). B = Right (1).
        // Left Hand: Index Right. Middle Out. Thumb points UP.
        // So forceDir = 1.
        
        // Formula: forceDir = -1 * fieldDir * currentDir
        
        const forceDir = currentOn ? -1 * fieldDir * currentDir : 0;

        // --- Loop ---
        const loop = () => {
            const state = animRef.current;
            
            // Wire Physics (Spring-Mass-Damper)
            // Target Y is forceDir * 60 (displacement pixels)
            const targetY = forceDir * 50;
            const k = 0.1; // Spring constant
            const damp = 0.85; // Damping
            
            const ay = (targetY - state.wireY) * k;
            state.wireV += ay;
            state.wireV *= damp;
            state.wireY += state.wireV;

            // Particle Animation (Current flow)
            // Spawn particles if current is on
            if (currentOn) {
                if (Math.random() > 0.8) {
                    state.particles.push({
                        z: currentDir === 1 ? -100 : 100, // Start far or near
                        life: 1.0
                    });
                }
            }
            // Update particles
            state.particles.forEach(p => {
                // Move along Z
                p.z += currentDir * 5; 
                p.life -= 0.02;
            });
            state.particles = state.particles.filter(p => Math.abs(p.z) < 150);

            draw();
            requestRef.current = requestAnimationFrame(loop);
        };

        // --- Drawing ---
        const draw = () => {
            const ctx = canvasRef.current?.getContext('2d');
            if (!ctx) return;

            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Setup Isometric-ish Projection
            // Center Origin
            const cx = CANVAS_WIDTH / 2;
            const cy = CANVAS_HEIGHT / 2;

            // --- 1. Draw Magnets (Left and Right) ---
            const magW = 100;
            const magH = 200;
            const magDist = 150;
            
            // Left Magnet
            // If fieldDir = 1 (Right), Left is N (Red). If -1 (Left), Left is S (Blue).
            ctx.fillStyle = fieldDir === 1 ? '#ef4444' : '#3b82f6';
            ctx.fillRect(cx - magDist - magW, cy - magH/2, magW, magH);
            // 3D Side
            ctx.fillStyle = fieldDir === 1 ? '#b91c1c' : '#1d4ed8';
            ctx.beginPath();
            ctx.moveTo(cx - magDist, cy - magH/2);
            ctx.lineTo(cx - magDist + 20, cy - magH/2 - 20);
            ctx.lineTo(cx - magDist + 20 + magW, cy - magH/2 - 20);
            ctx.lineTo(cx - magDist + magW, cy - magH/2);
            ctx.fill();
            // Label
            ctx.fillStyle = 'white';
            ctx.font = 'bold 40px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(fieldDir === 1 ? "N" : "S", cx - magDist - magW/2, cy);

            // Right Magnet
            ctx.fillStyle = fieldDir === 1 ? '#3b82f6' : '#ef4444';
            ctx.fillRect(cx + magDist, cy - magH/2, magW, magH);
            // 3D Side
            ctx.fillStyle = fieldDir === 1 ? '#1d4ed8' : '#b91c1c';
            ctx.beginPath();
            ctx.moveTo(cx + magDist, cy - magH/2);
            ctx.lineTo(cx + magDist + 20, cy - magH/2 - 20);
            ctx.lineTo(cx + magDist + 20 + magW, cy - magH/2 - 20);
            ctx.lineTo(cx + magDist + magW, cy - magH/2);
            ctx.fill();
            // Label
            ctx.fillStyle = 'white';
            ctx.fillText(fieldDir === 1 ? "S" : "N", cx + magDist + magW/2, cy);

            // --- 2. Draw Magnetic Field Lines (B) ---
            ctx.lineWidth = 2;
            // Multiple lines
            for (let y = cy - 60; y <= cy + 60; y += 30) {
                const startX = cx - magDist;
                const endX = cx + magDist;
                
                // Gradient for field
                const grad = ctx.createLinearGradient(startX, 0, endX, 0);
                grad.addColorStop(0, 'rgba(255,255,255,0)');
                grad.addColorStop(0.2, 'rgba(56, 189, 248, 0.5)'); // Sky blue field
                grad.addColorStop(0.8, 'rgba(56, 189, 248, 0.5)');
                grad.addColorStop(1, 'rgba(255,255,255,0)');
                
                ctx.strokeStyle = grad;
                ctx.beginPath();
                ctx.moveTo(startX, y);
                ctx.lineTo(endX, y);
                ctx.stroke();

                // Arrow on field lines
                if (y === cy) {
                    ctx.fillStyle = '#38bdf8';
                    const arrowX = fieldDir === 1 ? cx + 20 : cx - 20;
                    drawArrowHead(ctx, arrowX, y, fieldDir * 10, 0);
                    // Label B
                    ctx.font = 'bold 20px sans-serif';
                    ctx.fillText("B", arrowX, y - 15);
                }
            }

            // --- 3. Draw Wire (Current I) ---
            // Wire is along Z-axis. In 2D perspective, Z is diagonal.
            // Let's use a vanishing point perspective for the wire.
            // Center point (cx, cy + wireY).
            // Front point (cx - 40, cy + wireY + 40).
            // Back point (cx + 40, cy + wireY - 40).
            
            const wy = animRef.current.wireY;
            const wireColor = '#f59e0b'; // Amber

            ctx.lineWidth = 12;
            ctx.lineCap = 'round';
            ctx.strokeStyle = wireColor;
            
            const p1 = { x: cx - 100, y: cy + wy + 100 }; // Front-Leftish (Screen Out)
            const p2 = { x: cx + 100, y: cy + wy - 100 }; // Back-Rightish (Screen In)
            
            // Draw Wire
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();

            // Draw Current Direction (I)
            if (currentOn) {
                const midX = (p1.x + p2.x) / 2;
                const midY = (p1.y + p2.y) / 2;
                
                ctx.fillStyle = '#fff';
                // Direction vector
                const dx = p2.x - p1.x;
                const dy = p2.y - p1.y;
                // If currentDir = 1 (Into), vector is p1 -> p2
                // If currentDir = -1 (Out), vector is p2 -> p1
                const dir = currentDir;
                
                drawArrowHead(ctx, midX, midY, dir * dx * 0.1, dir * dy * 0.1);
                
                // Label I
                ctx.fillStyle = '#fbbf24';
                ctx.font = 'bold 24px sans-serif';
                ctx.fillText("I", midX + 20, midY - 20);

                // Draw flowing particles
                ctx.fillStyle = '#fff';
                animRef.current.particles.forEach(p => {
                    // Map z (-100 to 100) to line segment
                    // t from 0 to 1
                    const t = (p.z + 100) / 200; 
                    if (t>=0 && t<=1) {
                        const px = p1.x + (p2.x - p1.x) * t;
                        const py = p1.y + (p2.y - p1.y) * t;
                        ctx.beginPath(); ctx.arc(px, py, 3, 0, Math.PI*2); ctx.fill();
                    }
                });
            }

            // --- 4. Draw Force Vector (F) ---
            if (currentOn && forceDir !== 0) {
                const fy = cy + wy;
                const len = 80 * forceDir; // Up is negative Y in canvas? No, Y+ is down.
                // We want forceDir 1 to be UP visually. Canvas Y goes down. So forceDir 1 -> Y decreases.
                // My Physics calculation earlier: F = -j (Down).
                // If forceDir is +1 (Up), we draw line upwards (lower Y).
                // Let's check logic:
                // forceDir calculated as: -1 * fieldDir * currentDir
                // If field(1, Right) and Current(1, In), forceDir = -1. 
                // Left hand: First(R), Second(In), Thumb(Down). Correct.
                // Down means Increasing Y in Canvas.
                // So vector should point to cy + wy + len.
                
                // Draw thick arrow from wire center
                const fx = cx;
                
                ctx.lineWidth = 6;
                ctx.strokeStyle = '#22c55e'; // Green Force
                ctx.beginPath();
                ctx.moveTo(fx, fy);
                ctx.lineTo(fx, fy - (forceDir * -100)); // Draw opposite to forceDir value to match canvas?
                // Wait, if forceDir = -1 (Down), we want arrow pointing DOWN (Y increases).
                // So lineTo(fx, fy + 100).
                // So delta Y = forceDir * 100? No, -1 * 100 = -100 (Up).
                // Let's just fix visual:
                // forceDir -1 is DOWN. Arrow should point DOWN.
                ctx.lineTo(fx, fy - (forceDir * 100)); 
                ctx.stroke();

                // Arrowhead
                drawArrowHead(ctx, fx, fy - (forceDir * 100), 0, -forceDir * 20);

                // Label F
                ctx.fillStyle = '#22c55e';
                ctx.font = 'bold 30px sans-serif';
                ctx.fillText("F", fx + 20, fy - (forceDir * 50));
            }

            // --- 5. Draw Hand Helper (Overlay) ---
            drawHandIcon(ctx, 100, 100);
        };

        const drawArrowHead = (ctx, x, y, dx, dy) => {
            const headLen = 15;
            const angle = Math.atan2(dy, dx);
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x - headLen * Math.cos(angle - Math.PI / 6), y - headLen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(x - headLen * Math.cos(angle + Math.PI / 6), y - headLen * Math.sin(angle + Math.PI / 6));
            ctx.fill();
        };

        const drawHandIcon = (ctx, x, y) => {
            // Static legend
            // Just draws the 3 vectors with labels
            // 2D Representation
            
            // F (Thumb) - Up
            ctx.strokeStyle = '#22c55e'; ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x, y-40); ctx.stroke();
            ctx.fillStyle='#22c55e'; ctx.font='12px sans-serif'; ctx.fillText("Thumb (F)", x-30, y-45);
            drawArrowHead(ctx, x, y-40, 0, -10);

            // B (First) - Right
            ctx.strokeStyle = '#38bdf8';
            ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x+40, y); ctx.stroke();
            ctx.fillStyle='#38bdf8'; ctx.fillText("First (B)", x+45, y+5);
            drawArrowHead(ctx, x+40, y, 10, 0);

            // I (Second) - Down-Left (Pseudo 3D)
            ctx.strokeStyle = '#f59e0b';
            ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x-25, y+25); ctx.stroke();
            ctx.fillStyle='#f59e0b'; ctx.fillText("Second (I)", x-50, y+35);
            drawArrowHead(ctx, x-25, y+25, -10, 10);
            
            ctx.fillStyle = '#94a3b8';
            ctx.fillText("Left Hand Rule", x, y+50);
        };

        useEffect(() => {
            requestRef.current = requestAnimationFrame(loop);
            return () => cancelAnimationFrame(requestRef.current);
        }, [fieldDir, currentDir, currentOn]);

        useEffect(() => {
            if (window.lucide) window.lucide.createIcons();
        });

        return (
            <div className="h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden flex flex-col">
                <nav className="bg-slate-800 border-b border-slate-700 px-4 py-2 flex items-center justify-between shrink-0 h-14">
                    <div className="flex items-center space-x-3">
                        <div className="bg-green-500/20 p-1.5 rounded-lg">
                            <i data-lucide="hand-metal" className="w-5 h-5 text-green-400"></i>
                        </div>
                        <h1 className="text-lg font-bold text-white tracking-wide">Fleming's Left-Hand Rule</h1>
                    </div>
                    <div className="text-[10px] text-slate-400 font-mono bg-slate-900 px-2 py-1 rounded-full border border-slate-700">
                        Topic: Electromagnetism
                    </div>
                </nav>

                <main className="flex-1 overflow-hidden">
                    <div className="h-full max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-4">
                        
                        {/* LEFT: Canvas */}
                        <div className="lg:col-span-3 bg-slate-950 relative border-r border-slate-700">
                            <canvas 
                                ref={canvasRef} 
                                width={CANVAS_WIDTH} 
                                height={CANVAS_HEIGHT}
                                className="w-full h-full object-contain"
                            />
                            {/* Legend Overlay */}
                            <div className="absolute top-4 right-4 bg-slate-900/80 border border-slate-700 p-3 rounded-xl backdrop-blur">
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                    <div className="text-xs text-slate-300">North Pole</div>
                                </div>
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                                    <div className="text-xs text-slate-300">South Pole</div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-1 bg-amber-500 rounded"></div>
                                    <div className="text-xs text-slate-300">Current Wire</div>
                                </div>
                            </div>
                        </div>

                        {/* RIGHT: Controls */}
                        <div className="lg:col-span-1 bg-slate-900 border-l border-slate-700 flex flex-col h-full overflow-y-auto custom-scroll">
                            
                            <div className="p-5 space-y-8 my-auto">
                                
                                {/* Current Control */}
                                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-sm font-bold text-amber-400 flex items-center">
                                            <i data-lucide="zap" className="w-4 h-4 mr-2"></i> Current (I)
                                        </h3>
                                        <button 
                                            onClick={() => setCurrentOn(!currentOn)}
                                            className={`px-2 py-1 text-[10px] font-bold rounded ${currentOn ? 'bg-green-600 text-white' : 'bg-slate-700 text-slate-400'}`}
                                        >
                                            {currentOn ? "ON" : "OFF"}
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-2">
                                        <button 
                                            onClick={() => setCurrentDir(1)}
                                            disabled={!currentOn}
                                            className={`btn-toggle py-3 rounded-lg border text-xs font-bold flex flex-col items-center gap-1
                                                ${currentDir === 1 ? 'bg-amber-500/20 border-amber-500 text-amber-300' : 'bg-slate-900 border-slate-700 text-slate-500'}`}
                                        >
                                            <i data-lucide="arrow-up-right" className="w-4 h-4"></i>
                                            Into Screen
                                        </button>
                                        <button 
                                            onClick={() => setCurrentDir(-1)}
                                            disabled={!currentOn}
                                            className={`btn-toggle py-3 rounded-lg border text-xs font-bold flex flex-col items-center gap-1
                                                ${currentDir === -1 ? 'bg-amber-500/20 border-amber-500 text-amber-300' : 'bg-slate-900 border-slate-700 text-slate-500'}`}
                                        >
                                            <i data-lucide="arrow-down-left" className="w-4 h-4"></i>
                                            Out of Screen
                                        </button>
                                    </div>
                                </div>

                                {/* Magnetic Field Control */}
                                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                    <h3 className="text-sm font-bold text-sky-400 mb-4 flex items-center">
                                        <i data-lucide="magnet" className="w-4 h-4 mr-2"></i> Magnetic Field (B)
                                    </h3>
                                    
                                    <div className="grid grid-cols-2 gap-2">
                                        <button 
                                            onClick={() => setFieldDir(1)}
                                            className={`btn-toggle py-3 rounded-lg border text-xs font-bold flex flex-col items-center gap-1
                                                ${fieldDir === 1 ? 'bg-sky-500/20 border-sky-500 text-sky-300' : 'bg-slate-900 border-slate-700 text-slate-500'}`}
                                        >
                                            <div className="flex gap-1 items-center">
                                                <span className="text-red-500 font-bold">N</span>
                                                <i data-lucide="arrow-right" className="w-3 h-3"></i>
                                                <span className="text-blue-500 font-bold">S</span>
                                            </div>
                                            Left to Right
                                        </button>
                                        <button 
                                            onClick={() => setFieldDir(-1)}
                                            className={`btn-toggle py-3 rounded-lg border text-xs font-bold flex flex-col items-center gap-1
                                                ${fieldDir === -1 ? 'bg-sky-500/20 border-sky-500 text-sky-300' : 'bg-slate-900 border-slate-700 text-slate-500'}`}
                                        >
                                            <div className="flex gap-1 items-center">
                                                <span className="text-blue-500 font-bold">S</span>
                                                <i data-lucide="arrow-left" className="w-3 h-3"></i>
                                                <span className="text-red-500 font-bold">N</span>
                                            </div>
                                            Right to Left
                                        </button>
                                    </div>
                                </div>

                                {/* Result Display */}
                                <div className="bg-green-900/20 border border-green-500/30 p-4 rounded-xl text-center">
                                    <div className="text-xs text-green-300 font-bold uppercase mb-1">Resulting Force</div>
                                    <div className="text-2xl font-black text-white flex items-center justify-center gap-2">
                                        {currentOn ? (
                                            forceDir === -1 ? (
                                                <>
                                                    <i data-lucide="arrow-down" className="w-6 h-6"></i> DOWN
                                                </>
                                            ) : (
                                                <>
                                                    <i data-lucide="arrow-up" className="w-6 h-6"></i> UP
                                                </>
                                            )
                                        ) : (
                                            <span className="text-slate-500">None</span>
                                        )}
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
