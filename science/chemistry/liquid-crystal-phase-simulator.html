<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Crystal Phase Simulator - LuminousLearner International</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Three.js (r128) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        canvas { outline: none; }
        
        /* Slider Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; 
            background: #fff; border: 4px solid #38bdf8; cursor: pointer; margin-top: -10px; 
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; cursor: pointer; background: rgba(255,255,255,0.1); border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Safe Icon Component
        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        try {
                            const svgElement = window.lucide.createElement(iconData);
                            svgElement.setAttribute('class', className);
                            svgElement.setAttribute('width', size);
                            svgElement.setAttribute('height', size);
                            setSvgHtml(svgElement.outerHTML);
                        } catch (e) {}
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- PHASE CONFIG ---
        // Thresholds for auto-detection
        const PHASE_THRESHOLDS = {
            solid: 20,
            smectic: 50,
            nematic: 85
        };

        const PHASES = {
            solid: { 
                id: 'solid', name: 'Solid Crystal', temp: 0, 
                color: 'text-blue-400', bg: 'bg-blue-500',
                desc: 'Highly ordered state. Molecules vibrate in fixed positions and maintain a fixed orientation.' 
            },
            smectic: { 
                id: 'smectic', name: 'Smectic Liquid Crystal', temp: 35, 
                color: 'text-emerald-400', bg: 'bg-emerald-500',
                desc: 'Molecules form distinct layers. They flow within the layers but keep their orientation. (Like soap films).' 
            },
            nematic: { 
                id: 'nematic', name: 'Nematic Liquid Crystal', temp: 70, 
                color: 'text-yellow-400', bg: 'bg-yellow-500',
                desc: 'No layers (Positional Disorder). Molecules flow freely but stay parallel (Orientational Order). Used in LCD screens.' 
            },
            liquid: { 
                id: 'liquid', name: 'Isotropic Liquid', temp: 100, 
                color: 'text-red-400', bg: 'bg-red-500',
                desc: 'Complete disorder. Random position and random orientation. Properties are the same in all directions.' 
            }
        };

        const MOLECULE_COUNT = 300;

        // --- 3D SCENE COMPONENT ---
        const Scene3D = ({ temp }) => {
            const mountRef = useRef(null);
            const tempRef = useRef(temp);

            // Sync temp ref for animation loop
            useEffect(() => {
                tempRef.current = temp;
            }, [temp]);

            useEffect(() => {
                const container = mountRef.current;
                if (!container) return;

                // 1. Init Scene
                const width = container.clientWidth || window.innerWidth;
                const height = container.clientHeight || window.innerHeight;
                
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x020617); // Dark Blue

                const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
                camera.position.set(20, 15, 25);
                camera.lookAt(0, 0, 0);

                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(width, height);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                container.appendChild(renderer.domElement);

                // Controls
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.autoRotate = true;
                controls.autoRotateSpeed = 0.5;

                // 2. Visual Helpers
                const gridHelper = new THREE.GridHelper(40, 40, 0x334155, 0x1e293b);
                gridHelper.position.y = -8;
                scene.add(gridHelper);

                const boxGeometry = new THREE.BoxGeometry(18, 18, 18);
                const boxEdges = new THREE.EdgesGeometry(boxGeometry);
                const boxLine = new THREE.LineSegments(boxEdges, new THREE.LineBasicMaterial({ color: 0x64748b, opacity: 0.4, transparent: true }));
                scene.add(boxLine);

                const axesHelper = new THREE.AxesHelper(2);
                axesHelper.position.set(-9, -9, 9);
                scene.add(axesHelper);

                // Lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);
                const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
                dirLight.position.set(10, 20, 10);
                scene.add(dirLight);

                // 3. Molecules
                const geometry = new THREE.CylinderGeometry(0.25, 0.25, 1.6, 8);
                const material = new THREE.MeshStandardMaterial({ 
                    color: 0x22d3ee, // Cyan
                    roughness: 0.2,
                    metalness: 0.1
                });

                const mesh = new THREE.InstancedMesh(geometry, material, MOLECULE_COUNT);
                scene.add(mesh);

                // Data
                const dummy = new THREE.Object3D();
                const molecules = [];
                
                let idx = 0;
                const dim = Math.ceil(Math.pow(MOLECULE_COUNT, 1/3));
                const spacing = 2.2;
                const offset = (dim * spacing) / 2;

                for (let x = 0; x < dim; x++) {
                    for (let y = 0; y < dim; y++) {
                        for (let z = 0; z < dim; z++) {
                            if (idx >= MOLECULE_COUNT) break;
                            molecules.push({
                                // Base lattice (Solid)
                                bx: x * spacing - offset,
                                by: y * spacing - offset,
                                bz: z * spacing - offset,
                                // Current pos
                                x: x * spacing - offset,
                                y: y * spacing - offset,
                                z: z * spacing - offset,
                                // Velocities
                                vx: (Math.random()-0.5)*0.05,
                                vy: (Math.random()-0.5)*0.05,
                                vz: (Math.random()-0.5)*0.05,
                                // Rotation base
                                rx: 0, ry: 0, rz: 0,
                                // Rotation velocities
                                vrx: (Math.random()-0.5)*0.05,
                                vry: (Math.random()-0.5)*0.05,
                                vrz: (Math.random()-0.5)*0.05,
                                // Phase offsets for wobbly movement
                                phaseOff: Math.random() * 10
                            });
                            idx++;
                        }
                    }
                }

                // 4. Loop
                let frameId;
                const animate = () => {
                    frameId = requestAnimationFrame(animate);
                    const t = tempRef.current; // 0 to 100
                    
                    // Simulation Parameters based on Temp
                    // 0-20: Solid (Vibrate)
                    // 20-50: Smectic (Layer drift)
                    // 50-85: Nematic (Free drift, aligned)
                    // 85-100: Liquid (Chaos)

                    const B = 9; // Bounds
                    const layerSpacing = 2.5;
                    const time = Date.now() * 0.001;

                    molecules.forEach((mol, i) => {
                        // --- POSITION LOGIC ---
                        
                        // Thermal Vibration (increases with T)
                        const vibAmp = t * 0.003; 
                        const vibX = Math.sin(time * 5 + mol.phaseOff) * vibAmp;
                        const vibY = Math.cos(time * 5 + mol.phaseOff) * vibAmp;
                        const vibZ = Math.sin(time * 5 + mol.phaseOff + 2) * vibAmp;

                        if (t < 20) { 
                            // SOLID: Stick to grid + vibrate
                            mol.x += (mol.bx - mol.x) * 0.1;
                            mol.y += (mol.by - mol.y) * 0.1;
                            mol.z += (mol.bz - mol.z) * 0.1;
                        } else if (t < 50) { 
                            // SMECTIC: Y is constrained to layers, X/Z drift
                            const layerY = Math.round(mol.y / layerSpacing) * layerSpacing;
                            const layerStrength = Math.max(0, (50 - t) / 30); // Layers get weaker as T increases
                            
                            // Pull to layer center based on strength
                            mol.y += (layerY - mol.y) * 0.05 * layerStrength; 
                            
                            // Drift in X/Z
                            mol.x += mol.vx * (t/20);
                            mol.z += mol.vz * (t/20);
                            // Slight drift in Y allowed
                            mol.y += mol.vy * (t/100);
                        } else { 
                            // NEMATIC / LIQUID: Free 3D drift
                            mol.x += mol.vx * (t/30);
                            mol.y += mol.vy * (t/30);
                            mol.z += mol.vz * (t/30);
                        }

                        // Add vibration visual
                        const renderX = mol.x + vibX;
                        const renderY = mol.y + vibY;
                        const renderZ = mol.z + vibZ;

                        // Wrap around bounds
                        if (mol.x > B) mol.x -= 2*B; if (mol.x < -B) mol.x += 2*B;
                        if (mol.y > B) mol.y -= 2*B; if (mol.y < -B) mol.y += 2*B;
                        if (mol.z > B) mol.z -= 2*B; if (mol.z < -B) mol.z += 2*B;

                        // --- ROTATION LOGIC ---
                        dummy.position.set(renderX, renderY, renderZ);
                        
                        if (t < 85) { 
                            // ORDERED (Solid/Smectic/Nematic)
                            // Align mostly vertical (Y axis)
                            // Disorder increases with T
                            const disorder = t / 100; // 0 to 1
                            const wobbleAmp = disorder * 1.5; // Max wobble
                            
                            dummy.rotation.set(
                                Math.sin(time + mol.phaseOff) * wobbleAmp, 
                                mol.phaseOff, // Random Y rotation is irrelevant for cylinder
                                Math.cos(time + mol.phaseOff) * wobbleAmp
                            );
                        } else { 
                            // LIQUID: Complete tumble
                            mol.rx += mol.vrx;
                            mol.ry += mol.vry;
                            mol.rz += mol.vrz;
                            dummy.rotation.set(mol.rx, mol.ry, mol.rz);
                        }

                        dummy.updateMatrix();
                        mesh.setMatrixAt(i, dummy.matrix);
                    });

                    mesh.instanceMatrix.needsUpdate = true;
                    controls.update();
                    renderer.render(scene, camera);
                };
                
                animate();

                // Resize
                const handleResize = () => {
                    if (!container) return;
                    const w = container.clientWidth;
                    const h = container.clientHeight;
                    if (w && h) {
                        camera.aspect = w / h;
                        camera.updateProjectionMatrix();
                        renderer.setSize(w, h);
                    }
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    cancelAnimationFrame(frameId);
                    window.removeEventListener('resize', handleResize);
                    if (container && renderer.domElement) {
                        container.removeChild(renderer.domElement);
                    }
                    geometry.dispose();
                    material.dispose();
                };
            }, []);

            return <div ref={mountRef} className="w-full h-full" />;
        };

        // --- UI APP ---
        const App = () => {
            const [temp, setTemp] = useState(0); // 0 to 100
            
            // Determine active phase based on temp
            let activePhaseKey = 'solid';
            if (temp > PHASE_THRESHOLDS.solid) activePhaseKey = 'smectic';
            if (temp > PHASE_THRESHOLDS.smectic) activePhaseKey = 'nematic';
            if (temp > PHASE_THRESHOLDS.nematic) activePhaseKey = 'liquid';
            
            const activePhase = PHASES[activePhaseKey];

            // Handle button click: Jump to ideal temp for that phase
            const handlePhaseClick = (key) => {
                setTemp(PHASES[key].temp);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800 shrink-0">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="layers" className="text-emerald-400" /> Phase Simulator
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">LuminousLearner International</p>
                        </div>

                        <div className="p-6 flex-1 overflow-y-auto">
                            
                            {/* Status Card */}
                            <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-lg mb-8">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Current State</span>
                                    <span className="text-xs font-mono text-blue-300 bg-blue-900/30 px-2 py-0.5 rounded">{Math.round(temp)}% Heat</span>
                                </div>
                                <div className={`text-2xl font-black mb-2 transition-all duration-300 ${activePhase.color}`}>
                                    {activePhase.name}
                                </div>
                                <p className="text-sm text-slate-300 leading-relaxed h-20">
                                    {activePhase.desc}
                                </p>
                            </div>

                            {/* 1. Quick Jump Buttons */}
                            <div className="space-y-3 mb-8">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">Quick Jump</label>
                                {Object.entries(PHASES).map(([key, p]) => (
                                    <button 
                                        key={key}
                                        onClick={() => handlePhaseClick(key)}
                                        className={`w-full text-left p-3 rounded-xl border transition-all flex items-center gap-3 relative overflow-hidden
                                            ${activePhaseKey === key 
                                                ? 'bg-slate-800 border-white/30 ring-1 ring-white/20 shadow-lg' 
                                                : 'bg-slate-900 border-slate-800 hover:bg-slate-800 hover:border-slate-700'}
                                        `}
                                    >
                                        <div className={`w-2 h-2 rounded-full ${p.bg}`}></div>
                                        <span className={`font-bold text-sm ${activePhaseKey === key ? 'text-white' : 'text-slate-400'}`}>
                                            {p.name}
                                        </span>
                                        {activePhaseKey === key && (
                                            <div className="absolute right-4 text-emerald-400">
                                                <Icon name="check-circle" size={16} />
                                            </div>
                                        )}
                                    </button>
                                ))}
                            </div>

                            {/* 2. Continuous Slider */}
                            <div className="space-y-4 pt-6 border-t border-slate-800">
                                <div className="flex justify-between items-center">
                                    <label className="text-xs font-bold text-red-400 uppercase tracking-wider flex items-center gap-2">
                                        <Icon name="thermometer" size={14}/> Heat Energy
                                    </label>
                                    <span className="text-xs font-mono text-slate-500">Slide to observe transition</span>
                                </div>
                                
                                <div className="relative h-12 flex items-center group">
                                    <input 
                                        type="range" min="0" max="100" step="0.1"
                                        value={temp} 
                                        onChange={(e) => setTemp(parseFloat(e.target.value))}
                                        className="z-20 relative w-full cursor-pointer"
                                    />
                                    
                                    {/* Gradient Track Background */}
                                    <div className="absolute top-1/2 left-0 right-0 h-3 -mt-1.5 rounded-full overflow-hidden flex pointer-events-none ring-1 ring-white/10">
                                        {/* Solid Section */}
                                        <div className="h-full bg-blue-900/60" style={{width: `${PHASE_THRESHOLDS.solid}%`}}></div>
                                        {/* Smectic Section */}
                                        <div className="h-full bg-emerald-900/60" style={{width: `${PHASE_THRESHOLDS.smectic - PHASE_THRESHOLDS.solid}%`}}></div>
                                        {/* Nematic Section */}
                                        <div className="h-full bg-yellow-900/60" style={{width: `${PHASE_THRESHOLDS.nematic - PHASE_THRESHOLDS.smectic}%`}}></div>
                                        {/* Liquid Section */}
                                        <div className="h-full bg-red-900/60 flex-1"></div>
                                    </div>

                                    {/* Active Fill */}
                                    <div 
                                        className="absolute top-1/2 left-0 h-3 -mt-1.5 rounded-full bg-gradient-to-r from-blue-500 via-emerald-400 to-yellow-400 opacity-50 pointer-events-none transition-all duration-75"
                                        style={{width: `${temp}%`}}
                                    ></div>
                                </div>
                                
                                <div className="flex justify-between text-[10px] text-slate-500 font-mono px-1">
                                    <span>0%</span>
                                    <span>Solid</span>
                                    <span>Smectic</span>
                                    <span>Nematic</span>
                                    <span>Liquid</span>
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 relative bg-[#020617] overflow-hidden flex flex-col">
                        
                        <div className="flex-1 relative">
                            <Scene3D temp={temp} />
                            
                            <div className="absolute bottom-6 right-6 text-slate-500 text-xs pointer-events-none select-none bg-black/40 backdrop-blur px-4 py-2 rounded-full border border-white/10">
                                Left Click: Rotate • Right Click: Pan • Scroll: Zoom
                            </div>

                            <div className="absolute top-6 left-6 pointer-events-none">
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 bg-cyan-400 rounded-full animate-ping"></div>
                                    <span className="text-cyan-400 font-mono text-sm font-bold uppercase tracking-widest">Live View</span>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
