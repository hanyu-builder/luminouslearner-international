<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test for Water Simulator - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Dropper Animation */
        @keyframes drop-fall {
            0% { top: -20px; opacity: 1; transform: scale(1); }
            90% { top: 40px; opacity: 1; transform: scale(0.8); }
            100% { top: 45px; opacity: 0; transform: scale(1.5); }
        }
        .anim-drop {
            animation: drop-fall 1s ease-in forwards;
        }

        /* Cobalt Paper Spread (Pink) */
        @keyframes spread-pink {
            0% { width: 0; height: 0; opacity: 0.8; }
            100% { width: 60px; height: 60px; opacity: 0.9; }
        }
        .spot-pink {
            background: radial-gradient(circle, #f472b6 0%, #fbcfe8 70%, transparent 100%);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: spread-pink 1.5s ease-out forwards;
        }

        /* Copper Powder Spread (Blue) */
        @keyframes spread-blue {
            0% { transform: scale(0); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .spot-blue {
            background: radial-gradient(circle, #3b82f6 0%, #93c5fd 80%, transparent 100%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: spread-blue 1.5s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        const iconSvg = window.lucide.createElement(iconNode);
                        iconSvg.setAttribute('width', size);
                        iconSvg.setAttribute('height', size);
                        iconSvg.setAttribute('class', className);
                        setSvg(iconSvg.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        // Reagent Data (Internationalized)
        const Reagents = {
            cobalt: {
                id: 'cobalt',
                name: 'Cobalt Chloride Paper',
                desc: 'Blue when dry, turns Pink when wet.',
                baseColor: 'bg-blue-600', // Dry color
                wetColor: 'bg-pink-400', // Wet color (with water)
                type: 'paper'
            },
            copper: {
                id: 'copper',
                name: 'Anhydrous Copper(II) Sulfate',
                desc: 'White powder, turns Blue when wet.',
                baseColor: 'bg-slate-200', // Dry color (White/Light Gray)
                wetColor: 'bg-blue-600', // Wet color (with water)
                type: 'powder'
            }
        };

        // Sample Data (Internationalized)
        const Samples = [
            { id: 'water', name: 'Distilled Water', hasWater: true, color: 'bg-blue-100/50' },
            { id: 'tap', name: 'Tap Water', hasWater: true, color: 'bg-blue-100/50' },
            { id: 'oil', name: 'Cooking Oil', hasWater: false, color: 'bg-yellow-200/50' },
            { id: 'ethanol', name: 'Pure Ethanol', hasWater: false, color: 'bg-slate-100/50' }
        ];

        const App = () => {
            const [selectedReagent, setSelectedReagent] = useState(Reagents.cobalt);
            const [selectedSample, setSelectedSample] = useState(null);
            const [isDropping, setIsDropping] = useState(false);
            const [testResult, setTestResult] = useState(null); // 'positive' | 'negative' | null
            const [history, setHistory] = useState([]);

            const handleTest = () => {
                if (!selectedSample || isDropping) return;
                
                setIsDropping(true);
                setTestResult(null);

                // Animation delay
                setTimeout(() => {
                    if (selectedSample.hasWater) {
                        setTestResult('positive');
                    } else {
                        setTestResult('negative');
                    }
                    setIsDropping(false);
                    
                    // Add to history
                    setHistory(prev => [{
                        reagent: selectedReagent.name,
                        sample: selectedSample.name,
                        result: selectedSample.hasWater ? 'Contains Water (Positive)' : 'No Water (Negative)'
                    }, ...prev].slice(0, 5));

                }, 1000);
            };

            const resetTest = () => {
                setTestResult(null);
                setIsDropping(false);
            };

            const handleReagentChange = (reagent) => {
                setSelectedReagent(reagent);
                resetTest();
            };

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-5xl">
                    
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-blue-400 flex items-center gap-2">
                                <Icon name="Droplets" /> Test for Water Simulator
                            </h1>
                            <p className="text-slate-400 text-sm">Chemical Analysis: Presence of Water</p>
                        </div>
                        <button 
                            onClick={() => {setHistory([]); resetTest();}} 
                            className="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg flex items-center gap-2 transition-colors text-sm font-bold border border-slate-600"
                        >
                            <Icon name="RotateCcw" size={16} /> Clear Log
                        </button>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-6 flex-grow">
                        
                        {/* Left: Experiment Area */}
                        <div className="lg:w-2/3 bg-slate-900 rounded-2xl border border-slate-700 shadow-xl p-6 flex flex-col relative min-h-[500px]">
                            
                            {/* Step 1: Select Reagent */}
                            <div className="mb-8">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-3 flex items-center gap-2">
                                    <span className="bg-slate-700 text-slate-300 w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                                    Select Reagent
                                </h3>
                                <div className="grid grid-cols-2 gap-4">
                                    {Object.values(Reagents).map((r) => (
                                        <button
                                            key={r.id}
                                            onClick={() => handleReagentChange(r)}
                                            className={`p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 text-center
                                                ${selectedReagent.id === r.id 
                                                    ? 'border-blue-500 bg-blue-900/30 ring-2 ring-blue-500/50' 
                                                    : 'border-slate-700 bg-slate-800 hover:border-slate-500'}
                                            `}
                                        >
                                            <div className={`w-12 h-12 rounded-full shadow-inner border-2 border-white/20 ${r.baseColor}`}></div>
                                            <span className="font-bold text-sm text-slate-200">{r.name}</span>
                                        </button>
                                    ))}
                                </div>
                                <div className="mt-3 text-xs text-slate-400 bg-slate-950 p-2 rounded text-center border border-slate-800">
                                    {selectedReagent.desc}
                                </div>
                            </div>

                            {/* Step 2: Experiment Stage */}
                            <div className="flex-grow bg-slate-800 rounded-xl border border-slate-700 relative flex items-center justify-center overflow-hidden group shadow-inner">
                                {/* Lab Bench Texture */}
                                <div className="absolute inset-0 opacity-5 pointer-events-none" 
                                     style={{backgroundImage: 'radial-gradient(#fff 1px, transparent 1px)', backgroundSize: '20px 20px'}}></div>

                                {/* Reagent Visual */}
                                <div className="relative z-10 transform -translate-y-8">
                                    {selectedReagent.type === 'paper' ? (
                                        // Cobalt Chloride Paper
                                        <div className={`w-40 h-16 ${selectedReagent.baseColor} shadow-lg transform -rotate-2 transition-colors duration-500 relative overflow-hidden border border-white/20`}>
                                            {/* Texture */}
                                            <div className="absolute inset-0 opacity-20 bg-white mix-blend-overlay"></div>
                                            {/* Water Spot */}
                                            {testResult === 'positive' && <div className="spot-pink"></div>}
                                            {testResult === 'negative' && <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-black/20 rounded-full blur-md opacity-0 animate-in fade-in duration-1000 opacity-100"></div>}
                                        </div>
                                    ) : (
                                        // Copper Sulphate Powder (in a watch glass)
                                        <div className="w-48 h-48 relative flex items-center justify-center">
                                            {/* Watch Glass */}
                                            <div className="absolute bottom-0 w-full h-12 bg-white/10 border-b-4 border-white/20 rounded-[50%] shadow-xl backdrop-blur-sm z-20"></div>
                                            
                                            {/* Powder Pile */}
                                            <div className={`absolute bottom-4 w-32 h-12 ${selectedReagent.baseColor} rounded-[50%] z-10 transform scale-y-75 shadow-inner transition-all duration-700`}>
                                                {testResult === 'positive' && <div className="spot-blue"></div>}
                                                {testResult === 'negative' && <div className="absolute inset-0 bg-yellow-900/20 rounded-[50%]"></div>}
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Dropper Animation */}
                                {isDropping && (
                                    <div className="absolute top-4 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center">
                                        {/* Dropper Body */}
                                        <div className="w-4 h-24 bg-slate-200 border border-slate-400 rounded-b-full relative shadow-xl">
                                            <div className={`absolute bottom-0 w-full h-8 ${selectedSample?.color} rounded-b-full`}></div>
                                        </div>
                                        {/* Drop */}
                                        <div className={`w-3 h-3 ${selectedSample?.color} rounded-full absolute top-24 anim-drop border border-slate-300`}></div>
                                    </div>
                                )}

                                {/* Controls Overlay */}
                                <div className="absolute bottom-4 left-0 w-full flex justify-center gap-2 px-4 pt-4">
                                    {Samples.map((sample) => (
                                        <button
                                            key={sample.id}
                                            onClick={() => { setSelectedSample(sample); resetTest(); }}
                                            disabled={isDropping}
                                            className={`px-3 py-2 rounded-lg text-xs font-bold shadow-sm transition-all border
                                                ${selectedSample?.id === sample.id 
                                                    ? 'bg-slate-700 text-white border-slate-500 transform -translate-y-1 ring-1 ring-slate-400' 
                                                    : 'bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700 hover:text-slate-200'}
                                            `}
                                        >
                                            {sample.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Action Button */}
                            <div className="mt-6 flex justify-center">
                                <button 
                                    onClick={handleTest}
                                    disabled={!selectedSample || isDropping || testResult !== null}
                                    className="px-8 py-3 bg-green-600 hover:bg-green-500 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed text-white font-bold rounded-full shadow-lg transition-all flex items-center gap-2 text-lg"
                                >
                                    {isDropping ? 'Testing...' : testResult ? 'Test Complete (Select New Sample)' : <span><Icon name="Droplet" className="inline mr-2"/> Add Drop</span>}
                                </button>
                            </div>

                        </div>

                        {/* Right: Observations & Conclusion */}
                        <div className="lg:w-1/3 flex flex-col gap-4">
                            
                            {/* Observation Panel */}
                            <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-lg min-h-[200px]">
                                <h3 className="font-bold border-b border-slate-700 pb-2 mb-4 flex items-center gap-2 text-slate-300">
                                    <Icon name="Eye" /> Observations
                                </h3>
                                {testResult ? (
                                    <div className={`p-4 rounded-lg border-l-4 text-lg font-bold animate-in slide-in-from-bottom-2
                                        ${testResult === 'positive' ? 'bg-green-900/20 border-green-500 text-green-400' : 
                                          'bg-red-900/20 border-red-500 text-red-400'}
                                    `}>
                                        {selectedReagent.id === 'cobalt' 
                                            ? (testResult === 'positive' ? 'Turns Pink (Water Present)' : 'Remains Blue (No Water)')
                                            : (testResult === 'positive' ? 'Turns Blue (Water Present)' : 'Remains White (No Water)')
                                        }
                                    </div>
                                ) : (
                                    <div className="text-slate-500 text-center py-8 italic border-2 border-dashed border-slate-700 rounded-lg">
                                        Select a sample and click "Add Drop"...
                                    </div>
                                )}
                            </div>

                            {/* History Log */}
                            <div className="bg-slate-800 rounded-xl p-5 text-slate-300 border border-slate-700 shadow-lg flex-grow flex flex-col min-h-[300px]">
                                <h3 className="font-bold border-b border-slate-700 pb-2 mb-3 flex items-center gap-2 text-slate-300">
                                    <Icon name="ClipboardList" /> Lab Log
                                </h3>
                                <div className="space-y-2 font-mono text-sm flex-grow overflow-y-auto max-h-[250px]">
                                    {history.map((item, idx) => (
                                        <div key={idx} className={`p-3 rounded border-l-2 ${
                                            item.result.includes('Positive') ? 'bg-green-900/10 border-green-500 text-green-300' : 'bg-slate-900/50 border-slate-600 text-slate-400'
                                        }`}>
                                            <div className="font-bold text-xs uppercase mb-1">{item.sample}</div>
                                            <div>{item.reagent}: {item.result}</div>
                                        </div>
                                    ))}
                                    {history.length === 0 && <p className="text-slate-500 text-center mt-10">No tests recorded yet.</p>}
                                </div>
                            </div>

                        </div>
                    </div>

                    <div className="text-center text-slate-600 text-xs mt-8 border-t border-slate-800 pt-4">
                        Designed for HKDSE Chemistry | Luminous Learner Science Tools
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
