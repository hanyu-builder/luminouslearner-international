<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ionic Bond Animator - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .electron {
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: grab;
        }
        .electron:active { cursor: grabbing; }
        
        .atom-shell {
            transition: all 0.3s ease;
        }
        
        @keyframes pulse-success {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(34, 197, 94, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .animate-success {
            animation: pulse-success 1s infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 3s infinite ease-in-out;
        }
        
        /* Lattice 3D Effect */
        .lattice-grid {
            perspective: 1000px;
        }
        .lattice-ion {
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        const iconSvg = window.lucide.createElement(iconNode);
                        iconSvg.setAttribute('width', size);
                        iconSvg.setAttribute('height', size);
                        iconSvg.setAttribute('class', className);
                        setSvg(iconSvg.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        // Atom Data (Internationalized)
        const Atoms = {
            Na: { symbol: 'Na', name: 'Sodium', z: 11, valence: 1, type: 'metal', color: 'bg-yellow-500' },
            Mg: { symbol: 'Mg', name: 'Magnesium', z: 12, valence: 2, type: 'metal', color: 'bg-orange-500' },
            Li: { symbol: 'Li', name: 'Lithium', z: 3, valence: 1, type: 'metal', color: 'bg-red-500' },
            Cl: { symbol: 'Cl', name: 'Chlorine', z: 17, valence: 7, type: 'nonmetal', color: 'bg-green-500' },
            O: { symbol: 'O', name: 'Oxygen', z: 8, valence: 6, type: 'nonmetal', color: 'bg-blue-500' },
            F: { symbol: 'F', name: 'Fluorine', z: 9, valence: 7, type: 'nonmetal', color: 'bg-teal-500' }
        };

        // Possible Combinations with Ratios
        const Reactions = [
            { id: 'NaCl', metal: 'Na', nonmetal: 'Cl', mCount: 1, nmCount: 1, product: 'Sodium Chloride' },
            { id: 'MgO', metal: 'Mg', nonmetal: 'O', mCount: 1, nmCount: 1, product: 'Magnesium Oxide' },
            { id: 'LiF', metal: 'Li', nonmetal: 'F', mCount: 1, nmCount: 1, product: 'Lithium Fluoride' },
            { id: 'MgCl2', metal: 'Mg', nonmetal: 'Cl', mCount: 1, nmCount: 2, product: 'Magnesium Chloride' },
            { id: 'Li2O', metal: 'Li', nonmetal: 'O', mCount: 2, nmCount: 1, product: 'Lithium Oxide' }
        ];

        const App = () => {
            const [currentReaction, setCurrentReaction] = useState(Reactions[0]);
            const [transferredCount, setTransferredCount] = useState(0);
            const [stage, setStage] = useState('transfer'); // transfer, success, lattice
            
            const metal = Atoms[currentReaction.metal];
            const nonmetal = Atoms[currentReaction.nonmetal];
            
            const totalToTransfer = metal.valence * currentReaction.mCount;

            // Initialize
            useEffect(() => {
                setTransferredCount(0);
                setStage('transfer');
            }, [currentReaction]);

            // Handle Transfer Click
            const handleTransfer = () => {
                if (transferredCount < totalToTransfer) {
                    setTransferredCount(prev => {
                        const next = prev + 1;
                        // If all transferred
                        if (next === totalToTransfer) {
                            setTimeout(() => setStage('success'), 500);
                        }
                        return next;
                    });
                }
            };

            // Reset
            const reset = () => {
                setTransferredCount(0);
                setStage('transfer');
            };

            // Render Single Atom
            const renderAtom = (atomData, isMetal, index, totalTypeCount) => {
                let myTransferred = 0;
                let myReceived = 0;

                if (isMetal) {
                    const maxLoss = atomData.valence;
                    const consumedByPrevious = index * maxLoss;
                    const availableForMe = Math.max(0, transferredCount - consumedByPrevious);
                    myTransferred = Math.min(availableForMe, maxLoss);
                } else {
                    const maxGain = 8 - atomData.valence;
                    const consumedByPrevious = index * maxGain;
                    const availableForMe = Math.max(0, transferredCount - consumedByPrevious);
                    myReceived = Math.min(availableForMe, maxGain);
                }

                const isComplete = isMetal 
                    ? myTransferred === atomData.valence 
                    : myReceived === (8 - atomData.valence);

                const electrons = [];
                const currentElectrons = isMetal 
                    ? atomData.valence - myTransferred 
                    : atomData.valence + myReceived;

                for (let i = 0; i < currentElectrons; i++) {
                    const angle = (i / (isMetal ? atomData.valence : 8)) * 2 * Math.PI - Math.PI/2;
                    const r = 50; 
                    const x = Math.cos(angle) * r;
                    const y = Math.sin(angle) * r;
                    
                    const isReceivedElectron = !isMetal && i >= atomData.valence;
                    const colorClass = isReceivedElectron ? Atoms[currentReaction.metal].color : atomData.color;
                    
                    electrons.push(
                        <div key={i} 
                             className={`absolute w-3 h-3 rounded-full border border-white shadow-sm transition-all duration-500 ${colorClass}`}
                             style={{ transform: `translate(${x}px, ${y}px)` }}>
                        </div>
                    );
                }

                return (
                    <div key={`${atomData.symbol}-${index}`} className={`flex flex-col items-center gap-2 transition-all duration-500 ${stage === 'success' ? 'scale-105' : ''}`}>
                        <div className="relative w-32 h-32 flex items-center justify-center">
                            {/* Shell Ring */}
                            <div className={`absolute inset-0 rounded-full border-2 border-dashed m-4
                                ${isComplete ? 'border-green-400 opacity-60' : 'border-slate-500'}
                            `}></div>
                            
                            {/* Core */}
                            <div className={`w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold text-white shadow-lg z-10 ${atomData.color}
                                ${stage === 'success' ? 'animate-success' : ''}
                            `}>
                                {atomData.symbol}
                                {stage !== 'transfer' && (
                                    <sup className="text-xs ml-0.5">
                                        {isMetal ? `${atomData.valence}+` : `${8 - atomData.valence}-`}
                                    </sup>
                                )}
                            </div>

                            {/* Electrons */}
                            {electrons}
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-6xl">
                    
                    {/* Header */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-slate-700 pb-4 gap-4">
                        <div>
                            <h1 className="text-2xl font-bold text-green-400 flex items-center gap-2">
                                <Icon name="Zap" /> Ionic Bond Animator
                            </h1>
                            <p className="text-slate-400 text-sm">Ionic Bond Animator: 1:1, 1:2, 2:1 Ratios</p>
                        </div>
                        <div className="flex flex-wrap gap-2 justify-center">
                            {Reactions.map(r => (
                                <button
                                    key={r.id}
                                    onClick={() => setCurrentReaction(r)}
                                    className={`px-3 py-1 rounded border text-sm font-bold transition-colors
                                        ${currentReaction.id === r.id ? 'bg-green-600 text-white border-green-500' : 'bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700'}
                                    `}
                                >
                                    {r.id}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-grow flex flex-col lg:flex-row gap-8">
                        
                        {/* Visualization Area */}
                        <div className="w-full lg:w-2/3 bg-slate-800 rounded-3xl border-4 border-slate-700 relative flex flex-col items-center justify-center min-h-[500px] shadow-2xl overflow-hidden p-8">
                            
                            {/* Background Grid */}
                            <div className="absolute inset-0 opacity-10" 
                                 style={{backgroundImage: 'radial-gradient(#4ade80 1px, transparent 1px)', backgroundSize: '30px 30px'}}></div>

                            {/* Content Container */}
                            <div className="flex-grow flex flex-col justify-center items-center w-full z-10">
                                {stage !== 'lattice' ? (
                                    <div className="flex flex-col md:flex-row items-center justify-center gap-8 w-full">
                                        
                                        {/* Metal Atoms Column */}
                                        <div className="flex flex-col gap-4">
                                            {Array.from({length: currentReaction.mCount}).map((_, i) => 
                                                renderAtom(metal, true, i, currentReaction.mCount)
                                            )}
                                            <div className="text-center mt-1">
                                                <div className="text-sm font-bold text-white">{metal.name}</div>
                                                <div className="text-xs text-slate-400">Loses e⁻</div>
                                            </div>
                                        </div>

                                        {/* Transfer Controls */}
                                        <div className="flex flex-col items-center justify-center px-4 py-4">
                                            <Icon name="ArrowRight" size={40} className={`text-slate-600 transition-all duration-500 hidden md:block ${transferredCount > 0 ? 'text-green-400 scale-125' : ''}`} />
                                            <Icon name="ArrowDown" size={40} className={`text-slate-600 transition-all duration-500 md:hidden mb-4 ${transferredCount > 0 ? 'text-green-400 scale-125' : ''}`} />
                                            
                                            {stage === 'transfer' && (
                                                <button 
                                                    onClick={handleTransfer}
                                                    className="whitespace-nowrap px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-full shadow-lg transition-transform active:scale-95 animate-bounce"
                                                >
                                                    Transfer Electron ({transferredCount}/{totalToTransfer})
                                                </button>
                                            )}
                                        </div>

                                        {/* Non-Metal Atoms Column */}
                                        <div className="flex flex-col gap-4">
                                            {Array.from({length: currentReaction.nmCount}).map((_, i) => 
                                                renderAtom(nonmetal, false, i, currentReaction.nmCount)
                                            )}
                                            <div className="text-center mt-1">
                                                <div className="text-sm font-bold text-white">{nonmetal.name}</div>
                                                <div className="text-xs text-slate-400">Gains e⁻</div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    /* Lattice View */
                                    <div className="flex flex-col items-center animate-in zoom-in duration-700">
                                        <div className="grid grid-cols-3 gap-2 lattice-grid mb-6">
                                            {Array.from({length: 9}).map((_, i) => {
                                                let atom;
                                                let sign;
                                                
                                                if (currentReaction.mCount === 1 && currentReaction.nmCount === 1) {
                                                    const isPos = i % 2 === 0;
                                                    atom = isPos ? metal : nonmetal;
                                                    sign = isPos ? '+' : '-';
                                                } else if (currentReaction.mCount === 1 && currentReaction.nmCount === 2) {
                                                    const isPos = i % 3 === 0;
                                                    atom = isPos ? metal : nonmetal;
                                                    sign = isPos ? '2+' : '-';
                                                } else {
                                                    const isNeg = i % 3 === 0;
                                                    atom = isNeg ? nonmetal : metal;
                                                    sign = isNeg ? '2-' : '+';
                                                }

                                                return (
                                                    <div key={i} className={`w-16 h-16 rounded-full ${atom.color} flex items-center justify-center text-white font-bold text-xl shadow-[inset_-5px_-5px_10px_rgba(0,0,0,0.3)] border-2 border-white/20 lattice-ion animate-float`} style={{animationDelay: `${i*0.2}s`}}>
                                                        {sign}
                                                    </div>
                                                )
                                            })}
                                        </div>
                                        <div className="text-center">
                                            <h2 className="text-2xl font-bold text-white mb-2">{currentReaction.product}</h2>
                                            <p className="text-slate-300 max-w-md text-sm">
                                                Positive and negative ions pack tightly in a {currentReaction.mCount}:{currentReaction.nmCount} ratio, held together by strong electrostatic forces.
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Success Message */}
                            {stage === 'success' && (
                                <div className="mt-8 bg-green-600/90 text-white px-6 py-3 rounded-xl shadow-lg backdrop-blur flex items-center gap-3 animate-in slide-in-from-bottom-4 z-20">
                                    <Icon name="CheckCircle" size={24} />
                                    <div>
                                        <div className="font-bold">Reaction Complete!</div>
                                        <button onClick={() => setStage('lattice')} className="text-sm underline hover:text-green-200">View Lattice Structure &rarr;</button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Right: Info Panel */}
                        <div className="w-full lg:w-1/3 flex flex-col gap-6">
                            
                            <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg flex-grow">
                                <h3 className="text-lg font-bold mb-4 text-white flex items-center gap-2">
                                    <Icon name="BookOpen" /> Principles & Formulas
                                </h3>
                                
                                <div className="space-y-4 text-sm text-slate-300 leading-relaxed">
                                    <div className="p-3 bg-slate-900/50 rounded-lg border-l-4 border-blue-500">
                                        <strong className="text-white block mb-1">Chemical Formula</strong>
                                        <div className="text-xl font-mono text-center py-2 text-blue-400 font-bold">
                                            {currentReaction.id}
                                        </div>
                                        <p>
                                            Because {metal.name} has a {metal.valence}+ charge, and {nonmetal.name} has a {nonmetal.valence === 7 ? 1 : 2}- charge, 
                                            they must combine in a 
                                            <span className="text-white font-bold mx-1">{currentReaction.mCount} : {currentReaction.nmCount}</span>
                                            ratio to achieve <strong>Electrical Neutrality</strong>.
                                        </p>
                                    </div>
                                    
                                    <div className="p-3 bg-slate-900/50 rounded-lg border-l-4 border-green-500">
                                        <strong className="text-white block mb-1">Electron Transfer</strong>
                                        <ul className="list-disc list-inside mt-1 space-y-1">
                                            <li>Total electrons transferred: <span className="text-green-400 font-bold">{totalToTransfer}</span>.</li>
                                            <li>Each {metal.symbol} loses {metal.valence}.</li>
                                            <li>Each {nonmetal.symbol} gains {8 - nonmetal.valence}.</li>
                                        </ul>
                                    </div>
                                </div>

                                {stage === 'lattice' && (
                                    <div className="mt-6 pt-6 border-t border-slate-700">
                                        <button 
                                            onClick={reset}
                                            className="w-full py-3 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2"
                                        >
                                            <Icon name="RotateCcw" size={18} /> Reset Experiment
                                        </button>
                                    </div>
                                )}
                            </div>

                        </div>
                    </div>
                    
                    <div className="text-center text-slate-600 text-xs mt-8 border-t border-slate-800 pt-4">
                        Luminous Learner International | IB/A-Level Chemistry
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
