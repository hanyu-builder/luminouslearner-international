<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transition Metal Ion Color Gallery</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Liquid Animation */
        .liquid {
            transition: height 1s ease-in-out, background-color 0.8s ease-in-out;
        }
        
        /* Bubble Animation */
        @keyframes rise {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }
        .bubble {
            position: absolute;
            bottom: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            animation: rise 2s infinite ease-in;
        }
        
        /* Test Tube Glass Effect */
        .glass-tube {
            background: rgba(255, 255, 255, 0.1);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        try {
                            const svgElement = window.lucide.createElement(iconData);
                            svgElement.setAttribute('class', className);
                            svgElement.setAttribute('width', size);
                            svgElement.setAttribute('height', size);
                            setSvgHtml(svgElement.outerHTML);
                        } catch (e) { console.error(e); }
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- ION DATABASE ---
        const IONS = [
            {
                id: 'cr3', symbol: 'Cr³⁺', name: 'Chromium(III)',
                color: 'bg-green-600', hex: '#16a34a',
                desc: 'Green solution. Common in CrCl₃.',
                reactions: {
                    oh: { prod: 'Cr(OH)₃', state: 'ppt', color: 'bg-green-500', hex: '#22c55e', note: 'Green precipitate formed.' },
                    excess_oh: { prod: '[Cr(OH)₆]³⁻', state: 'aq', color: 'bg-green-700', hex: '#15803d', note: 'Precipitate dissolves (Amphoteric).' },
                    nh3: { prod: '[Cr(NH₃)₆]³⁺', state: 'aq', color: 'bg-purple-600', hex: '#9333ea', note: 'Precipitate dissolves to purple solution (Slow).' }
                }
            },
            {
                id: 'mn2', symbol: 'Mn²⁺', name: 'Manganese(II)',
                color: 'bg-pink-300', hex: '#f9a8d4',
                desc: 'Very pale pink solution.',
                reactions: {
                    oh: { prod: 'Mn(OH)₂', state: 'ppt', color: 'bg-orange-200', hex: '#fed7aa', note: 'Off-white ppt, turns brown in air.' },
                    excess_oh: { prod: 'Mn(OH)₂', state: 'ppt', color: 'bg-orange-200', hex: '#fed7aa', note: 'Insoluble in excess.' }
                }
            },
            {
                id: 'fe2', symbol: 'Fe²⁺', name: 'Iron(II)',
                color: 'bg-green-300', hex: '#86efac',
                desc: 'Pale green solution.',
                reactions: {
                    oh: { prod: 'Fe(OH)₂', state: 'ppt', color: 'bg-green-800', hex: '#166534', note: 'Dirty green ppt.' },
                    excess_oh: { prod: 'Fe(OH)₂', state: 'ppt', color: 'bg-green-800', hex: '#166534', note: 'Insoluble in excess.' }
                }
            },
            {
                id: 'fe3', symbol: 'Fe³⁺', name: 'Iron(III)',
                color: 'bg-yellow-500', hex: '#eab308',
                desc: 'Yellow/Orange solution.',
                reactions: {
                    oh: { prod: 'Fe(OH)₃', state: 'ppt', color: 'bg-red-800', hex: '#991b1b', note: 'Red-brown precipitate.' },
                    excess_oh: { prod: 'Fe(OH)₃', state: 'ppt', color: 'bg-red-800', hex: '#991b1b', note: 'Insoluble in excess.' }
                }
            },
            {
                id: 'co2', symbol: 'Co²⁺', name: 'Cobalt(II)',
                color: 'bg-pink-500', hex: '#ec4899',
                desc: 'Pink solution ([Co(H₂O)₆]²⁺).',
                reactions: {
                    oh: { prod: 'Co(OH)₂', state: 'ppt', color: 'bg-blue-600', hex: '#2563eb', note: 'Blue precipitate.' },
                    excess_oh: { prod: 'Co(OH)₂', state: 'ppt', color: 'bg-blue-600', hex: '#2563eb', note: 'Insoluble in excess.' },
                    nh3: { prod: '[Co(NH₃)₆]²⁺', state: 'aq', color: 'bg-yellow-600', hex: '#ca8a04', note: 'Precipitate dissolves to yellow/brown solution.' }
                }
            },
            {
                id: 'ni2', symbol: 'Ni²⁺', name: 'Nickel(II)',
                color: 'bg-green-500', hex: '#22c55e',
                desc: 'Green solution.',
                reactions: {
                    oh: { prod: 'Ni(OH)₂', state: 'ppt', color: 'bg-green-400', hex: '#4ade80', note: 'Green precipitate.' },
                    excess_oh: { prod: 'Ni(OH)₂', state: 'ppt', color: 'bg-green-400', hex: '#4ade80', note: 'Insoluble in excess.' },
                    nh3: { prod: '[Ni(NH₃)₆]²⁺', state: 'aq', color: 'bg-blue-600', hex: '#2563eb', note: 'Precipitate dissolves to blue solution.' }
                }
            },
            {
                id: 'cu2', symbol: 'Cu²⁺', name: 'Copper(II)',
                color: 'bg-cyan-500', hex: '#06b6d4',
                desc: 'Blue solution.',
                reactions: {
                    oh: { prod: 'Cu(OH)₂', state: 'ppt', color: 'bg-cyan-600', hex: '#0891b2', note: 'Pale blue precipitate.' },
                    excess_oh: { prod: 'Cu(OH)₂', state: 'ppt', color: 'bg-cyan-600', hex: '#0891b2', note: 'Insoluble in excess NaOH.' },
                    nh3: { prod: '[Cu(NH₃)₄]²⁺', state: 'aq', color: 'bg-blue-900', hex: '#1e3a8a', note: 'Deep blue solution (with excess NH₃).' }
                }
            }
        ];

        // --- COMPONENTS ---

        // 1. TEST TUBE
        const TestTube = ({ ion, state, isActive, onClick }) => {
            // state: 'initial' | 'precipitate' | 'solution'
            
            // Bubbles simulation
            const bubbles = Array.from({ length: 5 }).map((_, i) => ({
                left: Math.random() * 60 + 20 + '%',
                delay: Math.random() * 2 + 's',
                size: Math.random() * 6 + 4 + 'px'
            }));

            // Determine display color/state based on current reaction step
            let displayColor = ion.color;
            let displayHex = ion.hex;
            let fillHeight = '60%';
            let isPpt = false;

            if (state && state.type !== 'initial') {
                displayColor = state.data.color;
                displayHex = state.data.hex;
                isPpt = state.data.state === 'ppt';
            }

            return (
                <div 
                    className={`relative flex flex-col items-center cursor-pointer transition-all duration-300 ${isActive ? 'scale-110 -translate-y-4' : 'hover:-translate-y-2'}`}
                    onClick={onClick}
                >
                    {/* Tube Body */}
                    <div className="w-16 h-48 rounded-b-3xl glass-tube relative overflow-hidden backdrop-blur-sm">
                        
                        {/* Liquid */}
                        <div 
                            className="absolute bottom-0 left-0 w-full liquid"
                            style={{ 
                                height: fillHeight, 
                                backgroundColor: displayHex,
                                opacity: isPpt ? 0.9 : 0.6
                            }}
                        >
                            {/* Bubbles if liquid */}
                            {!isPpt && bubbles.map((b, i) => (
                                <div key={i} className="bubble" style={{ left: b.left, animationDelay: b.delay, width: b.size, height: b.size }}></div>
                            ))}
                            
                            {/* Precipitate Texture if ppt */}
                            {isPpt && (
                                <div className="absolute bottom-0 w-full h-1/2 bg-black/20 backdrop-blur-sm border-t border-white/10"></div>
                            )}
                        </div>

                        {/* Reflections */}
                        <div className="absolute top-4 left-2 w-1 h-32 bg-white/20 rounded-full"></div>
                        <div className="absolute top-4 right-2 w-0.5 h-32 bg-white/10 rounded-full"></div>
                    </div>

                    {/* Label */}
                    <div className={`mt-4 px-3 py-1 rounded-lg border text-sm font-bold font-mono transition-colors ${isActive ? 'bg-slate-700 border-white text-white' : 'bg-slate-800 border-slate-600 text-slate-400'}`}>
                        {ion.symbol}
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [selectedIonIdx, setSelectedIonIdx] = useState(6); // Default Cu
            const [reactionState, setReactionState] = useState({ type: 'initial', data: null }); // initial, step1, step2
            const [activeReagent, setActiveReagent] = useState(null); // 'NaOH' or 'NH3'

            const currentIon = IONS[selectedIonIdx];

            const handleIonSelect = (idx) => {
                setSelectedIonIdx(idx);
                setReactionState({ type: 'initial', data: null });
                setActiveReagent(null);
            };

            const handleAddReagent = (reagent) => {
                // Determine reaction outcome
                let result = null;
                let nextType = '';

                // Logic for "Add a few drops" (Step 1)
                if (reactionState.type === 'initial') {
                    if (reagent === 'NaOH' && currentIon.reactions.oh) {
                        result = currentIon.reactions.oh;
                        nextType = 'step1';
                    } else if (reagent === 'NH3' && currentIon.reactions.oh) {
                        // NH3 initially acts as base, producing hydroxide ppt for most
                        result = currentIon.reactions.oh;
                        nextType = 'step1';
                    }
                } 
                // Logic for "Add in excess" (Step 2)
                else if (reactionState.type === 'step1') {
                    nextType = 'step2';
                    
                    if (reagent === 'NaOH') {
                        if (currentIon.reactions.excess_oh) {
                            result = currentIon.reactions.excess_oh;
                        } else {
                            // Default to insoluble if no specific excess reaction defined
                            result = { ...currentIon.reactions.oh, note: 'Insoluble in excess NaOH.' };
                        }
                    } else if (reagent === 'NH3') {
                        if (currentIon.reactions.nh3) {
                            result = currentIon.reactions.nh3;
                        } else {
                            // Default to insoluble if no specific excess reaction defined
                            result = { ...currentIon.reactions.oh, note: 'Insoluble in excess NH₃.' };
                        }
                    }
                }

                if (result) {
                    setReactionState({ type: nextType, data: result });
                    setActiveReagent(reagent);
                }
            };

            const handleReset = () => {
                setReactionState({ type: 'initial', data: null });
                setActiveReagent(null);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col items-center p-4 md:p-8">
                    
                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 mb-2">
                            Transition Metal Ion Gallery
                        </h1>
                        <p className="text-slate-400 text-sm">Interactive Lab: Observe Precipitation & Complexation</p>
                    </div>

                    {/* Main Stage */}
                    <div className="w-full max-w-5xl grid grid-cols-1 md:grid-cols-12 gap-8">
                        
                        {/* 1. Test Tube Rack (Left) */}
                        <div className="md:col-span-8 bg-slate-900/50 rounded-3xl border border-slate-700 p-8 relative overflow-hidden">
                            <div className="absolute inset-0 opacity-20 pointer-events-none" 
                                style={{backgroundImage: 'radial-gradient(#334155 1px, transparent 1px)', backgroundSize: '20px 20px'}}>
                            </div>

                            {/* Rack Shelf */}
                            <div className="flex justify-center items-end gap-4 h-64 relative z-10 pb-8">
                                {/* Only show selected one centered? Or show all? Let's show all but highlight selected */}
                                {IONS.map((ion, idx) => (
                                    <div key={ion.id} className={idx === selectedIonIdx ? 'z-20' : 'z-10 opacity-60 scale-90 blur-[1px]'}>
                                        <TestTube 
                                            ion={ion} 
                                            state={idx === selectedIonIdx ? reactionState : null}
                                            isActive={idx === selectedIonIdx}
                                            onClick={() => handleIonSelect(idx)}
                                        />
                                    </div>
                                ))}
                                
                                {/* Rack Base */}
                                <div className="absolute bottom-0 w-full h-4 bg-slate-700 rounded-full shadow-xl"></div>
                            </div>

                            {/* Controls */}
                            <div className="flex justify-center gap-4 mt-8">
                                <button 
                                    onClick={() => handleAddReagent('NaOH')}
                                    disabled={reactionState.type === 'step2'}
                                    className="px-6 py-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 flex items-center gap-2 transition-all disabled:opacity-50"
                                >
                                    <div className="w-3 h-3 rounded-full bg-white"></div> 
                                    Add NaOH (aq)
                                </button>
                                <button 
                                    onClick={() => handleAddReagent('NH3')}
                                    disabled={reactionState.type === 'step2'}
                                    className="px-6 py-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 flex items-center gap-2 transition-all disabled:opacity-50"
                                >
                                    <div className="w-3 h-3 rounded-full bg-blue-400"></div>
                                    Add NH₃ (aq)
                                </button>
                                <button 
                                    onClick={handleReset}
                                    className="p-3 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded-xl border border-red-900/50 transition-all"
                                    title="Reset Tube"
                                >
                                    <Icon name="rotate-ccw" />
                                </button>
                            </div>
                        </div>

                        {/* 2. Info Panel (Right) */}
                        <div className="md:col-span-4 space-y-6">
                            
                            {/* Current Species Card */}
                            <div className="bg-slate-800 rounded-2xl border border-slate-700 p-6 shadow-xl">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white shadow-inner ${
                                        reactionState.type === 'initial' ? currentIon.color : reactionState.data.color
                                    }`}>
                                        {currentIon.symbol.replace(/\d[+-]/g, '')}
                                    </div>
                                    <div>
                                        <div className="text-xs text-slate-400 font-bold uppercase tracking-wider">
                                            {reactionState.type === 'initial' ? 'Initial Ion' : reactionState.data.state === 'ppt' ? 'Precipitate' : 'Complex Ion'}
                                        </div>
                                        <div className="text-xl font-bold text-white">
                                            {reactionState.type === 'initial' 
                                                ? currentIon.symbol 
                                                : reactionState.data.prod}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="text-sm text-slate-300 leading-relaxed bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
                                    {reactionState.type === 'initial' 
                                        ? currentIon.desc 
                                        : reactionState.data.note}
                                </div>
                            </div>

                            {/* Reaction Status */}
                            <div className="bg-slate-800/50 p-6 rounded-2xl border border-slate-700/50">
                                <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Experiment Log</h3>
                                <div className="space-y-4 relative">
                                    {/* Timeline Line */}
                                    <div className="absolute left-2 top-2 bottom-2 w-0.5 bg-slate-700"></div>

                                    {/* Step 0 */}
                                    <div className="flex gap-4 relative">
                                        <div className={`w-4 h-4 rounded-full border-2 z-10 shrink-0 ${reactionState.type === 'initial' ? 'bg-emerald-500 border-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]' : 'bg-slate-700 border-slate-600'}`}></div>
                                        <div>
                                            <div className="text-sm font-bold text-slate-300">Start</div>
                                            <div className="text-xs text-slate-500">Aqueous solution of {currentIon.name}</div>
                                        </div>
                                    </div>

                                    {/* Step 1 */}
                                    <div className={`flex gap-4 relative transition-opacity duration-500 ${reactionState.type === 'initial' ? 'opacity-30' : 'opacity-100'}`}>
                                        <div className={`w-4 h-4 rounded-full border-2 z-10 shrink-0 ${reactionState.type === 'step1' ? 'bg-blue-500 border-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]' : reactionState.type === 'step2' ? 'bg-slate-700 border-slate-600' : 'bg-slate-800 border-slate-700'}`}></div>
                                        <div>
                                            <div className="text-sm font-bold text-slate-300">Add few drops {activeReagent}</div>
                                            <div className="text-xs text-slate-500">Precipitation occurs</div>
                                        </div>
                                    </div>

                                    {/* Step 2 */}
                                    <div className={`flex gap-4 relative transition-opacity duration-500 ${reactionState.type === 'step2' ? 'opacity-100' : 'opacity-30'}`}>
                                        <div className={`w-4 h-4 rounded-full border-2 z-10 shrink-0 ${reactionState.type === 'step2' ? 'bg-purple-500 border-purple-500 shadow-[0_0_10px_rgba(168,85,247,0.5)]' : 'bg-slate-800 border-slate-700'}`}></div>
                                        <div>
                                            <div className="text-sm font-bold text-slate-300">Add excess {activeReagent}</div>
                                            <div className="text-xs text-slate-500">
                                                {reactionState.type === 'step2' 
                                                    ? (reactionState.data.state === 'aq' ? 'Precipitate dissolves (Complexation)' : 'No further change') 
                                                    : '...'}
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
