<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detergent Action Simulator</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Smooth transitions for SVG elements */
        .molecule { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .oil-drop { transition: all 0.5s ease-in-out; }
        
        /* Water background animation */
        @keyframes wave {
            0% { transform: translateX(0) translateZ(0) scaleY(1) }
            50% { transform: translateX(-25%) translateZ(0) scaleY(0.8) }
            100% { transform: translateX(-50%) translateZ(0) scaleY(1) }
        }
        .water-bg {
            animation: wave 15s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- COMPONENTS ---

        // 1. DETERGENT MOLECULE (Pin Shape)
        const DetergentMolecule = ({ x, y, rotation, scale = 1, opacity = 1 }) => (
            <g transform={`translate(${x}, ${y}) rotate(${rotation}) scale(${scale})`} style={{ opacity }} className="molecule">
                {/* Hydrophobic Tail (Zigzag) */}
                <path d="M0,0 L-5,5 L-10,-5 L-15,5 L-20,-5 L-25,5 L-30,-5" 
                    fill="none" stroke="#94a3b8" strokeWidth="2" strokeLinecap="round" />
                {/* Hydrophilic Head */}
                <circle cx="0" cy="0" r="5" fill="#3b82f6" stroke="white" strokeWidth="1" />
            </g>
        );

        // 2. OIL DROPLET (Blob)
        const OilDroplet = ({ cx, cy, r, opacity = 1, scale = 1 }) => (
            <circle cx={cx} cy={cy} r={r} fill="#facc15" fillOpacity="0.9" style={{ opacity, transform: `scale(${scale})`, transformOrigin: `${cx}px ${cy}px` }} className="oil-drop" stroke="#fbbf24" strokeWidth="2" />
        );

        // 3. MICELLE (Small oil drop with detergent around it)
        const Micelle = ({ cx, cy, scale = 1, rotationOffset = 0 }) => {
            const detergentCount = 8;
            const detergents = [];
            for (let i = 0; i < detergentCount; i++) {
                const angle = (i / detergentCount) * 360 + rotationOffset;
                // Calculate position on the rim of the oil drop
                const rad = angle * (Math.PI / 180);
                const dist = 18; // Distance from center
                const dx = Math.cos(rad) * dist;
                const dy = Math.sin(rad) * dist;
                // Rotation: Tail points IN (so rotation should be angle + 180)
                detergents.push(
                    <DetergentMolecule key={i} x={cx + dx} y={cy + dy} rotation={angle} scale={0.7} />
                );
            }

            return (
                <g style={{ transform: `scale(${scale})`, transformOrigin: `${cx}px ${cy}px` }} className="molecule">
                    <OilDroplet cx={cx} cy={cy} r={18} />
                    {detergents}
                </g>
            );
        };

        // --- MAIN SIMULATION SCENE ---
        const SimulationScene = ({ progress }) => {
            // Progress: 0 to 100
            // 0-20: Initial State (Oil on Cloth)
            // 20-50: Adding Detergent (Molecules appear)
            // 50-70: Orientation (Tails into oil)
            // 70-100: Agitation & Micelle Formation (Oil breaks up)

            const width = 600;
            const height = 400;
            const centerX = width / 2;
            const centerY = height / 2 + 50; // On the "cloth" at bottom

            // -- CALCULATE STATES --
            
            // 1. Main Oil Drop
            // It stays big until 70, then shrinks/disappears
            const mainDropOpacity = progress > 80 ? 0 : 1;
            const mainDropScale = progress > 70 ? 1 - ((progress - 70) / 20) : 1;
            
            // 2. Free Detergent Molecules (Floating)
            // Appear from 20-50. Move towards oil 50-70.
            const detergentCount = 12;
            const freeDetergents = [];
            
            if (progress > 10 && progress < 85) {
                const entryProgress = Math.min(1, Math.max(0, (progress - 10) / 20)); // 0 to 1 during 10-30
                const orientationProgress = Math.min(1, Math.max(0, (progress - 40) / 30)); // 0 to 1 during 40-70

                for (let i = 0; i < detergentCount; i++) {
                    // Random start positions (floating in water)
                    const randX = (i * 50) % width; 
                    const randY = (i * 30) % 200;
                    const randRot = (i * 45) % 360;

                    // Target positions (Surrounding the oil drop)
                    const angle = (i / detergentCount) * 180 + 180; // Semicircle on top
                    const rad = angle * (Math.PI / 180);
                    const targetDist = 55; // Oil radius + buffer
                    const targetX = centerX + Math.cos(rad) * targetDist;
                    const targetY = centerY + Math.sin(rad) * targetDist;
                    const targetRot = angle; // Tail pointing IN

                    // Interpolate
                    const currX = randX + (targetX - randX) * orientationProgress;
                    const currY = randY + (targetY - randY) * orientationProgress;
                    const currRot = randRot + (targetRot - randRot) * orientationProgress;
                    
                    const opacity = entryProgress;

                    freeDetergents.push(
                        <DetergentMolecule key={i} x={currX} y={currY} rotation={currRot} opacity={opacity} />
                    );
                }
            }

            // 3. Micelles (Formed after agitation)
            // Appear from 70-100, lifting off
            const micelles = [];
            if (progress > 70) {
                const micelleProgress = (progress - 70) / 30; // 0 to 1
                
                // Micelle 1 (Left)
                micelles.push(
                    <Micelle 
                        key="m1" 
                        cx={centerX - 60 * micelleProgress} 
                        cy={centerY - 100 * micelleProgress} 
                        scale={micelleProgress} 
                        rotationOffset={micelleProgress * 100}
                    />
                );
                // Micelle 2 (Right)
                micelles.push(
                    <Micelle 
                        key="m2" 
                        cx={centerX + 60 * micelleProgress} 
                        cy={centerY - 80 * micelleProgress} 
                        scale={micelleProgress} 
                        rotationOffset={-micelleProgress * 100}
                    />
                );
                // Micelle 3 (Center up)
                micelles.push(
                    <Micelle 
                        key="m3" 
                        cx={centerX} 
                        cy={centerY - 140 * micelleProgress} 
                        scale={micelleProgress} 
                        rotationOffset={micelleProgress * 50}
                    />
                );
            }

            return (
                <div className="relative w-full h-full bg-blue-900/20 overflow-hidden rounded-xl border border-blue-500/30">
                    {/* Background Water */}
                    <div className="absolute inset-0 pointer-events-none opacity-30">
                        <div className="water-bg absolute bottom-0 left-0 w-[200%] h-full bg-gradient-to-t from-blue-600/20 to-transparent"></div>
                    </div>

                    <svg width="100%" height="100%" viewBox={`0 0 ${width} ${height}`} className="relative z-10">
                        {/* The Cloth Surface */}
                        <rect x="0" y={height - 20} width={width} height="20" fill="#94a3b8" />
                        <text x="20" y={height - 8} fill="#475569" fontSize="10" fontWeight="bold">CLOTH SURFACE / FABRIC</text>

                        {/* Initial Large Oil Stain */}
                        {mainDropOpacity > 0 && (
                            <g style={{ opacity: mainDropOpacity, transform: `scale(${mainDropScale})`, transformOrigin: `${centerX}px ${centerY}px` }}>
                                {/* Flattened bottom to look like stain */}
                                <path d={`M${centerX-50},${centerY} A50,40 0 1,1 ${centerX+50},${centerY} L${centerX-50},${centerY}`} fill="#facc15" fillOpacity="0.9" />
                            </g>
                        )}

                        {/* Detergents */}
                        {freeDetergents}

                        {/* Micelles */}
                        {micelles}
                        
                    </svg>

                    {/* Stage Label */}
                    <div className="absolute top-4 left-4 bg-slate-900/80 backdrop-blur px-4 py-2 rounded-lg border border-slate-700 shadow-xl">
                        <div className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Current Stage</div>
                        <div className="text-xl font-bold text-white flex items-center gap-2">
                            {progress < 20 && <span>üõ¢Ô∏è Oil Stain (Grease)</span>}
                            {progress >= 20 && progress < 50 && <span>üß™ Adding Detergent</span>}
                            {progress >= 50 && progress < 70 && <span>üìç Orientation</span>}
                            {progress >= 70 && <span>ü´ß Emulsification</span>}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [progress, setProgress] = useState(0);

            // Step handlers
            const handleNext = () => {
                setProgress(p => Math.min(100, p + 5)); // Advance by 5%
            };

            const handlePrev = () => {
                setProgress(p => Math.max(0, p - 5)); // Go back by 5%
            };

            const handleReset = () => {
                setProgress(0);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar Info */}
                    <div className="w-full md:w-96 bg-slate-900 border-r border-slate-800 flex flex-col z-20 shadow-2xl">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-2xl font-bold flex items-center gap-2 text-white">
                                <Icon name="droplets" className="text-blue-400" /> Detergent Action
                            </h1>
                            <p className="text-sm text-slate-400 mt-2">Principles of Cleaning & Emulsification</p>
                        </div>

                        <div className="flex-1 overflow-y-auto p-6 space-y-8">
                            {/* Structure Card */}
                            <div className="bg-slate-800/50 p-5 rounded-2xl border border-slate-700">
                                <h3 className="text-sm font-bold text-slate-300 uppercase mb-4 flex items-center gap-2">
                                    <Icon name="microscope" className="w-4 h-4"/> Molecule Structure
                                </h3>
                                <div className="flex items-center justify-center py-4 bg-slate-900 rounded-xl border border-slate-800 relative mb-4">
                                    <svg width="200" height="60" viewBox="0 0 200 60">
                                        {/* Tail Label */}
                                        <text x="40" y="55" fill="#94a3b8" fontSize="10" textAnchor="middle" fontWeight="bold">Hydrophobic Tail</text>
                                        <text x="40" y="10" fill="#64748b" fontSize="9" textAnchor="middle">Oil-loving</text>
                                        
                                        {/* Head Label */}
                                        <text x="160" y="55" fill="#3b82f6" fontSize="10" textAnchor="middle" fontWeight="bold">Hydrophilic Head</text>
                                        <text x="160" y="10" fill="#60a5fa" fontSize="9" textAnchor="middle">Water-loving</text>

                                        {/* The Molecule */}
                                        <g transform="translate(160, 30) scale(1.5)">
                                            <path d="M0,0 L-10,5 L-20,-5 L-30,5 L-40,-5 L-50,5 L-60,-5 L-70,5" 
                                                fill="none" stroke="#94a3b8" strokeWidth="3" strokeLinecap="round" />
                                            <circle cx="0" cy="0" r="6" fill="#3b82f6" stroke="white" strokeWidth="2" />
                                        </g>
                                    </svg>
                                </div>
                                <p className="text-xs text-slate-400 leading-relaxed">
                                    Detergent molecules act as a bridge. The <strong>non-polar hydrocarbon tail</strong> dissolves in oil, while the <strong>ionic head</strong> dissolves in water.
                                </p>
                            </div>

                            {/* Principle Explanation */}
                            <div className="space-y-4">
                                <div className={`transition-all duration-500 ${progress >= 0 && progress < 50 ? 'opacity-100 translate-x-0' : 'opacity-40 translate-x-4'}`}>
                                    <div className="flex items-center gap-3 mb-2">
                                        <div className="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold">1</div>
                                        <h4 className="font-bold text-white">Wetting</h4>
                                    </div>
                                    <p className="text-sm text-slate-400 pl-9">Water surface tension is reduced, allowing water to spread over the surface.</p>
                                </div>

                                <div className={`transition-all duration-500 ${progress >= 50 && progress < 70 ? 'opacity-100 translate-x-0' : 'opacity-40 translate-x-4'}`}>
                                    <div className="flex items-center gap-3 mb-2">
                                        <div className="w-6 h-6 rounded-full bg-emerald-900 text-emerald-400 flex items-center justify-center text-xs font-bold">2</div>
                                        <h4 className="font-bold text-emerald-400">Orientation</h4>
                                    </div>
                                    <p className="text-sm text-slate-400 pl-9">Hydrophobic tails bury into the grease. Hydrophilic heads remain in water.</p>
                                </div>

                                <div className={`transition-all duration-500 ${progress >= 70 ? 'opacity-100 translate-x-0' : 'opacity-40 translate-x-4'}`}>
                                    <div className="flex items-center gap-3 mb-2">
                                        <div className="w-6 h-6 rounded-full bg-blue-900 text-blue-400 flex items-center justify-center text-xs font-bold">3</div>
                                        <h4 className="font-bold text-blue-400">Emulsification</h4>
                                    </div>
                                    <p className="text-sm text-slate-400 pl-9">Agitation breaks oil into tiny droplets called <strong>Micelles</strong>. The negative heads repel each other, preventing droplets from rejoining.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 relative flex flex-col h-screen overflow-hidden">
                        <div className="flex-1 p-4 md:p-8 flex items-center justify-center">
                            <div className="w-full h-full max-h-[600px] shadow-2xl rounded-2xl overflow-hidden">
                                <SimulationScene progress={progress} />
                            </div>
                        </div>

                        {/* Control Bar */}
                        <div className="bg-slate-800 border-t border-slate-700 p-6 flex flex-col md:flex-row gap-6 items-center shrink-0 safe-area-bottom">
                            
                            {/* Step Controls */}
                            <div className="flex items-center gap-3">
                                <button 
                                    onClick={handlePrev}
                                    className="w-12 h-12 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center transition-all active:scale-95 disabled:opacity-50"
                                    disabled={progress <= 0}
                                    title="Previous Step"
                                >
                                    <Icon name="chevron-left" className="w-6 h-6" />
                                </button>
                                
                                <button 
                                    onClick={handleNext}
                                    className="w-16 h-16 rounded-full bg-blue-600 hover:bg-blue-500 text-white flex items-center justify-center shadow-lg shadow-blue-500/30 transition-all hover:scale-105 active:scale-95 disabled:opacity-50 disabled:bg-slate-700"
                                    disabled={progress >= 100}
                                    title="Next Step"
                                >
                                    <Icon name="chevron-right" className="w-8 h-8" />
                                </button>
                            </div>

                            <div className="flex-1 w-full space-y-2">
                                <div className="flex justify-between text-xs font-bold text-slate-400 uppercase tracking-wider">
                                    <span>Start</span>
                                    <span>Cleaning Process</span>
                                    <span>Clean</span>
                                </div>
                                <div className="relative h-6 group">
                                    <div className="absolute top-1/2 left-0 right-0 h-2 bg-slate-700 rounded-full transform -translate-y-1/2 overflow-hidden">
                                        <div 
                                            className="h-full bg-gradient-to-r from-blue-500 to-emerald-400 transition-all duration-200 ease-out" 
                                            style={{width: `${progress}%`}}
                                        ></div>
                                    </div>
                                    <input 
                                        type="range" min="0" max="100" step="0.1"
                                        value={progress}
                                        onChange={(e) => setProgress(parseFloat(e.target.value))}
                                        className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                    />
                                    <div 
                                        className="absolute top-1/2 w-6 h-6 bg-white rounded-full shadow-md transform -translate-y-1/2 -translate-x-1/2 pointer-events-none transition-all duration-200 ease-out group-hover:scale-110"
                                        style={{left: `${progress}%`}}
                                    ></div>
                                </div>
                            </div>

                            <button 
                                onClick={handleReset}
                                className="p-3 rounded-xl hover:bg-slate-700 text-slate-400 hover:text-white transition-colors flex flex-col items-center gap-1"
                                title="Reset Simulation"
                            >
                                <Icon name="rotate-ccw" className="w-5 h-5" />
                                <span className="text-[10px] font-bold uppercase">Reset</span>
                            </button>
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
