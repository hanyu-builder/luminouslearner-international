<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neutralization Solver - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .input-group:focus-within label { color: #818cf8; }
        .input-group:focus-within input { border-color: #818cf8; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        
        /* Titration Animation */
        @keyframes drip {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(100px) scale(0.5); opacity: 0; }
        }
        .drip-anim { animation: drip 0.5s infinite ease-in; }
        
        .liquid-level { transition: height 1s ease-out; }
        .color-change { transition: background-color 1s ease; }

        /* Dark Mode Select Override */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            appearance: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Chemical Data (Internationalized)
        const Acids = [
            { name: 'Hydrochloric Acid (HCl)', formula: 'HCl', basicity: 1, type: 'strong' },
            { name: 'Nitric Acid (HNO₃)', formula: 'HNO3', basicity: 1, type: 'strong' },
            { name: 'Sulfuric Acid (H₂SO₄)', formula: 'H2SO4', basicity: 2, type: 'strong' },
            { name: 'Ethanoic Acid (CH₃COOH)', formula: 'CH3COOH', basicity: 1, type: 'weak', pKa: 4.76 }
        ];

        const Alkalis = [
            { name: 'Sodium Hydroxide (NaOH)', formula: 'NaOH', acidity: 1, type: 'strong' },
            { name: 'Potassium Hydroxide (KOH)', formula: 'KOH', acidity: 1, type: 'strong' },
            { name: 'Ammonia (NH₃)', formula: 'NH3', acidity: 1, type: 'weak', pKb: 4.75 },
            { name: 'Calcium Hydroxide (Ca(OH)₂)', formula: 'Ca(OH)2', acidity: 2, type: 'strong' } // Treated as strong base for simple calc
        ];

        const App = () => {
            const [acid, setAcid] = useState(Acids[0]);
            const [alkali, setAlkali] = useState(Alkalis[0]);
            
            // Inputs
            const [ma, setMa] = useState(''); // Molarity Acid
            const [va, setVa] = useState(''); // Volume Acid
            const [mb, setMb] = useState(''); // Molarity Alkali
            const [vb, setVb] = useState(''); // Volume Alkali (Target usually)
            
            const [target, setTarget] = useState('vb'); // What to calculate?
            const [result, setResult] = useState(null);
            const [equation, setEquation] = useState('');
            const [moleRatio, setMoleRatio] = useState({ a: 1, b: 1 });
            const [isTitrating, setIsTitrating] = useState(false);

            const Icon = ({ name, size = 20, className = "" }) => {
                const [svg, setSvg] = useState('');
                useEffect(() => {
                    if (window.lucide) {
                        const iconNode = window.lucide.icons[name];
                        if (iconNode) {
                            const iconSvg = window.lucide.createElement(iconNode);
                            iconSvg.setAttribute('width', size);
                            iconSvg.setAttribute('height', size);
                            iconSvg.setAttribute('class', className);
                            setSvg(iconSvg.outerHTML);
                        }
                    }
                }, [name, size, className]);
                return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
            };

            // Update Equation and Ratio when chemicals change
            useEffect(() => {
                // Balance logic: Acid basicity vs Alkali acidity
                // LCM of (acid.basicity, alkali.acidity)
                
                const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
                const lcm = (a, b) => (a * b) / gcd(a, b);
                
                const hCount = acid.basicity;
                const ohCount = alkali.acidity;
                const common = lcm(hCount, ohCount);
                
                const coeffAcid = common / hCount;
                const coeffAlkali = common / ohCount;
                
                setMoleRatio({ a: coeffAcid, b: coeffAlkali });

                // Construct Equation String
                let eqStr = '';
                if (coeffAcid > 1) eqStr += `${coeffAcid} `;
                eqStr += `${acid.formula} + `;
                if (coeffAlkali > 1) eqStr += `${coeffAlkali} `;
                eqStr += `${alkali.formula} → Salt + H₂O`;
                
                setEquation(eqStr);
                setResult(null); // Reset result on change
            }, [acid, alkali]);

            const calculate = () => {
                setIsTitrating(true);
                setResult(null);

                // Delay for animation
                setTimeout(() => {
                    try {
                        // Formula: (Ma * Va) / na = (Mb * Vb) / nb
                        // na = moleRatio.a, nb = moleRatio.b
                        
                        const na = moleRatio.a;
                        const nb = moleRatio.b;
                        let res = 0;

                        if (target === 'vb') {
                            // Vb = (Ma * Va * nb) / (na * Mb)
                            res = (parseFloat(ma) * parseFloat(va) * nb) / (na * parseFloat(mb));
                        } else if (target === 'mb') {
                            // Mb = (Ma * Va * nb) / (na * Vb)
                            res = (parseFloat(ma) * parseFloat(va) * nb) / (na * parseFloat(vb));
                        } else if (target === 'va') {
                            // Va = (Mb * Vb * na) / (nb * Ma)
                            res = (parseFloat(mb) * parseFloat(vb) * na) / (nb * parseFloat(ma));
                        } else if (target === 'ma') {
                            // Ma = (Mb * Vb * na) / (nb * Va)
                            res = (parseFloat(mb) * parseFloat(vb) * na) / (nb * parseFloat(va));
                        }

                        if (isFinite(res) && res > 0) {
                            setResult(res);
                        } else {
                            setResult('Error');
                        }
                    } catch (e) {
                        setResult('Error');
                    }
                    setIsTitrating(false);
                }, 1500);
            };

            // UI Helper: Is input disabled?
            const isDisabled = (field) => target === field;

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-5xl">
                    
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-purple-400 flex items-center gap-2">
                                <Icon name="FlaskRound" /> Neutralization Solver
                            </h1>
                            <p className="text-slate-500 text-sm">Titration Calculator ($M_aV_a$ vs $M_bV_b$)</p>
                        </div>
                        <button onClick={() => { setMa(''); setVa(''); setMb(''); setVb(''); setResult(null); }} className="px-4 py-2 bg-slate-800 text-slate-400 rounded-lg hover:bg-slate-700 hover:text-white font-bold text-sm flex items-center gap-2 transition-colors border border-slate-700">
                            <Icon name="RotateCcw" size={16} /> Reset
                        </button>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 flex-grow">
                        
                        {/* Left: Setup & Inputs */}
                        <div className="w-full lg:w-1/2 flex flex-col gap-6">
                            
                            {/* Chemical Selection */}
                            <div className="bg-slate-900 p-5 rounded-2xl shadow-xl border border-slate-800">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-3 flex items-center gap-2">
                                    <Icon name="TestTubes" size={16}/> 1. Select Reactants
                                </h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="text-xs font-bold text-red-400 block mb-1">Acid</label>
                                        <select 
                                            value={acid.formula} 
                                            onChange={(e) => setAcid(Acids.find(a => a.formula === e.target.value))}
                                            className="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg font-bold text-red-400 text-sm outline-none focus:ring-2 focus:ring-red-500"
                                        >
                                            {Acids.map(a => <option key={a.formula} value={a.formula}>{a.name}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-blue-400 block mb-1">Alkali (Base)</label>
                                        <select 
                                            value={alkali.formula} 
                                            onChange={(e) => setAlkali(Alkalis.find(a => a.formula === e.target.value))}
                                            className="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg font-bold text-blue-400 text-sm outline-none focus:ring-2 focus:ring-blue-500"
                                        >
                                            {Alkalis.map(a => <option key={a.formula} value={a.formula}>{a.name}</option>)}
                                        </select>
                                    </div>
                                </div>
                                
                                {/* Balanced Equation Display */}
                                <div className="mt-4 p-3 bg-slate-950 rounded-xl text-center border border-slate-700">
                                    <div className="text-[10px] text-slate-500 uppercase mb-1 font-bold">Balanced Equation</div>
                                    <div className="text-white font-mono text-base md:text-lg font-bold break-words">
                                        <span className="text-red-400">{moleRatio.a}</span> {acid.formula} + <span className="text-blue-400">{moleRatio.b}</span> {alkali.formula} &rarr; Salt + H₂O
                                    </div>
                                </div>
                            </div>

                            {/* Calculation Inputs */}
                            <div className="bg-slate-900 p-6 rounded-2xl shadow-xl border border-purple-500/30 relative">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-4 flex items-center gap-2">
                                    <Icon name="Calculator" size={16}/> 2. Data Entry & Target
                                </h3>

                                {/* Target Selector */}
                                <div className="flex justify-between mb-4 bg-slate-800 p-1 rounded-lg border border-slate-700">
                                    {['ma', 'va', 'mb', 'vb'].map(t => (
                                        <button
                                            key={t}
                                            onClick={() => setTarget(t)}
                                            className={`px-3 py-1.5 rounded-md text-xs font-bold transition-all uppercase
                                                ${target === t ? 'bg-purple-600 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}
                                            `}
                                        >
                                            Find {t.toUpperCase()}
                                        </button>
                                    ))}
                                </div>

                                <div className="grid grid-cols-2 gap-6">
                                    {/* Acid Side */}
                                    <div className="space-y-3 border-r border-slate-700 pr-3">
                                        <div className={`input-group ${isDisabled('ma') ? 'opacity-50' : ''}`}>
                                            <label className="block text-xs font-bold text-red-400 mb-1">Mₐ (Acid Conc.)</label>
                                            <div className="relative">
                                                <input type="number" value={ma} onChange={(e) => setMa(e.target.value)} disabled={isDisabled('ma')} className="w-full p-2 rounded border border-slate-600 bg-slate-800 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target==='ma'?'?':'e.g. 0.1'} />
                                                <span className="absolute right-2 top-2 text-[10px] text-slate-500">M</span>
                                            </div>
                                        </div>
                                        <div className={`input-group ${isDisabled('va') ? 'opacity-50' : ''}`}>
                                            <label className="block text-xs font-bold text-red-400 mb-1">Vₐ (Acid Vol.)</label>
                                            <div className="relative">
                                                <input type="number" value={va} onChange={(e) => setVa(e.target.value)} disabled={isDisabled('va')} className="w-full p-2 rounded border border-slate-600 bg-slate-800 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target==='va'?'?':'e.g. 25'} />
                                                <span className="absolute right-2 top-2 text-[10px] text-slate-500">cm³</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Alkali Side */}
                                    <div className="space-y-3 pl-3">
                                        <div className={`input-group ${isDisabled('mb') ? 'opacity-50' : ''}`}>
                                            <label className="block text-xs font-bold text-blue-400 mb-1">Mᵦ (Alkali Conc.)</label>
                                            <div className="relative">
                                                <input type="number" value={mb} onChange={(e) => setMb(e.target.value)} disabled={isDisabled('mb')} className="w-full p-2 rounded border border-slate-600 bg-slate-800 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target==='mb'?'?':'e.g. 0.2'} />
                                                <span className="absolute right-2 top-2 text-[10px] text-slate-500">M</span>
                                            </div>
                                        </div>
                                        <div className={`input-group ${isDisabled('vb') ? 'opacity-50' : ''}`}>
                                            <label className="block text-xs font-bold text-blue-400 mb-1">Vᵦ (Alkali Vol.)</label>
                                            <div className="relative">
                                                <input type="number" value={vb} onChange={(e) => setVb(e.target.value)} disabled={isDisabled('vb')} className="w-full p-2 rounded border border-slate-600 bg-slate-800 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target==='vb'?'?':'25.0'} />
                                                <span className="absolute right-2 top-2 text-[10px] text-slate-500">cm³</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button 
                                    onClick={calculate}
                                    disabled={isTitrating}
                                    className="mt-6 w-full py-3 bg-purple-600 text-white font-bold rounded-xl shadow-lg hover:bg-purple-500 transition-all active:scale-95 text-lg flex items-center justify-center gap-2 disabled:opacity-70"
                                >
                                    {isTitrating ? <Icon name="Loader2" className="animate-spin"/> : <Icon name="FlaskConical" />}
                                    Start Titration
                                </button>
                            </div>
                        </div>

                        {/* Right: Visual & Result */}
                        <div className="w-full lg:w-1/2 flex flex-col gap-6">
                            
                            {/* Titration Visual */}
                            <div className="bg-slate-900 rounded-2xl shadow-xl border border-slate-800 p-6 flex justify-center items-end min-h-[350px] relative overflow-hidden">
                                <div className="absolute inset-0 bg-slate-950/50"></div>
                                <div className="absolute inset-0 opacity-10" style={{backgroundImage: 'radial-gradient(#fff 1px, transparent 1px)', backgroundSize: '20px 20px'}}></div>
                                
                                {/* Burette (Alkali usually in burette for simplicity in visual, though label changes in real life) */}
                                <div className="absolute top-0 flex flex-col items-center z-10">
                                    <div className="w-6 h-64 border-x-2 border-b-2 border-slate-500 bg-white/5 relative rounded-b-md overflow-hidden backdrop-blur-sm">
                                        <div className="w-full bg-blue-500/50 absolute bottom-0 transition-all duration-1000" style={{ height: isTitrating ? '50%' : '90%' }}></div>
                                        {/* Graduations */}
                                        {[0,10,20,30,40,50].map(v => (
                                            <div key={v} className="absolute w-2 h-px bg-slate-400 right-0" style={{ top: `${(v/50)*100}%` }}></div>
                                        ))}
                                    </div>
                                    <div className="w-1 h-6 bg-slate-500 relative">
                                        {isTitrating && <div className="w-2 h-2 bg-blue-400 rounded-full absolute top-full -left-0.5 drip-anim"></div>}
                                    </div>
                                    <div className="absolute top-4 -right-16 text-xs text-blue-400 font-bold bg-slate-900 px-2 py-1 rounded border border-blue-900">Titrant</div>
                                </div>

                                {/* Conical Flask */}
                                <div className="relative z-20 mt-32 flex flex-col items-center">
                                    {/* Flask Body */}
                                    <div className="w-32 h-40 border-4 border-slate-400 rounded-b-[3rem] rounded-t-lg bg-white/5 backdrop-blur-sm relative overflow-hidden flex items-end justify-center">
                                        {/* Solution */}
                                        <div className={`w-full h-12 liquid-level transition-all duration-1000 ${result ? 'bg-pink-400/60' : 'bg-transparent'}`}
                                             style={{ height: isTitrating ? '60%' : '30%' }}>
                                        </div>
                                    </div>
                                    <div className="text-xs text-red-400 mt-2 font-bold uppercase bg-slate-900 px-2 py-1 rounded border border-red-900">Analyte</div>
                                </div>
                            </div>

                            {/* Result Card */}
                            {result !== null && result !== 'Error' && (
                                <div className="bg-slate-800 p-6 rounded-2xl shadow-lg border border-slate-700 text-white animate-in slide-in-from-bottom-4 fade-in">
                                    <div className="flex justify-between items-end mb-4">
                                        <span className="text-slate-400 text-sm font-bold uppercase">Calculated {target.toUpperCase()}</span>
                                        <span className="text-4xl font-mono font-bold text-purple-400">
                                            {parseFloat(result.toFixed(3))}
                                            <span className="text-lg ml-2 text-slate-500">
                                                {target.startsWith('m') ? 'M' : 'cm³'}
                                            </span>
                                        </span>
                                    </div>
                                    
                                    <div className="bg-slate-900/50 p-4 rounded-lg border border-slate-600">
                                        <div className="text-xs font-bold text-slate-500 uppercase mb-2">Formula Used:</div>
                                        <div className="font-mono text-sm text-center text-slate-300">
                                            <span className="text-red-400">MₐVₐ</span> / <span className="text-slate-500">{moleRatio.a}</span> = 
                                            <span className="text-blue-400"> MᵦVᵦ</span> / <span className="text-slate-500">{moleRatio.b}</span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {result === 'Error' && (
                                <div className="p-4 bg-red-900/20 text-red-400 rounded-xl font-bold text-center border border-red-500/30 animate-pulse">
                                    Calculation Error: Please check your inputs.
                                </div>
                            )}

                        </div>
                    </div>
                    
                    <div className="text-center text-slate-600 text-xs mt-8 border-t border-slate-800 pt-4">
                        Luminous Learner International | IB/A-Level Chemistry
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
