<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Equation Finder</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- MathJax for Formula -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        try {
                            const svgElement = window.lucide.createElement(iconData);
                            svgElement.setAttribute('class', className);
                            svgElement.setAttribute('width', size);
                            svgElement.setAttribute('height', size);
                            setSvgHtml(svgElement.outerHTML);
                        } catch (e) { console.error(e); }
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        const App = () => {
            // Data Structure: Array of experiments
            // Each experiment: { id, a: [A], b: [B], rate: Initial Rate }
            const [data, setData] = useState([
                { id: 1, a: 0.10, b: 0.10, rate: 0.002 },
                { id: 2, a: 0.20, b: 0.10, rate: 0.004 },
                { id: 3, a: 0.10, b: 0.20, rate: 0.008 }
            ]);

            const [result, setResult] = useState(null);
            const [mode, setMode] = useState('manual'); // 'manual' or 'practice'

            // --- SOLVER LOGIC ---
            const solveOrder = () => {
                let orderA = null, orderB = null;
                let logicSteps = [];

                // 1. Find Order of A (Keep B constant)
                // Look for pairs where [B] is constant but [A] changes
                for (let i = 0; i < data.length; i++) {
                    for (let j = 0; j < data.length; j++) {
                        if (i === j) continue;
                        if (data[i].b === data[j].b && data[i].a !== data[j].a) {
                            const ratioA = data[j].a / data[i].a;
                            const ratioRate = data[j].rate / data[i].rate;
                            
                            // Approx check for integer ratios
                            const exactOrder = Math.log(ratioRate) / Math.log(ratioA);
                            const roundedOrder = Math.round(exactOrder);

                            if (Math.abs(exactOrder - roundedOrder) < 0.1) {
                                orderA = roundedOrder;
                                logicSteps.push({
                                    target: 'A',
                                    exp1: i + 1,
                                    exp2: j + 1,
                                    constant: 'B',
                                    ratioConc: ratioA,
                                    ratioRate: ratioRate,
                                    order: roundedOrder
                                });
                                break; // Found it
                            }
                        }
                    }
                    if (orderA !== null) break;
                }

                // 2. Find Order of B (Keep A constant)
                for (let i = 0; i < data.length; i++) {
                    for (let j = 0; j < data.length; j++) {
                        if (i === j) continue;
                        if (data[i].a === data[j].a && data[i].b !== data[j].b) {
                            const ratioB = data[j].b / data[i].b;
                            const ratioRate = data[j].rate / data[i].rate;
                            
                            const exactOrder = Math.log(ratioRate) / Math.log(ratioB);
                            const roundedOrder = Math.round(exactOrder);

                            if (Math.abs(exactOrder - roundedOrder) < 0.1) {
                                orderB = roundedOrder;
                                logicSteps.push({
                                    target: 'B',
                                    exp1: i + 1,
                                    exp2: j + 1,
                                    constant: 'A',
                                    ratioConc: ratioB,
                                    ratioRate: ratioRate,
                                    order: roundedOrder
                                });
                                break;
                            }
                        }
                    }
                    if (orderB !== null) break;
                }

                // 3. Calculate k
                let kValue = 0;
                let kUnits = '';
                if (orderA !== null && orderB !== null) {
                    // Use Exp 1
                    const exp = data[0];
                    kValue = exp.rate / (Math.pow(exp.a, orderA) * Math.pow(exp.b, orderB));
                    
                    const totalOrder = orderA + orderB;
                    if (totalOrder === 0) kUnits = 'mol dm⁻³ s⁻¹';
                    else if (totalOrder === 1) kUnits = 's⁻¹';
                    else kUnits = `dm${3*(totalOrder-1)} mol⁻${totalOrder-1} s⁻¹`;
                }

                setResult({ orderA, orderB, kValue, kUnits, logicSteps });
            };

            // Generate Random Question
            const generateQuestion = () => {
                const targetOrderA = Math.floor(Math.random() * 3); // 0, 1, 2
                const targetOrderB = Math.floor(Math.random() * 3);
                const targetK = Number((Math.random() * 0.05 + 0.001).toFixed(4));
                
                const baseA = 0.10;
                const baseB = 0.10;

                // Create consistent data points
                // Exp 1: Baseline
                const rate1 = targetK * Math.pow(baseA, targetOrderA) * Math.pow(baseB, targetOrderB);
                
                // Exp 2: Double A
                const rate2 = targetK * Math.pow(baseA * 2, targetOrderA) * Math.pow(baseB, targetOrderB);
                
                // Exp 3: Double B
                const rate3 = targetK * Math.pow(baseA, targetOrderA) * Math.pow(baseB * 2, targetOrderB);

                setData([
                    { id: 1, a: baseA, b: baseB, rate: Number(rate1.toPrecision(3)) },
                    { id: 2, a: baseA * 2, b: baseB, rate: Number(rate2.toPrecision(3)) },
                    { id: 3, a: baseA, b: baseB * 2, rate: Number(rate3.toPrecision(3)) }
                ]);
                setResult(null); // Clear previous result
                setMode('practice');
            };

            // Input Handler
            const updateData = (idx, field, val) => {
                const newData = [...data];
                newData[idx][field] = parseFloat(val);
                setData(newData);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Left Panel: Inputs */}
                    <div className="w-full md:w-96 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen overflow-y-auto">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="calculator" className="text-emerald-400" /> Rate Equation Finder
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Determine Order of Reaction</p>
                        </div>

                        <div className="p-6 space-y-6">
                            
                            {/* Mode Switch */}
                            <div className="grid grid-cols-2 gap-2 bg-slate-800/50 p-1 rounded-xl">
                                <button 
                                    onClick={() => { setMode('manual'); setResult(null); setData([{ id: 1, a: 0, b: 0, rate: 0 }, { id: 2, a: 0, b: 0, rate: 0 }, { id: 3, a: 0, b: 0, rate: 0 }]); }}
                                    className={`py-2 text-sm font-bold rounded-lg transition-all ${mode === 'manual' ? 'bg-emerald-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Manual Input
                                </button>
                                <button 
                                    onClick={generateQuestion}
                                    className={`py-2 text-sm font-bold rounded-lg transition-all ${mode === 'practice' ? 'bg-blue-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Practice Gen
                                </button>
                            </div>

                            {/* Data Table Input */}
                            <div className="space-y-4">
                                <div className="grid grid-cols-4 gap-2 text-xs font-bold text-slate-500 uppercase text-center">
                                    <span>Exp</span>
                                    <span>[A]</span>
                                    <span>[B]</span>
                                    <span>Rate</span>
                                </div>
                                
                                {data.map((row, idx) => (
                                    <div key={row.id} className="grid grid-cols-4 gap-2 items-center">
                                        <div className="text-center font-mono text-slate-400 font-bold">{row.id}</div>
                                        <input 
                                            type="number" step="0.01" 
                                            value={row.a}
                                            onChange={(e) => updateData(idx, 'a', e.target.value)}
                                            className="bg-slate-800 border border-slate-700 rounded-lg p-2 text-center text-sm font-mono focus:border-emerald-500 focus:outline-none text-emerald-300"
                                        />
                                        <input 
                                            type="number" step="0.01" 
                                            value={row.b}
                                            onChange={(e) => updateData(idx, 'b', e.target.value)}
                                            className="bg-slate-800 border border-slate-700 rounded-lg p-2 text-center text-sm font-mono focus:border-emerald-500 focus:outline-none text-blue-300"
                                        />
                                        <input 
                                            type="number" step="0.001" 
                                            value={row.rate}
                                            onChange={(e) => updateData(idx, 'rate', e.target.value)}
                                            className="bg-slate-800 border border-slate-700 rounded-lg p-2 text-center text-sm font-mono focus:border-emerald-500 focus:outline-none text-yellow-300"
                                        />
                                    </div>
                                ))}
                            </div>

                            <button 
                                onClick={solveOrder}
                                className="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg shadow-emerald-500/20 transition-all active:scale-95"
                            >
                                <Icon name="search" /> Solve Rate Equation
                            </button>

                        </div>
                    </div>

                    {/* Right Panel: Results */}
                    <div className="flex-1 bg-slate-900/50 p-6 md:p-12 overflow-y-auto relative">
                        <div className="absolute inset-0 opacity-10 pointer-events-none" 
                            style={{backgroundImage: 'linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px)', backgroundSize: '40px 40px'}}>
                        </div>

                        <div className="max-w-3xl mx-auto relative z-10">
                            {!result ? (
                                <div className="flex flex-col items-center justify-center h-96 text-slate-500">
                                    <Icon name="flask-conical" className="w-16 h-16 mb-4 opacity-30" />
                                    <p className="text-lg">Enter data and click Solve</p>
                                </div>
                            ) : (
                                <div className="space-y-8 fade-in">
                                    
                                    {/* Final Equation Card */}
                                    <div className="bg-slate-800 rounded-3xl border border-slate-700 p-8 shadow-2xl relative overflow-hidden">
                                        <div className="absolute top-0 right-0 p-24 bg-emerald-500/10 blur-3xl rounded-full"></div>
                                        
                                        <h2 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Calculated Rate Equation</h2>
                                        
                                        <div className="text-4xl md:text-5xl font-mono font-black text-white mb-6">
                                            Rate = <span className="text-yellow-400">k</span>
                                            [A]<sup className="text-emerald-400">{result.orderA ?? '?'}</sup>
                                            [B]<sup className="text-blue-400">{result.orderB ?? '?'}</sup>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div className="bg-slate-900/50 p-4 rounded-xl border border-slate-600">
                                                <div className="text-xs text-slate-500 font-bold uppercase">Order w.r.t A</div>
                                                <div className="text-2xl font-bold text-emerald-400">{result.orderA ?? 'N/A'}</div>
                                            </div>
                                            <div className="bg-slate-900/50 p-4 rounded-xl border border-slate-600">
                                                <div className="text-xs text-slate-500 font-bold uppercase">Order w.r.t B</div>
                                                <div className="text-2xl font-bold text-blue-400">{result.orderB ?? 'N/A'}</div>
                                            </div>
                                            <div className="bg-slate-900/50 p-4 rounded-xl border border-slate-600">
                                                <div className="text-xs text-slate-500 font-bold uppercase">Total Order</div>
                                                <div className="text-2xl font-bold text-white">{(result.orderA + result.orderB) ?? 'N/A'}</div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Rate Constant */}
                                    <div className="bg-slate-800/50 p-6 rounded-2xl border border-slate-700 flex items-center justify-between">
                                        <div>
                                            <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-1">Rate Constant (k)</h3>
                                            <div className="text-2xl font-mono font-bold text-yellow-400">
                                                {result.kValue.toExponential(2)}
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-1">Units</h3>
                                            <div className="text-lg font-mono font-bold text-slate-300">
                                                {result.kUnits}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Deduction Logic (Step-by-Step) */}
                                    <div className="space-y-4">
                                        <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                            <Icon name="list-checks" className="text-emerald-400" /> Deduction Steps
                                        </h3>
                                        
                                        {result.logicSteps.length > 0 ? result.logicSteps.map((step, idx) => (
                                            <div key={idx} className="bg-slate-800 p-5 rounded-xl border border-slate-700 hover:border-slate-500 transition-colors">
                                                <div className="flex gap-3 mb-2">
                                                    <span className="bg-slate-700 text-xs px-2 py-1 rounded text-white font-bold">Step {idx + 1}</span>
                                                    <span className="text-sm font-bold text-slate-300">
                                                        Compare <span className="text-white">Exp {step.exp1}</span> and <span className="text-white">Exp {step.exp2}</span>
                                                    </span>
                                                </div>
                                                <p className="text-sm text-slate-400 leading-relaxed">
                                                    While concentration of <strong className="text-white">{step.constant}</strong> is constant, 
                                                    concentration of <strong className={step.target === 'A' ? 'text-emerald-400' : 'text-blue-400'}>{step.target}</strong> increases by <strong className="text-white">{step.ratioConc.toFixed(1)}x</strong>.
                                                    <br/>
                                                    The initial rate increases by <strong className="text-white">{step.ratioRate.toFixed(1)}x</strong>.
                                                </p>
                                                <div className="mt-3 p-3 bg-slate-900/50 rounded-lg font-mono text-sm text-slate-300 border border-slate-700">
                                                    ({step.ratioConc})<sup>n</sup> = {step.ratioRate.toFixed(1)} 
                                                    <span className="mx-3">→</span> 
                                                    n = {step.order}
                                                </div>
                                            </div>
                                        )) : (
                                            <div className="p-4 bg-red-900/20 border border-red-500/30 rounded-xl text-red-300 text-sm">
                                                Could not deduce integer orders from the given data. Check values.
                                            </div>
                                        )}
                                    </div>

                                </div>
                            )}
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
