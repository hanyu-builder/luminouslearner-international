<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redox Titration Simulator</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Liquid Animations */
        .liquid { transition: height 0.3s ease-out, background-color 0.5s ease-in-out; }
        
        .drop {
            animation: dropFall 0.6s linear;
        }
        @keyframes dropFall {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(200px) scale(0.5); opacity: 0; }
        }

        /* Swirl Animation */
        .swirl { animation: swirl 2s infinite linear; }
        @keyframes swirl {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- TITRATION DATA ---
        const EXPERIMENTS = {
            kmno4: {
                id: 'kmno4',
                name: 'KMnO₄ vs Fe²⁺',
                desc: 'Determination of Iron(II) concentration using Potassium Permanganate.',
                analyte: 'Iron(II) Sulfate (Fe²⁺)',
                titrant: 'Potassium Permanganate (MnO₄⁻)',
                indicator: 'None (Self-indicator)',
                eq: 'MnO₄⁻ + 5Fe²⁺ + 8H⁺ → Mn²⁺ + 5Fe³⁺ + 4H₂O',
                targetVol: 25.0, // Simplified target
                colors: {
                    titrant: 'bg-purple-600', // Deep purple in burette
                    start: 'bg-emerald-50/20', // Pale green/colorless in flask
                    end: 'bg-pink-400/40', // Pale pink at endpoint
                    over: 'bg-purple-600/60' // Purple if overshot
                }
            },
            iodine: {
                id: 'iodine',
                name: 'Iodine vs Thiosulfate',
                desc: 'Standardization of Sodium Thiosulfate using Iodine solution.',
                analyte: 'Iodine Solution (I₂)',
                titrant: 'Sodium Thiosulfate (S₂O₃²⁻)',
                indicator: 'Starch Solution (Added near end)',
                eq: 'I₂ + 2S₂O₃²⁻ → 2I⁻ + S₄O₆²⁻',
                targetVol: 25.0,
                colors: {
                    titrant: 'bg-slate-100/50', // Colorless in burette
                    start: 'bg-yellow-800/80', // Brown in flask
                    nearEnd: 'bg-yellow-200/60', // Pale yellow
                    starch: 'bg-blue-950/90', // Blue-black
                    end: 'bg-white/5', // Colorless at endpoint
                    over: 'bg-white/5' // Stays colorless
                }
            }
        };

        const App = () => {
            const [expId, setExpId] = useState('kmno4');
            const [addedVol, setAddedVol] = useState(0);
            const [starchAdded, setStarchAdded] = useState(false);
            const [isDropping, setIsDropping] = useState(false);
            const [dropKey, setDropKey] = useState(0); 

            const currentExp = EXPERIMENTS[expId];
            const target = currentExp.targetVol;

            // --- LOGIC: Determine Flask Color ---
            const getFlaskColor = () => {
                const vol = addedVol;
                
                if (expId === 'kmno4') {
                    // KMnO4 Titration Logic
                    if (vol < target - 0.1) return currentExp.colors.start; // Before end
                    if (vol >= target - 0.1 && vol <= target + 0.1) return currentExp.colors.end; // End point (Pink)
                    return currentExp.colors.over; // Overshot (Purple)
                } 
                else if (expId === 'iodine') {
                    // Iodine Titration Logic
                    if (vol >= target) return currentExp.colors.end; // Done (Colorless)
                    
                    if (starchAdded) {
                        // If starch added, it's Blue-Black until Iodine is gone
                        return currentExp.colors.starch; 
                    }
                    
                    // Before starch
                    // 0 -> Target: Brown fades to Pale Yellow
                    const progress = vol / target;
                    if (progress > 0.8) return currentExp.colors.nearEnd; // Pale yellow (time to add starch)
                    return currentExp.colors.start; // Brown
                }
                return 'bg-transparent';
            };

            const addTitrant = (amount) => {
                setIsDropping(true);
                setDropKey(prev => prev + 1);
                setTimeout(() => setIsDropping(false), 500);
                setAddedVol(prev => parseFloat((prev + amount).toFixed(1)));
            };

            const reset = () => {
                setAddedVol(0);
                setStarchAdded(false);
            };

            const flaskColorClass = getFlaskColor();

            // Determine Status Message
            let statusMsg = "Titrating...";
            let statusColor = "text-slate-400";
            let showStarchBtn = false;

            if (expId === 'kmno4') {
                if (addedVol >= target - 0.1 && addedVol <= target + 0.1) {
                    statusMsg = "End Point Reached (Permanent Pink)";
                    statusColor = "text-pink-400";
                } else if (addedVol > target + 0.1) {
                    statusMsg = "Over-titrated! (Too Dark)";
                    statusColor = "text-red-400";
                }
            } else if (expId === 'iodine') {
                if (addedVol >= target) {
                    statusMsg = "End Point Reached (Colourless)";
                    statusColor = "text-emerald-400";
                } else if (addedVol > target * 0.8 && !starchAdded) {
                    statusMsg = "Pale yellow reached. Add Starch now!";
                    statusColor = "text-yellow-400 animate-pulse";
                    showStarchBtn = true;
                } else if (starchAdded) {
                    statusMsg = "Starch added. Titrate until colourless.";
                    statusColor = "text-blue-400";
                }
            }

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="flask-conical" className="text-purple-400" /> Redox Titration
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Determine End Point & Indicators</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1 overflow-y-auto">
                            
                            {/* Experiment Selector */}
                            <div className="space-y-3">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">Select Experiment</label>
                                {Object.entries(EXPERIMENTS).map(([key, exp]) => (
                                    <button 
                                        key={key}
                                        onClick={() => { setExpId(key); reset(); }}
                                        className={`w-full text-left p-3 rounded-xl border transition-all flex items-center justify-between
                                            ${expId === key ? 'bg-slate-800 border-purple-500 text-white shadow-lg' : 'bg-slate-900/50 border-slate-700 text-slate-400 hover:bg-slate-800'}
                                        `}
                                    >
                                        <span className="text-sm font-bold">{exp.name}</span>
                                        {expId === key && <div className="w-2 h-2 bg-purple-400 rounded-full shadow-[0_0_5px_rgba(192,132,252,0.8)]"></div>}
                                    </button>
                                ))}
                            </div>

                            {/* Info Card */}
                            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                <div className="flex items-center gap-2 mb-2 text-emerald-400 font-bold text-xs uppercase">
                                    <Icon name="info" size={14} /> Indicator Logic
                                </div>
                                <p className="text-xs text-slate-400 leading-relaxed mb-2">
                                    <strong>{currentExp.indicator}</strong>
                                </p>
                                <div className="text-[10px] text-slate-500 font-mono bg-slate-900 p-2 rounded border border-slate-800 break-words leading-relaxed">
                                    {currentExp.eq}
                                </div>
                            </div>

                            {/* Controls */}
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1">Add Titrant</label>
                                <div className="grid grid-cols-3 gap-2">
                                    <button onClick={() => addTitrant(5.0)} className="py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-mono text-sm font-bold text-white transition-colors border border-slate-600">+5 mL</button>
                                    <button onClick={() => addTitrant(1.0)} className="py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-mono text-sm font-bold text-white transition-colors border border-slate-600">+1 mL</button>
                                    <button onClick={() => addTitrant(0.1)} className="py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-mono text-sm font-bold text-white transition-colors border border-slate-600">+0.1</button>
                                </div>
                                
                                {showStarchBtn && (
                                    <button 
                                        onClick={() => setStarchAdded(true)}
                                        className="w-full py-3 mt-2 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-sm text-white flex items-center justify-center gap-2 shadow-lg animate-pulse transition-all"
                                    >
                                        <Icon name="droplet" size={16}/> Add Starch Indicator
                                    </button>
                                )}
                                
                                <button onClick={reset} className="w-full py-3 mt-4 bg-slate-800 hover:bg-slate-700 rounded-xl font-bold text-sm text-slate-400 flex items-center justify-center gap-2 border border-slate-700 transition-colors">
                                    <Icon name="rotate-ccw" size={16}/> Reset
                                </button>
                            </div>

                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 relative bg-[#020617] overflow-hidden flex flex-col items-center justify-center">
                        
                        {/* Burette System */}
                        <div className="relative flex flex-col items-center h-[600px]">
                            
                            {/* Burette Tube */}
                            <div className="w-6 h-64 border-x-2 border-slate-500 bg-slate-800/30 relative mb-0.5 overflow-hidden">
                                {/* Liquid in Burette - Drains from top */}
                                <div className={`absolute bottom-0 left-0 w-full transition-all duration-300 ${currentExp.colors.titrant}`} 
                                     style={{ height: `${Math.max(0, 100 - (addedVol/50)*100)}%` }}></div>
                                
                                {/* Tick Marks */}
                                <div className="absolute right-0 top-0 h-full w-1.5 border-l border-slate-600 flex flex-col justify-between py-1 pointer-events-none">
                                    {[...Array(11)].map((_, i) => <div key={i} className="w-full h-px bg-slate-400/50"></div>)}
                                </div>
                            </div>

                            {/* Tap (Stopcock) */}
                            <div className="w-12 h-8 flex flex-col items-center relative z-10">
                                <div className="w-1 h-2 bg-slate-500"></div>
                                <div className="w-8 h-4 bg-slate-400 rounded-sm flex items-center justify-center shadow-md">
                                    <div className={`w-1 h-5 bg-slate-600 rounded-full transition-transform duration-200 ${isDropping ? 'rotate-0' : 'rotate-90'}`}></div>
                                </div>
                                <div className="w-1 h-2 bg-slate-500 relative">
                                    {/* Drop Animation */}
                                    {isDropping && (
                                        <div key={dropKey} className={`absolute top-full left-1/2 -translate-x-1/2 w-2 h-2 rounded-full ${currentExp.colors.titrant} drop`}></div>
                                    )}
                                </div>
                            </div>

                            {/* Conical Flask */}
                            <div className="relative mt-12">
                                {/* Flask Body */}
                                <div className="w-40 h-40 border-4 border-slate-400/30 rounded-[50%_50%_40%_40%_/_60%_60%_40%_40%] bg-white/5 backdrop-blur-sm relative overflow-hidden shadow-2xl">
                                    
                                    {/* Solution Level - Increases as titrant is added */}
                                    <div 
                                        className={`absolute bottom-0 w-full transition-all duration-500 liquid ${flaskColorClass}`}
                                        style={{ height: `${40 + (addedVol/50)*40}%` }} // Start at 40%, fills up
                                    >
                                        {/* Swirl Overlay */}
                                        <div className="absolute inset-0 bg-gradient-to-tr from-black/20 to-transparent opacity-40"></div>
                                        {/* Surface Line */}
                                        <div className="absolute top-0 left-0 w-full h-1 bg-white/20"></div>
                                    </div>

                                    {/* Glass Reflection */}
                                    <div className="absolute top-8 left-3 w-3 h-24 bg-gradient-to-b from-white/10 to-transparent rounded-full -rotate-12 pointer-events-none"></div>
                                </div>
                                
                                {/* Flask Neck (Visual only) */}
                                <div className="absolute -top-12 left-1/2 -translate-x-1/2 w-10 h-14 border-x-4 border-slate-400/30 bg-white/5 backdrop-blur-sm z-0"></div>
                            </div>

                            {/* Volume Readout */}
                            <div className="mt-12 text-center">
                                <div className="text-5xl font-mono font-black text-white mb-2 tabular-nums">
                                    {addedVol.toFixed(1)} <span className="text-xl text-slate-500 font-bold">mL</span>
                                </div>
                                <div className={`text-xs font-bold uppercase tracking-[0.2em] ${statusColor} h-6`}>
                                    {statusMsg}
                                </div>
                            </div>

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
