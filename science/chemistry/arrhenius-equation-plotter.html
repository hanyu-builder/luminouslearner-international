<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrhenius Equation Plotter</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js for Graphing -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        try {
                            const svgElement = window.lucide.createElement(iconData);
                            svgElement.setAttribute('class', className);
                            svgElement.setAttribute('width', size);
                            svgElement.setAttribute('height', size);
                            setSvgHtml(svgElement.outerHTML);
                        } catch (e) { console.error(e); }
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        const R_CONSTANT = 8.314; // J K-1 mol-1

        const App = () => {
            // State: Raw Data Points
            const [points, setPoints] = useState([
                { t: 300, k: 0.0025 },
                { t: 310, k: 0.0050 },
                { t: 320, k: 0.0100 },
                { t: 330, k: 0.0190 }
            ]);
            
            const [results, setResults] = useState(null);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            // Calculation & Plotting Logic
            useEffect(() => {
                if (points.length < 2) return;

                // 1. Process Data (Convert T to 1/T, k to ln k)
                const processedData = points.map(p => ({
                    x: 1 / (p.t), // 1/T (K^-1)
                    y: Math.log(p.k), // ln k
                    rawT: p.t,
                    rawK: p.k
                }));

                // 2. Linear Regression (Least Squares)
                const n = processedData.length;
                const sumX = processedData.reduce((acc, p) => acc + p.x, 0);
                const sumY = processedData.reduce((acc, p) => acc + p.y, 0);
                const sumXY = processedData.reduce((acc, p) => acc + (p.x * p.y), 0);
                const sumXX = processedData.reduce((acc, p) => acc + (p.x * p.x), 0);

                const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;

                // 3. Calculate Ea and A
                // Slope = -Ea / R  =>  Ea = -Slope * R
                // Intercept = ln A =>  A = e^Intercept
                const eaJoules = -slope * R_CONSTANT;
                const eaKJ = eaJoules / 1000;
                const preExpA = Math.exp(intercept);

                setResults({
                    slope: slope,
                    intercept: intercept,
                    ea: eaKJ,
                    a: preExpA,
                    r2: calculateR2(processedData, slope, intercept) // Optional: Goodness of fit
                });

                // 4. Draw Chart
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                
                // Generate line points (start and end of x range)
                const minX = Math.min(...processedData.map(p => p.x));
                const maxX = Math.max(...processedData.map(p => p.x));
                const lineData = [
                    { x: minX, y: slope * minX + intercept },
                    { x: maxX, y: slope * maxX + intercept }
                ];

                chartInstance.current = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [
                            {
                                label: 'Experimental Data',
                                data: processedData,
                                backgroundColor: '#10B981', // Emerald 500
                                borderColor: '#10B981',
                                pointRadius: 6,
                                pointHoverRadius: 8
                            },
                            {
                                type: 'line',
                                label: 'Best Fit Line',
                                data: lineData,
                                borderColor: '#3B82F6', // Blue 500
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                borderDash: [5, 5]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#94a3b8' } },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const raw = ctx.raw;
                                        if(ctx.dataset.type === 'line') return null;
                                        return `1/T: ${raw.x.toExponential(4)}, ln k: ${raw.y.toFixed(3)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                title: { display: true, text: '1 / T  (K⁻¹)', color: '#94a3b8' },
                                ticks: { color: '#64748b' },
                                grid: { color: '#334155' }
                            },
                            y: {
                                title: { display: true, text: 'ln k', color: '#94a3b8' },
                                ticks: { color: '#64748b' },
                                grid: { color: '#334155' }
                            }
                        }
                    }
                });

            }, [points]);

            // Helper: R-squared calculation
            const calculateR2 = (data, m, c) => {
                const yMean = data.reduce((acc, p) => acc + p.y, 0) / data.length;
                const ssTot = data.reduce((acc, p) => acc + Math.pow(p.y - yMean, 2), 0);
                const ssRes = data.reduce((acc, p) => acc + Math.pow(p.y - (m * p.x + c), 2), 0);
                return 1 - (ssRes / ssTot);
            };

            const handleInputChange = (idx, field, value) => {
                const newPoints = [...points];
                newPoints[idx][field] = parseFloat(value);
                setPoints(newPoints);
            };

            const addRow = () => {
                setPoints([...points, { t: 0, k: 0 }]);
            };

            const removeRow = (idx) => {
                const newPoints = points.filter((_, i) => i !== idx);
                setPoints(newPoints);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Left Panel: Data Entry */}
                    <div className="w-full md:w-96 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen overflow-y-auto">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="line-chart" className="text-emerald-400" /> Arrhenius Plotter
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Determine Activation Energy (Ea)</p>
                        </div>

                        <div className="p-6 space-y-6">
                            
                            {/* Data Table */}
                            <div className="space-y-3">
                                <div className="grid grid-cols-6 gap-2 text-xs font-bold text-slate-500 uppercase text-center mb-2">
                                    <span className="col-span-2">Temp (K)</span>
                                    <span className="col-span-3">Rate Const (k)</span>
                                    <span className="col-span-1"></span>
                                </div>
                                
                                {points.map((pt, idx) => (
                                    <div key={idx} className="grid grid-cols-6 gap-2 items-center">
                                        <input 
                                            type="number" 
                                            value={pt.t} 
                                            onChange={(e) => handleInputChange(idx, 't', e.target.value)}
                                            className="col-span-2 bg-slate-800 border border-slate-700 rounded-lg p-2 text-center text-sm font-mono focus:border-emerald-500 outline-none text-emerald-300"
                                            placeholder="T"
                                        />
                                        <input 
                                            type="number" step="0.0001"
                                            value={pt.k} 
                                            onChange={(e) => handleInputChange(idx, 'k', e.target.value)}
                                            className="col-span-3 bg-slate-800 border border-slate-700 rounded-lg p-2 text-center text-sm font-mono focus:border-emerald-500 outline-none text-blue-300"
                                            placeholder="k"
                                        />
                                        <button 
                                            onClick={() => removeRow(idx)}
                                            className="col-span-1 flex justify-center text-slate-600 hover:text-red-400 transition-colors"
                                            disabled={points.length <= 2}
                                        >
                                            <Icon name="trash-2" size={16} />
                                        </button>
                                    </div>
                                ))}

                                <button 
                                    onClick={addRow}
                                    className="w-full py-2 border-2 border-dashed border-slate-700 rounded-lg text-slate-500 text-sm font-bold hover:border-slate-500 hover:text-slate-300 transition-all flex items-center justify-center gap-2"
                                >
                                    <Icon name="plus" size={16}/> Add Data Point
                                </button>
                            </div>

                            {/* Results Card */}
                            {results && (
                                <div className="bg-slate-800 rounded-2xl border border-slate-700 p-5 space-y-4 shadow-lg animate-pulse-once">
                                    <div>
                                        <div className="text-xs text-slate-500 font-bold uppercase mb-1">Slope (m)</div>
                                        <div className="text-xl font-mono font-bold text-white">{results.slope.toFixed(2)}</div>
                                    </div>
                                    <div className="pt-4 border-t border-slate-700">
                                        <div className="text-xs text-slate-500 font-bold uppercase mb-1">Activation Energy (Ea)</div>
                                        <div className="text-3xl font-mono font-black text-emerald-400">
                                            {results.ea.toFixed(2)} <span className="text-sm font-normal text-emerald-400/60">kJ mol⁻¹</span>
                                        </div>
                                        <p className="text-xs text-slate-500 mt-1">Calculated from Eₐ = -Slope × R</p>
                                    </div>
                                    <div className="pt-4 border-t border-slate-700">
                                        <div className="text-xs text-slate-500 font-bold uppercase mb-1">Pre-exponential (A)</div>
                                        <div className="text-lg font-mono font-bold text-blue-300">
                                            {results.a.toExponential(2)}
                                        </div>
                                    </div>
                                    {results.r2 < 0.95 && (
                                        <div className="text-xs text-red-400 bg-red-900/20 p-2 rounded border border-red-500/30 flex gap-2">
                                            <Icon name="alert-triangle" size={14} /> 
                                            Poor Fit (R² = {results.r2.toFixed(3)})
                                        </div>
                                    )}
                                </div>
                            )}

                        </div>
                    </div>

                    {/* Right Panel: Graph */}
                    <div className="flex-1 bg-slate-900/50 p-4 md:p-8 flex flex-col relative overflow-hidden">
                        {/* Background Grid */}
                        <div className="absolute inset-0 opacity-10 pointer-events-none" 
                            style={{backgroundImage: 'linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px)', backgroundSize: '20px 20px'}}>
                        </div>

                        <div className="flex-1 relative z-10 bg-slate-800/80 backdrop-blur rounded-3xl border border-slate-700 p-4 shadow-2xl flex flex-col">
                            <div className="flex justify-between items-center mb-4 px-2">
                                <h2 className="text-lg font-bold text-white flex items-center gap-2">
                                    <Icon name="scatter-chart" className="text-blue-400" /> Arrhenius Plot
                                </h2>
                                <div className="text-xs font-mono text-slate-400 bg-slate-900 px-3 py-1 rounded-full border border-slate-600">
                                    ln k = -Eₐ/R (1/T) + ln A
                                </div>
                            </div>
                            
                            <div className="flex-1 relative w-full min-h-[300px]">
                                <canvas ref={chartRef}></canvas>
                            </div>
                        </div>

                        {/* Formula Explanation */}
                        <div className="mt-6 p-6 bg-slate-800 rounded-2xl border border-slate-700 z-10 shrink-0">
                            <h3 className="text-sm font-bold text-slate-300 uppercase mb-3 flex items-center gap-2">
                                <Icon name="book-open" className="text-yellow-400 w-4 h-4"/> Theory Guide
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-slate-400">
                                <div>
                                    <p className="mb-2"><strong className="text-white">The Equation:</strong> Taking the natural log of the Arrhenius equation transforms it into a linear form <span className="font-mono text-emerald-300">y = mx + c</span>.</p>
                                    <ul className="list-disc pl-4 space-y-1">
                                        <li>y-axis: <span className="font-mono text-blue-300">ln k</span></li>
                                        <li>x-axis: <span className="font-mono text-emerald-300">1 / T</span></li>
                                    </ul>
                                </div>
                                <div>
                                    <p className="mb-2"><strong className="text-white">Calculating Ea:</strong> The slope of the line (m) is equal to <span className="font-mono text-red-300">-Eₐ / R</span>.</p>
                                    <p>Therefore, to find Activation Energy:</p>
                                    <div className="font-mono bg-slate-900 p-2 rounded text-center mt-2 border border-slate-600 text-white">
                                        Eₐ = -Slope × 8.314 J mol⁻¹
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
