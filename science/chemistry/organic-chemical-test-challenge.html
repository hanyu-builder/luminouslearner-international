<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organic Chemical Test Challenge</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Liquid Animation */
        .liquid-fill {
            transition: height 1s ease-in-out, background-color 1s ease-in-out;
        }
        
        /* Drop Animation */
        .drop-fall {
            animation: drop 0.6s cubic-bezier(0.5, 0, 1, 1);
        }
        @keyframes drop {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(150px) scale(0.5); opacity: 0; }
        }

        /* Flask Shake on Wrong Answer */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 
            10%, 90% { transform: translate3d(-1px, 0, 0); } 
            20%, 80% { transform: translate3d(2px, 0, 0); } 
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 
            40%, 60% { transform: translate3d(4px, 0, 0); } 
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- GAME DATA (Translated & Verified) ---
        const REAGENTS = [
            { id: 'kmno4', name: 'Acidified KMnO₄', color: 'bg-purple-600', type: 'Oxidation' },
            { id: 'br2', name: 'Bromine in CCl₄', color: 'bg-orange-500', type: 'Addition' }, 
            { id: 'tollens', name: 'Tollens\' Reagent', color: 'bg-slate-200', type: 'Oxidation' },
            { id: '24dnp', name: '2,4-DNP', color: 'bg-orange-600', type: 'Condensation' },
            { id: 'iodoform', name: 'I₂ / NaOH', color: 'bg-yellow-700', type: 'Iodoform Test' },
            { id: 'nahco3', name: 'NaHCO₃ (aq)', color: 'bg-white', type: 'Acid-Base' },
            { id: 'agno3', name: 'AgNO₃ / Ethanol', color: 'bg-slate-100', type: 'Hydrolysis' }, 
            { id: 'naoh_heat', name: 'NaOH (aq), Heat', color: 'bg-white', type: 'Hydrolysis' } 
        ];

        // Mode 1: Distinguish (Versus)
        const VERSUS_CHALLENGES = [
            {
                id: 1,
                pair: ['Propan-1-ol', 'Propanone'],
                targetA: 'Propan-1-ol', targetB: 'Propanone',
            },
            {
                id: 2,
                pair: ['Ethanol', 'Ethanoic Acid'],
                targetA: 'Ethanol', targetB: 'Ethanoic Acid',
            },
            {
                id: 3,
                pair: ['Cyclohexene', 'Cyclohexane'],
                targetA: 'Cyclohexene', targetB: 'Cyclohexane',
            },
            {
                id: 4,
                pair: ['Propanal', 'Propanone'],
                targetA: 'Propanal', targetB: 'Propanone',
            },
            {
                id: 5,
                pair: ['Propan-2-ol', 'Propan-1-ol'],
                targetA: 'Propan-2-ol', targetB: 'Propan-1-ol',
            },
            {
                id: 6,
                pair: ['1-Chlorobutane', 'Butan-1-ol'],
                targetA: '1-Chlorobutane', targetB: 'Butan-1-ol',
            },
            {
                id: 7,
                pair: ['Ethanamide', 'Ethyl Ethanoate'],
                targetA: 'Ethanamide', targetB: 'Ethyl Ethanoate',
            }
        ];

        // Mode 2: Identify (Unknown)
        const IDENTITY_CHALLENGES = [
            {
                id: 101,
                answer: 'Propanone',
                candidates: ['Propan-1-ol', 'Propanone', 'Propanal', 'Propanoic Acid']
            },
            {
                id: 102,
                answer: 'Ethanoic Acid',
                candidates: ['Ethanol', 'Ethanoic Acid', 'Ethyl Ethanoate', 'Ethanal']
            },
            {
                id: 103,
                answer: 'Cyclohexene',
                candidates: ['Cyclohexane', 'Cyclohexene', 'Benzene', 'Hexane']
            },
            {
                id: 104,
                answer: 'Propanal',
                candidates: ['Propanone', 'Propan-1-ol', 'Propanal', 'Propanoic Acid']
            },
            {
                id: 105,
                answer: 'Ethyl Ethanoate',
                candidates: ['Ethanoic Acid', 'Ethanol', 'Ethyl Ethanoate', 'Ethanal']
            },
            {
                id: 106,
                answer: '1-Chlorobutane',
                candidates: ['Butan-1-ol', '1-Chlorobutane', 'Butanoic Acid', 'Butanone']
            },
            {
                id: 107,
                answer: 'Ethanamide',
                candidates: ['Ethanoic Acid', 'Ethylamine', 'Ethanamide', 'Ethyl Ethanoate']
            }
        ];

        // Comprehensive Reaction Logic
        const getReactionResult = (compound, reagentId) => {
            // Default: No Reaction (color of reagent mixes in)
            let res = { 
                color: reagentId === 'kmno4' ? 'bg-purple-600/80' : 
                       reagentId === 'br2' ? 'bg-orange-400/60' : 
                       reagentId === '24dnp' ? 'bg-orange-600/80' : 
                       reagentId === 'iodoform' ? 'bg-yellow-700/60' :
                       reagentId === 'tollens' ? 'bg-slate-200/40' : 
                       reagentId === 'agno3' ? 'bg-slate-100/40' : 'bg-white/10',
                obs: 'No observable change',
                reacted: false
            };

            // 1. Acidified KMnO4 (Oxidation)
            if (reagentId === 'kmno4') {
                if (['Propan-1-ol', 'Ethanol', 'Propanal', 'Cyclohexene', 'Propan-2-ol', 'Ethanal', 'Butan-1-ol'].includes(compound)) {
                    return { color: 'bg-white/10', obs: 'Purple colour decolourises', reacted: true };
                }
            }

            // 2. Bromine in CCl4 (Addition)
            if (reagentId === 'br2') {
                if (['Cyclohexene'].includes(compound)) {
                    return { color: 'bg-white/10', obs: 'Orange colour decolourises rapidly', reacted: true };
                }
                if (['Phenol', 'Phenylamine'].includes(compound)) { 
                     return { color: 'bg-white/50', obs: 'Decolourises & White ppt', reacted: true, type: 'ppt' };
                }
            }

            // 3. Tollens' Reagent (Silver Mirror)
            if (reagentId === 'tollens') {
                if (['Propanal', 'Ethanal'].includes(compound)) {
                    return { color: 'bg-gradient-to-b from-slate-300 to-slate-500', obs: 'Silver mirror formed', reacted: true, type: 'coating' };
                }
            }

            // 4. 2,4-DNP (Carbonyls)
            if (reagentId === '24dnp') {
                if (['Propanal', 'Propanone', 'Ethanal', 'Butanone'].includes(compound)) {
                    return { color: 'bg-orange-500', obs: 'Yellow/Orange precipitate', reacted: true, type: 'ppt' };
                }
            }

            // 5. Iodoform (Methyl ketone or Methyl secondary alcohol)
            if (reagentId === 'iodoform') {
                if (['Propanone', 'Ethanol', 'Propan-2-ol', 'Ethanal', 'Butanone'].includes(compound)) {
                    return { color: 'bg-yellow-300', obs: 'Yellow precipitate (CHI₃)', reacted: true, type: 'ppt' };
                }
            }

            // 6. NaHCO3 (Acids)
            if (reagentId === 'nahco3') {
                if (['Ethanoic Acid', 'Propanoic Acid', 'Butanoic Acid'].includes(compound)) {
                    return { color: 'bg-white/10', obs: 'Colourless gas bubbles (CO₂)', reacted: true, type: 'gas' };
                }
            }

            // 7. AgNO3 / Ethanol (Haloalkanes)
            if (reagentId === 'agno3') {
                if (['1-Chlorobutane'].includes(compound)) {
                    // Cl- gives white ppt (AgCl), slowly
                    return { color: 'bg-white/80', obs: 'White precipitate (Slow)', reacted: true, type: 'ppt' };
                }
            }

            // 8. NaOH, Heat (Amides/Ammonium salts)
            if (reagentId === 'naoh_heat') {
                if (['Ethanamide'].includes(compound)) {
                    return { color: 'bg-white/10', obs: 'Pungent gas (NH₃) evolved', reacted: true, type: 'gas' };
                }
            }

            return res;
        };

        // --- COMPONENTS ---
        
        const Flask = ({ label, result, dropping }) => {
            return (
                <div className="flex flex-col items-center">
                    {/* Flask Body */}
                    <div className="relative w-32 h-40 border-4 border-slate-400/30 rounded-b-[3rem] rounded-t-lg bg-white/5 backdrop-blur-sm overflow-hidden shadow-xl">
                        {/* Drop Animation */}
                        {dropping && (
                            <div className={`absolute top-0 left-1/2 -translate-x-1/2 w-3 h-3 rounded-full drop-fall ${dropping.color}`}></div>
                        )}
                        
                        {/* Liquid */}
                        <div className={`absolute bottom-0 left-0 w-full liquid-fill transition-all duration-1000
                             ${result ? result.color : 'bg-white/5'}
                             ${result && result.type === 'gas' ? 'animate-pulse' : ''}
                        `} style={{ height: '60%' }}>
                             {/* Bubbles for gas */}
                             {result && result.type === 'gas' && (
                                 <div className="w-full h-full absolute inset-0 flex justify-center items-end">
                                     {[...Array(5)].map((_, i) => <div key={i} className="w-2 h-2 bg-white/80 rounded-full animate-bounce mx-1"></div>)}
                                 </div>
                             )}
                             {/* Silver Mirror */}
                             {result && result.type === 'coating' && (
                                 <div className="absolute inset-0 bg-gradient-to-tr from-slate-300 via-white to-slate-400 opacity-90"></div>
                             )}
                        </div>
                    </div>
                    <div className="mt-4 text-center">
                        <div className="text-lg font-bold text-white">{label}</div>
                        <div className={`text-xs mt-1 font-mono transition-all ${result ? 'opacity-100' : 'opacity-0'} ${result && result.reacted ? 'text-emerald-400' : 'text-slate-400'}`}>
                            {result ? result.obs : '...'}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('versus'); // 'versus' | 'identify'
            
            // Versus State
            const [versusIdx, setVersusIdx] = useState(0);
            const [versusResults, setVersusResults] = useState({ A: null, B: null });
            
            // Identify State
            const [identifyIdx, setIdentifyIdx] = useState(0);
            const [identifyResult, setIdentifyResult] = useState(null);
            
            // Common State
            const [isAnimating, setIsAnimating] = useState(false);
            const [feedback, setFeedback] = useState(null); 
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);

            const currentVersusQ = VERSUS_CHALLENGES[versusIdx];
            const currentIdentifyQ = IDENTITY_CHALLENGES[identifyIdx];

            // Reset on mode or question change
            useEffect(() => {
                setVersusResults({ A: null, B: null });
                setIdentifyResult(null);
                setFeedback(null);
                setIsAnimating(false);
            }, [mode, versusIdx, identifyIdx]);

            // --- HANDLERS ---

            const handleVersusTest = (reagent) => {
                if (isAnimating || feedback) return;
                setIsAnimating(reagent);
                
                const resA = getReactionResult(currentVersusQ.targetA, reagent.id);
                const resB = getReactionResult(currentVersusQ.targetB, reagent.id);

                setTimeout(() => {
                    setVersusResults({ A: resA, B: resB });
                    setIsAnimating(false);

                    const distinguished = (resA.obs !== resB.obs);

                    if (distinguished) {
                        setFeedback({ type: 'success', msg: 'Correctly Distinguished!' });
                        setScore(s => s + 10 + streak * 5);
                        setStreak(s => s + 1);
                    } else {
                        setFeedback({ type: 'fail', msg: 'Failed to Distinguish' });
                        setStreak(0);
                    }
                }, 600);
            };

            const handleIdentifyTest = (reagent) => {
                if (isAnimating || feedback) return;
                
                setIsAnimating(reagent);
                const res = getReactionResult(currentIdentifyQ.answer, reagent.id);
                
                setTimeout(() => {
                    setIdentifyResult(res);
                    setIsAnimating(false);
                }, 600);
            };

            const handleIdentifyGuess = (candidate) => {
                if (feedback) return;

                if (candidate === currentIdentifyQ.answer) {
                    setFeedback({ type: 'success', msg: `Correct! It was ${candidate}.` });
                    setScore(s => s + 20 + streak * 5);
                    setStreak(s => s + 1);
                } else {
                    setFeedback({ type: 'fail', msg: `Wrong! It was ${currentIdentifyQ.answer}.` });
                    setStreak(0);
                }
            };

            const nextQ = () => {
                // Only advance if we are not animating.
                if (isAnimating) return;

                if (mode === 'versus') {
                    setVersusIdx(prev => (prev + 1) % VERSUS_CHALLENGES.length);
                } else {
                    setIdentifyIdx(prev => (prev + 1) % IDENTITY_CHALLENGES.length);
                }
                // Reset feedback immediately to close the modal and allow state reset in useEffect to take effect cleanly
                setFeedback(null);
            };

            const resetFlask = () => {
                setIdentifyResult(null);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col items-center p-4 md:p-8">
                    
                    {/* Header & Mode Switch */}
                    <div className="w-full max-w-5xl mb-8 space-y-4">
                        <div className="flex justify-between items-center bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-purple-600 rounded-lg"><Icon name="flask-conical" className="text-white" /></div>
                                <div>
                                    <h1 className="text-lg font-bold">Chemical Test Challenge</h1>
                                    <div className="text-xs text-slate-400">Organic Chemistry Analysis</div>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                {streak > 1 && <div className="text-orange-400 font-bold flex gap-1 animate-pulse"><Icon name="flame"/> {streak}</div>}
                                <div className="bg-slate-900 px-4 py-1 rounded text-emerald-400 font-mono font-bold">{score} pts</div>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-2">
                            <button 
                                onClick={() => setMode('versus')}
                                className={`py-3 rounded-xl font-bold text-sm transition-all ${mode === 'versus' ? 'bg-blue-600 text-white shadow-lg' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                            >
                                Versus Mode (Distinguish)
                            </button>
                            <button 
                                onClick={() => setMode('identify')}
                                className={`py-3 rounded-xl font-bold text-sm transition-all ${mode === 'identify' ? 'bg-emerald-600 text-white shadow-lg' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                            >
                                Identify Mode (Unknown)
                            </button>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-3 gap-8">
                        
                        {/* LEFT: The Lab Bench */}
                        <div className="lg:col-span-2 bg-slate-900 rounded-3xl border border-slate-800 p-8 relative overflow-hidden min-h-[400px] flex flex-col">
                            <div className="absolute top-4 left-1/2 -translate-x-1/2 text-slate-500 text-xs font-bold uppercase tracking-widest">
                                {mode === 'versus' ? 'Distinguish X from Y' : 'Identify Unknown'}
                            </div>
                            
                            {/* Stage */}
                            <div className="flex-1 flex items-center justify-center gap-12 relative z-10">
                                {mode === 'versus' ? (
                                    <>
                                        <Flask label={`A: ${currentVersusQ.targetA}`} result={versusResults.A} dropping={isAnimating} />
                                        <div className="w-px h-32 bg-slate-800"></div>
                                        <Flask label={`B: ${currentVersusQ.targetB}`} result={versusResults.B} dropping={isAnimating} />
                                    </>
                                ) : (
                                    <div className="flex flex-col items-center gap-4">
                                        <Flask label="Unknown Sample" result={identifyResult} dropping={isAnimating} />
                                        {identifyResult && !feedback && (
                                            <button onClick={resetFlask} className="text-xs text-slate-400 hover:text-white flex items-center gap-1 bg-slate-800 px-3 py-1 rounded-full border border-slate-700">
                                                <Icon name="rotate-ccw" size={12}/> New Sample
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Feedback Overlay */}
                            {feedback && (
                                <div className={`absolute bottom-0 left-0 right-0 p-6 border-t backdrop-blur-xl animate-in slide-in-from-bottom-4 z-20
                                    ${feedback.type === 'success' ? 'bg-emerald-900/90 border-emerald-500/50' : 'bg-red-900/90 border-red-500/50'}
                                `}>
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className={`font-bold text-lg ${feedback.type === 'success' ? 'text-emerald-400' : 'text-red-400'}`}>
                                                {feedback.type === 'success' ? 'Success!' : 'Incorrect'}
                                            </div>
                                            <div className="text-sm text-slate-300 mt-1">{feedback.msg}</div>
                                        </div>
                                        <button onClick={nextQ} className="px-6 py-2 bg-white text-slate-900 rounded-lg font-bold hover:bg-slate-200 transition-colors shadow-lg flex items-center gap-2">
                                            Next <Icon name="arrow-right" size={16}/>
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* RIGHT: Controls */}
                        <div className="space-y-6">
                            
                            {/* Reagent Selection */}
                            <div className="bg-slate-800/50 rounded-2xl border border-slate-700 p-4">
                                <div className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1 mb-3">Select Reagent</div>
                                <div className="grid grid-cols-1 gap-2 max-h-[300px] overflow-y-auto pr-1 custom-scrollbar">
                                    {REAGENTS.map(r => (
                                        <button 
                                            key={r.id}
                                            onClick={() => mode === 'versus' ? handleVersusTest(r) : handleIdentifyTest(r)}
                                            disabled={!!feedback || isAnimating}
                                            className="w-full text-left p-3 rounded-xl bg-slate-800 border border-slate-700 hover:border-slate-500 hover:bg-slate-700 transition-all group relative overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            <div className={`absolute left-0 top-0 bottom-0 w-1 ${r.color}`}></div>
                                            <div className="pl-3 flex justify-between items-center">
                                                <div>
                                                    <div className="font-bold text-sm text-white">{r.name}</div>
                                                    <div className="text-[10px] text-slate-400">{r.type}</div>
                                                </div>
                                                {isAnimating && isAnimating.id === r.id && <Icon name="loader-2" size={16} className="animate-spin text-slate-400"/>}
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Identification Choices (Only for Identify Mode) */}
                            {mode === 'identify' && !feedback && (
                                <div className="bg-slate-800/50 rounded-2xl border border-slate-700 p-4 animate-in fade-in">
                                    <div className="text-xs font-bold text-emerald-500 uppercase tracking-widest px-1 mb-3">Make a Guess</div>
                                    <div className="grid grid-cols-2 gap-2">
                                        {currentIdentifyQ.candidates.map((c, i) => (
                                            <button 
                                                key={i}
                                                onClick={() => handleIdentifyGuess(c)}
                                                className="p-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg text-xs text-slate-300 font-bold transition-colors"
                                            >
                                                {c}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
