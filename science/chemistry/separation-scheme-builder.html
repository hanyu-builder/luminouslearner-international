<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Separation Scheme Builder - LuminousLearner International</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Animations */
        .drip { animation: drip 2s infinite ease-in; }
        @keyframes drip {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            80% { transform: translateY(20px) scale(0.8); opacity: 1; }
            100% { transform: translateY(30px) scale(0.5); opacity: 0; }
        }
        
        .boil { animation: boil 0.5s infinite alternate; }
        @keyframes boil {
            0% { transform: translateY(0); }
            100% { transform: translateY(-2px); }
        }

        .ion-move-right { animation: moveRight 1.5s linear infinite; }
        @keyframes moveRight {
            0% { transform: translateX(0); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateX(100px); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        try {
                            const svgElement = window.lucide.createElement(iconData);
                            svgElement.setAttribute('class', className);
                            svgElement.setAttribute('width', size);
                            svgElement.setAttribute('height', size);
                            setSvgHtml(svgElement.outerHTML);
                        } catch (e) { console.error(e); }
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATASET (Internationalized) ---
        const MIXTURES = [
            {
                id: 'oil_water',
                name: 'Oil + Water',
                type: 'Immiscible Liquids',
                method: 'Separating Funnel',
                desc: 'Uses density difference. The denser liquid (water) settles at the bottom and is drained first.',
                components: [
                    { name: 'Oil', density: 0.8, color: 'bg-yellow-400/80', boilingPoint: 300 },
                    { name: 'Water', density: 1.0, color: 'bg-blue-500/60', boilingPoint: 100 }
                ],
                steps: ['Pour mixture into funnel', 'Allow layers to settle', 'Open tap to collect water', 'Close tap before oil enters'],
                visual: 'funnel'
            },
            {
                id: 'ethanol_water',
                name: 'Ethanol + Water',
                type: 'Miscible Liquids',
                method: 'Fractional Distillation',
                desc: 'Separates based on boiling points (Ethanol 78Â°C vs Water 100Â°C). Requires a fractionating column for efficiency.',
                components: [
                    { name: 'Ethanol', density: 0.79, color: 'bg-slate-200/30', boilingPoint: 78 }, // Visible color for visualization
                    { name: 'Water', density: 1.0, color: 'bg-blue-500/10', boilingPoint: 100 }
                ],
                steps: ['Heat mixture', 'Ethanol vaporizes first (lower BP)', 'Vapor passes through column', 'Condenses into receiver'],
                visual: 'distillation',
                fractional: true
            },
            {
                id: 'salt_water',
                name: 'Salt + Water',
                type: 'Solid Dissolved in Liquid',
                method: 'Simple Distillation',
                desc: 'Used to obtain the solvent (pure water) from a solution. The solute (salt) remains in the flask due to high boiling point.',
                components: [
                    { name: 'Salt', density: 2.1, color: 'bg-white', boilingPoint: 1465, textColor: 'text-slate-900' },
                    { name: 'Water', density: 1.0, color: 'bg-blue-200/30', boilingPoint: 100 }
                ],
                steps: ['Heat solution', 'Water evaporates', 'Salt remains in flask', 'Water condenses'],
                visual: 'distillation',
                fractional: false
            },
            {
                id: 'iodine_water',
                name: 'Iodine in Water',
                type: 'Solute Extraction',
                method: 'Solvent Extraction',
                desc: 'Extracting a solute (Iodine) from an aqueous solution using an organic solvent (e.g., Hexane) in which it is more soluble.',
                components: [
                    { name: 'Hexane', density: 0.66, color: 'bg-purple-500/50', boilingPoint: 69 }, // Purple representation for Iodine in organic layer
                    { name: 'Water', density: 1.0, color: 'bg-blue-100/30', boilingPoint: 100 }
                ],
                steps: ['Add organic solvent', 'Shake funnel to transfer Iodine', 'Allow layers to settle', 'Collect organic layer'],
                visual: 'funnel',
                extraction: true
            }
        ];

        // --- VISUALIZERS ---

        const SeparatingFunnel = ({ mixture, progress }) => {
            // Layer logic
            // Sort by density: heavier (higher density) at bottom
            const layers = [...mixture.components].sort((a, b) => b.density - a.density);
            const bottomLayer = layers[0];
            const topLayer = layers[1];

            // Progress 0: Mixed/Settling -> 50: Draining -> 100: Done
            const drainHeight = Math.max(0, 100 - (progress * 2)); // Bottom layer height %

            return (
                <div className="relative w-full h-full flex flex-col items-center justify-center">
                    {/* Funnel Body */}
                    <div className="relative w-32 h-64">
                        {/* Top Bulb */}
                        <div className="absolute top-0 left-0 w-32 h-48 rounded-t-full rounded-b-[40px] border-4 border-slate-400 bg-slate-800/30 backdrop-blur overflow-hidden z-10">
                            {/* Top Layer */}
                            <div className={`absolute top-0 left-0 w-full h-full ${topLayer.color} transition-all duration-1000`} 
                                 style={{ transform: `translateY(${progress > 50 ? (progress-50) + '%' : '0%'})` }}>
                                <span className="absolute top-10 left-1/2 -translate-x-1/2 text-xs font-bold text-slate-700">{topLayer.name}</span>
                            </div>
                            
                            {/* Bottom Layer */}
                            <div className={`absolute bottom-0 left-0 w-full ${bottomLayer.color} transition-all duration-100`} 
                                 style={{ height: `${drainHeight}%` }}>
                                <span className="absolute bottom-4 left-1/2 -translate-x-1/2 text-xs font-bold text-slate-900">{bottomLayer.name}</span>
                            </div>
                        </div>
                        
                        {/* Stem & Tap */}
                        <div className="absolute top-48 left-1/2 -translate-x-1/2 w-2 h-16 bg-slate-400"></div>
                        <div className={`absolute top-52 left-1/2 -translate-x-1/2 w-8 h-4 bg-slate-300 rounded transition-transform ${progress > 0 && progress < 100 ? 'rotate-90' : 'rotate-0'}`}></div>
                        
                        {/* Drips */}
                        {progress > 0 && progress < 50 && (
                            <div className="absolute top-64 left-1/2 -translate-x-1/2">
                                <div className={`w-2 h-2 rounded-full ${bottomLayer.color} drip`}></div>
                            </div>
                        )}
                    </div>

                    {/* Beaker */}
                    <div className="mt-8 w-24 h-32 border-x-2 border-b-2 border-slate-400 relative rounded-b-xl overflow-hidden">
                         <div className={`absolute bottom-0 w-full ${bottomLayer.color} transition-all duration-100`}
                              style={{ height: `${Math.min(100, progress * 2)}%` }}>
                         </div>
                         <span className="absolute bottom-2 w-full text-center text-xs font-bold text-white drop-shadow-md">Collected</span>
                    </div>
                </div>
            );
        };

        const DistillationSet = ({ mixture, progress }) => {
            // Sort components by boiling point to correctly identify volatile vs residue
            // Volatile (Lower BP) comes out first. Residue (Higher BP) stays.
            const sortedComponents = [...mixture.components].sort((a, b) => a.boilingPoint - b.boilingPoint);
            
            const volatile = sortedComponents[0]; // Lower BP (e.g. Water in Salt+Water)
            const residue = sortedComponents[1];  // Higher BP (e.g. Salt in Salt+Water)
            const isFractional = mixture.fractional;

            // Bubble animation
            const bubbles = progress > 0 && progress < 80;

            return (
                <div className="relative w-full h-full flex items-end justify-center pb-10">
                    
                    {/* Heat Source */}
                    <div className={`absolute bottom-10 left-20 w-16 h-10 bg-orange-500/50 blur-lg rounded-full transition-opacity ${progress > 0 && progress < 90 ? 'opacity-100' : 'opacity-0'}`}></div>
                    <div className="absolute bottom-10 left-24 text-2xl">ðŸ”¥</div>

                    {/* Round Bottom Flask */}
                    <div className="absolute bottom-20 left-16 w-24 h-24 rounded-full border-2 border-slate-400 bg-slate-800/30 overflow-hidden z-10">
                        <div className={`w-full h-full ${residue.color} relative ${bubbles ? 'boil' : ''}`} style={{opacity: 0.8}}>
                            {bubbles && <div className="absolute bottom-2 left-4 w-2 h-2 bg-white/50 rounded-full animate-ping"></div>}
                        </div>
                        <span className={`absolute bottom-8 w-full text-center text-[10px] font-bold ${residue.textColor || 'text-slate-300'}`}>{residue.name}</span>
                    </div>

                    {/* Column (Fractionating or Simple) */}
                    <div className="absolute bottom-40 left-[88px] w-6 h-32 border-x-2 border-slate-400 bg-slate-800/10 z-0">
                        {isFractional && (
                            <div className="w-full h-full flex flex-col justify-around items-center py-2">
                                {[...Array(5)].map((_,i) => <div key={i} className="w-4 h-4 rounded-full border border-slate-500 bg-slate-400/30"></div>)}
                            </div>
                        )}
                    </div>

                    {/* Thermometer Head */}
                    <div className="absolute bottom-[280px] left-[80px] w-10 h-12 border-2 border-slate-400 rounded-t-lg bg-white/10 flex items-center justify-center">
                        <span className="text-[10px] text-red-400 font-mono font-bold">
                            {progress > 20 ? volatile.boilingPoint : '25'}Â°C
                        </span>
                    </div>

                    {/* Condenser (Slanted) */}
                    <div className="absolute bottom-[240px] left-[110px] w-40 h-8 border-2 border-slate-400 bg-blue-200/10 rotate-12 transform-origin-left z-10 flex items-center overflow-hidden">
                         <div className="w-full h-full bg-blue-400/10 animate-pulse"></div> {/* Water jacket */}
                         <div className="absolute top-1/2 left-0 w-full h-1 bg-white/30 -translate-y-1/2"></div> {/* Inner tube */}
                         {/* Drops moving */}
                         {progress > 30 && progress < 90 && (
                             <div className={`absolute left-0 w-2 h-2 rounded-full ${volatile.color} bg-opacity-80 ion-move-right`}></div>
                         )}
                    </div>

                    {/* Receiver Flask */}
                    <div className="absolute bottom-16 left-[280px] w-16 h-20 border-2 border-slate-400 rounded-b-xl bg-slate-800/30 overflow-hidden flex items-end justify-center">
                        <div className={`w-full transition-all duration-[5000ms] ${volatile.color}`} 
                             style={{ height: progress > 30 ? `${progress}%` : '0%', opacity: 0.8 }}>
                        </div>
                        <span className="absolute bottom-2 text-[10px] font-bold text-white drop-shadow-md">{volatile.name}</span>
                    </div>

                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [selectedId, setSelectedId] = useState(MIXTURES[0].id);
            const [progress, setProgress] = useState(0);
            const [isRunning, setIsRunning] = useState(false);

            const currentMix = MIXTURES.find(m => m.id === selectedId);

            useEffect(() => {
                let interval;
                if (isRunning) {
                    interval = setInterval(() => {
                        setProgress(p => {
                            if (p >= 100) {
                                setIsRunning(false);
                                return 100;
                            }
                            return p + 1;
                        });
                    }, 50); // Simulation speed
                }
                return () => clearInterval(interval);
            }, [isRunning]);

            const handleStart = () => {
                setProgress(0);
                setIsRunning(true);
            };

            const handleReset = () => {
                setProgress(0);
                setIsRunning(false);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col z-10 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icon name="flask-conical" className="text-emerald-400" /> Scheme Builder
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Separation & Purification</p>
                        </div>

                        <div className="p-4 space-y-2 flex-1 overflow-y-auto">
                            <label className="text-xs font-bold text-slate-500 uppercase tracking-widest px-1 mb-2 block">Select Mixture</label>
                            {MIXTURES.map((m) => (
                                <button 
                                    key={m.id}
                                    onClick={() => { setSelectedId(m.id); handleReset(); }}
                                    className={`w-full text-left p-4 rounded-xl border transition-all flex flex-col gap-1
                                        ${selectedId === m.id 
                                            ? 'bg-slate-800 border-emerald-500 ring-1 ring-emerald-500/50' 
                                            : 'bg-slate-900/50 border-slate-700 hover:bg-slate-800'}
                                    `}
                                >
                                    <div className="flex justify-between items-center w-full">
                                        <span className="font-bold text-sm">{m.name}</span>
                                        {selectedId === m.id && <Icon name="check-circle" className="text-emerald-400" size={16}/>}
                                    </div>
                                    <span className="text-[10px] text-slate-400">{m.type}</span>
                                </button>
                            ))}
                        </div>

                        {/* Method Info */}
                        <div className="mt-auto p-6 border-t border-slate-800 bg-slate-900">
                            <div className="flex items-center gap-2 mb-2 text-emerald-400">
                                <Icon name="settings" size={16} />
                                <span className="text-xs font-bold uppercase">Recommended Method</span>
                            </div>
                            <div className="text-lg font-bold text-white mb-2">{currentMix.method}</div>
                            <p className="text-xs text-slate-400 leading-relaxed">{currentMix.desc}</p>
                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 relative bg-[#020617] overflow-hidden flex flex-col">
                        
                        {/* Visualizer */}
                        <div className="flex-1 relative flex items-center justify-center p-8">
                            {currentMix.visual === 'funnel' ? (
                                <SeparatingFunnel mixture={currentMix} progress={progress} />
                            ) : (
                                <DistillationSet mixture={currentMix} progress={progress} />
                            )}
                        </div>

                        {/* Steps & Controls */}
                        <div className="h-48 bg-slate-800 border-t border-slate-700 p-6 shrink-0 flex flex-col gap-4 z-20">
                            
                            {/* Progress Bar & Controls */}
                            <div className="flex items-center gap-4">
                                <button 
                                    onClick={isRunning ? () => setIsRunning(false) : handleStart}
                                    className="w-12 h-12 rounded-full bg-emerald-600 hover:bg-emerald-500 text-white flex items-center justify-center shadow-lg transition-all hover:scale-105 active:scale-95 shrink-0"
                                >
                                    <Icon name={isRunning ? "pause" : "play"} size={20} fill="currentColor" />
                                </button>
                                
                                <div className="flex-1">
                                    <div className="flex justify-between text-xs font-bold text-slate-400 uppercase mb-2">
                                        <span>Start</span>
                                        <span>Separation Progress</span>
                                        <span>Done</span>
                                    </div>
                                    <div className="h-2 bg-slate-700 rounded-full overflow-hidden">
                                        <div className="h-full bg-emerald-500 transition-all duration-100 ease-linear" style={{width: `${progress}%`}}></div>
                                    </div>
                                </div>

                                <button 
                                    onClick={handleReset}
                                    className="p-3 rounded-xl hover:bg-slate-700 text-slate-400 hover:text-white transition-colors"
                                >
                                    <Icon name="rotate-ccw" size={20} />
                                </button>
                            </div>

                            {/* Steps Indicator */}
                            <div className="grid grid-cols-4 gap-2">
                                {currentMix.steps.map((step, i) => {
                                    const isActive = progress >= (i * 25) && progress < ((i + 1) * 25);
                                    const isDone = progress >= ((i + 1) * 25);
                                    return (
                                        <div key={i} className={`p-3 rounded-lg border text-center transition-all duration-500
                                            ${isActive ? 'bg-emerald-900/30 border-emerald-500 text-emerald-300 scale-105 shadow' : 
                                              isDone ? 'bg-slate-800 border-slate-600 text-slate-500 opacity-60' : 
                                              'bg-slate-900/50 border-slate-800 text-slate-600'}
                                        `}>
                                            <div className="text-[10px] font-bold uppercase mb-1">Step {i + 1}</div>
                                            <div className="text-xs truncate">{step}</div>
                                        </div>
                                    );
                                })}
                            </div>

                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
