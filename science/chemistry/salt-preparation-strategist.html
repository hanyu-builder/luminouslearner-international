<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salt Preparation Strategist</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Flowchart Lines Animation */
        .flow-line {
            stroke-dasharray: 10;
            animation: dash 1s linear infinite;
            opacity: 0.3;
            transition: all 0.3s ease;
        }
        .flow-line.active {
            stroke: #10b981;
            opacity: 1;
            stroke-width: 3px;
        }
        
        @keyframes dash {
            to { stroke-dashoffset: -20; }
        }

        /* Method Card Glow */
        .method-card.active {
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
            border-width: 2px;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Inline Icons to remove external dependency ---
        const Icons = {
            FlaskConical: ({ size = 20, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2" />
                    <path d="M8.5 2h7" />
                    <path d="M7 16h10" />
                </svg>
            ),
            GitBranch: ({ size = 20, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <line x1="6" y1="3" x2="6" y2="15" />
                    <circle cx="18" cy="6" r="3" />
                    <circle cx="6" cy="18" r="3" />
                    <path d="M18 9a9 9 0 0 1-9 9" />
                </svg>
            ),
            Filter: ({ size = 20, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
                </svg>
            ),
            Pipette: ({ size = 20, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M2 22l6-6" />
                    <path d="M9 13l3 3" />
                    <path d="M12 16l3-3" />
                    <path d="M10 2l11 11" />
                    <path d="M22 2l-2.5 2.5" />
                </svg>
            ),
            Beaker: ({ size = 20, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M4.5 3h15" />
                    <path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3" />
                    <line x1="6" y1="14" x2="18" y2="14" />
                </svg>
            ),
            ListChecks: ({ size = 20, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M10 6h11" />
                    <path d="M10 12h11" />
                    <path d="M10 18h11" />
                    <path d="M4 6h1" />
                    <path d="M4 12h1" />
                    <path d="M4 18h1" />
                </svg>
            )
        };

        const { FlaskConical, GitBranch, Filter, Pipette, Beaker, ListChecks } = Icons;


        // --- EXTENDED DATA ---
        const CATIONS = [
            { id: 'Na', name: 'Sodium (Na⁺)', group: 1 },
            { id: 'K', name: 'Potassium (K⁺)', group: 1 },
            { id: 'NH4', name: 'Ammonium (NH₄⁺)', group: 1 },
            { id: 'Mg', name: 'Magnesium (Mg²⁺)', group: 2 },
            { id: 'Ca', name: 'Calcium (Ca²⁺)', group: 2 },
            { id: 'Ba', name: 'Barium (Ba²⁺)', group: 2 },
            { id: 'Al', name: 'Aluminium (Al³⁺)', group: 3 },
            { id: 'Zn', name: 'Zinc (Zn²⁺)', group: 'Transition' },
            { id: 'Fe2', name: 'Iron(II) (Fe²⁺)', group: 'Transition' },
            { id: 'Fe3', name: 'Iron(III) (Fe³⁺)', group: 'Transition' },
            { id: 'Cu', name: 'Copper(II) (Cu²⁺)', group: 'Transition' },
            { id: 'Ag', name: 'Silver (Ag⁺)', group: 'Transition' },
            { id: 'Pb', name: 'Lead(II) (Pb²⁺)', group: 4 }
        ];

        const ANIONS = [
            { id: 'Cl', name: 'Chloride (Cl⁻)', exceptions: ['Ag', 'Pb'] }, 
            { id: 'Br', name: 'Bromide (Br⁻)', exceptions: ['Ag', 'Pb'] },
            { id: 'I', name: 'Iodide (I⁻)', exceptions: ['Ag', 'Pb', 'Cu'] },
            { id: 'NO3', name: 'Nitrate (NO₃⁻)', allSoluble: true },
            { id: 'SO4', name: 'Sulfate (SO₄²⁻)', exceptions: ['Ba', 'Pb', 'Ca'] }, 
            { id: 'CO3', name: 'Carbonate (CO₃²⁻)', solubleOnlyWith: ['Na', 'K', 'NH4'] }
        ];

        const METHODS = {
            titration: {
                id: 'titration',
                title: 'Acid-Alkali Titration',
                desc: 'Used for preparing SOLUBLE salts from Group 1 metals and Ammonium.',
                steps: [
                    '1. Pipette a known volume of alkali into a conical flask.',
                    '2. Add a few drops of indicator (e.g., Methyl Orange or Phenolphthalein).',
                    '3. Titrate with acid from a burette until the end-point is reached.',
                    '4. Record the volume of acid used.',
                    '5. Repeat the titration with the same volumes but WITHOUT indicator.',
                    '6. Crystallise the solution to obtain pure salt crystals.'
                ],
                color: 'border-purple-500 text-purple-400'
            },
            excess: {
                id: 'excess',
                title: 'Excess Insoluble Reagent',
                desc: 'Used for preparing SOLUBLE salts of metals like Magnesium, Zinc, Iron, and Copper.',
                steps: [
                    '1. Warm the dilute acid in a beaker.',
                    '2. Add the insoluble solid (Metal, Oxide, or Carbonate) in excess until no more dissolves.',
                    '3. Filter the mixture to remove the excess unreacted solid.',
                    '4. Transfer the filtrate (salt solution) to an evaporating basin.',
                    '5. Heat to concentrate, then allow to cool and crystallise.'
                ],
                color: 'border-orange-500 text-orange-400'
            },
            precipitation: {
                id: 'precipitation',
                title: 'Precipitation',
                desc: 'Used for preparing INSOLUBLE salts.',
                steps: [
                    '1. Mix two aqueous solutions containing the required ions (e.g., Nitrate + Sodium salt).',
                    '2. A precipitate forms immediately.',
                    '3. Filter the mixture to collect the precipitate as residue.',
                    '4. Wash the precipitate with distilled water to remove impurities.',
                    '5. Dry the salt in an oven or between filter papers.'
                ],
                color: 'border-emerald-500 text-emerald-400'
            }
        };

        // --- LOGIC ---
        const checkSolubility = (catId, anId) => {
            const anion = ANIONS.find(a => a.id === anId);
            if (anion.allSoluble) return true;
            if (anion.solubleOnlyWith) return anion.solubleOnlyWith.includes(catId);
            if (anion.exceptions) return !anion.exceptions.includes(catId);
            return true; // Default soluble
        };

        const getMethod = (catId, isSoluble) => {
            if (!isSoluble) return 'precipitation';
            if (['Na', 'K', 'NH4'].includes(catId)) return 'titration';
            return 'excess';
        };

        // New logic for color determination
        const getSaltAppearance = (catId, anId) => {
            // Specific colors
            if (catId === 'Cu') {
                if (anId === 'CO3') return { name: 'Green', class: 'bg-green-500' };
                if (anId === 'Cl') return { name: 'Green-Blue', class: 'bg-teal-500' };
                return { name: 'Blue', class: 'bg-blue-500' };
            }
            if (catId === 'Fe2') return { name: 'Pale Green', class: 'bg-emerald-300' };
            if (catId === 'Fe3') return { name: 'Yellow / Brown', class: 'bg-yellow-600' };
            
            // Halides
            if (catId === 'Ag') {
                if (anId === 'I') return { name: 'Yellow', class: 'bg-yellow-300' };
                if (anId === 'Br') return { name: 'Cream (Pale Yellow)', class: 'bg-yellow-100' };
                return { name: 'White', class: 'bg-white' };
            }
            if (catId === 'Pb' && anId === 'I') return { name: 'Bright Yellow', class: 'bg-yellow-400' };

            // Default White
            return { name: 'White / Colourless', class: 'bg-white' };
        };

        const App = () => {
            const [catId, setCatId] = useState('Na');
            const [anId, setAnId] = useState('Cl');
            const [isSoluble, setIsSoluble] = useState(true);
            const [method, setMethod] = useState('titration');
            const [appearance, setAppearance] = useState({ name: 'White', class: 'bg-white' });

            // Update logic on selection
            useEffect(() => {
                const sol = checkSolubility(catId, anId);
                setIsSoluble(sol);
                setMethod(getMethod(catId, sol));
                setAppearance(getSaltAppearance(catId, anId));
            }, [catId, anId]);

            const currentCation = CATIONS.find(c => c.id === catId);
            const currentAnion = ANIONS.find(a => a.id === anId);
            const currentMethod = METHODS[method];

            // --- FLOWCHART COMPONENT ---
            const Flowchart = () => {
                // Paths activation logic
                const path1Active = true; // Start -> Soluble?
                const path2Active = isSoluble; // Soluble -> Gp1?
                const path3Active = !isSoluble; // Insoluble -> Precip
                const path4Active = isSoluble && (method === 'titration'); // Gp1 -> Titration
                const path5Active = isSoluble && (method === 'excess'); // Not Gp1 -> Excess

                return (
                    <div className="relative w-full h-[400px] bg-slate-800/50 rounded-3xl border border-slate-700 p-8 flex flex-col items-center justify-start select-none">
                        
                        {/* Start Node */}
                        <div className="z-10 bg-blue-600 text-white px-6 py-3 rounded-full font-bold shadow-lg mb-8 flex items-center gap-2">
                            <span>Target: {currentCation.name.split(' ')[0]} {currentAnion.name.split(' ')[0]}</span>
                            {/* Small color dot preview in start node */}
                            <div className={`w-3 h-3 rounded-full ${appearance.class} border border-black/20`}></div>
                        </div>

                        {/* SVG Lines Layer */}
                        <svg className="absolute top-0 left-0 w-full h-full pointer-events-none overflow-visible">
                            <defs>
                                <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
                                </marker>
                                <marker id="arrow-active" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
                                </marker>
                            </defs>
                            
                            {/* Line 1: To Decision 1 */}
                            <line x1="50%" y1="60" x2="50%" y2="100" className={`flow-line ${path1Active ? 'active' : ''}`} markerEnd={path1Active ? "url(#arrow-active)" : "url(#arrow)"} />
                            
                            {/* Line 2: Decision 1 to Precipitation (Left) */}
                            <path d="M 50% 140 L 20% 140 L 20% 250" fill="none" className={`flow-line ${path3Active ? 'active' : ''}`} markerEnd={path3Active ? "url(#arrow-active)" : "url(#arrow)"} />
                            
                            {/* Line 3: Decision 1 to Decision 2 (Right) */}
                            <path d="M 50% 140 L 80% 140 L 80% 170" fill="none" className={`flow-line ${path2Active ? 'active' : ''}`} markerEnd={path2Active ? "url(#arrow-active)" : "url(#arrow)"} />

                            {/* Line 4: Decision 2 to Titration (Left branch) */}
                            <path d="M 80% 210 L 60% 210 L 60% 250" fill="none" className={`flow-line ${path4Active ? 'active' : ''}`} markerEnd={path4Active ? "url(#arrow-active)" : "url(#arrow)"} />

                            {/* Line 5: Decision 2 to Excess (Right branch) */}
                            <path d="M 80% 210 L 100% 210 L 100% 250" fill="none" className={`flow-line ${path5Active ? 'active' : ''}`} markerEnd={path5Active ? "url(#arrow-active)" : "url(#arrow)"} />

                        </svg>

                        {/* Nodes */}
                        <div className="w-full relative h-full">
                            
                            {/* Decision 1 */}
                            <div className="absolute top-[60px] left-1/2 -translate-x-1/2 bg-slate-700 border-2 border-slate-500 px-4 py-2 rounded-lg text-sm font-bold text-slate-200 w-48 text-center z-10 shadow-md">
                                Is it Soluble in Water?
                            </div>

                            {/* Method: Precipitation */}
                            <div className={`absolute top-[210px] left-[10%] w-[20%] p-3 rounded-xl border-2 text-center transition-all duration-500 method-card ${method === 'precipitation' ? 'active bg-emerald-900/50 border-emerald-500' : 'bg-slate-800 border-slate-700 opacity-50'}`}>
                                <div className="text-xs font-bold mb-1 text-emerald-400">NO</div>
                                <div className="font-bold text-white text-sm md:text-base">Precipitation</div>
                            </div>

                            {/* Decision 2 */}
                            <div className={`absolute top-[130px] left-[65%] w-[30%] bg-slate-700 border-2 border-slate-500 px-3 py-2 rounded-lg text-sm font-bold text-slate-200 text-center z-10 transition-opacity duration-300 shadow-md ${!isSoluble ? 'opacity-30 grayscale' : 'opacity-100
