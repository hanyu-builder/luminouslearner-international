<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Profile Diagram Maker - LuminousLearner</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .chart-container {
            position: relative;
            height: 450px; /* Increased height for better visibility */
            width: 100%;
            background-color: #1e293b; /* Dark chart background */
            border-radius: 1rem;
            border: 2px solid #334155;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons[name]) {
                    const iconNode = window.lucide.icons[name];
                    const iconSvg = window.lucide.createElement(iconNode);
                    iconSvg.setAttribute('width', size);
                    iconSvg.setAttribute('height', size);
                    iconSvg.setAttribute('class', className);
                    setSvg(iconSvg.outerHTML);
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        const Presets = [
            { 
                name: 'Combustion (CH4)', 
                type: 'exothermic', 
                dh: -89, 
                ea: 200, 
                cat: false,
                desc: 'Highly exothermic reaction. Requires initial activation energy (spark) to start.'
            },
            { 
                name: 'Haber Process', 
                type: 'exothermic', 
                dh: -92, 
                ea: 250, 
                cat: true, 
                desc: 'N₂ + 3H₂ ⇌ 2NH₃. Iron catalyst lowers the high activation energy required to break the triple bond.'
            },
            { 
                name: 'Photosynthesis', 
                type: 'endothermic', 
                dh: 150, 
                ea: 100, 
                cat: true, 
                desc: 'Endothermic reaction (takes in energy). Chlorophyll acts as a catalyst (enzyme).'
            }
        ];

        const App = () => {
            // State
            const [reactionType, setReactionType] = useState('exothermic'); // exothermic, endothermic
            const [deltaH, setDeltaH] = useState(-50);
            const [activationEnergy, setActivationEnergy] = useState(100);
            const [showCatalyst, setShowCatalyst] = useState(false);
            const [currentPreset, setCurrentPreset] = useState(null);
            
            const canvasRef = useRef(null);
            const chartInstance = useRef(null);

            // Chart Styling for Dark Mode
            const colorPrimary = '#e2e8f0'; 
            const lineColor = '#64748b'; 

            const loadPreset = (p) => {
                setReactionType(p.type);
                setDeltaH(p.dh);
                setActivationEnergy(p.ea);
                setShowCatalyst(p.cat);
                setCurrentPreset(p);
            };

            // Draw Chart
            useEffect(() => {
                if (!canvasRef.current) return;
                
                const ctx = canvasRef.current.getContext('2d');
                if (chartInstance.current) chartInstance.current.destroy();

                // Coordinates Logic
                const reactantY = 50; 
                const productY = reactantY + deltaH; 
                const transitionY = reactantY + activationEnergy; 
                // Catalysed Ea is 60% of uncatalysed Ea
                const catalystEa = activationEnergy * 0.6; 
                const catalystY = reactantY + catalystEa; 

                // Generate Curve Points
                const generateCurve = (peakY) => {
                    const points = [];
                    // Start and Initial Plateau (0-20)
                    for(let x=0; x<=20; x+=2) points.push({x, y: reactantY});
                    // Reactant to Peak (21-50)
                    for(let x=21; x<=50; x+=1) {
                        const progress = (x - 20) / 30;
                        const y = reactantY + (peakY - reactantY) * Math.sin(progress * Math.PI / 2);
                        points.push({x, y});
                    }
                    // Peak to Product (51-80)
                    for(let x=51; x<=80; x+=1) {
                        const progress = (x - 50) / 30;
                        const y = peakY - (peakY - productY) * (1 - Math.cos(progress * Math.PI / 2)); 
                        points.push({x, y});
                    }
                    // Final Plateau (81-100)
                    for(let x=81; x<=100; x+=2) points.push({x, y: productY});
                    return points;
                };

                const uncatalysedData = generateCurve(transitionY);
                const catalysedData = showCatalyst ? generateCurve(catalystY) : [];
                
                const datasets = [
                    {
                        label: 'Uncatalysed',
                        data: uncatalysedData,
                        showLine: true,
                        borderColor: '#3b82f6', // Blue
                        borderWidth: 3,
                        pointRadius: 0,
                        tension: 0.4
                    },
                    {
                        label: 'Catalysed',
                        data: catalysedData,
                        showLine: true,
                        borderColor: '#22c55e', // Green
                        borderWidth: 3,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        tension: 0.4,
                        hidden: !showCatalyst
                    }
                ];

                chartInstance.current = new Chart(ctx, {
                    type: 'scatter',
                    data: { datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'linear',
                                min: 0, max: 100,
                                title: { display: true, text: 'Reaction Coordinate', font: { weight: 'bold', color: colorPrimary } },
                                ticks: { display: false },
                                grid: { color: lineColor, drawOnChartArea: false }
                            },
                            y: {
                                // Ensure y-axis covers all points
                                min: Math.min(productY, reactantY) - 20,
                                max: Math.max(transitionY, catalystY) + 20,
                                title: { display: true, text: 'Potential Energy (kJ/mol)', font: { weight: 'bold', color: colorPrimary } },
                                ticks: { display: false },
                                grid: { color: lineColor }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: reactionType === 'exothermic' ? 'Exothermic Reaction' : 'Endothermic Reaction',
                                color: colorPrimary,
                                font: { size: 16 }
                            },
                            legend: { 
                                position: 'top',
                                labels: { usePointStyle: true, color: colorPrimary, font: { weight: 'bold' } },
                                onClick: null 
                            },
                            tooltip: { enabled: false }
                        },
                        animation: { duration: 800 }
                    },
                    plugins: [{
                        id: 'customLabels',
                        afterDraw: (chart) => {
                            const ctx = chart.ctx;
                            const xAxis = chart.scales.x;
                            const yAxis = chart.scales.y;
                            const dhColor = reactionType === 'exothermic' ? '#ef4444' : '#3b82f6';
                            const dhLabel = deltaH > 0 ? `ΔH = +${deltaH}` : `ΔH = ${deltaH}`;
                            
                            ctx.save();
                            ctx.font = 'bold 12px Inter';
                            ctx.textAlign = 'center';
                            
                            const drawArrow = (x, y1, y2, color, label, labelXOffset = 5) => {
                                // Arrow shaft
                                ctx.beginPath();
                                ctx.strokeStyle = color;
                                ctx.lineWidth = 2;
                                ctx.setLineDash([]);
                                ctx.moveTo(x, y1);
                                ctx.lineTo(x, y2);
                                ctx.stroke();
                                
                                // Arrow heads (simple line style)
                                const headSize = 5;
                                ctx.beginPath();
                                ctx.fillStyle = color;
                                
                                // Head at y2
                                ctx.fillRect(x - headSize/2, y2 - headSize/2, headSize, headSize);
                                
                                // Draw Label
                                ctx.fillStyle = color;
                                ctx.textAlign = 'left';
                                ctx.fillText(label, x + labelXOffset, (y1 + y2) / 2);
                            };

                            // --- 1. Draw Energy Levels (R & P) ---
                            ctx.fillStyle = colorPrimary;
                            ctx.textAlign = 'left';
                            ctx.fillText('Reactants (R)', xAxis.getPixelForValue(10) - 20, yAxis.getPixelForValue(reactantY) + 4);
                            ctx.fillText('Products (P)', xAxis.getPixelForValue(85) + 20, yAxis.getPixelForValue(productY) + 4);

                            // --- 2. Draw Activation Energy (Uncatalysed) ---
                            const uncatalysedArrowX = xAxis.getPixelForValue(35);
                            const rY = yAxis.getPixelForValue(reactantY);
                            const peakY = yAxis.getPixelForValue(transitionY);
                            
                            // Line segments for visibility
                            ctx.strokeStyle = '#f59e0b'; // Amber
                            ctx.lineWidth = 1;
                            ctx.setLineDash([2, 4]);
                            ctx.beginPath();
                            ctx.moveTo(xAxis.getPixelForValue(20), rY);
                            ctx.lineTo(uncatalysedArrowX, rY);
                            ctx.moveTo(xAxis.getPixelForValue(50), peakY);
                            ctx.lineTo(uncatalysedArrowX, peakY);
                            ctx.stroke();

                            drawArrow(uncatalysedArrowX, rY, peakY, '#f59e0b', `Ea (${activationEnergy} kJ)`, 5);

                            // --- 3. Draw Activation Energy (Catalysed) ---
                            if (showCatalyst) {
                                const catPeakY = yAxis.getPixelForValue(catalystY);
                                const catArrowX = xAxis.getPixelForValue(45);
                                drawArrow(catArrowX, rY, catPeakY, '#15803d', `Ea' (${catalystEa.toFixed(0)} kJ)`);
                            }

                            // --- 4. Draw Delta H ---
                            const dhX = xAxis.getPixelForValue(85);
                            const pY = yAxis.getPixelForValue(productY);
                            drawArrow(dhX, rY, pY, dhColor, dhLabel, 5);
                            
                            ctx.restore();
                        }
                    }]
                });
            }, [reactionType, deltaH, activationEnergy, showCatalyst]);

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-5xl">
                    
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-blue-400 flex items-center gap-2">
                                <Icon name="Activity" /> Energy Profile Diagram Maker
                            </h1>
                            <p className="text-slate-500 text-sm">Visualize Activation Energy and Enthalpy Change</p>
                        </div>
                        
                        {/* Preset Buttons */}
                        <div className="flex gap-2">
                            {Presets.map((p, i) => (
                                <button
                                    key={i}
                                    onClick={() => loadPreset(p)}
                                    className={`px-3 py-1 rounded text-xs font-bold border transition-all
                                        ${currentPreset?.name === p.name 
                                            ? 'bg-blue-900/30 text-blue-400 border-blue-500/50' 
                                            : 'bg-slate-800 text-slate-500 border-slate-700 hover:bg-slate-700'}<
                                    `}>
                                    {p.name.split(' ')[0]}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 flex-grow">
                        
                        {/* Left: Controls */}
                        <div className="w-full lg:w-1/3 flex flex-col gap-6">
                            
                            <div className="bg-slate-900 p-6 rounded-2xl shadow-xl border border-slate-800">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-4 flex items-center gap-2">
                                    <Icon name="Settings2" size={16} className="text-slate-500"/> Parameters
                                </h3>

                                {/* Reaction Type */}
                                <div className="mb-4">
                                    <label className="text-xs font-bold text-slate-500 block mb-2">Reaction Type</label>
                                    <div className="flex bg-slate-800 p-1 rounded-lg border border-slate-700">
                                        <button 
                                            onClick={() => setReactionType('exothermic')}
                                            className={`flex-1 py-2 rounded-md text-sm font-bold transition-all ${reactionType === 'exothermic' ? 'bg-slate-900 text-red-400 shadow' : 'text-slate-500 hover:text-slate-300'}`}
                                        >
                                            Exothermic
                                        </button>
                                        <button 
                                            onClick={() => setReactionType('endothermic')}
                                            className={`flex-1 py-2 rounded-md text-sm font-bold transition-all ${reactionType === 'endothermic' ? 'bg-slate-900 text-blue-400 shadow' : 'text-slate-500 hover:text-slate-300'}`}
                                        >
                                            Endothermic
                                        </button>
                                    </div>
                                </div>

                                {/* Delta H Slider */}
                                <div className="mb-4">
                                    <div className="flex justify-between mb-1">
                                        <label className="text-xs font-bold text-pink-400">Enthalpy Change (ΔH)</label>
                                        <span className="text-xs font-mono font-bold text-pink-400">{deltaH} kJ</span>
                                    </div>
                                    <input 
                                        type="range" 
                                        min={reactionType === 'exothermic' ? -200 : 10} 
                                        max={reactionType === 'exothermic' ? -10 : 200} 
                                        value={deltaH} 
                                        onChange={(e) => setDeltaH(parseInt(e.target.value))}
                                        className={`w-full h-2 rounded-lg appearance-none cursor-pointer ${reactionType === 'exothermic' ? 'bg-red-900/50 accent-red-500' : 'bg-blue-900/50 accent-blue-500'}`}
                                    />
                                </div>

                                {/* Activation Energy Slider */}
                                <div className="mb-6">
                                    <div className="flex justify-between mb-1">
                                        <label className="text-xs font-bold text-amber-400">Activation Energy (Ea)</label>
                                        <span className="text-xs font-mono font-bold text-amber-400">{activationEnergy} kJ</span>
                                    </div>
                                    <input 
                                        type="range" 
                                        min="20" 
                                        max="300" 
                                        value={activationEnergy} 
                                        onChange={(e) => setActivationEnergy(parseInt(e.target.value))}
                                        className="w-full h-2 bg-amber-900/50 rounded-lg appearance-none cursor-pointer accent-amber-500"
                                    />
                                </div>

                                {/* Catalyst Toggle */}
                                <button 
                                    onClick={() => setShowCatalyst(!showCatalyst)}
                                    className={`w-full py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 transition-all shadow-sm border-2
                                        ${showCatalyst ? 'bg-emerald-900/30 border-emerald-500 text-emerald-400' : 'bg-slate-800 border-slate-700 text-slate-500 hover:bg-slate-700'}
                                    `}
                                >
                                    <Icon name={showCatalyst ? 'CheckSquare' : 'Square'} size={18} />
                                    Show Catalysed Pathway
                                </button>
                            </div>

                            {/* Legend / Explanation */}
                            <div className="bg-slate-900 p-5 rounded-2xl text-white shadow-xl border border-slate-800">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-2 flex items-center gap-2">
                                    <Icon name="Info" size={16} className="text-yellow-400"/> Diagram Interpretation
                                </h3>
                                <ul className="text-xs space-y-2 opacity-90 list-disc list-inside text-slate-400">
                                    <li><span className="text-amber-400 font-bold">Ea</span>: The energy barrier that must be overcome.</li>
                                    <li><span className="text-pink-400 font-bold">ΔH</span>: Net energy change (E<sub>products</sub> - E<sub>reactants</sub>).</li>
                                    <li><span className="text-emerald-400 font-bold">Catalyst</span>: Provides an alternative path with a lower E<sub>a</sub>.</li>
                                </ul>
                                {currentPreset && (
                                    <div className="mt-3 pt-3 border-t border-slate-700 text-xs text-slate-300 italic">
                                        {currentPreset.desc}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Right: Diagram */}
                        <div className="w-full lg:w-2/3 bg-slate-900 rounded-3xl border-4 border-slate-800 p-4 shadow-xl flex flex-col">
                            <div className="flex-grow chart-container relative">
                                <canvas ref={canvasRef}></canvas>
                            </div>
                            <div className="mt-4 text-center text-xs text-slate-500 font-mono">
                                {reactionType === 'exothermic' ? 'Exothermic Reaction: Products have lower energy (ΔH is negative)' : 'Endothermic Reaction: Products have higher energy (ΔH is positive)'}
                            </div>
                        </div>

                    </div>

                    <div className="text-center text-slate-600 text-xs mt-8">
                        Luminous Learner Science Tools | IB/A-Level Chemistry
                    </div>
                </div>
            );
        };

        lucide.createIcons();
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
