<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Displacement Reaction Predictor</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Beaker Liquid Animation */
        .liquid {
            transition: background-color 1s ease-in-out, opacity 0.5s;
        }
        
        /* Metal Coating Animation */
        .coating-enter {
            animation: coat 2s forwards;
        }
        
        .deposit-appear {
            animation: depositFadeIn 2s ease-out forwards;
        }
        
        @keyframes coat {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes depositFadeIn {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, className = "", size = 20 }) => {
            const [svgHtml, setSvgHtml] = useState('');
            useEffect(() => {
                if (window.lucide && window.lucide.icons) {
                    const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[pascalName];
                    if (iconData && typeof window.lucide.createElement === 'function') {
                        const svgElement = window.lucide.createElement(iconData);
                        svgElement.setAttribute('class', className);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        setSvgHtml(svgElement.outerHTML);
                    }
                }
            }, [name, className, size]);
            if (!svgHtml) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="flex items-center justify-center" />;
        };

        // --- DATA (Translated) ---
        const METALS = [
            { id: 'Mg', name: 'Magnesium', color: 'bg-slate-300', reactivity: 10, depositColor: 'bg-slate-400' },
            { id: 'Zn', name: 'Zinc', color: 'bg-slate-400', reactivity: 6, depositColor: 'bg-gray-500' },
            { id: 'Fe', name: 'Iron', color: 'bg-zinc-600', reactivity: 5, depositColor: 'bg-gray-700' },
            { id: 'Cu', name: 'Copper', color: 'bg-orange-400', reactivity: 3, depositColor: 'bg-orange-600' },
            { id: 'Ag', name: 'Silver', color: 'bg-slate-200', reactivity: 1, depositColor: 'bg-gray-300' }
        ];

        const SOLUTIONS = [
            { 
                id: 'NaCl', name: 'Sodium Chloride', metalId: 'Na', // Added NaCl
                ion: 'Na⁺', colorClass: 'bg-blue-50/20', hex: '#f8fafc', reactivity: 12, // Very high reactivity
                desc: 'Colourless solution'
            },
            { 
                id: 'MgSO4', name: 'Magnesium Sulfate', metalId: 'Mg', 
                ion: 'Mg²⁺', colorClass: 'bg-blue-50/20', hex: '#f8fafc', reactivity: 10,
                desc: 'Colourless solution'
            },
            { 
                id: 'ZnSO4', name: 'Zinc Sulfate', metalId: 'Zn', 
                ion: 'Zn²⁺', colorClass: 'bg-blue-50/20', hex: '#f8fafc', reactivity: 6,
                desc: 'Colourless solution'
            },
            { 
                id: 'FeSO4', name: 'Iron(II) Sulfate', metalId: 'Fe', 
                ion: 'Fe²⁺', colorClass: 'bg-green-200/40', hex: '#bbf7d0', reactivity: 5,
                desc: 'Pale green solution'
            },
            { 
                id: 'CuSO4', name: 'Copper(II) Sulfate', metalId: 'Cu', 
                ion: 'Cu²⁺', colorClass: 'bg-blue-500/40', hex: '#3b82f6', reactivity: 3,
                desc: 'Blue solution'
            },
            { 
                id: 'AgNO3', name: 'Silver Nitrate', metalId: 'Ag', 
                ion: 'Ag⁺', colorClass: 'bg-blue-50/20', hex: '#f8fafc', reactivity: 1,
                desc: 'Colourless solution'
            }
        ];

        // Reaction Logic
        const getReaction = (metal, solution) => {
            // Metal reactivity from object
            const metalReactivity = METALS.find(m => m.id === metal.id).reactivity;
            
            // Solution metal reactivity: Find in METALS or use the value in SOLUTIONS (for Na)
            let solutionMetalReactivity = solution.reactivity;
            if (solutionMetalReactivity === undefined) {
                 // Fallback if not explicitly defined in SOLUTIONS object (for existing ones like Cu, Fe)
                 const m = METALS.find(m => m.id === solution.metalId);
                 solutionMetalReactivity = m ? m.reactivity : 0;
            }

            if (metal.id === solution.metalId) return { type: 'none', msg: 'No reaction (Same metal)' };
            
            if (metalReactivity > solutionMetalReactivity) {
                // Find deposit color
                let depositColor = 'bg-gray-500'; // Default
                const displacedMetal = METALS.find(m => m.id === solution.metalId);
                if (displacedMetal) depositColor = displacedMetal.depositColor;
                // Special case for silver (Ag) deposit - often looks grey/black in powder form, but let's keep it silvery/grey
                if (solution.metalId === 'Ag') depositColor = 'bg-slate-300';

                return {
                    type: 'displacement',
                    msg: 'Reaction occurs!',
                    equation: `${metal.id}(s) + ${solution.ion}(aq) → ${metal.id}${metal.id === 'Ag' ? '⁺' : '²⁺'}(aq) + ${solution.metalId}(s)`,
                    productSolid: displacedMetal ? displacedMetal.color : 'bg-gray-400', // Coating on the strip
                    productDeposit: depositColor, // The pile at bottom
                    displacedMetalName: solution.metalId, // For label
                    productSolution: 'bg-blue-50/10' 
                };
            }
            return { type: 'none', msg: 'No reaction (Metal is less reactive)' };
        };

        const getFinalColor = (metalId, solutionId) => {
            if (solutionId === 'CuSO4') {
                if (metalId === 'Fe') return 'bg-green-200/40'; 
                return 'bg-blue-50/20'; 
            }
            if (solutionId === 'AgNO3' && metalId === 'Cu') return 'bg-blue-500/40';
            return 'bg-blue-50/20';
        };

        const App = () => {
            const [selectedSolution, setSelectedSolution] = useState(SOLUTIONS[4]); // Default CuSO4
            const [droppedMetal, setDroppedMetal] = useState(null);
            const [result, setResult] = useState(null);
            const [isResetting, setIsResetting] = useState(false);

            const handleMetalClick = (metal) => {
                if (droppedMetal) {
                    setDroppedMetal(null);
                    setResult(null);
                    setTimeout(() => performDrop(metal), 300);
                } else {
                    performDrop(metal);
                }
            };

            const performDrop = (metal) => {
                setDroppedMetal(metal);
                const res = getReaction(metal, selectedSolution);
                
                let finalBg = selectedSolution.colorClass;
                if (res.type === 'displacement') {
                    finalBg = getFinalColor(metal.id, selectedSolution.id);
                }
                
                setResult({ ...res, finalColor: finalBg });
            };

            const reset = () => {
                setIsResetting(true);
                setTimeout(() => {
                    setDroppedMetal(null);
                    setResult(null);
                    setIsResetting(false);
                }, 300);
            };

            const changeSolution = (sol) => {
                setSelectedSolution(sol);
                setDroppedMetal(null);
                setResult(null);
            };

            return (
                <div className="min-h-screen bg-[#0F172A] text-white flex flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar: Metals */}
                    <div className="w-full md:w-72 bg-slate-900 border-r border-slate-800 flex flex-col z-20 shadow-xl h-screen shrink-0">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-lg font-bold flex items-center gap-2">
                                <Icon name="flask-conical" className="text-emerald-400" /> Metal Lab
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Click metal to add</p>
                        </div>

                        <div className="p-6 space-y-4 overflow-y-auto">
                            {METALS.map((m) => (
                                <div key={m.id} className="relative">
                                    <div className="text-xs font-bold text-slate-500 mb-1 uppercase">{m.name}</div>
                                    <motion.button
                                        onClick={() => handleMetalClick(m)}
                                        className={`w-full h-12 rounded-lg border-2 border-slate-600 flex items-center justify-center cursor-pointer shadow-lg relative z-50 ${m.color} ${droppedMetal?.id === m.id ? 'opacity-50 ring-2 ring-emerald-500' : 'opacity-100 hover:border-white'}`}
                                        whileHover={{ scale: 1.02 }}
                                        whileTap={{ scale: 0.95 }}
                                    >
                                        <span className="font-black text-slate-800 text-xl">{m.id}</span>
                                        <span className="absolute right-3 bottom-1 text-[10px] text-slate-700 font-bold">Solid</span>
                                    </motion.button>
                                </div>
                            ))}
                        </div>
                        
                        <div className="mt-auto p-6 bg-slate-800/50 border-t border-slate-800">
                            <div className="text-xs text-slate-400 flex items-center gap-2">
                                <Icon name="info" size={14}/> Reactivity decreases down the list
                            </div>
                        </div>
                    </div>

                    {/* Main Stage */}
                    <div className="flex-1 bg-slate-950 relative flex flex-col items-center justify-center p-8 overflow-hidden">
                        
                        {/* Solution Selector (Top) */}
                        <div className="absolute top-8 z-10 flex gap-2 bg-slate-900 p-1.5 rounded-xl border border-slate-800 shadow-xl overflow-x-auto max-w-full">
                            {SOLUTIONS.map(sol => (
                                <button
                                    key={sol.id}
                                    onClick={() => changeSolution(sol)}
                                    className={`px-4 py-2 rounded-lg text-xs font-bold transition-all whitespace-nowrap
                                        ${selectedSolution.id === sol.id 
                                            ? 'bg-blue-600 text-white shadow-md' 
                                            : 'text-slate-400 hover:bg-slate-800 hover:text-white'}
                                    `}
                                >
                                    {sol.id}
                                </button>
                            ))}
                        </div>

                        {/* Beaker Simulation */}
                        <div className="relative w-64 h-80">
                            {/* Beaker Glass */}
                            <div className="absolute bottom-0 w-full h-full border-x-4 border-b-4 border-slate-500/30 rounded-b-3xl bg-white/5 backdrop-blur-sm overflow-hidden">
                                
                                {/* Liquid */}
                                <div 
                                    className={`absolute bottom-0 w-full h-3/4 liquid transition-colors duration-1000 ${result ? result.finalColor : selectedSolution.colorClass}`}
                                >
                                </div>

                                {/* Metal Piece inside */}
                                <AnimatePresence>
                                    {droppedMetal && !isResetting && (
                                        <motion.div 
                                            initial={{ y: -300, opacity: 0, rotate: 10 }}
                                            animate={{ y: 90, opacity: 1, rotate: 0 }}
                                            exit={{ y: 200, opacity: 0 }}
                                            transition={{ type: "spring", stiffness: 120, damping: 15 }}
                                            className={`absolute left-1/2 -translate-x-1/2 w-16 h-32 rounded-lg border-2 border-black/20 flex items-center justify-center ${droppedMetal.color}`}
                                        >
                                            {/* Metal Deposit Overlay (On the strip) */}
                                            {result && result.type === 'displacement' && (
                                                <div className={`absolute inset-0 rounded-lg opacity-80 coating-enter ${result.productSolid}`}></div>
                                            )}
                                            <span className="relative z-10 font-black text-slate-900 text-2xl opacity-50">{droppedMetal.id}</span>
                                        </motion.div>
                                    )}
                                </AnimatePresence>
                                
                                {/* Deposit at bottom (NEW FEATURE) */}
                                {result && result.type === 'displacement' && (
                                    <div className="absolute bottom-4 left-4 flex flex-col items-center z-20 deposit-appear">
                                        <div className={`w-8 h-6 rounded-full ${result.productDeposit} shadow-sm border border-black/20`}></div>
                                        <div className={`w-6 h-4 rounded-full ${result.productDeposit} -mt-3 ml-4 shadow-sm border border-black/20`}></div>
                                        <span className="text-[10px] font-bold text-white bg-black/50 px-1.5 rounded mt-1 backdrop-blur-sm">
                                            {result.displacedMetalName} Deposit
                                        </span>
                                    </div>
                                )}

                                {/* Labels */}
                                <div className="absolute bottom-4 right-4 text-right">
                                    <span className="text-sm font-bold text-white/50 drop-shadow-md block">{selectedSolution.name}</span>
                                </div>
                            </div>
                        </div>

                        {/* Reaction Result Panel */}
                        <div className="absolute bottom-8 w-full max-w-3xl px-4">
                            {result ? (
                                <div className={`p-6 rounded-2xl border shadow-2xl backdrop-blur-md animate-in flex flex-col md:flex-row items-center justify-between gap-6
                                    ${result.type === 'displacement' ? 'bg-emerald-900/80 border-emerald-500/50' : 'bg-slate-800/80 border-slate-600/50'}
                                `}>
                                    <div>
                                        <div className={`text-xs font-bold uppercase mb-1 flex items-center gap-2 ${result.type === 'displacement' ? 'text-emerald-400' : 'text-slate-400'}`}>
                                            <Icon name={result.type === 'displacement' ? 'check-circle' : 'x-circle'} size={16}/>
                                            {result.type === 'displacement' ? 'Success' : 'No Reaction'}
                                        </div>
                                        <h2 className="text-xl font-bold text-white">{result.msg}</h2>
                                        {result.type === 'displacement' && (
                                            <div className="mt-2 bg-black/30 px-3 py-2 rounded-lg font-mono text-sm text-emerald-200 border border-white/10 inline-block">
                                                {result.equation}
                                            </div>
                                        )}
                                    </div>
                                    <button onClick={reset} className="px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl font-bold text-white transition-colors flex items-center gap-2">
                                        <Icon name="rotate-ccw" size={18}/> Reset
                                    </button>
                                </div>
                            ) : (
                                <div className="text-center text-slate-500 text-sm animate-pulse">
                                    Click a metal from the left to add it to the beaker...
                                </div>
                            )}
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
