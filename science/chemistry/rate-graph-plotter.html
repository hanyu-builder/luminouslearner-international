<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Graph Plotter - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Dark Mode Styling for Chart/Data Inputs */
        .data-input {
            transition: all 0.2s;
            background-color: #1e293b;
            color: #e2e8f0;
            border-color: #334155;
        }
        .data-input:focus {
            background-color: #0F172A;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        
        /* Table Scrollbar - Dark Mode */
        .table-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .table-scroll::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .table-scroll::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }
        .table-scroll::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Chart.js Global Dark Mode Overrides */
        canvas {
            background-color: #1e293b !important;
            border-radius: 1rem;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Utility Icon Component
        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        const iconSvg = window.lucide.createElement(iconNode);
                        iconSvg.setAttribute('width', size);
                        iconSvg.setAttribute('height', size);
                        iconSvg.setAttribute('class', className);
                        setSvg(iconSvg.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        // Presets Data (Internationalized)
        const Presets = {
            concTime: [
                { 
                    name: 'Zero Order', 
                    data: [
                        {x: 0, y: 1.0}, {x: 10, y: 0.9}, {x: 20, y: 0.8}, {x: 30, y: 0.7}, 
                        {x: 40, y: 0.6}, {x: 50, y: 0.5}, {x: 60, y: 0.4}, {x: 70, y: 0.3}
                    ],
                    desc: 'Concentration decreases linearly with time (constant slope).'
                },
                { 
                    name: 'First Order', 
                    data: [
                        {x: 0, y: 1.0}, {x: 10, y: 0.7}, {x: 20, y: 0.49}, {x: 30, y: 0.34}, 
                        {x: 40, y: 0.24}, {x: 50, y: 0.17}, {x: 60, y: 0.12}, {x: 70, y: 0.08}
                    ],
                    desc: 'Concentration decreases exponentially (constant half-life).'
                }
            ],
            rateConc: [
                {
                    name: 'Second Order',
                    data: [
                        {x: 0.1, y: 0.002}, {x: 0.2, y: 0.008}, {x: 0.3, y: 0.018}, 
                        {x: 0.4, y: 0.032}, {x: 0.5, y: 0.050}
                    ],
                    desc: 'Rate is proportional to concentration squared (Parabolic curve).'
                },
                 {
                    name: 'Zero Order',
                    data: [
                        {x: 0.1, y: 0.01}, {x: 0.2, y: 0.01}, {x: 0.3, y: 0.01}, 
                        {x: 0.4, y: 0.01}, {x: 0.5, y: 0.01}
                    ],
                    desc: 'Rate is independent of concentration (Horizontal line).'
                }
            ]
        };

        const App = () => {
            const [mode, setMode] = useState('concTime'); // concTime, rateConc
            const [data, setData] = useState([
                { id: 1, x: 0, y: 1.0 },
                { id: 2, x: 10, y: 0.8 },
                { id: 3, x: 20, y: 0.65 },
                { id: 4, x: 30, y: 0.55 }
            ]);
            const [initialRate, setInitialRate] = useState(null);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            // --- Logic: Calculate Initial Rate ---
            const calculateResults = () => {
                if (mode === 'concTime') {
                    // Initial Rate = Slope of tangent at t=0
                    const sorted = [...data].sort((a, b) => a.x - b.x);
                    
                    if (sorted.length >= 2) {
                        const p1 = sorted[0];
                        const p2 = sorted[1];
                        if (parseFloat(p1.x) === 0) {
                            const slope = (parseFloat(p2.y) - parseFloat(p1.y)) / (parseFloat(p2.x) - parseFloat(p1.x));
                            setInitialRate(Math.abs(slope).toFixed(4));
                        } else {
                            setInitialRate("Requires data starting at t=0");
                        }
                    }
                } else {
                    setInitialRate(null);
                }
            };

            // --- Chart Rendering ---
            useEffect(() => {
                if (chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    if (chartInstance.current) chartInstance.current.destroy();

                    const sortedData = [...data].sort((a, b) => a.x - b.x)
                        .map(d => ({ x: parseFloat(d.x), y: parseFloat(d.y) }))
                        .filter(d => !isNaN(d.x) && !isNaN(d.y));

                    // Determine chart labels based on mode
                    const xLabel = mode === 'concTime' ? 'Time (s)' : 'Concentration (mol dm⁻³)';
                    const yLabel = mode === 'concTime' ? 'Concentration (mol dm⁻³)' : 'Initial Rate (mol dm⁻³ s⁻¹)';
                    const title = mode === 'concTime' ? 'Concentration-Time Graph' : 'Rate-Concentration Graph';

                    // Dataset config
                    const dataset = {
                        label: 'Experimental Data',
                        data: sortedData,
                        borderColor: '#6366f1', // Indigo 500
                        backgroundColor: 'rgba(99, 102, 241, 0.5)',
                        borderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        showLine: mode === 'concTime',
                        tension: 0.4
                    };

                    // Global chart styling for Dark Mode
                    const colorPrimary = '#e2e8f0'; // Text/Axis color
                    const gridColor = '#334155';
                    const fontStyle = 'Inter';

                    // Tangent Line for Initial Rate (Conc-Time only)
                    const datasets = [dataset];
                    if (mode === 'concTime' && sortedData.length >= 2 && sortedData[0].x === 0) {
                        const p1 = sortedData[0];
                        const p2 = sortedData[1];
                        const slope = (p2.y - p1.y) / (p2.x - p1.x);
                        // Extend tangent slightly beyond p2.x for visualization
                        const tangentEnd = { x: p2.x * 1.5, y: p1.y + slope * p2.x * 1.5 }; 
                        datasets.push({
                            label: 'Initial Rate Tangent',
                            data: [p1, tangentEnd],
                            borderColor: '#ef4444', // Red
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false
                        });
                    }

                    chartInstance.current = new Chart(ctx, {
                        type: 'scatter',
                        data: { datasets },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: title, font: { size: 16, family: fontStyle, color: colorPrimary } },
                                legend: { position: 'bottom', labels: { color: colorPrimary, font: { family: fontStyle } } }
                            },
                            scales: {
                                x: {
                                    type: 'linear',
                                    position: 'bottom',
                                    title: { display: true, text: xLabel, font: { weight: 'bold', family: fontStyle, color: colorPrimary } },
                                    ticks: { color: colorPrimary, font: { family: fontStyle } },
                                    grid: { color: gridColor }
                                },
                                y: {
                                    title: { display: true, text: yLabel, font: { weight: 'bold', family: fontStyle, color: colorPrimary } },
                                    ticks: { color: colorPrimary, font: { family: fontStyle } },
                                    grid: { color: gridColor }
                                }
                            }
                        }
                    });
                    
                    calculateResults();
                }
            }, [data, mode]);

            // --- Handlers ---
            const handleDataChange = (id, field, value) => {
                setData(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
            };

            const addRow = () => {
                const newId = data.length > 0 ? Math.max(...data.map(d => d.id)) + 1 : 1;
                const lastX = data.length > 0 ? parseFloat(data[data.length - 1].x) : 0;
                // Add a reasonable guess for X increment
                const xGuess = data.length > 1 ? parseFloat(data[1].x) - parseFloat(data[0].x) : 10;
                setData([...data, { id: newId, x: lastX + xGuess, y: '' }]);
            };

            const removeRow = (id) => {
                if (data.length > 2) setData(data.filter(item => item.id !== id));
            };

            const loadPreset = (preset) => {
                setData(preset.data.map((d, i) => ({ id: i, x: d.x, y: d.y })));
            };

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-6xl">
                    
                    {/* Header */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-slate-800 pb-4 gap-4">
                        <div>
                            <h1 className="text-2xl font-bold text-indigo-400 flex items-center gap-2">
                                <Icon name="LineChart" /> Rate Graph Plotter
                            </h1>
                            <p className="text-slate-500 text-sm">Chemical Kinetics Visualization</p>
                        </div>
                        
                        {/* Mode Switcher */}
                        <div className="flex bg-slate-800 p-1 rounded-lg border border-slate-700">
                            <button 
                                onClick={() => { setMode('concTime'); setData([{id:1, x:0, y:1}, {id:2, x:10, y:0.8}]); }}
                                className={`px-4 py-2 rounded-md text-xs font-bold transition-all flex items-center gap-2 ${mode === 'concTime' ? 'bg-slate-900 text-indigo-400 shadow-lg' : 'text-slate-400 hover:text-white'}`}
                            >
                                <Icon name="Activity" size={14}/> Conc-Time Graph
                            </button>
                            <button 
                                onClick={() => { setMode('rateConc'); setData([{id:1, x:0.1, y:0.01}, {id:2, x:0.2, y:0.02}]); }}
                                className={`px-4 py-2 rounded-md text-xs font-bold transition-all flex items-center gap-2 ${mode === 'rateConc' ? 'bg-slate-900 text-emerald-400 shadow-lg' : 'text-slate-400 hover:text-white'}`}
                            >
                                <Icon name="BarChart2" size={14}/> Rate-Conc Graph
                            </button>
                        </div>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 flex-grow">
                        
                        {/* Left: Data Input */}
                        <div className="w-full lg:w-1/3 flex flex-col gap-6">
                            
                            {/* Presets */}
                            <div className="bg-slate-900 p-4 rounded-xl border border-slate-800 shadow-xl">
                                <h4 className="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                                    <Icon name="Zap" size={14}/> Load Preset Data
                                </h4>
                                <div className="flex flex-wrap gap-2">
                                    {(mode === 'concTime' ? Presets.concTime : Presets.rateConc).map((p, i) => (
                                        <button 
                                            key={i}
                                            onClick={() => loadPreset(p)}
                                            className="px-3 py-1 bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-700 rounded text-xs font-bold transition-colors"
                                            title={p.desc}
                                        >
                                            {p.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Data Table */}
                            <div className="bg-slate-900 p-6 rounded-2xl shadow-md border border-slate-800 flex-grow flex flex-col max-h-[600px]">
                                <h3 className="text-sm font-bold text-slate-400 mb-4 flex items-center gap-2">
                                    <Icon name="Table" size={16}/> Experimental Data
                                </h3>
                                
                                <div className="grid grid-cols-6 gap-2 mb-2 px-2 text-xs font-bold text-slate-500 uppercase">
                                    <div className="col-span-2">{mode === 'concTime' ? 'Time (s)' : 'Conc. (M)'}</div>
                                    <div className="col-span-3">{mode === 'concTime' ? 'Conc. (M)' : 'Rate (M/s)'}</div>
                                    <div className="col-span-1 text-center">Action</div>
                                </div>

                                <div className="flex-grow overflow-y-auto table-scroll space-y-2 pr-1">
                                    {data.map((row) => (
                                        <div key={row.id} className="grid grid-cols-6 gap-2 items-center">
                                            <div className="col-span-2">
                                                <input 
                                                    type="number" 
                                                    value={row.x} 
                                                    onChange={(e) => handleDataChange(row.id, 'x', e.target.value)}
                                                    className="w-full p-2 rounded border font-mono text-sm text-center data-input outline-none"
                                                    placeholder={mode === 'concTime' ? 'Time' : 'Conc'}
                                                />
                                            </div>
                                            <div className="col-span-3">
                                                <input 
                                                    type="number" 
                                                    value={row.y} 
                                                    onChange={(e) => handleDataChange(row.id, 'y', e.target.value)}
                                                    className="w-full p-2 rounded border font-mono text-sm text-center data-input outline-none"
                                                    placeholder={mode === 'concTime' ? 'Conc' : 'Rate'}
                                                />
                                            </div>
                                            <div className="col-span-1 text-center">
                                                <button 
                                                    onClick={() => removeRow(row.id)}
                                                    className="text-slate-500 hover:text-red-400 transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
                                                    disabled={data.length <= 2}
                                                >
                                                    <Icon name="Trash2" size={16}/>
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <button 
                                    onClick={addRow}
                                    className="mt-4 w-full py-2 border-2 border-dashed border-slate-700 text-slate-400 hover:border-indigo-500 hover:text-indigo-400 rounded-xl font-bold text-xs flex items-center justify-center gap-1 transition-all"
                                >
                                    <Icon name="Plus" size={14}/> Add Data Point
                                </button>
                            </div>

                        </div>

                        {/* Right: Graph & Analysis */}
                        <div className="w-full lg:w-2/3 flex flex-col gap-6">
                            
                            {/* Chart Area */}
                            <div className="bg-slate-900 p-4 rounded-3xl shadow-lg border border-slate-800 h-[500px] relative">
                                <canvas ref={chartRef}></canvas>
                            </div>

                            {/* Analysis Panel (Only for Conc-Time Initial Rate) */}
                            {mode === 'concTime' && (
                                <div className="bg-slate-900 p-6 rounded-2xl shadow-lg text-white border border-slate-800">
                                    <h3 className="text-xs font-bold text-slate-400 uppercase mb-4 flex items-center gap-2">
                                        <Icon name="Activity" size={16}/> Analysis Results
                                    </h3>
                                    <div className="flex flex-col md:flex-row justify-between items-center gap-6">
                                        <div>
                                            <div className="text-sm font-bold text-indigo-400 mb-1">Initial Rate (Rate₀)</div>
                                            <div className="text-xs text-slate-500">Estimated from the tangent slope at t=0</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-4xl font-mono font-black text-emerald-400">
                                                {initialRate ? initialRate : '--'}
                                            </div>
                                            <div className="text-sm text-slate-500 font-mono">mol dm⁻³ s⁻¹</div>
                                        </div>
                                    </div>
                                    
                                    <div className="mt-4 pt-4 border-t border-slate-700 text-xs text-slate-500 font-mono bg-slate-800/50 p-3 rounded-lg">
                                        Rate₀ ≈ - (&Delta;C / &Delta;t) ≈ - ({data[1]?.y} - {data[0]?.y}) / ({data[1]?.x} - {data[0]?.x})
                                    </div>
                                </div>
                            )}

                        </div>

                    </div>
                    
                    <div className="text-center text-slate-600 text-xs mt-8 border-t border-slate-800 pt-4">
                        Luminous Learner International | IB/A-Level Chemistry
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
