<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Rusting Investigator - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .rust-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: #8c2f00; /* Darker rust red */
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        /* Rust Animation Classes */
        .rusted-mild .rust-dot { opacity: 0.3; }
        .rusted-medium .rust-dot { opacity: 0.6; }
        .rusted-severe .rust-dot { opacity: 1; }

        /* Animation for fast forward */
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-rust { animation: fade-in 2s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const TestSetups = [
            { 
                id: 1, 
                name: 'Control', 
                description: 'Iron Nail + Air + Water', 
                conditions: { air: true, water: true, salt: false }, 
                color: 'bg-green-900/20 border-green-500/30 text-green-200', 
                expectedRust: 2 
            },
            { 
                id: 2, 
                name: 'No Water', 
                description: 'Iron Nail + Air + Drying Agent', 
                conditions: { air: true, water: false, salt: false }, 
                color: 'bg-yellow-900/20 border-yellow-500/30 text-yellow-200', 
                expectedRust: 0 
            },
            { 
                id: 3, 
                name: 'No Air', 
                description: 'Iron Nail + Boiled Water + Oil', 
                conditions: { air: false, water: true, salt: false }, 
                color: 'bg-blue-900/20 border-blue-500/30 text-blue-200', 
                expectedRust: 0 
            },
            { 
                id: 4, 
                name: 'Accelerator', 
                description: 'Iron Nail + Salt Water + Air', 
                conditions: { air: true, water: true, salt: true }, 
                color: 'bg-red-900/20 border-red-500/30 text-red-200', 
                expectedRust: 3 
            },
            { 
                id: 5, 
                name: 'Protected', 
                description: 'Iron Nail + Oil Coating', 
                conditions: { air: false, water: false, salt: false }, 
                color: 'bg-slate-800 border-slate-600 text-slate-300', 
                expectedRust: 0 
            }
        ];

        const RustLevel = {
            0: 'No Rust',
            1: 'Mild Rust',
            2: 'Moderate Rust',
            3: 'Severe Rust'
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        const iconSvg = window.lucide.createElement(iconNode);
                        iconSvg.setAttribute('width', size);
                        iconSvg.setAttribute('height', size);
                        iconSvg.setAttribute('class', className);
                        setSvg(iconSvg.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        const App = () => {
            const [isSimulating, setIsSimulating] = useState(false);
            const [dayCount, setDayCount] = useState(0);
            const [rustState, setRustState] = useState(TestSetups.map(s => ({ id: s.id, rustLevel: 0 })));

            // Simulation Effect
            useEffect(() => {
                let interval;
                if (isSimulating && dayCount < 10) {
                    interval = setInterval(() => {
                        setDayCount(prev => prev + 1);
                    }, 200); // 200ms per day
                } else if (dayCount >= 10) {
                    setIsSimulating(false);
                }
                return () => clearInterval(interval);
            }, [isSimulating, dayCount]);

            // Rust Calculation Effect
            useEffect(() => {
                if (dayCount > 0) {
                    setRustState(TestSetups.map(setup => {
                        const { air, water, salt } = setup.conditions;
                        let rustFactor = 0;

                        // Base condition: Needs Air AND Water
                        if (air && water) {
                            rustFactor = 1;
                            // Salt accelerates rusting significantly
                            if (salt) rustFactor = 3;
                        }
                        
                        // Time factor (rust progresses over time)
                        let level = 0;
                        if (rustFactor > 0) {
                            level = Math.min(3, Math.ceil(dayCount * 0.3 * rustFactor)); // Progressively rusts up to 3
                        }

                        return { id: setup.id, rustLevel: level };
                    }));
                }
            }, [dayCount]);

            const startSimulation = () => {
                if (dayCount < 10) {
                    setIsSimulating(true);
                } else {
                    setDayCount(0);
                    setRustState(TestSetups.map(s => ({ id: s.id, rustLevel: 0 })));
                    setIsSimulating(true);
                }
            };

            const BeakerVisual = ({ setup, rustLevel }) => {
                const levelClass = `rusted-${rustLevel}`;
                const baseHeight = setup.conditions.water ? 'h-1/2' : 'h-1/4';
                
                // Content color and label
                let contentBg = setup.conditions.water ? setup.conditions.salt ? 'bg-red-400/30' : 'bg-blue-400/30' : 'bg-transparent';
                let topLayer = setup.id === 3 ? 'bg-yellow-500/80 h-1/4' : 'bg-transparent';
                
                // Rust dots positions
                const rustDots = Array.from({length: 15}).map((_, i) => ({
                    x: 35 + (i % 3) * 10 + (Math.random() * 5),
                    y: 40 + Math.floor(i / 3) * 10 + (Math.random() * 5),
                    delay: i * 0.1
                }));

                return (
                    <div className="flex flex-col items-center w-full p-2">
                        <div className="w-24 h-40 border-4 border-slate-600 rounded-b-xl relative overflow-hidden flex flex-col justify-end bg-slate-800/50">
                            
                            {/* Content (Liquid/Air) */}
                            <div className={`w-full ${contentBg} absolute bottom-0 ${baseHeight} transition-all duration-1000`}></div>
                            {/* Top Layer (Oil/Air) */}
                            <div className={`w-full ${topLayer} absolute top-0`}></div>

                            {/* Iron Nail */}
                            <div className={`absolute left-1/2 -translate-x-1/2 w-2 h-14 bg-slate-400 rounded-b-full z-10`} 
                                 style={{ bottom: setup.conditions.water ? '15%' : '5%' }}>
                                
                                {/* Rust Layer */}
                                <div className={`absolute inset-0 ${levelClass} animate-rust`} key={dayCount}>
                                    {rustDots.map(dot => (
                                        <div key={dot.x} className="rust-dot" style={{ left: `${dot.x}%`, top: `${dot.y}%`, animationDelay: `${dot.delay}s` }}></div>
                                    ))}
                                </div>
                            </div>
                            
                            {/* Bottom Content Label */}
                            {setup.id === 2 && <span className="absolute bottom-2 text-[8px] text-slate-400 w-full text-center font-bold">CaCl₂ (Dry)</span>}
                            {setup.id === 5 && <span className="absolute top-2 text-[8px] text-slate-300 w-full text-center font-bold z-20">Oil Layer</span>}
                            
                            {/* Water Line */}
                            {setup.conditions.water && <div className="absolute w-full h-px border-t border-slate-500/50" style={{ bottom: '50%' }}></div>}
                        </div>
                        
                        <div className="mt-3 text-center">
                            <h4 className="text-sm font-bold text-slate-300">{setup.name}</h4>
                            <p className="text-[10px] text-slate-500 italic mb-1">{setup.description.split('+').slice(1).join('+')}</p>
                            <div className={`px-2 py-0.5 rounded text-xs font-bold inline-block border ${setup.color}`}>
                                {RustLevel[rustLevel]}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-6xl">
                    
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-orange-500 flex items-center gap-2">
                                <Icon name="ShieldAlert" /> Iron Rusting Investigator
                            </h1>
                            <p className="text-slate-500 text-sm">Time-Lapse Experiment Simulation</p>
                        </div>
                        <button 
                            onClick={startSimulation} 
                            disabled={isSimulating} 
                            className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-500 font-bold text-sm flex items-center gap-2 transition-colors disabled:bg-slate-700 disabled:text-slate-500"
                        >
                            <Icon name={isSimulating ? "Loader2" : "Play"} size={16} className={isSimulating ? 'animate-spin' : ''} />
                            {isSimulating ? `Day ${dayCount}...` : dayCount > 0 ? 'Restart' : 'Start Time-Lapse'}
                        </button>
                    </div>

                    {/* Simulation Grid */}
                    <div className="bg-slate-900 p-6 rounded-2xl shadow-xl border border-slate-800 flex justify-around gap-4 mb-8 overflow-x-auto">
                        {TestSetups.map(setup => {
                            const currentRust = rustState.find(r => r.id === setup.id);
                            return <BeakerVisual key={setup.id} setup={setup} rustLevel={currentRust ? currentRust.rustLevel : 0} />;
                        })}
                    </div>

                    {/* Theory and Results Summary */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        <div className="bg-slate-900 p-6 rounded-2xl shadow-md border border-slate-800 lg:col-span-2">
                            <h3 className="text-xl font-bold text-slate-300 mb-4 flex items-center gap-2">
                                <Icon name="FlaskConical" className="text-blue-500" /> Experiment Conclusions
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="p-4 bg-blue-900/20 border-l-4 border-blue-500 rounded-lg">
                                    <strong className="text-blue-400 block mb-1">Necessary Conditions</strong>
                                    <ul className="text-sm text-blue-300 list-disc list-inside">
                                        <li><strong>Oxygen</strong> (from Air)</li>
                                        <li><strong>Water</strong> (Moisture)</li>
                                    </ul>
                                </div>
                                <div className="p-4 bg-red-900/20 border-l-4 border-red-500 rounded-lg">
                                    <strong className="text-red-400 block mb-1">Accelerators</strong>
                                    <ul className="text-sm text-red-300 list-disc list-inside">
                                        <li><strong>Ionic Compounds</strong> (e.g., Salt) increase conductivity of water.</li>
                                        <li><strong>Acidic pH</strong> accelerates the redox process.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <p className="mt-4 text-sm text-slate-500">
                                <strong>Observation:</strong> Only nails exposed to BOTH air and water (#1, #4) rust. Removing either component (#2, #3, #5) effectively prevents rusting.
                            </p>
                        </div>

                        {/* Equation Card */}
                        <div className="bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-lg">
                            <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <Icon name="Zap" className="text-yellow-400" /> Electrochemical Principles
                            </h3>
                            <div className="text-sm text-slate-300 leading-relaxed space-y-2">
                                <p className="font-bold text-red-400 text-xs uppercase">Anode (Oxidation)</p>
                                <p className="font-mono text-white bg-slate-950 p-2 rounded border border-slate-700">Fe(s) &rarr; Fe²⁺(aq) + 2e⁻</p>
                                
                                <p className="font-bold text-blue-400 text-xs uppercase pt-2">Cathode (Reduction)</p>
                                <p className="font-mono text-white bg-slate-950 p-2 rounded border border-slate-700">O₂(g) + 2H₂O(l) + 4e⁻ &rarr; 4OH⁻(aq)</p>
                                
                                <p className="font-bold text-green-400 text-xs uppercase pt-2">Product (Rust)</p>
                                <p className="font-mono text-white bg-slate-950 p-2 rounded border border-slate-700">Fe₂O₃·xH₂O</p>
                            </div>
                        </div>
                    </div>
                    
                    <div className="text-center text-slate-600 text-xs mt-8">
                        Luminous Learner International | IB/A-Level Chemistry
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
