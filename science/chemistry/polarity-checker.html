<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polarity Checker - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        canvas { outline: none; }
        
        /* Custom scrollbar for molecule list */
        .molecule-list::-webkit-scrollbar { width: 6px; }
        .molecule-list::-webkit-scrollbar-track { background: #1e293b; }
        .molecule-list::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .molecule-list::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Electronegativity Data (Pauling Scale)
        const EN = {
            H: 2.2, B: 2.04, C: 2.55, N: 3.04, O: 3.44, F: 3.98, Cl: 3.16, S: 2.58, Be: 1.57
        };

        const Colors = {
            H: 0xffffff, B: 0xffaa00, C: 0x333333, N: 0x3b82f6, O: 0xef4444, F: 0x22c55e, Cl: 0x10b981, S: 0xeab308, Be: 0x94a3b8
        };

        // Molecule Definitions (Internationalized)
        // Atoms: [Element, x, y, z]
        const Molecules = [
            {
                id: 'H2', name: 'Hydrogen', formula: 'H₂', type: 'nonpolar',
                atoms: [['H', -0.7, 0, 0], ['H', 0.7, 0, 0]],
                bonds: [[0, 1]],
                desc: 'Non-polar covalent bond. Two identical atoms share electrons equally.'
            },
            {
                id: 'HCl', name: 'Hydrogen Chloride', formula: 'HCl', type: 'polar',
                atoms: [['H', -0.8, 0, 0], ['Cl', 0.8, 0, 0]],
                bonds: [[0, 1]],
                desc: 'Polar molecule. Chlorine (EN 3.16) is more electronegative than Hydrogen (EN 2.2), pulling electrons towards itself.'
            },
            {
                id: 'CO2', name: 'Carbon Dioxide', formula: 'CO₂', type: 'nonpolar',
                atoms: [['C', 0, 0, 0], ['O', -1.2, 0, 0], ['O', 1.2, 0, 0]],
                bonds: [[0, 1], [0, 2]],
                desc: 'Non-polar molecule. Although C=O bonds are polar, the linear geometry causes the dipoles to cancel out.'
            },
            {
                id: 'H2O', name: 'Water', formula: 'H₂O', type: 'polar',
                atoms: [['O', 0, 0.2, 0], ['H', -0.8, -0.4, 0], ['H', 0.8, -0.4, 0]], // Bent
                bonds: [[0, 1], [0, 2]],
                desc: 'Polar molecule. The bent shape (V-shape) means the bond dipoles do not cancel, resulting in a net dipole.'
            },
            {
                id: 'BF3', name: 'Boron Trifluoride', formula: 'BF₃', type: 'nonpolar',
                atoms: [
                    ['B', 0, 0, 0],
                    ['F', 0, 1.3, 0],
                    ['F', 1.12, -0.65, 0],
                    ['F', -1.12, -0.65, 0]
                ],
                bonds: [[0, 1], [0, 2], [0, 3]],
                desc: 'Non-polar molecule. The trigonal planar symmetry allows the three polar B-F bonds to cancel perfectly.'
            },
            {
                id: 'NH3', name: 'Ammonia', formula: 'NH₃', type: 'polar',
                atoms: [
                    ['N', 0, 0.2, 0],
                    ['H', 0, -0.5, 0.9],
                    ['H', -0.8, -0.5, -0.45],
                    ['H', 0.8, -0.5, -0.45]
                ],
                bonds: [[0, 1], [0, 2], [0, 3]],
                desc: 'Polar molecule. The trigonal pyramidal shape is asymmetrical due to the lone pair on Nitrogen.'
            },
            {
                id: 'CCl4', name: 'Tetrachloromethane', formula: 'CCl₄', type: 'nonpolar',
                atoms: [
                    ['C', 0, 0, 0],
                    ['Cl', 0, 1.2, 0],
                    ['Cl', 1.13, -0.4, 0],
                    ['Cl', -0.56, -0.4, 0.98],
                    ['Cl', -0.56, -0.4, -0.98]
                ],
                bonds: [[0, 1], [0, 2], [0, 3], [0, 4]],
                desc: 'Non-polar molecule. The tetrahedral symmetry causes the four polar C-Cl dipoles to cancel out.'
            },
            {
                id: 'CHCl3', name: 'Trichloromethane', formula: 'CHCl₃', type: 'polar',
                atoms: [
                    ['C', 0, 0, 0],
                    ['H', 0, 1.2, 0],
                    ['Cl', 1.13, -0.4, 0],
                    ['Cl', -0.56, -0.4, 0.98],
                    ['Cl', -0.56, -0.4, -0.98]
                ],
                bonds: [[0, 1], [0, 2], [0, 3], [0, 4]],
                desc: 'Polar molecule. Although tetrahedral, the atoms are different (H vs Cl), creating an imbalance in charge distribution.'
            }
        ];

        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        const iconSvg = window.lucide.createElement(iconNode);
                        iconSvg.setAttribute('width', size);
                        iconSvg.setAttribute('height', size);
                        iconSvg.setAttribute('class', className);
                        setSvg(iconSvg.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        // --- 3D Scene Component ---
        const MoleculeScene = ({ molecule, showBondDipoles, showNetDipole, showCharges }) => {
            const mountRef = useRef(null);
            const sceneRef = useRef(null);
            const rendererRef = useRef(null);
            const frameIdRef = useRef(null);
            
            useEffect(() => {
                if (!mountRef.current) return;

                // Setup
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x1e293b); // Slate 800
                sceneRef.current = scene;

                const width = mountRef.current.clientWidth;
                const height = mountRef.current.clientHeight;

                const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 100);
                camera.position.z = 6;
                camera.position.y = 1;

                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(width, height);
                // Clear previous canvas if exists
                if (mountRef.current.children.length > 0) {
                     mountRef.current.removeChild(mountRef.current.children[0]);
                }
                mountRef.current.appendChild(renderer.domElement);
                rendererRef.current = renderer;

                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.autoRotate = true;
                controls.autoRotateSpeed = 1.5;

                // Lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
                scene.add(ambientLight);
                const pointLight = new THREE.PointLight(0xffffff, 0.8);
                pointLight.position.set(5, 5, 5);
                scene.add(pointLight);

                // --- Build Molecule ---
                const group = new THREE.Group();

                // Add Atoms
                molecule.atoms.forEach((atom, idx) => {
                    const [el, x, y, z] = atom;
                    const color = Colors[el] || 0xcccccc;
                    const size = el === 'H' ? 0.3 : el === 'Cl' ? 0.6 : 0.45;
                    
                    const geo = new THREE.SphereGeometry(size, 32, 32);
                    const mat = new THREE.MeshPhongMaterial({ color: color, shininess: 50 });
                    const mesh = new THREE.Mesh(geo, mat);
                    mesh.position.set(x, y, z);
                    group.add(mesh);

                    // Add Partial Charges Text (Sprite)
                    if (showCharges && EN[el]) {
                         // Find neighbors to determine delta
                         let neighborsEN = [];
                         molecule.bonds.forEach(b => {
                             if (b[0] === idx) neighborsEN.push(EN[molecule.atoms[b[1]][0]]);
                             if (b[1] === idx) neighborsEN.push(EN[molecule.atoms[b[0]][0]]);
                         });
                         
                         if (neighborsEN.length > 0) {
                             const avgNeighborEN = neighborsEN.reduce((a,b)=>a+b,0) / neighborsEN.length;
                             const myEN = EN[el];
                             const diff = Math.abs(myEN - avgNeighborEN);
                             
                             if (diff > 0.3) {
                                 const symbol = myEN > avgNeighborEN ? 'δ-' : 'δ+';
                                 const spriteColor = myEN > avgNeighborEN ? '#ef4444' : '#3b82f6';
                                 
                                 const canvas = document.createElement('canvas');
                                 const ctx = canvas.getContext('2d');
                                 canvas.width = 64; canvas.height = 64;
                                 ctx.fillStyle = spriteColor;
                                 ctx.font = 'bold 48px serif';
                                 ctx.textAlign = 'center';
                                 ctx.textBaseline = 'middle';
                                 ctx.fillText(symbol, 32, 32);
                                 const texture = new THREE.CanvasTexture(canvas);
                                 const spriteMat = new THREE.SpriteMaterial({ map: texture });
                                 const sprite = new THREE.Sprite(spriteMat);
                                 sprite.position.copy(mesh.position).add(new THREE.Vector3(0.3, 0.3, 0));
                                 sprite.scale.set(0.6, 0.6, 1);
                                 group.add(sprite);
                             }
                         }
                    }
                });

                // Calculate Net Dipole Vector
                let netDipole = new THREE.Vector3(0, 0, 0);

                // Add Bonds and Bond Dipoles
                molecule.bonds.forEach(bond => {
                    const idx1 = bond[0];
                    const idx2 = bond[1];
                    const a1 = molecule.atoms[idx1];
                    const a2 = molecule.atoms[idx2];
                    
                    const v1 = new THREE.Vector3(a1[1], a1[2], a1[3]);
                    const v2 = new THREE.Vector3(a2[1], a2[2], a2[3]);
                    
                    // Draw Bond Cylinder
                    const distance = v1.distanceTo(v2);
                    const mid = new THREE.Vector3().addVectors(v1, v2).multiplyScalar(0.5);
                    const cylinderGeo = new THREE.CylinderGeometry(0.08, 0.08, distance, 12);
                    const cylinderMat = new THREE.MeshPhongMaterial({ color: 0x94a3b8 });
                    const cylinder = new THREE.Mesh(cylinderGeo, cylinderMat);
                    cylinder.position.copy(mid);
                    cylinder.lookAt(v2);
                    cylinder.rotateX(Math.PI / 2);
                    group.add(cylinder);

                    // Calculate Dipole
                    const en1 = EN[a1[0]];
                    const en2 = EN[a2[0]];
                    const diff = Math.abs(en1 - en2);

                    if (diff > 0.3) { // Threshold for polar bond
                        const direction = new THREE.Vector3().subVectors(v2, v1).normalize();
                        if (en1 > en2) direction.negate(); // Point towards higher EN
                        
                        // Add to net dipole
                        netDipole.add(direction.clone().multiplyScalar(diff));

                        // Visual Arrow for Bond Dipole
                        if (showBondDipoles) {
                            const arrowColor = 0xffff00; // Yellow
                            const arrowLength = 0.8;
                            const arrowDir = direction.clone();
                            const arrowOrigin = mid.clone().sub(direction.clone().multiplyScalar(0.4)); 
                            const arrowHelper = new THREE.ArrowHelper(arrowDir, arrowOrigin, arrowLength, arrowColor, 0.2, 0.15);
                            group.add(arrowHelper);
                        }
                    }
                });

                // Net Dipole Visual
                if (showNetDipole && netDipole.length() > 0.1 && molecule.type === 'polar') {
                    const origin = new THREE.Vector3(0, 0, 0); 
                    const length = 2.5; 
                    const color = 0xec4899; // Pink
                    const arrowHelper = new THREE.ArrowHelper(netDipole.normalize(), origin, length, color, 0.5, 0.3);
                    group.add(arrowHelper);
                }

                scene.add(group);

                // Animation Loop
                const animate = () => {
                    frameIdRef.current = requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                };
                animate();

                // Handle Resize
                const handleResize = () => {
                     if (mountRef.current && rendererRef.current) {
                        const w = mountRef.current.clientWidth;
                        const h = mountRef.current.clientHeight;
                        camera.aspect = w / h;
                        camera.updateProjectionMatrix();
                        rendererRef.current.setSize(w, h);
                     }
                }
                window.addEventListener('resize', handleResize);

                // Cleanup
                return () => {
                    window.removeEventListener('resize', handleResize);
                    cancelAnimationFrame(frameIdRef.current);
                    if (mountRef.current && rendererRef.current) {
                        mountRef.current.removeChild(rendererRef.current.domElement);
                        rendererRef.current.dispose();
                    }
                    // Dispose Geometries
                    group.traverse((obj) => {
                        if (obj.isMesh) {
                            obj.geometry.dispose();
                            obj.material.dispose();
                        }
                    });
                };
            }, [molecule, showBondDipoles, showNetDipole, showCharges]);

            return <div ref={mountRef} className="w-full h-full rounded-2xl overflow-hidden shadow-inner bg-slate-900" />;
        };

        // --- Main App ---
        const App = () => {
            const [selectedMol, setSelectedMol] = useState(Molecules[0]);
            const [showBondDipoles, setShowBondDipoles] = useState(true);
            const [showNetDipole, setShowNetDipole] = useState(true);
            const [showCharges, setShowCharges] = useState(false);

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-6xl">
                    
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-teal-400 flex items-center gap-2">
                                <Icon name="Magnet" /> Polarity Checker
                            </h1>
                            <p className="text-slate-400 text-sm">Predicting Molecular Polarity from Bond Dipoles & Geometry</p>
                        </div>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 flex-grow">
                        
                        {/* Left: 3D View */}
                        <div className="w-full lg:w-2/3 h-[500px] relative">
                            <MoleculeScene 
                                molecule={selectedMol} 
                                showBondDipoles={showBondDipoles}
                                showNetDipole={showNetDipole}
                                showCharges={showCharges}
                            />
                            <div className="absolute bottom-4 left-4 text-xs text-slate-500 bg-black/60 px-2 py-1 rounded pointer-events-none backdrop-blur-sm">
                                Left Click to Rotate • Scroll to Zoom
                            </div>
                            
                            {/* Legend Overlay */}
                            <div className="absolute top-4 left-4 flex flex-col gap-2 bg-black/40 p-2 rounded border border-slate-700/50 backdrop-blur-sm text-xs">
                                <div className="flex items-center gap-2 text-yellow-300"><Icon name="ArrowRight" size={14}/> Bond Dipole</div>
                                <div className="flex items-center gap-2 text-pink-400"><Icon name="ArrowUpRight" size={14}/> Net Dipole</div>
                            </div>
                        </div>

                        {/* Right: Controls & Analysis */}
                        <div className="w-full lg:w-1/3 flex flex-col gap-6">
                            
                            {/* Molecule Selection Grid */}
                            <div className="bg-slate-900 p-4 rounded-2xl border border-slate-800 shadow-lg">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-3">Select Molecule</h3>
                                <div className="grid grid-cols-3 gap-2 molecule-list max-h-40 overflow-y-auto pr-1">
                                    {Molecules.map(m => (
                                        <button 
                                            key={m.id}
                                            onClick={() => setSelectedMol(m)}
                                            className={`p-2 rounded-lg text-center transition-all border
                                                ${selectedMol.id === m.id 
                                                    ? 'bg-teal-900/50 border-teal-500 text-teal-300' 
                                                    : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700'}
                                            `}
                                        >
                                            <div className="font-bold text-lg">{m.formula}</div>
                                            <div className="text-[10px] truncate">{m.name}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Visual Controls */}
                            <div className="bg-slate-900 p-4 rounded-2xl border border-slate-800 shadow-lg">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-3">Display Settings</h3>
                                <div className="space-y-2">
                                    <label className="flex items-center gap-3 cursor-pointer p-2 hover:bg-slate-800 rounded transition-colors">
                                        <input type="checkbox" checked={showBondDipoles} onChange={(e) => setShowBondDipoles(e.target.checked)} className="accent-yellow-500 w-4 h-4" />
                                        <span className="text-slate-200 text-sm">Show Bond Dipoles</span>
                                    </label>
                                    <label className="flex items-center gap-3 cursor-pointer p-2 hover:bg-slate-800 rounded transition-colors">
                                        <input type="checkbox" checked={showNetDipole} onChange={(e) => setShowNetDipole(e.target.checked)} className="accent-pink-500 w-4 h-4" />
                                        <span className="text-slate-200 text-sm">Show Net Dipole</span>
                                    </label>
                                    <label className="flex items-center gap-3 cursor-pointer p-2 hover:bg-slate-800 rounded transition-colors">
                                        <input type="checkbox" checked={showCharges} onChange={(e) => setShowCharges(e.target.checked)} className="accent-blue-500 w-4 h-4" />
                                        <span className="text-slate-200 text-sm">Show Partial Charges (&delta;)</span>
                                    </label>
                                </div>
                            </div>

                            {/* Analysis Result */}
                            <div className={`p-5 rounded-2xl border-l-4 shadow-lg transition-all animate-in flex-grow
                                ${selectedMol.type === 'polar' ? 'bg-blue-900/20 border-blue-500' : 'bg-slate-800/50 border-slate-500'}
                            `}>
                                <div className="flex justify-between items-center mb-2">
                                    <h2 className="text-xl font-bold text-white">{selectedMol.name}</h2>
                                    <span className={`px-2 py-1 rounded text-xs font-bold uppercase ${selectedMol.type === 'polar' ? 'bg-blue-600 text-white' : 'bg-slate-600 text-slate-300'}`}>
                                        {selectedMol.type === 'polar' ? 'POLAR' : 'NON-POLAR'}
                                    </span>
                                </div>
                                <p className="text-sm text-slate-300 leading-relaxed">
                                    {selectedMol.desc}
                                </p>
                            </div>

                        </div>
                    </div>
                    
                    <div className="text-center text-slate-600 text-xs mt-8 border-t border-slate-800 pt-4">
                        Luminous Learner International | IB/A-Level Chemistry
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
