<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dilution Calculator - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .input-group:focus-within label {
            color: #60a5fa; /* Blue-400 */
        }
        .input-group:focus-within input {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }

        /* Liquid Animation */
        .liquid {
            transition: height 1s ease, background-color 1s ease, opacity 1s ease;
        }
        
        /* Water drop animation */
        @keyframes drop {
            0% { transform: translateY(-20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(20px); opacity: 0; }
        }
        .water-drop {
            animation: drop 0.8s infinite;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        const iconSvg = window.lucide.createElement(iconNode);
                        iconSvg.setAttribute('width', size);
                        iconSvg.setAttribute('height', size);
                        iconSvg.setAttribute('class', className);
                        setSvg(iconSvg.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        const App = () => {
            // State for inputs
            const [m1, setM1] = useState('');
            const [v1, setV1] = useState('');
            const [m2, setM2] = useState('');
            const [v2, setV2] = useState('');
            
            // State for calculation status
            const [target, setTarget] = useState('v2'); // m1, v1, m2, v2
            const [result, setResult] = useState(null);
            const [error, setError] = useState('');
            const [isAnimating, setIsAnimating] = useState(false);

            // Calculation Logic
            const calculate = () => {
                setError('');
                setResult(null);
                setIsAnimating(true);

                const valM1 = parseFloat(m1);
                const valV1 = parseFloat(v1);
                const valM2 = parseFloat(m2);
                const valV2 = parseFloat(v2);

                let calcResult = 0;

                try {
                    if (target === 'm1') {
                        if (!valV1 || !valM2 || !valV2) throw new Error('Please enter V1, M2, V2');
                        calcResult = (valM2 * valV2) / valV1;
                    } else if (target === 'v1') {
                        if (!valM1 || !valM2 || !valV2) throw new Error('Please enter M1, M2, V2');
                        calcResult = (valM2 * valV2) / valM1;
                    } else if (target === 'm2') {
                        if (!valM1 || !valV1 || !valV2) throw new Error('Please enter M1, V1, V2');
                        calcResult = (valM1 * valV1) / valV2;
                    } else if (target === 'v2') {
                        if (!valM1 || !valV1 || !valM2) throw new Error('Please enter M1, V1, M2');
                        calcResult = (valM1 * valV1) / valM2;
                    }
                    
                    if (calcResult < 0 || !isFinite(calcResult)) throw new Error('Invalid result (possible division by zero)');
                    
                    // Logic Check: M1 should be > M2 (Dilution) for standard cases, but formula works regardless.
                    // Warn if M2 > M1 (Concentration) which is physically impossible by just adding water.
                    if ((target === 'm2' && calcResult > valM1) || (target === 'm1' && valM2 > calcResult)) {
                        // setError('Warning: Final concentration cannot be higher than initial concentration in a dilution.');
                    }

                    setTimeout(() => {
                        setResult(calcResult);
                        setIsAnimating(false);
                    }, 800);

                } catch (e) {
                    setError(e.message);
                    setIsAnimating(false);
                }
            };

            // Reset
            const reset = () => {
                setM1(''); setV1(''); setM2(''); setV2('');
                setResult(null); setError('');
                setIsAnimating(false);
            };

            // Visual Helpers
            // Opacity based on Molarity (Logarithmic scale visual)
            const getOpacity = (m) => {
                if (!m) return 0;
                const val = parseFloat(m);
                return Math.min(1, Math.max(0.1, Math.log10(val + 1) * 0.8)); 
            };
            
            // Height based on Volume (Linear)
            const getHeight = (v) => {
                if (!v) return 10;
                const val = parseFloat(v);
                // Scale factor: assume max volume usually around 1000 or relative to other values
                // Use relative scale if both exist
                const maxV = Math.max(parseFloat(v1)||0, parseFloat(v2)||0, val) || 100;
                return Math.min(100, Math.max(10, (val / maxV) * 80));
            };

            // Determine displayed values for visual
            const displayM1 = target === 'm1' && result ? result : m1;
            const displayV1 = target === 'v1' && result ? result : v1;
            const displayM2 = target === 'm2' && result ? result : m2;
            const displayV2 = target === 'v2' && result ? result : v2;

            const isDisabled = (field) => target === field;

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-5xl">
                    
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-blue-400 flex items-center gap-2">
                                <Icon name="Beaker" /> Dilution Calculator
                            </h1>
                            <p className="text-slate-500 text-sm">Molarity Dilution (M₁V₁ = M₂V₂)</p>
                        </div>
                        <button onClick={reset} className="px-4 py-2 bg-slate-800 text-slate-400 rounded-lg hover:bg-slate-700 hover:text-white font-bold text-sm flex items-center gap-2 transition-colors border border-slate-700">
                            <Icon name="RotateCcw" size={16} /> Reset
                        </button>
                    </div>

                    <div className="flex flex-col lg:flex-row gap-8 flex-grow">
                        
                        {/* Left: Calculator Inputs */}
                        <div className="w-full lg:w-5/12 flex flex-col gap-6">
                            
                            <div className="bg-slate-900 p-6 rounded-2xl shadow-xl border border-blue-500/30">
                                
                                {/* Target Selection */}
                                <div className="mb-6">
                                    <label className="text-xs font-bold text-slate-400 uppercase mb-2 block">Calculate Target</label>
                                    <div className="grid grid-cols-4 gap-2">
                                        {['m1', 'v1', 'm2', 'v2'].map(t => (
                                            <button
                                                key={t}
                                                onClick={() => { setTarget(t); setResult(null); }}
                                                className={`py-2 rounded-lg font-bold text-sm border-2 transition-all uppercase
                                                    ${target === t ? 'border-blue-500 bg-blue-900/30 text-blue-400' : 'border-slate-700 text-slate-500 hover:border-blue-500/50'}
                                                `}
                                            >
                                                {t.toUpperCase()}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Inputs Grid */}
                                <div className="space-y-6 relative">
                                    {/* Before Dilution */}
                                    <div className="p-4 bg-slate-800/50 rounded-xl border border-slate-700 relative group">
                                        <div className="absolute -top-3 left-4 bg-slate-600 text-white px-2 py-0.5 rounded text-xs font-bold shadow-sm">Initial (Stock)</div>
                                        <div className="grid grid-cols-2 gap-4 mt-2">
                                            <div className={`input-group ${target === 'm1' ? 'opacity-50 pointer-events-none' : ''}`}>
                                                <label className="block text-xs font-bold text-slate-500 mb-1">M₁ (Molarity)</label>
                                                <div className="relative">
                                                    <input type="number" value={m1} onChange={(e) => setM1(e.target.value)} className="w-full p-2 rounded bg-slate-900 border border-slate-600 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target === 'm1' ? 'Target' : 'e.g. 2.0'} />
                                                    <span className="absolute right-3 top-2 text-xs text-slate-500 font-bold">M</span>
                                                </div>
                                            </div>
                                            <div className={`input-group ${target === 'v1' ? 'opacity-50 pointer-events-none' : ''}`}>
                                                <label className="block text-xs font-bold text-slate-500 mb-1">V₁ (Volume)</label>
                                                <div className="relative">
                                                    <input type="number" value={v1} onChange={(e) => setV1(e.target.value)} className="w-full p-2 rounded bg-slate-900 border border-slate-600 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target === 'v1' ? 'Target' : 'e.g. 50'} />
                                                    <span className="absolute right-3 top-2 text-xs text-slate-500 font-bold">cm³</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex justify-center -my-3 relative z-10">
                                        <div className="bg-slate-900 p-1 rounded-full border border-slate-700">
                                            <Icon name="ArrowDown" className="text-slate-500" size={20} />
                                        </div>
                                    </div>

                                    {/* After Dilution */}
                                    <div className="p-4 bg-blue-900/10 rounded-xl border border-blue-500/30 relative group">
                                        <div className="absolute -top-3 left-4 bg-blue-600 text-white px-2 py-0.5 rounded text-xs font-bold shadow-sm">Final (Diluted)</div>
                                        <div className="grid grid-cols-2 gap-4 mt-2">
                                            <div className={`input-group ${target === 'm2' ? 'opacity-50 pointer-events-none' : ''}`}>
                                                <label className="block text-xs font-bold text-blue-400 mb-1">M₂ (Molarity)</label>
                                                <div className="relative">
                                                    <input type="number" value={m2} onChange={(e) => setM2(e.target.value)} className="w-full p-2 rounded bg-slate-900 border border-slate-600 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target === 'm2' ? 'Target' : 'e.g. 0.5'} />
                                                    <span className="absolute right-3 top-2 text-xs text-blue-400 font-bold">M</span>
                                                </div>
                                            </div>
                                            <div className={`input-group ${target === 'v2' ? 'opacity-50 pointer-events-none' : ''}`}>
                                                <label className="block text-xs font-bold text-blue-400 mb-1">V₂ (Volume)</label>
                                                <div className="relative">
                                                    <input type="number" value={v2} onChange={(e) => setV2(e.target.value)} className="w-full p-2 rounded bg-slate-900 border border-slate-600 text-white font-mono font-bold outline-none placeholder:text-slate-600" placeholder={target === 'v2' ? 'Target' : 'e.g. 200'} />
                                                    <span className="absolute right-3 top-2 text-xs text-blue-400 font-bold">cm³</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {error && (
                                    <div className="mt-4 p-3 bg-red-900/30 border border-red-500/50 text-red-400 rounded-lg text-sm font-bold flex items-center gap-2 animate-pulse">
                                        <Icon name="AlertTriangle" size={16} /> {error}
                                    </div>
                                )}

                                <button 
                                    onClick={calculate}
                                    disabled={isAnimating}
                                    className="mt-6 w-full py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-500 transition-all active:scale-95 text-lg flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed"
                                >
                                    {isAnimating ? <Icon name="Loader2" className="animate-spin" /> : <Icon name="Calculator" />}
                                    Calculate
                                </button>
                            </div>

                        </div>

                        {/* Right: Visualization & Result */}
                        <div className="w-full lg:w-7/12 flex flex-col gap-6">
                            
                            {/* Visual Beakers */}
                            <div className="bg-slate-900 rounded-2xl shadow-xl border border-slate-800 p-6 flex justify-around items-end min-h-[300px] relative">
                                
                                {/* Beaker 1 (Initial) */}
                                <div className="flex flex-col items-center w-1/3">
                                    <div className="w-24 h-40 border-x-4 border-b-4 border-slate-600 rounded-b-xl relative overflow-hidden bg-white/5 flex flex-col justify-end backdrop-blur-sm">
                                        <div 
                                            className="w-full bg-purple-500 liquid" 
                                            style={{ 
                                                height: `${getHeight(displayV1)}%`, 
                                                opacity: getOpacity(displayM1) 
                                            }}
                                        ></div>
                                        <div className="absolute bottom-0 w-full text-center text-[10px] text-slate-400 font-mono bg-slate-900/80 py-1 border-t border-slate-700">
                                            Initial
                                        </div>
                                    </div>
                                    <div className="mt-2 text-center">
                                        <div className="font-bold text-slate-300">M₁: {displayM1 || '?'} M</div>
                                        <div className="text-xs text-slate-500">V₁: {displayV1 || '?'} cm³</div>
                                    </div>
                                </div>

                                {/* Arrow */}
                                <div className="mb-12 text-slate-600 flex flex-col items-center">
                                    <span className="text-xs font-bold mb-1 text-blue-400">+ Water</span>
                                    <Icon name="ArrowRight" size={32} />
                                    {isAnimating && (
                                        <div className="absolute top-10 water-drop">
                                            <Icon name="Droplet" className="fill-blue-400 text-blue-400" />
                                        </div>
                                    )}
                                </div>

                                {/* Beaker 2 (Final) */}
                                <div className="flex flex-col items-center w-1/3">
                                    <div className="w-24 h-40 border-x-4 border-b-4 border-slate-600 rounded-b-xl relative overflow-hidden bg-white/5 flex flex-col justify-end backdrop-blur-sm">
                                        <div 
                                            className="w-full bg-purple-500 liquid" 
                                            style={{ 
                                                height: `${getHeight(displayV2)}%`, 
                                                opacity: getOpacity(displayM2) 
                                            }}
                                        ></div>
                                        <div className="absolute bottom-0 w-full text-center text-[10px] text-slate-400 font-mono bg-slate-900/80 py-1 border-t border-slate-700">
                                            Final
                                        </div>
                                    </div>
                                    <div className="mt-2 text-center">
                                        <div className={`font-bold ${result && (target === 'm2' || target === 'v2') ? 'text-green-400 text-xl' : 'text-slate-300'}`}>
                                            M₂: {result && target === 'm2' ? parseFloat(result.toFixed(4)) : (displayM2 || '?')} M
                                        </div>
                                        <div className={`text-xs ${result && target === 'v2' ? 'text-green-400 font-bold' : 'text-slate-500'}`}>
                                            V₂: {result && target === 'v2' ? parseFloat(result.toFixed(2)) : (displayV2 || '?')} cm³
                                        </div>
                                    </div>
                                </div>

                            </div>

                            {/* Result Box */}
                            {result !== null && (
                                <div className="bg-slate-800 p-6 rounded-2xl shadow-lg border border-slate-700 text-white animate-in slide-in-from-bottom-4 fade-in">
                                    <div className="flex items-center gap-3 mb-4 border-b border-slate-700 pb-2">
                                        <Icon name="CheckCircle" className="text-green-400" />
                                        <h3 className="font-bold">Calculation Result</h3>
                                    </div>
                                    
                                    <div className="flex justify-between items-end mb-4">
                                        <span className="text-slate-400 text-sm font-bold uppercase">{target.toUpperCase()} =</span>
                                        <span className="text-4xl font-mono font-bold text-blue-400">
                                            {parseFloat(result.toFixed(4))}
                                            <span className="text-lg ml-2 text-slate-500">
                                                {target.startsWith('m') ? 'M (mol dm⁻³)' : 'cm³'}
                                            </span>
                                        </span>
                                    </div>

                                    <div className="bg-slate-900/50 p-3 rounded-lg font-mono text-sm text-slate-300 border border-slate-700">
                                        <p className="mb-1 text-xs text-slate-500">// Formula Used</p>
                                        {target === 'm1' && `M₁ = (M₂ × V₂) ÷ V₁ = (${m2} × ${v2}) ÷ ${v1}`}
                                        {target === 'v1' && `V₁ = (M₂ × V₂) ÷ M₁ = (${m2} × ${v2}) ÷ ${m1}`}
                                        {target === 'm2' && `M₂ = (M₁ × V₁) ÷ V₂ = (${m1} × ${v1}) ÷ ${v2}`}
                                        {target === 'v2' && `V₂ = (M₁ × V₁) ÷ M₂ = (${m1} × ${v1}) ÷ ${m2}`}
                                    </div>

                                    {target === 'v2' && (
                                        <div className="mt-3 text-xs text-yellow-400 flex items-center gap-2 bg-yellow-900/20 p-2 rounded border border-yellow-500/30">
                                            <Icon name="Info" size={14} />
                                            Volume of water to add = V₂ - V₁ = {(result - parseFloat(v1)).toFixed(2)} cm³
                                        </div>
                                    )}
                                </div>
                            )}

                        </div>
                    </div>
                    
                    <div className="text-center text-slate-600 text-xs mt-8 border-t border-slate-800 pt-4">
                        Luminous Learner International | IB/A-Level Chemistry
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
