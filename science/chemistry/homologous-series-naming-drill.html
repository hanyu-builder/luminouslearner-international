<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IUPAC Naming Drill - LuminousLearner International</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #e2e8f0; margin: 0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .atom-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5); }
        
        /* Custom scrollbar for molecule viewer if needed */
        .molecule-container {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                if (window.lucide) {
                    const iconNode = window.lucide.icons[name];
                    if (iconNode) {
                        const iconSvg = window.lucide.createElement(iconNode);
                        iconSvg.setAttribute('width', size);
                        iconSvg.setAttribute('height', size);
                        iconSvg.setAttribute('class', className);
                        setSvg(iconSvg.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="flex items-center" />;
        };

        // --- 1. Structure Generation Engine ---
        
        const generateStructure = (config) => {
            const nodes = [];
            const links = [];
            const spacing = 60;
            const startX = 0;
            const startY = 0;

            const addNode = (x, y, el, color) => {
                nodes.push({ x, y, el, color });
                return nodes.length - 1;
            };

            // 1. Build Main Chain
            for (let i = 0; i < config.chain; i++) {
                // Determine color based on element (Carbon is dark grey in dark mode context)
                addNode(startX + i * spacing, startY, 'C', 'bg-slate-700 border-slate-500 text-white');
                if (i > 0) {
                    let type = 'single';
                    if (config.doubleBond === i) type = 'double';
                    if (config.tripleBond === i) type = 'triple';
                    links.push({ s: i - 1, t: i, type });
                }
            }

            // 2. Add Substituents / Functional Groups
            if (config.subs) {
                config.subs.forEach(sub => {
                    const parentIdx = sub.pos - 1;
                    if (parentIdx < 0 || parentIdx >= nodes.length) return;

                    const parentNode = nodes[parentIdx];
                    let subX = parentNode.x;
                    let subY = parentNode.y + (sub.up ? -spacing : spacing);
                    
                    if (sub.left) { subX -= spacing; subY = parentNode.y; }

                    if (sub.type === 'methyl') {
                        const idx = addNode(subX, subY, 'C', 'bg-slate-700 border-slate-500 text-white');
                        links.push({ s: parentIdx, t: idx });
                    } 
                    else if (sub.type === 'ethyl') {
                        const idx1 = addNode(subX, subY, 'C', 'bg-slate-700 border-slate-500 text-white');
                        const idx2 = addNode(subX + spacing/2, subY + spacing, 'C', 'bg-slate-700 border-slate-500 text-white');
                        links.push({ s: parentIdx, t: idx1 });
                        links.push({ s: idx1, t: idx2 });
                    }
                    else if (['Cl', 'Br', 'I', 'F', 'OH', 'NH2'].includes(sub.type)) {
                        let color = '';
                        if(sub.type === 'Cl') color = 'bg-green-600 border-green-500 text-white';
                        if(sub.type === 'Br') color = 'bg-orange-700 border-orange-600 text-white';
                        if(sub.type === 'I') color = 'bg-purple-700 border-purple-600 text-white';
                        if(sub.type === 'F') color = 'bg-teal-600 border-teal-500 text-white';
                        if(sub.type === 'OH') color = 'bg-red-600 border-red-500 text-white';
                        if(sub.type === 'NH2') color = 'bg-blue-600 border-blue-500 text-white';
                        
                        const idx = addNode(subX, subY, sub.type === 'NH2' ? 'NHâ‚‚' : sub.type, color);
                        links.push({ s: parentIdx, t: idx });
                    }
                    else if (sub.type === '=O') { // Carbonyl
                        const idx = addNode(subX, subY, 'O', 'bg-red-600 border-red-500 text-white');
                        links.push({ s: parentIdx, t: idx, type: 'double' });
                    }
                });
            }
            
            // Ester Handling
            if (config.esterR) {
                // Find carbonyl C
                const cIdx = config.subs.find(s => s.type === '=O').pos - 1;
                const cNode = nodes[cIdx];
                
                // Add Ether O
                const oIdx = addNode(cNode.x + spacing, cNode.y, 'O', 'bg-red-600 border-red-500 text-white');
                links.push({ s: cIdx, t: oIdx });
                
                // Add R group
                for(let i=0; i<config.esterR; i++) {
                    const rIdx = addNode(cNode.x + spacing * (i+2), cNode.y, 'C', 'bg-slate-700 border-slate-500 text-white');
                    links.push({ s: i===0 ? oIdx : nodes.length-2, t: rIdx });
                }
            }

            return { nodes, links };
        };

        // --- 2. The Database ---
        const RawQuestions = [
            // ALKANES
            { name: 'Methane', formula: 'CHâ‚„', config: { chain: 1 } },
            { name: 'Ethane', formula: 'Câ‚‚Hâ‚†', config: { chain: 2 } },
            { name: 'Propane', formula: 'Câ‚ƒHâ‚ˆ', config: { chain: 3 } },
            { name: 'Butane', formula: 'Câ‚„Hâ‚â‚€', config: { chain: 4 } },
            { name: '2-methylpropane', formula: 'Câ‚„Hâ‚â‚€', config: { chain: 3, subs: [{pos:2, type:'methyl'}] } },
            
            // ALKENES
            { name: 'Ethene', formula: 'Câ‚‚Hâ‚„', config: { chain: 2, doubleBond: 1 } },
            { name: 'Propene', formula: 'Câ‚ƒHâ‚†', config: { chain: 3, doubleBond: 1 } },
            { name: 'But-2-ene', formula: 'Câ‚„Hâ‚ˆ', config: { chain: 4, doubleBond: 2 } },

            // HALOALKANES
            { name: 'Chloromethane', formula: 'CHâ‚ƒCl', config: { chain: 1, subs: [{pos:1, type:'Cl'}] } },
            { name: '1-bromopropane', formula: 'Câ‚ƒHâ‚‡Br', config: { chain: 3, subs: [{pos:3, type:'Br'}] } },
            { name: '2-chloro-2-methylpropane', formula: 'Câ‚„Hâ‚‰Cl', config: { chain: 3, subs: [{pos:2, type:'methyl', up:true}, {pos:2, type:'Cl'}] } },

            // ALCOHOLS
            { name: 'Methanol', formula: 'CHâ‚ƒOH', config: { chain: 1, subs: [{pos:1, type:'OH'}] } },
            { name: 'Ethanol', formula: 'Câ‚‚Hâ‚…OH', config: { chain: 2, subs: [{pos:2, type:'OH'}] } },
            { name: 'Propan-2-ol', formula: 'Câ‚ƒHâ‚‡OH', config: { chain: 3, subs: [{pos:2, type:'OH'}] } },

            // CARBONYLS & ACIDS
            { name: 'Methanal', formula: 'HCHO', config: { chain: 1, subs: [{pos:1, type:'=O', up:true}] } },
            { name: 'Propanone', formula: 'Câ‚ƒHâ‚†O', config: { chain: 3, subs: [{pos:2, type:'=O', up:true}] } },
            { name: 'Ethanoic Acid', formula: 'CHâ‚ƒCOOH', config: { chain: 2, subs: [{pos:2, type:'=O', up:true}, {pos:2, type:'OH'}] } },
            
            // ESTERS & AMINES
            { name: 'Methyl ethanoate', formula: 'Câ‚ƒHâ‚†Oâ‚‚', config: { chain: 2, subs: [{pos:2, type:'=O', up:true}], esterR: 1 } },
            { name: 'Ethylamine', formula: 'Câ‚‚Hâ‚…NHâ‚‚', config: { chain: 2, subs: [{pos:2, type:'NH2'}] } }
        ];

        // Distractor Generator
        const generateDistractors = (correctName) => {
            const options = new Set();
            options.add(correctName);
            while (options.size < 4) {
                const randomQ = RawQuestions[Math.floor(Math.random() * RawQuestions.length)];
                if (randomQ.name !== correctName) options.add(randomQ.name);
            }
            return Array.from(options).sort(() => Math.random() - 0.5);
        };

        const App = () => {
            const [question, setQuestion] = useState(null);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [qIndex, setQIndex] = useState(0);
            const [queue, setQueue] = useState([]);

            useEffect(() => {
                setQueue([...RawQuestions].sort(() => Math.random() - 0.5));
            }, []);

            useEffect(() => {
                if (queue.length > 0) loadQuestion(0);
            }, [queue]);

            const loadQuestion = (idx) => {
                const raw = queue[idx % queue.length];
                const opts = generateDistractors(raw.name);
                const structData = generateStructure(raw.config);
                
                let series = 'Organic Compound';
                if(raw.name.includes('ane')) series = 'Alkane';
                if(raw.name.includes('ene')) series = 'Alkene';
                if(raw.name.includes('ol')) series = 'Alcohol';
                if(raw.name.includes('al')) series = 'Aldehyde';
                if(raw.name.includes('one')) series = 'Ketone';
                if(raw.name.includes('Acid')) series = 'Carboxylic Acid';
                if(raw.name.includes('oate')) series = 'Ester';
                if(raw.name.includes('amine')) series = 'Amine';
                if(raw.name.includes('chloro') || raw.name.includes('bromo')) series = 'Halogenoalkane';

                setQuestion({ ...raw, options: opts, structure: structData, series });
                setFeedback(null);
                setQIndex(idx);
            };

            const handleAnswer = (ans) => {
                if (feedback) return;
                const isCorrect = ans === question.name;
                if (isCorrect) {
                    setScore(s => s + 10);
                    setStreak(s => s + 1);
                    setFeedback({ type: 'success', msg: 'Correct!' });
                } else {
                    setStreak(0);
                    setFeedback({ type: 'error', msg: `Incorrect. The correct answer is ${question.name}`, selected: ans });
                }
            };

            const nextQ = () => loadQuestion(qIndex + 1);

            // Visual Component
            const MoleculeViewer = ({ data }) => {
                const xs = data.nodes.map(n => n.x);
                const ys = data.nodes.map(n => n.y);
                const minX = Math.min(...xs), maxX = Math.max(...xs);
                const minY = Math.min(...ys), maxY = Math.max(...ys);
                
                const width = maxX - minX + 100;
                const height = maxY - minY + 100;
                const offsetX = -minX + 50;
                const offsetY = -minY + 50;
                const scale = Math.min(1, 500 / width, 250 / height);

                return (
                    <div className="w-full h-64 bg-slate-900 rounded-xl border-4 border-slate-700 relative overflow-hidden flex items-center justify-center molecule-container shadow-inner">
                        <div style={{ transform: `scale(${scale})` }} className="relative">
                            <svg width={width} height={height} className="overflow-visible">
                                {data.links.map((link, i) => {
                                    const s = data.nodes[link.s];
                                    const t = data.nodes[link.t];
                                    const x1 = s.x + offsetX, y1 = s.y + offsetY;
                                    const x2 = t.x + offsetX, y2 = t.y + offsetY;
                                    
                                    if (link.type === 'double') {
                                        return <g key={i} stroke="#94a3b8" strokeWidth="4" strokeLinecap="round">
                                            <line x1={x1} y1={y1-4} x2={x2} y2={y2-4} />
                                            <line x1={x1} y1={y1+4} x2={x2} y2={y2+4} />
                                        </g>;
                                    }
                                    if (link.type === 'triple') {
                                        return <g key={i} stroke="#94a3b8" strokeWidth="3" strokeLinecap="round">
                                            <line x1={x1} y1={y1-6} x2={x2} y2={y2-6} />
                                            <line x1={x1} y1={y1} x2={x2} y2={y2} />
                                            <line x1={x1} y1={y1+6} x2={x2} y2={y2+6} />
                                        </g>;
                                    }
                                    return <line key={i} x1={x1} y1={y1} x2={x2} y2={y2} stroke="#94a3b8" strokeWidth="4" strokeLinecap="round"/>;
                                })}
                            </svg>
                            
                            {data.nodes.map((node, i) => (
                                <div key={i} 
                                     className={`absolute flex items-center justify-center font-bold border-2 atom-shadow z-10 rounded-full ${node.color}
                                        ${node.el.length > 2 ? 'text-xs w-10 h-10' : 'text-sm w-10 h-10'}
                                     `}
                                     style={{ left: node.x + offsetX - 20, top: node.y + offsetY - 20 }}
                                >
                                    {node.el}
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            if (!question) return <div className="min-h-screen bg-[#0F172A] flex items-center justify-center text-slate-500 animate-pulse">Loading Question Bank...</div>;

            return (
                <div className="flex flex-col h-full container mx-auto px-4 py-6 max-w-2xl">
                    <div className="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-emerald-400 flex items-center gap-2">
                                <Icon name="FlaskConical" /> IUPAC Naming Drill
                            </h1>
                            <p className="text-slate-500 text-sm">Master Homologous Series</p>
                        </div>
                        <div className="text-right">
                            <div className="text-emerald-400 font-mono font-bold text-xl">Score: {score}</div>
                            <div className="text-xs text-slate-500">Streak: <span className="text-orange-400 font-bold">{streak} ðŸ”¥</span></div>
                        </div>
                    </div>

                    <div className="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700 mb-6 animate-in fade-in">
                        <div className="flex justify-between items-center mb-4">
                            <span className="text-xs font-bold bg-slate-700 text-slate-300 px-2 py-1 rounded border border-slate-600">Q{qIndex+1}</span>
                            <span className="text-xs font-bold text-emerald-400 uppercase tracking-wider">{question.series}</span>
                        </div>
                        
                        <MoleculeViewer data={question.structure} />
                        
                        <div className="mt-4 text-center">
                            <div className="text-xs text-slate-500 mb-1 uppercase font-bold">Molecular Formula</div>
                            <div className="font-mono text-lg text-white tracking-wider bg-slate-900/50 inline-block px-3 py-1 rounded border border-slate-600/50">
                                {question.formula}
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
                        {question.options.map((opt, i) => (
                            <button 
                                key={i} 
                                onClick={() => handleAnswer(opt)} 
                                disabled={feedback}
                                className={`p-4 rounded-xl font-bold text-left transition-all border-2 relative
                                    ${feedback 
                                        ? (opt === question.correct ? 'bg-green-900/40 border-green-500 text-green-300' : opt === feedback.selected ? 'bg-red-900/40 border-red-500 text-red-300' : 'bg-slate-800 border-slate-700 text-slate-500 opacity-50')
                                        : 'bg-slate-800 border-slate-700 text-slate-200 hover:border-emerald-500 hover:bg-slate-750 hover:shadow-md cursor-pointer active:scale-98'}
                                `}
                            >
                                {opt}
                            </button>
                        ))}
                    </div>

                    {feedback && (
                        <div className={`p-4 rounded-xl flex justify-between items-center animate-in slide-in-from-bottom-2 shadow-lg border
                            ${feedback.type === 'success' ? 'bg-green-900/30 border-green-500/50 text-green-300' : 'bg-red-900/30 border-red-500/50 text-red-300'}
                        `}>
                            <div className="font-bold flex items-center gap-3">
                                {feedback.type === 'success' ? <Icon name="CheckCircle" /> : <Icon name="XCircle" />}
                                <span>{feedback.msg}</span>
                            </div>
                            <button onClick={nextQ} className="px-6 py-2 bg-white text-slate-900 rounded-lg font-bold hover:bg-slate-200 transition-colors flex items-center gap-2 shadow-sm">
                                Next <Icon name="ArrowRight" size={16}/>
                            </button>
                        </div>
                    )}
                    
                    <div className="text-center text-slate-600 text-xs mt-auto pt-8">
                        Luminous Learner Science Tools | HKDSE Topic XI
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
